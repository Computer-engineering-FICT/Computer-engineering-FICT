
ASEM-51 V1.3                                         Copyright (c) 2002 by W.W. Heinz                                         PAGE 1





       MCS-51 Family Macro Assembler   A S E M - 5 1   V 1.3
       =====================================================



	Source File:	comparch2_lab5_uropb.asm
	Object File:	comparch2_lab5_uropb.hex
	List File:	comparch2_lab5_uropb.lst



 Line  I  Addr  Code            Source

    1:				;/*
    2:				; * Computer architecture
    3:				; * Lab5
    4:				; * Date: 10.12.12
    5:				; *
    6:				; * Task:
    7:				; *    F = X2/X1 + (X2 + X1)/2
    8:				; *    X1 - CF, X2 - TF, F - TF
    9:				; */
   10:
   11:					Convert_To_CF MACRO ADR
   12:					MOV A, ADR
   13:					CPL A
   14:					ADD A, #1
   15:					MOV ADR, A
   16:					ENDM
   17:
   18:					Convert_To_TF MACRO ADR
   19:						Convert_To_CF ADR
   20:					ENDM
   21:
   22:		N      0051		X2 		   EQU 81
   23:		N      0009		X1		   EQU 09
   24:
   25:		N      0028		Adr_F	   EQU 28h
   26:
   27:				; For addition
   28:		N      0027		Adr_Rez_Add 	EQU 27h
   29:				; For division
   30:		N      0030		Sign_div   		EQU 30h
   31:		N      0020		Adr_s_X1   		EQU 20h
   32:		N      0021		Adr_X1 	   		EQU 21h
   33:		N      0020		Adr_s_X2   		EQU 20h
   34:		N      0023		Adr_X2	   		EQU 23h
   35:		N      0024		Adr_s_Rez_Div  	EQU 24h
   36:		N      0025		Adr_Rez_Div    	EQU 25h
   37:
   38:				; Write to external memory
   39:	  0000	78 00			MOV R0, #0h
   40:	  0002	74 09			MOV A, #X1
   41:	  0004	F2			MOVX @R0, A
   42:	  0005	08			INC R0
   43:	  0006	74 51			MOV A, #X2

ASEM-51 V1.3                                         Copyright (c) 2002 by W.W. Heinz                                         PAGE 2



 Line  I  Addr  Code            Source

   44:	  0008	F2			MOVX @R0, A
   45:				; Read from external memory
   46:	  0009	78 00			MOV R0, #0h
   47:	  000B	E2			MOVX A, @R0
   48:	  000C	F5 21			MOV Adr_X1, A
   49:	  000E	08			INC R0
   50:	  000F	E2			MOVX A, @R0
   51:	  0010	F5 23			MOV Adr_X2, A
   52:
   53:	  0012	11 2D			ACALL Division
   54:	  0014	11 65		        ACALL Addition
   55:
   56:	  0016	E5 25		        MOV A, Adr_Rez_Div
   57:	  0018	25 27		        ADD A, Adr_Rez_Add
   58:	  001A	F5 28		        MOV Adr_F, A
   59:
   60:	  001C	78 10			MOV R0, #10h
   61:	  001E	E5 25			MOV A, Adr_Rez_Div
   62:	  0020	F2			MOVX @R0, A
   63:	  0021	08			INC R0
   64:	  0022	E5 27			MOV A, Adr_Rez_Add
   65:	  0024	F2			MOVX @R0, A
   66:	  0025	08			INC R0
   67:	  0026	E5 28			MOV A, Adr_F
   68:	  0028	F2			MOVX @R0, A
   69:	  0029	08			INC R0
   70:	  002A	02 00 A0		JMP Ended
   71:
   72:
   73:	  002D			Division:
   74:	  002D	C0 23			PUSH Adr_X2
   75:	  002F	C0 21			PUSH Adr_X1
   76:
   77:	  0031	30 1F 04		JNB 1Fh, X2_positive
   78:	  0034	D2 30			SETB Sign_div
   79:	  0036	C2 1F			CLR 1Fh
   80:	  0038			X2_positive:
   81:
   82:	  0038	30 0F 13		JNB 0Fh, X1_positive
   83:					Convert_to_TF Adr_X1
   84+ 1					Convert_To_CF Adr_X1
   85+ 2  003B	E5 21			MOV A, Adr_X1
   86+ 2  003D	F4			CPL A
   87+ 2  003E	24 01			ADD A, #1
   88+ 2  0040	F5 21			MOV Adr_X1, A
   89:	  0042	20 30 05		JB Sign_div, sign_plus
   90:	  0045	D2 30			SETB Sign_div
   91:	  0047	02 00 4C		JMP label10
   92:	  004A			sign_plus:
   93:	  004A	C2 30			CLR Sign_div
   94:	  004C			label10:
   95:	  004C	C2 0F			CLR 0Fh
   96:	  004E			X1_positive:
   97:
   98:	  004E	E5 23			MOV A, Adr_X2
   99:	  0050	85 21 F0		MOV B, Adr_X1

ASEM-51 V1.3                                         Copyright (c) 2002 by W.W. Heinz                                         PAGE 3



 Line  I  Addr  Code            Source

  100:	  0053	84			DIV AB
  101:	  0054	F5 25			MOV Adr_Rez_Div, A
  102:
  103:	  0056	D0 21			POP Adr_X1
  104:	  0058	D0 23			POP Adr_X2
  105:	  005A	30 30 07		JNB Sign_div, end_div
  106:					Convert_To_TF Adr_Rez_Div
  107+ 1					Convert_To_CF Adr_Rez_Div
  108+ 2  005D	E5 25			MOV A, Adr_Rez_Div
  109+ 2  005F	F4			CPL A
  110+ 2  0060	24 01			ADD A, #1
  111+ 2  0062	F5 25			MOV Adr_Rez_Div, A
  112:	  0064			end_div:
  113:	  0064	22			RET
  114:
  115:	  0065			Addition:
  116:	  0065	C0 23			PUSH Adr_X2
  117:	  0067	C0 21			PUSH Adr_X1
  118:	  0069	30 0F 02		JNB 0Fh, X1_positiv
  119:	  006C	C2 0F			CLR 0Fh
  120:	  006E			X1_positiv:
  121:	  006E	30 1F 09		JNB 1Fh, X2_positiv
  122:	  0071	C2 1F			CLR 1Fh
  123:					Convert_To_CF Adr_X2
  124+ 1  0073	E5 23			MOV A, Adr_X2
  125+ 1  0075	F4			CPL A
  126+ 1  0076	24 01			ADD A, #1
  127+ 1  0078	F5 23			MOV Adr_X2, A
  128:
  129:	  007A			X2_positiv:
  130:	  007A	C3			CLR C
  131:	  007B	E5 21			MOV A, Adr_X1
  132:	  007D	35 23			ADDC A, Adr_X2
  133:	  007F	F5 27			MOV Adr_Rez_Add, A
  134:
  135:	  0081	30 3F 09		JNB 3Fh, plus
  136:					Convert_To_CF Adr_Rez_Add
  137+ 1  0084	E5 27			MOV A, Adr_Rez_Add
  138+ 1  0086	F4			CPL A
  139+ 1  0087	24 01			ADD A, #1
  140+ 1  0089	F5 27			MOV Adr_Rez_Add, A
  141:	  008B	D2 D1			SETB PSW.1
  142:	  008D			plus:
  143:	  008D	C3			CLR C
  144:	  008E	13			RRC A
  145:	  008F	F5 27			MOV Adr_Rez_Add, A
  146:
  147:	  0091	30 D1 07		JNB PSW.1, end_add
  148:					Convert_To_CF Adr_Rez_Add
  149+ 1  0094	E5 27			MOV A, Adr_Rez_Add
  150+ 1  0096	F4			CPL A
  151+ 1  0097	24 01			ADD A, #1
  152+ 1  0099	F5 27			MOV Adr_Rez_Add, A
  153:	  009B			end_add:
  154:
  155:	  009B	D0 21			POP Adr_X1

ASEM-51 V1.3                                         Copyright (c) 2002 by W.W. Heinz                                         PAGE 4



 Line  I  Addr  Code            Source

  156:	  009D	D0 23			POP Adr_X2
  157:	  009F	22			RET
  158:
  159:	  00A0			Ended:
  160:	  00A0	00			NOP
  161:					END





                     register banks used:  ---

                     no errors




ASEM-51 V1.3                                         Copyright (c) 2002 by W.W. Heinz                                         PAGE 5





	       L I S T   O F   S Y M B O L S
	       =============================


SYMBOL				  TYPE     VALUE	LINE
------------------------------------------------------------
??ASEM_51			  NUMBER    8051
??VERSION			  NUMBER    0130
AC				  BIT	      D6
ACC				  DATA	      E0
ADDITION			  CODE	    0065	 115
ADR_F				  NUMBER    0028	  25
ADR_REZ_ADD			  NUMBER    0027	  28
ADR_REZ_DIV			  NUMBER    0025	  36
ADR_S_REZ_DIV			  NUMBER    0024	  35
ADR_S_X1			  NUMBER    0020	  31
ADR_S_X2			  NUMBER    0020	  33
ADR_X1				  NUMBER    0021	  32
ADR_X2				  NUMBER    0023	  34
B				  DATA	      F0
CONVERT_TO_CF			  MACRO	        	  11
CONVERT_TO_TF			  MACRO	        	  18
CY				  BIT	      D7
DIVISION			  CODE	    002D	  73
DPH				  DATA	      83
DPL				  DATA	      82
EA				  BIT	      AF
ENDED				  CODE	    00A0	 159
END_ADD				  CODE	    009B	 153
END_DIV				  CODE	    0064	 112
ES				  BIT	      AC
ET0				  BIT	      A9
ET1				  BIT	      AB
EX0				  BIT	      A8
EX1				  BIT	      AA
EXTI0				  CODE	    0003
EXTI1				  CODE	    0013
F0				  BIT	      D5
IE				  DATA	      A8
IE0				  BIT	      89
IE1				  BIT	      8B
INT0				  BIT	      B2
INT1				  BIT	      B3
IP				  DATA	      B8
IT0				  BIT	      88
IT1				  BIT	      8A
LABEL10				  CODE	    004C	  94
OV				  BIT	      D2
P				  BIT	      D0
P0				  DATA	      80
P1				  DATA	      90
P2				  DATA	      A0
P3				  DATA	      B0
PCON				  DATA	      87
PLUS				  CODE	    008D	 142
PS				  BIT	      BC

ASEM-51 V1.3                                         Copyright (c) 2002 by W.W. Heinz                                         PAGE 6



SYMBOL				  TYPE     VALUE	LINE
------------------------------------------------------------
PSW				  DATA	      D0
PT0				  BIT	      B9
PT1				  BIT	      BB
PX0				  BIT	      B8
PX1				  BIT	      BA
RB8				  BIT	      9A
RD				  BIT	      B7
REN				  BIT	      9C
RESET				  CODE	    0000
RI				  BIT	      98
RS0				  BIT	      D3
RS1				  BIT	      D4
RXD				  BIT	      B0
SBUF				  DATA	      99
SCON				  DATA	      98
SIGN_DIV			  NUMBER    0030	  30
SIGN_PLUS			  CODE	    004A	  92
SINT				  CODE	    0023
SM0				  BIT	      9F
SM1				  BIT	      9E
SM2				  BIT	      9D
SP				  DATA	      81
T0				  BIT	      B4
T1				  BIT	      B5
TB8				  BIT	      9B
TCON				  DATA	      88
TF0				  BIT	      8D
TF1				  BIT	      8F
TH0				  DATA	      8C
TH1				  DATA	      8D
TI				  BIT	      99
TIMER0				  CODE	    000B
TIMER1				  CODE	    001B
TL0				  DATA	      8A
TL1				  DATA	      8B
TMOD				  DATA	      89
TR0				  BIT	      8C
TR1				  BIT	      8E
TXD				  BIT	      B1
WR				  BIT	      B6
X1				  NUMBER    0009	  23
X1_POSITIV			  CODE	    006E	 120
X1_POSITIVE			  CODE	    004E	  96
X2				  NUMBER    0051	  22
X2_POSITIV			  CODE	    007A	 129
X2_POSITIVE			  CODE	    0038	  80

<html>

<head>
<meta http-equiv="Content-Type"
content="text/html; charset=windows-1251">
<meta name="Template"
content="C:\PROGRAM FILES\MICROSOFT OFFICE\OFFICE\html.dot">
<meta name="GENERATOR" content="Microsoft FrontPage Express 2.0">
<title>Доступ к внешней памяти</title>
</head>

<body background="fill_mk51.jpg" tppabs="http://ofap.ulstu.ru/res/REFER_BOOK_MK48&MK51/images/fill_mk51.jpg" link="#0000FF"
vlink="#800080">

<p><a name="Доступ к внешней памяти"></a><font
color="#000000" size="5"><strong>5. Доступ к
внешней памяти</strong></font></p>

<hr size="4" color="#000000">

<p align="left"><font size="4" face="Times New Roman">В
микроконтроллерных системах,
построенных на основе МК51, возможно
использование двух типов внешней
памяти: постоянной памяти программ
(ВПП) и оперативной памяти данных
(ВПД). Доступ к ВПП осуществляется
при помощи управляющего сигнала </font><font
size="5"><sup><b>¬</b></sup></font><font size="4"
face="Times New Roman">РВПП, который
выполняет функцию строб-сигнала
чтения. Доступ к ВПД обеспечивается
управляющими сигналами </font><font size="5"><sup><b>¬</b></sup></font><font
size="4" face="Times New Roman">ЧТ и </font><font size="5"><sup><b>¬</b></sup></font><font
size="4" face="Times New Roman">ЗП, которые
формируются в линиях Р3.7 и Р3.6 при
выполнении портом 3 альтернативных
функций (см. </font><a
href="inputoutputports_mk51.htm#табл.8.1" tppabs="http://ofap.ulstu.ru/res/REFER_BOOK_MK48&MK51/mk51/inputoutputports_mk51.htm#табл.8.1"><font
color="#FF0000" size="4">табл. 8.1</font></a><font size="4"
face="Times New Roman">).</font></p>

<p align="left"><font size="4" face="Times New Roman">При
обращении к ВПП всегда
используется 16-битный адрес. Доступ
к ВПД возможен с использованием
16-битного адреса (MOVX A, @DPTR) или
8-битного адреса (MOVX A, @Ri).</font></p>

<p align="left"><font size="4" face="Times New Roman">В
любых случаях использования
16-битного адреса старший байт
адреса фиксируется (и сохраняется
неизменным в течение одного цикла
записи или чтения) в
регистре-защелке порта 2.</font></p>

<p align="left"><font size="4" face="Times New Roman">Если
очередной цикл внешней памяти (MOVX A,
@DPTR) следует не сразу же за
предыдущим циклом внешней памяти,
то неизменяемое содержимое
регистра-защелки порта 2
восстанавливается в следующем
цикле. Если используется 8-битный
адрес (MOVX A, @Ri), то содержимое
регистра-защелки порта 2 остается
неизменным на его внешних выводах в
течение всего цикла внешней памяти.</font></p>

<p align="left"><font size="4" face="Times New Roman">Через
порт 0 в режиме временного
мультиплексирования
осуществляется выдача младшего
байта адреса и передача байта
данных. Сигнал САВП должен быть
использован для записи байта
адреса во внешний регистр. Затем в
цикле записи выводимый байт данных
появляется на внешних выводах
порта 0 только перед появлением
сигнала </font><font size="5"><sup><b>¬</b></sup></font><font
size="4" face="Times New Roman">ЗП. В цикле чтения
вводимый байт данных принимается в
порт 0 по фронту стробирующего
сигнала </font><font size="5"><sup><b>¬</b></sup></font><font
size="4" face="Times New Roman">ЧТ.</font></p>

<p align="left"><font size="4" face="Times New Roman">При
любом обращении к внешней памяти
устройство управления MK51 загружает
в регистр-защелку порта 0 код 0FFH,
стирая тем самым информацию,
которая могла в нем храниться.</font></p>

<p align="left"><font size="4" face="Times New Roman">Доступ
к ВПП возможен при выполнении двух
условий: либо на вход отключения
резидентной памяти программ ( </font><font
size="5"><sup><b>¬</b></sup></font><font size="4"
face="Times New Roman">ОРПП) подается
активный сигнал, либо содержимое
счетчика команд превышает значение
0FFFH. Наличие сигнала </font><font size="5"><sup><b>¬</b></sup></font><font
size="4" face="Times New Roman">ОРПП необходимо
для обеспечения доступа к младшим
4К адресам адресного пространства
ВПП при использовании МК31
(микроконтроллера без резидентной
памяти программ). </font></p>

<p align="left"><font size="4" face="Times New Roman">Временные
диаграммы на </font><a href="#рис.3.6"><font
color="#FF0000" size="4">рис. 3.6</font></a><font size="4"
face="Times New Roman"> иллюстрируют процесс
генерации управляющих сигналов
САВП и РВПП при обращении к внешней
памяти.</font></p>

<p align="center"><a name="рис.3.6"></a></p>

<p align="center"><img src="extmem_3_6.gif" tppabs="http://ofap.ulstu.ru/res/REFER_BOOK_MK48&MK51/images/extmem_3_6.gif" border="2"
width="480" height="455"></p>

<p align="center"><font size="4" face="Times New Roman"><b>рис.
</b></font><font size="4"><b>3</b></font><font size="4"
face="Times New Roman"><b>.</b></font><font size="4"><b>6</b></font><font
size="4" face="Times New Roman"><b>. Временные
диаграммы операций с обращением к
внешней памяти</b></font></p>

<p align="left"><font size="4" face="Times New Roman">Основная
функция сигнала САВП – обеспечить
временное согласование передачи из
порта 0 на внешний регистр младшего
байта адреса в цикле чтения из ВПП.
Сигнал САВП приобретает значение 1
дважды в каждом машинном цикле. Это
происходит даже тогда, когда в
цикле выборки нет обращения к ВПП.
Доступ к ВПД возможен только в том
случае, если сигнал САВП
отсутствует. Первый сигнал САВП во
втором машинном цикле команды MOVX
блокируется. Следовательно, в любой
МК-системе, не использующей ВПД,
сигнал САВП генерируется с
постоянной частотой, равной 1/</font><font
size="4">1</font><font size="4" face="Times New Roman">6
частоты резонатора, и может быть
использован для синхронизации
внешних устройств или для
реализации различных временных
функций.</font></p>

<p align="left"><font size="4" face="Times New Roman">При
обращении к РПП сигнал РВПП не
генерируется, а при обращении к ВПП
он выполняет функцию строб-сигнала
чтения. Полный цикл чтения ВПД,
включая установку и снятие сигнала
ЧТ, занимает 12 периодов резонатора.</font></p>

<p align="left"><font size="4" face="Times New Roman">Временные
диаграммы на </font><a href="#рис.3.7"><font
color="#FF0000" size="4">рис. 3.7</font></a><font size="4"
face="Times New Roman"> и </font><a href="#рис.3.8"><font
color="#FF0000" size="4">рис. 3.8</font></a><font size="4"
face="Times New Roman"> иллюстрируют процесс
выборки команды из ВПП и работу с
ВПД в режимах чтения и записи
соответственно.</font></p>

<p align="center"><a name="рис.3.7"></a></p>

<p align="center"><img src="timediag_3_7.gif" tppabs="http://ofap.ulstu.ru/res/REFER_BOOK_MK48&MK51/images/timediag_3_7.gif"
border="2" width="533" height="340"></p>

<p align="center"><font size="4" face="Times New Roman"><b>Рис.
</b></font><font size="4"><b>3</b></font><font size="4"
face="Times New Roman"><b>.</b></font><font size="4"><b>7</b></font><font
size="4" face="Times New Roman"><b>. Временная
диаграмма выборки команды из ВПП</b></font></p>

<p align="center"><a name="рис.3.8"></a></p>

<p align="center"><img src="timediag_3_8.gif" tppabs="http://ofap.ulstu.ru/res/REFER_BOOK_MK48&MK51/images/timediag_3_8.gif"
border="2" width="549" height="435"></p>

<p align="center"><font size="4" face="Times New Roman"><b>Рис.
</b></font><font size="4"><b>3</b></font><font size="4"
face="Times New Roman"><b>.</b></font><font size="4"><b>8</b></font><font
size="4" face="Times New Roman"><b>. Временная
диаграмма работы с ВДП</b></font></p>

<p align="center">&nbsp;</p>

<p align="left"><font size="4" face="Times New Roman"><b>Особый
режим работы МК51.</b> Содержимое
памяти программ МК51 заполняется
единожды на этапе разработки
МК-системы и не может быть
модифицировано в завершенном
(конечном) изделии. По этой причине
микроконтроллеры не являются
машинами классической
&quot;фон-неймановской&quot;
архитектуры. Оперативная память
данных (резидентная или внешняя) не
может быть использована для
хранения кодов программы, так как в
МК выборка команд производится
только из области адресов памяти
программ. Эта особенность
архитектуры МК объясняется тем, что
в большинстве применений МК
требуется наличие одной
неизменяемой прикладной программы,
хранимой в ПЗУ, наличие ОЗУ
небольшой емкости для временного
хранения переменных и эффективных,
а следовательно, разных методов
адресации памяти программ и памяти
данных.</font></p>

<p align="left"><font size="4" face="Times New Roman">Однако
на этапе разработки и отладки
прикладных программ машина
&quot;фон-неймановского&quot; типа
оказывается очень удобной, так как
позволяет разработчику оперативно
изменять коды прикладной
программы, размещаемой в ОЗУ. С этой
целью МК-система может быть
модифицирована для совмещения
адресного пространства ВПП и ВПД
путем подключения внешней логики,
как показано на </font><a href="#рис.3.9"><font
color="#FF0000" size="4">рис. 3.9</font></a><font size="4"
face="Times New Roman">.</font></p>

<p align="center"><a name="рис.3.9"></a></p>

<p align="center"><img src="shema_3_9.gif" tppabs="http://ofap.ulstu.ru/res/REFER_BOOK_MK48&MK51/images/shema_3_9.gif" border="2"
width="300" height="167"></p>

<p align="center"><font size="4" face="Times New Roman"><b>Рис.
</b></font><font size="4"><b>3</b></font><font size="4"
face="Times New Roman"><b>.</b></font><font size="4"><b>9</b></font><font
size="4" face="Times New Roman"><b>. Схема
совмещения адресного пространства
ВПП и ВПД</b></font></p>

<p align="left"><font size="4" face="Times New Roman">Здесь
на выходе схемы И формируется
строб-сигнал чтения, который может
быть использован для объединения
памяти программ и памяти данных во
внешнем ОЗУ. При этом необходимо
учитывать, что в МК51 на схемном
уровне реализуются пять различных
и независимых механизмов адресации
для доступа к ПРР, РПД, ВПП, ВПД и
блоку регистров специальных
функций. Вследствие этого
перемещаемая версия прикладной
программы, которая отлаживается в
среде внешней памяти
программ/данных, будет отличаться
от загружаемой в РП (окончательной)
версии программы.</font></p>

<p align="left"><font size="4" face="Times New Roman">Подобный
способ организации управления
внешней памятью может быть
использован в тех применениях МК51,
где требуется оперативная
перезагрузка или модификация
прикладных программ (с помощью УВВ),
как в ЭВМ классической архитектуры.</font></p>

<p>&nbsp;</p>

<p><a href="#доступ к внешней памяти"><font
color="#0000FF" size="4">Доступ к внешней
памяти</font></a></p>

<hr size="4" color="#008000">
<div align="center"><center>

<table border="0" cellpadding="20" cellspacing="0">
    <tr>
        <td><a href="start_mk48.htm" tppabs="http://ofap.ulstu.ru/res/REFER_BOOK_MK48&MK51/mk48/start_mk48.htm"><font
        color="#0000FF" size="4" face="Times New Roman"><b><tt><u>КМ1816ВЕ48</u></tt></b></font></a></td>
        <td><a href="start_mk51.htm" tppabs="http://ofap.ulstu.ru/res/REFER_BOOK_MK48&MK51/mk51/start_mk51.htm"><font color="#0000FF"
        size="4" face="Times New Roman"><b><tt><u>КМ1816ВЕ51</u></tt></b></font></a></td>
        <td><a href="start.htm" tppabs="http://ofap.ulstu.ru/res/REFER_BOOK_MK48&MK51/start.htm"><font color="#0000FF" size="4">Первая
        страница</font></a></td>
    </tr>
</table>
</center></div>
</body>
</html>

<html>

<head>
<meta http-equiv="Content-Type"
content="text/html; charset=windows-1251">
<meta name="Template"
content="C:\PROGRAM FILES\MICROSOFT OFFICE\OFFICE\html.dot">
<meta name="GENERATOR" content="Microsoft FrontPage Express 2.0">
<title>Особые режимы работы</title>
</head>

<body background="fill_mk51.jpg" tppabs="http://ofap.ulstu.ru/res/REFER_BOOK_MK48&MK51/images/fill_mk51.jpg" link="#0000FF"
vlink="#800080">

<p><a name="Особые_режимы_работы_МК51"></a><font
color="#000000" size="5"><strong>9. Особые режимы
работы МК51</strong></font></p>

<ul>
    <li><a
        href="#режим_загрузки_и_верификации_прикладных_"><font
        color="#0000FF" size="4">9.1. Режим загрузки
        и верификации прикладных
        программ</font></a><font color="#0000FF"> </font></li>
    <li><a
        href="#работа_мк51_в_пошаговом_режиме"><font
        color="#0000FF" size="4">9.2. Работа MK51 в
        пошаговом режиме</font></a><font
        color="#0000FF"> </font></li>
    <li><a
        href="#сброс, режим холостого хода и режим пониженного энергопотребления"><font
        color="#0000FF" size="4">9.3. Сброс, режим
        холостого хода и режим
        пониженного энергопотребления</font></a><font
        color="#0000FF"> </font></li>
</ul>

<hr size="4" color="#000000">

<p><a
name="Режим_загрузки_и_верификации_прикладных_"></a><font
color="#000000" size="5"><strong>9.1. Режим загрузки
и верификации прикладных программ</strong></font></p>

<hr color="#008000">

<p align="left"><font size="4" face="Times New Roman">Под
воздействием внешних
электрических сигналов МК51 может
быть электрически
запрограммирован или, иными
словами, в РПП микроконтроллера
могут быть загружены объектные
коды прикладной программы.
Содержимое РПП микроконтроллера
может быть уничтожено выдержкой
под ультрафиолетовым источником
света (стирание) для последующего
перепрограммирования.
Микроконтроллер имеет средство
защиты от программного
&quot;разбоя&quot;, обеспечивающее
невозможность прочтения
содержимого РПП в конечном изделии
и, следовательно, сохранение
профессиональных секретов
разработчика прикладного
программного обеспечения.</font></p>

<p align="left"><font size="4" face="Times New Roman"><b>Загрузка
программ в РПП.</b> В режиме
программирования МК51 должен
работать на пониженной частоте (с
резонатором 4-6 МГц) из-за
необходимости мультиплексирования
на внутренней шине адресной и
кодовой информации. На </font><a
href="#рис.3.14"><font color="#FF0000" size="4">рис. 3.14</font></a><font
size="4" face="Times New Roman"> приведена схема
подключения МК51 к программатору. </font></p>

<p align="center"><a name="рис.3.14"></a></p>

<p align="center"><img src="program_3_14.gif" tppabs="http://ofap.ulstu.ru/res/REFER_BOOK_MK48&MK51/images/program_3_14.gif"
border="2" width="270" height="290"></p>

<p align="center"><font size="4" face="Times New Roman"><b>Рис.
</b></font><font size="4"><b>3</b></font><font size="4"
face="Times New Roman"><b>.1</b></font><font size="4"><b>4</b></font><font
size="4" face="Times New Roman"><b>.
Программирование МК51 (загрузка в
РПП микроконтроллера)</b></font></p>

<p align="left"><font size="4" face="Times New Roman">Адрес
ячейки РПП, в которую должен быть
загружен байт прикладной
программы, подается на выводы порта
1 и выводы P2.0-Р2.3 порта 2. При этом
загружаемый байт поступает в МК
через порт 0. Выводы Р2.4-Р2.6 и </font><font
size="5"><sup><b>¬</b></sup></font><font size="4"
face="Times New Roman">PSEN должны быть
заземлены, а на выводы Р2.7 и RST
необходимо подать уровень
логической 1 (для входа RST уровень
логической 1 – не менее 2.5 В, для
остальных входов – стандартный
уровень ТТЛ). На входе </font><font size="5"><sup><b>¬</b></sup></font><font
size="4" face="Times New Roman">EA/VPP
поддерживается уровень +5 В, но в
момент загрузки байта он должен
быть подключен к источнику
напряжения с уровнем +21 В. В это
время уровень на входе ALE/ </font><font
size="5"><sup><b>¬</b></sup></font><font size="4"
face="Times New Roman">PROG должен быть не менее
чем на 50 мс сброшен в 0. После этого
напряжение на входе </font><font size="5"><sup><b>¬</b></sup></font><font
size="4" face="Times New Roman">EA/VPP возвращается
к уровню +5 В. Источник напряжения +21
В (VPP) должен быть очень хорошо
стабилизирован, так как превышение
предельного значения +21.5 В на входе </font><font
size="5"><sup><b>¬</b></sup></font><font size="4"
face="Times New Roman">EA/VPP приводит к
необратимым повреждениям РПП. </font></p>

<p align="left"><font size="4" face="Times New Roman"><b>Запись
бита защиты.</b> Бит защиты РПП,
будучи установлен, запрещает
доступ к РПП любыми внешними
средствами. Схема записи бита
защиты показана на </font><a href="#рис.3.15"><font
color="#FF0000" size="4">рис. 3.15</font></a><font size="4"
face="Times New Roman">.</font></p>

<p align="center"><a name="рис.3.15"></a></p>

<p align="center"><img src="writeprot_3_15.gif" tppabs="http://ofap.ulstu.ru/res/REFER_BOOK_MK48&MK51/images/writeprot_3_15.gif"
border="2" width="240" height="270"></p>

<p align="center"><font size="4" face="Times New Roman"><b>Рис.
3.</b></font><font size="4"><b>15</b></font><font size="4"
face="Times New Roman"><b>. Запись бита защиты
РПП</b></font></p>

<p align="left"><font size="4" face="Times New Roman">Процедура
записи бита защиты такая же, как и
при загрузке программ в РПП, но на
вывод P2.6 должен подаваться уровень
1. Сигналы на выводах портов P0, P1 и
P2.0-P2.3 могут быть в любом состоянии.
Однажды установленный бит защиты
можно сбросит только путем полного
стирания РПП под источником
УФ-излучения. </font></p>

<p align="left"><font size="4" face="Times New Roman"><b>Верификация
программ.</b> Если бит защиты не
запрограммирован, то содержимое
РПП может быть прочитано с целью
проверки правильности загрузки
прикладной программы либо по ходу
программирования либо после
окончания программирования МК51.</font><font
size="4"> </font><font size="4" face="Times New Roman">Доступ
к ячейкам РПП (</font><a href="#рис.3.16"><font
color="#FF0000" size="4">рис. 3.16</font></a><font size="4"
face="Times New Roman">) осуществляется так
же, как и при программировании РПП
за исключением того, что на вывод P2.7
подается сигнал 0, используемы в
качестве строб-сигнала чтения.
Считанные коды команд и
соответствующие им адреса РПП
могут отображаться для визуального
контроля на любом внешнем
индикаторе и, кроме того, могут быть
переданы в ОЗУ инструментальной
ЭВМ для дизассемблирования.</font></p>

<p align="center"><a name="рис.3.16"></a></p>

<p align="center"><img src="verify_3_16.gif" tppabs="http://ofap.ulstu.ru/res/REFER_BOOK_MK48&MK51/images/verify_3_16.gif" border="2"
width="250" height="289"></p>

<p align="center"><font size="4" face="Times New Roman"><b>Рис.
3.</b></font><font size="4"><b>16</b></font><font size="4"
face="Times New Roman"><b>. Верификация
программ (проверка содержимого РПП)</b></font></p>

<p align="center">&nbsp;</p>

<p>&nbsp;</p>

<p align="left"><font size="4" face="Times New Roman"><b>Стирание
РПП.</b> Для стирания содержимого РПП
микроконтролер следует поместить
под источник УФ-излучения с длиной
волны менее 4*10</font><font size="4"><sup>-7</sup></font><font
size="4" face="Times New Roman"> м. Если кварцевая
лампа имеет световую мощность 12000
мкВт/см</font><font size="4"><sup>2</sup></font><font
size="4" face="Times New Roman">, а расстояние
между источником света и МК равно 2-3
см, то выдержка 20-30 мин обеспечивает
световую дозу, достаточную для
надежного стирания РПП. После
стирания в матрице РПП содержатся
все единицы. </font></p>

<p align="left"><font size="4" face="Times New Roman">Так
как в спектре солнечного света и
люминесцентного освещения
содержится излучение с длиной
волны менее 4*10</font><font size="4"><sup>-7</sup></font><font
size="4" face="Times New Roman"> м, то пребывание
МК под воздействием этих
источников света дольше
установленного предела (около
одной недели на солнечном свете или
около трех лет при люминесцентном
освещении) может привести к
искажению содержимого РПП. Для
защиты содержимого РПП от
разрушения под воздействием света
на окне корпуса МК укрепляют
светонепроницаемый экран. </font></p>

<p>&nbsp;</p>

<p>&nbsp;</p>

<p><a href="#особые_режимы_работы_мк51"><font
color="#0000FF" size="4">Особые режимы работы
МК51</font></a></p>

<hr color="#008000">

<p><a
name="Работа_МК51_в_пошаговом_режиме"></a><font
color="#000000" size="5"><strong>9.2. Работа MK51 в
пошаговом режиме</strong></font></p>

<hr color="#008000">

<p align="left"><font size="4" face="Times New Roman">На
этапе отладки прикладной программы
в прототипе МК-системы очень
удобным для разработчика
оказывается режим пошагового
(покомандного) исполнения
программы. Система прерываний МК51
позволяет реализовать этот режим
работы путем использования
нескольких дополнительных команд.
Как было описано в разделе </font><a
href="interruptsystem_mk51.htm" tppabs="http://ofap.ulstu.ru/res/REFER_BOOK_MK48&MK51/mk51/interruptsystem_mk51.htm"><font color="#0000FF" size="4">Система
прерываний</font></a><font size="4"
face="Times New Roman">, внешний запрос
прерывания не будет обслужен до тех
пор, пока обслуживается прерывание
с равным приоритетом. Этот запрос
будет воспринят лишь после того,
как одна команда после команды RETI
будет выполнена. Иными словами,
однажды вызвав подпрограмму
обслуживания прерывания, вызвать
ее вновь невозможно до тех пор, пока
хотя бы одна команда основной
программы не будет исполнена.
Использовать это свойство системы
прерываний МК51 для реализации
пошагового режима можно следующим
образом: одно из внешних
прерываний, например </font><font size="5"><sup><b>¬</b></sup></font><font
size="4" face="Times New Roman">INT0 (вывод Р3.2
микроконтроллера),
запрограммировать для
представления запроса уровнем
сигнала (IT = 0), а подпрограмма
обслуживания этого прерывания
должна заканчиваться
последовательностью команд:</font></p>

<table border="0" cellpadding="0" cellspacing="0" width="649">
    <tr>
        <td valign="top" width="13%" height="11"><font
        color="#0080C0" size="4"><strong>JNB</strong></font></td>
        <td valign="top" width="17%" height="11"><font
        color="#0080C0" size="4"><strong>P3.2, $</strong></font></td>
        <td valign="top" width="69%" height="11"><font
        color="#FF00FF" size="4"><em>; Ожидание
        уровня 1 на входе INT0</em></font></td>
    </tr>
    <tr>
        <td valign="top" width="13%" height="11"><font
        color="#0080C0" size="4"><strong>JB</strong></font></td>
        <td valign="top" width="17%" height="11"><font
        color="#0080C0" size="4"><strong>P3.2, $</strong></font></td>
        <td valign="top" width="69%" height="11"><font
        color="#FF00FF" size="4"><em>; Ожидание
        уровня 0 на входе INT1 </em></font></td>
    </tr>
    <tr>
        <td valign="top" width="13%" height="11"><font
        color="#0080C0" size="4"><strong>RETI</strong></font></td>
        <td valign="top" width="17%" height="11">&nbsp;</td>
        <td valign="top" width="69%" height="11"><font
        color="#FF00FF" size="4"><em>; Возврат и
        выполнение одной команды</em></font></td>
    </tr>
</table>

<p>&nbsp;</p>

<p><font size="4" face="Times New Roman">Здесь
символом $ обозначено текущее
содержимое счетчика команд. Теперь
если на вывод </font><font size="5"><sup><b>¬</b></sup></font><font
size="4" face="Times New Roman">INT0 подавать
сигнал от клавиши ШАГ отладочного
модуля системы, то МК51 по сигналу </font><font
size="5"><sup><b>¬</b></sup></font><font size="4"
face="Times New Roman">INT0 = 0 вызовет
подпрограмму обслуживания
внешнего прерывания 0 и будет в ней
находиться до тех пор, пока не
обнаружит на входе </font><font size="5"><sup><b>¬</b></sup></font><font
size="4" face="Times New Roman">INTO новый импульс
(переход из 0 в 1 и снова в 0). По
команде RETI произойдет возврат в
основную программу, выполнение в
ней одной команды и немедленный
вызов подпрограммы обслуживания
внешнего прерывания 0.</font></p>

<p>&nbsp;</p>

<p>&nbsp;</p>

<p><a href="#особые_режимы_работы_мк51"><font
color="#0000FF" size="4">Особые режимы работы
МК51</font></a></p>

<hr color="#008000">

<p align="left"><a
name="Сброс, режим холостого хода и режим пониженного энергопотребления"></a><font
color="#000000" size="5"><strong>9.3. Сброс, режим
холостого хода и режим пониженного
энергопотребления</strong></font></p>

<hr color="#008000">

<p align="left"><font size="4" face="Times New Roman"><b>Сброс.</b>
В отличие от МК48 сброс МК51
осуществляется путем подачи на
вход СБР (RST) сигнала 1. Для
уверенного сброса МК51 этот сигнал 1
должен быть удержан на входе СБР по
меньшей мере в течение двух
машинных циклов (24 периода
резонатора). Квазидвунаправленые
буферные схемы внешних выводов ALE и </font><font
size="5"><sup><b>¬</b></sup></font><font size="4"
face="Times New Roman">PSEN находятся при этом в
режиме ввода. Под воздействием
сигнала СБР сбрасывается
содержимое регистров: PC, АСС, В, PSW,
DPTR, TMOD, TCON, Т/C0, T/C1, IE, IP и SCON, в
регистре PCON сбрасывается только
старший бит, в peгистр-указатель
стека загружается код 07Н, а в порты
Р0-Р3 – коды 0FFH. Состояние регистра
SBUF неопределенное. Сигнал СБР не
воздействует на содержимое ячеек
РПД. Когда включается
электропитание (VCC), содержимое РПД
неопределенно, за исключением
операции возврата из режима
пониженного энергопотребления.</font></p>

<p align="left"><font size="4" face="Times New Roman">На </font><a
href="#рис.3.17&amp;3.18"><font color="#FF0000" size="4">рис.
3.17</font></a><font size="4" face="Times New Roman">
показана схема автоматического
формирования сигнала СБР при
включении электропитания. Время,
необходимое для полного заряда
емкости, обеспечивает уверенный
запуск резонатора и его работу в
течение более чем двух машинных
циклов.</font></p>

<p align="center"><a name="рис.3.17&amp;3.18"></a></p>

<p align="center"><img src="shema_res_3_17&18.gif" tppabs="http://ofap.ulstu.ru/res/REFER_BOOK_MK48&MK51/images/shema_res_3_17&18.gif"
border="2" width="450" height="200"></p>

<p>&nbsp;</p>

<p align="left"><font size="4" face="Times New Roman"><b>Режим
холостого хода.</b> Любая команда, по
которой установится управляющий
бит IDL (PCON.0) в регистре управления
мощностью, переведет МК51 в режим
холостого хода. При этом продолжает
работу внутренний генератор
синхросигналов (</font><a
href="#рис.3.17&amp;3.18"><font color="#FF0000" size="4">рис.
3.18</font></a><font size="4" face="Times New Roman">). Все
регистры сохраняют свое значение.
На выводах всех портов
удерживается то логическое
состояние, которое на них было в
момент перехода в режим холостого
хода. На выводах ALE и </font><font size="5"><sup><b>¬</b></sup></font><font
size="4" face="Times New Roman">PSEN формируется
уровень 1. </font></p>

<p align="left"><font size="4" face="Times New Roman">Выйти
из режима холостого хода можно или
по сигналу СБР, или по прерыванию.
Любой из разрешенных сигналов
прерывания приведет к
аппаратурному сбросу бита PCON.0 и
прекратит тем самым режим
холостого хода. После исполнения
команды RETI (выход из подпрограммы
обслуживания прерывания) будет
исполнена команда, которая следует
в программе за командой, переведшей
МК51 в режим холостого хода. (В
некоторых модификациях МК51 этот
режим может отсутствовать.)</font></p>

<p align="left"><font size="4" face="Times New Roman"><b>Режим
пониженного энергопотребления.</b> В
тех применениях МК-систем, где
потребление электроэнергии, а
следовательно, габаритные размеры
и масса источника электропитания
являются одними из основных
показателей качества изделия,
возможно использование МК51 в
режиме пониженного
энергопотребления. Перевод МК51 в
этот режим возможен по команде,
которая установит бит PCON.1 в
регистре управления мощностью (см. </font><a
href="followinterface_mk51.htm#табл.11.2" tppabs="http://ofap.ulstu.ru/res/REFER_BOOK_MK48&MK51/mk51/followinterface_mk51.htm#табл.11.2"><font
color="#FF0000" size="4">табл. 11.2</font></a><font size="4"
face="Times New Roman">). В этом режиме
останавливается генератор
синхросигналов, содержимое РПД и
регистров специальных функций
сохраняется, а на выходных
контактах портов удерживаются
значения, соответствующие
содержимому их буферных регистров.
Выходы сигналов ALE и </font><font size="5"><sup><b>¬</b></sup></font><font
size="4" face="Times New Roman">PSEN сбрасываются.
При этом электропитание
осуществляется через вывод RST/VPD. </font></p>

<p align="left"><font size="4" face="Times New Roman">В
режиме пониженного
энергопотребления напряжение
электропитания (VCC) может быть
отключено. Перед выходом из режима
оно должно быть восстановлено до
номинального значения.</font></p>

<p align="left"><font size="4" face="Times New Roman">Выход
из режима пониженного
энергопотребления возможен только
по сигналу RST. При этом
переопределяются все регистры
специальных</font><font size="4"> </font><font
size="4" face="Times New Roman">функций, но
содержимое РПД не изменяется. (В
некоторых модификациях МК51 этот
режим может отсутствовать.)</font></p>

<p align="left">&nbsp;</p>

<p align="left"><font size="4"><strong>Защита от
падения напряжения.</strong></font><font
size="4" face="Times New Roman"> При не мгновенных
отказах блока электропитания
МК-системы можно обеспечить
сохранность содержимого РПД с
помощью маломощного (батарейного)
аварийного источника
электропитания, подсоединяемого к
выводу RST/VPD. Для этого МК при
получении сообщения о грозящем
падении напряжения VCC (прерывание
от системы контроля
электропитания) должен перегрузить
в РПД основные параметры
прерванного процесса и выдать
сигнал, разрешающий подключение к
выводу RST/VPD аварийного источника
питания. Все эти процедуры МК
должен успеть выполнить до того,
как напряжение основного источника
электропитания упадет ниже
рабочего предела. После
восстановления номинального
значения напряжения в основной
цепи электропитания выполняется
системный сброс, и источник
аварийного электропитания может
быть отключен.</font></p>

<p>&nbsp;</p>

<p>&nbsp;</p>

<p><a href="#особые_режимы_работы_мк51"><font
color="#0000FF" size="4">Особые режимы работы
МК51</font></a></p>

<hr size="4" color="#008000">
<div align="center"><center>

<table border="0" cellpadding="20" cellspacing="0">
    <tr>
        <td><a href="start_mk48.htm" tppabs="http://ofap.ulstu.ru/res/REFER_BOOK_MK48&MK51/mk48/start_mk48.htm"><font
        color="#0000FF" size="4" face="Times New Roman"><b><tt><u>КМ1816ВЕ48</u></tt></b></font></a></td>
        <td><a href="start_mk51.htm" tppabs="http://ofap.ulstu.ru/res/REFER_BOOK_MK48&MK51/mk51/start_mk51.htm"><font color="#0000FF"
        size="4" face="Times New Roman"><b><tt><u>КМ1816ВЕ51</u></tt></b></font></a></td>
        <td><a href="start.htm" tppabs="http://ofap.ulstu.ru/res/REFER_BOOK_MK48&MK51/start.htm"><font color="#0000FF" size="4">Первая
        страница</font></a></td>
    </tr>
</table>
</center></div>
</body>
</html>

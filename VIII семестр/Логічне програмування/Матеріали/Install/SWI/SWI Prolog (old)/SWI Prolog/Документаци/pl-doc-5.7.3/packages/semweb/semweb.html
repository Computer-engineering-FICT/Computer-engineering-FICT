<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">

<HTML>
<HEAD>
<TITLE>SWI-Prolog Semantic Web Library</TITLE><STYLE type="text/css">
/* Style sheet for SWI-Prolog latex2html
*/

dd.defbody
{ margin-bottom: 1em;
}

dt.pubdef
{ background-color: #c5e1ff;
}

.bib dd
{ margin-bottom: 1em;
}

.bib dt
{ float: left;
margin-right: 1.3ex;
}

pre.code
{ margin-left: 1.5em;
margin-right: 1.5em;
border: 1px dotted;
padding-top: 5px;
padding-left: 5px;
padding-bottom: 5px;
background-color: #f8f8f8;
}

div.navigate
{ text-align: center;
background-color: #f0f0f0;
border: 1px dotted;
padding: 5px;
}

div.title
{ text-align: center;
padding-bottom: 1em;
font-size: 200%;
font-weight: bold;
}

div.author
{ text-align: center;
font-style: italic;
}

div.abstract
{ margin-top: 2em;
background-color: #f0f0f0;
border: 1px dotted;
padding: 5px;
margin-left: 10%; margin-right:10%;
}

div.abstract-title
{ text-align: center;
padding: 5px;
font-size: 120%;
font-weight: bold;
}

div.toc-h1
{ font-size: 200%;
font-weight: bold;
}

div.toc-h2
{ font-size: 120%;
font-weight: bold;
margin-left: 2em;
}

div.toc-h3
{ font-size: 100%;
font-weight: bold;
margin-left: 4em;
}

div.toc-h4
{ font-size: 100%;
margin-left: 6em;
}

span.sec-nr
{ 
}

span.sec-title
{ 
}

span.pred-ext
{ font-weight: bold;
}

span.pred-tag
{ float: right;
font-size: 80%;
font-style: italic;
color: #202020;
}

/* Footnotes */

sup.fn { color: blue; text-decoration: underline; }
span.fn-text { display: none; }
sup.fn span {display: none;}
sup:hover span 
{ display: block !important;
position: absolute; top: auto; left: auto; width: 80%;
color: #000; background: white;
border: 2px solid;
padding: 5px; margin: 10px; z-index: 100;
font-size: smaller;
}
</STYLE>
</HEAD>
<BODY BGCOLOR="white"> 

<P>
<DIV class="title">SWI-Prolog Semantic Web Library</DIV>
<DIV class="author">Jan Wielemaker <BR>
HCS, <BR>
University of Amsterdam <BR>
The Netherlands <BR>
E-mail: <A class="url" href="mailto:wielemak@science.uva.nl">wielemak@science.uva.nl</A></DIV>
<DIV class="abstract">
<DIV class="abstract-title">Abstract</DIV> This document describes a 
library for dealing with standards from the
<A class="url" href="http://www.w3c.org/">W3C</A> standard for the <EM>Semantic 
Web</EM>. Like the standards themselves (RDF, RDFS and OWL) this 
infrastructure is modular. It consists of Prolog packages for reading, 
querying and storing semantic web documents as well as XPCE libraries 
that provide visualisation and editing. The Prolog libraries can be used 
without the XPCE GUI modules. The library has been actively used with 
upto 10 million triples, using approximately 1GB of memory. Its 
scalability is limited by memory only. The library can be used both on 
32-bit and 64-bit platforms.
</DIV>

<H1><A NAME="document-contents">Table of Contents</A></H1>

<DIV class="toc">
<DIV class="toc-h2"><A class="sec" href="#sec:1"><SPAN class="sec-nr">1</SPAN> <SPAN class="sec-title">Introduction</SPAN></A></DIV>
<DIV class="toc-h2"><A class="sec" href="#sec:2"><SPAN class="sec-nr">2</SPAN> <SPAN class="sec-title">Modules</SPAN></A></DIV>
<DIV class="toc-h2"><A class="sec" href="#sec:3"><SPAN class="sec-nr">3</SPAN> <SPAN class="sec-title">Module 
semweb/rdf_db</SPAN></A></DIV>
<DIV class="toc-h3"><A class="sec" href="#sec:3.1"><SPAN class="sec-nr">3.1</SPAN> <SPAN class="sec-title">Query 
the RDF database</SPAN></A></DIV>
<DIV class="toc-h4"><A class="sec" href="#sec:3.1.1"><SPAN class="sec-nr">3.1.1</SPAN> <SPAN class="sec-title">Literal 
matching and indexing</SPAN></A></DIV>
<DIV class="toc-h3"><A class="sec" href="#sec:3.2"><SPAN class="sec-nr">3.2</SPAN> <SPAN class="sec-title">Predicate 
properties</SPAN></A></DIV>
<DIV class="toc-h3"><A class="sec" href="#sec:3.3"><SPAN class="sec-nr">3.3</SPAN> <SPAN class="sec-title">Modifying 
the database</SPAN></A></DIV>
<DIV class="toc-h4"><A class="sec" href="#sec:3.3.1"><SPAN class="sec-nr">3.3.1</SPAN> <SPAN class="sec-title">Modifying 
predicates</SPAN></A></DIV>
<DIV class="toc-h4"><A class="sec" href="#sec:3.3.2"><SPAN class="sec-nr">3.3.2</SPAN> <SPAN class="sec-title">Transactions</SPAN></A></DIV>
<DIV class="toc-h3"><A class="sec" href="#sec:3.4"><SPAN class="sec-nr">3.4</SPAN> <SPAN class="sec-title">Loading 
and saving to file</SPAN></A></DIV>
<DIV class="toc-h4"><A class="sec" href="#sec:3.4.1"><SPAN class="sec-nr">3.4.1</SPAN> <SPAN class="sec-title">Caching 
triples</SPAN></A></DIV>
<DIV class="toc-h4"><A class="sec" href="#sec:3.4.2"><SPAN class="sec-nr">3.4.2</SPAN> <SPAN class="sec-title">Partial 
save</SPAN></A></DIV>
<DIV class="toc-h4"><A class="sec" href="#sec:3.4.3"><SPAN class="sec-nr">3.4.3</SPAN> <SPAN class="sec-title">Fast 
loading and saving</SPAN></A></DIV>
<DIV class="toc-h4"><A class="sec" href="#sec:3.4.4"><SPAN class="sec-nr">3.4.4</SPAN> <SPAN class="sec-title">MD5 
digests</SPAN></A></DIV>
<DIV class="toc-h3"><A class="sec" href="#sec:3.5"><SPAN class="sec-nr">3.5</SPAN> <SPAN class="sec-title">Namespace 
Handling</SPAN></A></DIV>
<DIV class="toc-h4"><A class="sec" href="#sec:3.5.1"><SPAN class="sec-nr">3.5.1</SPAN> <SPAN class="sec-title">Namespace 
handling for custom predicates</SPAN></A></DIV>
<DIV class="toc-h3"><A class="sec" href="#sec:3.6"><SPAN class="sec-nr">3.6</SPAN> <SPAN class="sec-title">Monitoring 
the database</SPAN></A></DIV>
<DIV class="toc-h3"><A class="sec" href="#sec:3.7"><SPAN class="sec-nr">3.7</SPAN> <SPAN class="sec-title">Miscellaneous 
predicates</SPAN></A></DIV>
<DIV class="toc-h3"><A class="sec" href="#sec:3.8"><SPAN class="sec-nr">3.8</SPAN> <SPAN class="sec-title">Issues 
with rdf_db</SPAN></A></DIV>
<DIV class="toc-h2"><A class="sec" href="#sec:4"><SPAN class="sec-nr">4</SPAN> <SPAN class="sec-title">Plugin 
modules for rdf_db</SPAN></A></DIV>
<DIV class="toc-h3"><A class="sec" href="#sec:4.1"><SPAN class="sec-nr">4.1</SPAN> <SPAN class="sec-title">Hooks 
into the RDF library</SPAN></A></DIV>
<DIV class="toc-h3"><A class="sec" href="#sec:4.2"><SPAN class="sec-nr">4.2</SPAN> <SPAN class="sec-title">Library 
semweb/rdf_zlib_plugin</SPAN></A></DIV>
<DIV class="toc-h3"><A class="sec" href="#sec:4.3"><SPAN class="sec-nr">4.3</SPAN> <SPAN class="sec-title">Library 
semweb/rdf_http_plugin</SPAN></A></DIV>
<DIV class="toc-h3"><A class="sec" href="#sec:4.4"><SPAN class="sec-nr">4.4</SPAN> <SPAN class="sec-title">Library 
semweb/rdf_litindex: Indexing words in literals</SPAN></A></DIV>
<DIV class="toc-h3"><A class="sec" href="#sec:4.5"><SPAN class="sec-nr">4.5</SPAN> <SPAN class="sec-title">Literal 
maps: Creating additional indices on literals</SPAN></A></DIV>
<DIV class="toc-h3"><A class="sec" href="#sec:4.6"><SPAN class="sec-nr">4.6</SPAN> <SPAN class="sec-title">Module 
semweb/rdf_persistency</SPAN></A></DIV>
<DIV class="toc-h4"><A class="sec" href="#sec:4.6.1"><SPAN class="sec-nr">4.6.1</SPAN> <SPAN class="sec-title">Enriching 
the journals</SPAN></A></DIV>
<DIV class="toc-h3"><A class="sec" href="#sec:4.7"><SPAN class="sec-nr">4.7</SPAN> <SPAN class="sec-title">Module 
semweb/rdf_turtle</SPAN></A></DIV>
<DIV class="toc-h2"><A class="sec" href="#sec:5"><SPAN class="sec-nr">5</SPAN> <SPAN class="sec-title">Module 
semweb/rdfs</SPAN></A></DIV>
<DIV class="toc-h3"><A class="sec" href="#sec:5.1"><SPAN class="sec-nr">5.1</SPAN> <SPAN class="sec-title">Hierarchy 
and class-individual relations</SPAN></A></DIV>
<DIV class="toc-h3"><A class="sec" href="#sec:5.2"><SPAN class="sec-nr">5.2</SPAN> <SPAN class="sec-title">Collections 
and Containers</SPAN></A></DIV>
<DIV class="toc-h3"><A class="sec" href="#sec:5.3"><SPAN class="sec-nr">5.3</SPAN> <SPAN class="sec-title">Labels 
and textual search</SPAN></A></DIV>
<DIV class="toc-h2"><A class="sec" href="#sec:6"><SPAN class="sec-nr">6</SPAN> <SPAN class="sec-title">OWL</SPAN></A></DIV>
<DIV class="toc-h2"><A class="sec" href="#sec:7"><SPAN class="sec-nr">7</SPAN> <SPAN class="sec-title">Module 
semweb/rdf_edit</SPAN></A></DIV>
<DIV class="toc-h3"><A class="sec" href="#sec:7.1"><SPAN class="sec-nr">7.1</SPAN> <SPAN class="sec-title">Transaction 
management</SPAN></A></DIV>
<DIV class="toc-h3"><A class="sec" href="#sec:7.2"><SPAN class="sec-nr">7.2</SPAN> <SPAN class="sec-title">File 
management</SPAN></A></DIV>
<DIV class="toc-h3"><A class="sec" href="#sec:7.3"><SPAN class="sec-nr">7.3</SPAN> <SPAN class="sec-title">Encapsulated 
predicates</SPAN></A></DIV>
<DIV class="toc-h3"><A class="sec" href="#sec:7.4"><SPAN class="sec-nr">7.4</SPAN> <SPAN class="sec-title">High-level 
modification predicates</SPAN></A></DIV>
<DIV class="toc-h3"><A class="sec" href="#sec:7.5"><SPAN class="sec-nr">7.5</SPAN> <SPAN class="sec-title">Undo</SPAN></A></DIV>
<DIV class="toc-h3"><A class="sec" href="#sec:7.6"><SPAN class="sec-nr">7.6</SPAN> <SPAN class="sec-title">Journalling</SPAN></A></DIV>
<DIV class="toc-h3"><A class="sec" href="#sec:7.7"><SPAN class="sec-nr">7.7</SPAN> <SPAN class="sec-title">Broadcasting 
change events</SPAN></A></DIV>
<DIV class="toc-h2"><A class="sec" href="#sec:8"><SPAN class="sec-nr">8</SPAN> <SPAN class="sec-title">Related 
packages and issues</SPAN></A></DIV>
</DIV>

<H2><A NAME="sec:1"><SPAN class="sec-nr">1</SPAN> <SPAN class="sec-title">Introduction</SPAN></A></H2>

<P>SWI-Prolog has started support for web-documents with the development 
of a small and fast SGML/XML parser, followed by an RDF parser (early 
2000). With the <CODE>semweb</CODE> library we provide more high level 
support for manipulating semantic web documents. The semantic web is the 
likely point of orientation for knowledge representation in the future, 
making a library designed in its spirit promising.

<H2><A NAME="sec:2"><SPAN class="sec-nr">2</SPAN> <SPAN class="sec-title">Modules</SPAN></A></H2>

<P>Central to this library is the module <CODE>library(semweb/rdf_db.pl)</CODE>, 
providing storage and basic querying for RDF triples. This triple store 
is filled using the RDF parser realised by <CODE>library(rdf.pl)</CODE>. 
The storage module can quickly save and load (partial) databases. The 
modules
<CODE>library(semweb/rdfs.pl)</CODE> and <CODE>library(semweb/owl.pl)</CODE> 
add querying in terms of the more powerful RDFS and OWL languages. 
Module
<CODE>library(semweb/rdf_edit.pl)</CODE> adds editing, undo, journaling 
and change-forwarding. Finally, a variety of XPCE modules visualise and 
edit the database. Figure <A class="fig" href="#fig:modules">figure 1</A> 
summarised the modular design.

<P><A NAME="fig:modules"></A>
<CENTER>
<IMG SRC="modules.gif">
</CENTER>
<TABLE ALIGN=center WIDTH="75%"><TR><TD>
<B>Figure 1 : </B>Modules for the Semantic Web library</TABLE>

<H2><A NAME="sec:3"><SPAN class="sec-nr">3</SPAN> <SPAN class="sec-title">Module 
semweb/rdf_db</SPAN></A></H2>

<P>The central module is called <CODE>rdf_db</CODE>. It provides storage 
and indexed querying of RDF triples. Triples are stored as a quintuple. 
The first three elements denote the RDF triple. <VAR>File</VAR> and
<VAR>Line</VAR> provide information about the origin of the triple.
<BLOCKQUOTE>
{<VAR>Subject</VAR> <VAR>Predicate</VAR> <VAR>Object</VAR> <VAR>File</VAR> <VAR>Line</VAR>}
</BLOCKQUOTE>

<P>The actual storage is provided by the <EM>foreign language (C)</EM> 
module <CODE>rdf_db.c</CODE>. Using a dedicated C-based implementation 
we can reduced memory usage and improve indexing capabilities.<SUP class="fn">1<SPAN class="fn-text">The 
orginal implementation was in Prolog. This version was implemented in 3 
hours, where the C-based implementation costed a full week. The C-based 
implementation requires about half the memory and provides about twice 
the performance.</SPAN></SUP> Currently the following indexing is 
provided.

<P>
<UL>
<LI>Any of the 3 fields of the triple
<LI><VAR>Subject</VAR> + <VAR>Predicate</VAR> and <VAR>Predicate</VAR> + <VAR>Object</VAR>
<LI><VAR>Predicates</VAR> are indexed on the <EM>highest property</EM>. 
In other words, if predicates are related through
<CODE>subPropertyOf</CODE> predicates indexing happens on the most 
abstract predicate. This makes calls to <A NAME="idx:rdfhas4:1"></A><A class="pred" href="#rdf_has/4">rdf_has/4</A> 
very efficient.
<LI>String literal <VAR>Objects</VAR> are indexed case-insensitive to 
make case-insensitive queries fully indexed. See <A NAME="idx:rdf3:2"></A><A class="pred" href="#rdf/3">rdf/3</A>.
</UL>

<H3><A NAME="sec:3.1"><SPAN class="sec-nr">3.1</SPAN> <SPAN class="sec-title">Query 
the RDF database</SPAN></A></H3>

<A NAME="sec:rdfquery"></A>

<DL>
<DT class="pubdef"><A NAME="rdf/3"><STRONG>rdf</STRONG>(<VAR>?Subject, 
?Predicate, ?Object</VAR>)</A></DT>
<DD class="defbody">
Elementary query for triples. <VAR>Subject</VAR> and <VAR>Predicate</VAR> 
are atoms representing the fully qualified URL of the resource. <VAR>Object</VAR> 
is either an atom representing a resource or <CODE>literal(Value)</CODE> 
if the object is a literal value. If a value of the form
<CODE>NameSpaceID : LocalName</CODE> is provided it is expanded to a 
ground atom using <A NAME="idx:expandgoal2:3"></A><SPAN class="pred-ext">expand_goal/2</SPAN>. 
This implies you can use this construct in compiled code without paying 
a performance penalty. See also
<A class="sec" href="#sec:3.5">section 3.5</A>. Literal values take one 
of the following forms:

<DL>
<DT><STRONG>Atom</STRONG></DT>
<DD class="defbody">
If the value is a simple atom it is the textual representation of a 
string literal without explicit type or language (<CODE>xml:lang</CODE>) 
qualifier.</DD>
<DT><STRONG>lang</STRONG>(<VAR>LangID, Atom</VAR>)</DT>
<DD class="defbody">
<VAR>Atom</VAR> represents the text of a string literal qualified with 
the given language.</DD>
<DT><STRONG>type</STRONG>(<VAR>TypeID, Value</VAR>)</DT>
<DD class="defbody">
Used for attributes qualified using the <CODE>rdf:datatype</CODE>
<VAR>TypeID</VAR>. The <VAR>Value</VAR> is either the textual 
representation or a natural Prolog representation. See the option
<CODE>convert_typed_literal(:Convertor)</CODE> of the parser. The 
storage layer provides efficient handling of atoms, integers (64-bit) 
and floats (native C-doubles). All other data is represented as a Prolog 
record.
</DD>
</DL>

<P>For string querying purposes, <VAR>Object</VAR> can be of the form
<CODE>literal(+Query, -Value)</CODE>, where <VAR>Query</VAR> is one of 
the terms below. Details of literal matching and indexing are described 
in <A class="sec" href="#sec:3.1.1">section 3.1.1</A>.

<DL>
<DT><STRONG>exact</STRONG>(<VAR>+Text</VAR>)</DT>
<DD class="defbody">
Perform exact, but case-insensitive match. This query is fully indexed.
</DD>
<DT><STRONG>substring</STRONG>(<VAR>+Text</VAR>)</DT>
<DD class="defbody">
Match any literal that contains <VAR>Text</VAR> as a case-insensitive 
substring. The query is not indexed on <VAR>Object</VAR>.
</DD>
<DT><STRONG>word</STRONG>(<VAR>+Text</VAR>)</DT>
<DD class="defbody">
Match any literal that contains <VAR>Text</VAR> delimited by a non 
alpha-numeric character, the start or end of the string. The query is 
not indexed on <VAR>Object</VAR>.
</DD>
<DT><STRONG>prefix</STRONG>(<VAR>+Text</VAR>)</DT>
<DD class="defbody">
Match any literal that starts with <VAR>Text</VAR>. This call is 
intended for <EM>completion</EM>. The query is indexed using the binary 
tree of literals. See <A class="sec" href="#sec:3.1.1">section 3.1.1</A> 
for details.
</DD>
<DT><STRONG>like</STRONG>(<VAR>+Pattern</VAR>)</DT>
<DD class="defbody">
Match any literal that matches <VAR>Pattern</VAR> case insensitively, 
where the `*' character in <VAR>Pattern</VAR> matches zero or more 
characters.
</DD>
</DL>

<P>Backtracking never returns duplicate triples. Duplicates can be 
retrieved using <A NAME="idx:rdf4:4"></A><A class="pred" href="#rdf/4">rdf/4</A>. 
The predicate <A NAME="idx:rdf3:5"></A><A class="pred" href="#rdf/3">rdf/3</A> 
raises a type-error if called with improper arguments. If <A NAME="idx:rdf3:6"></A><A class="pred" href="#rdf/3">rdf/3</A> 
is called with a term
<CODE>literal(_)</CODE> as <VAR>Subject</VAR> or <VAR>Predicate</VAR> 
object it fails silently. This allows for graph matching goals like
<CODE>rdf(S,P,O),rdf(O,P2,O2)</CODE> to proceed without errors.<SUP class="fn">2<SPAN class="fn-text">Discussion 
in the SPARQL community votes for allowing literal values as subject. 
Although we have no principal objections, we fear such an extension will 
promote poor modelling practice.</SPAN></SUP></DD>
<DT class="pubdef"><A NAME="rdf/4"><STRONG>rdf</STRONG>(<VAR>?Subject, 
?Predicate, ?Object, ?Source</VAR>)</A></DT>
<DD class="defbody">
As <A NAME="idx:rdf3:7"></A><A class="pred" href="#rdf/3">rdf/3</A> but 
in addition return the source-location of the triple. The source is 
either a plain atom or a term of the format
<CODE>Atom : Integer</CODE> where <VAR>Atom</VAR> is intended to be used 
as filename or URL and <VAR>Integer</VAR> for representing the 
line-number. Unlike <A NAME="idx:rdf3:8"></A><A class="pred" href="#rdf/3">rdf/3</A>, 
this predicate does not remove duplicates from the result set.</DD>
<DT class="pubdef"><A NAME="rdf_has/4"><STRONG>rdf_has</STRONG>(<VAR>?Subject, 
?Predicate, ?Object, -TriplePred</VAR>)</A></DT>
<DD class="defbody">
This query exploits the RDFS <CODE>subPropertyOf</CODE> relation. It 
returns any triple whose stored predicate equals <VAR>Predicate</VAR> or 
can reach this by following the recursive <VAR>subPropertyOf</VAR> 
relation. The actual stored predicate is returned in <VAR>TriplePred</VAR>. 
The example below gets all subclasses of an RDFS (or OWL) class, even if 
the relation used is not <CODE>rdfs:subClassOf</CODE>, but a 
user-defined sub-property thereof.<SUP class="fn">3<SPAN class="fn-text">This 
predicate realises semantics defined in RDF-Schema rather than RDF. It 
is part of the <CODE>library(rdf_db)</CODE> module because the indexing 
of this module incorporates the <CODE>rdfs:subClassOf</CODE> predicate.</SPAN></SUP>

<PRE class="code">
subclasses(Class, SubClasses) :-
        findall(S, rdf_has(S, rdfs:subClassOf, Class), SubClasses).
</PRE>

<P>Note that <A NAME="idx:rdfhas4:9"></A><A class="pred" href="#rdf_has/4">rdf_has/4</A> 
and <A NAME="idx:rdfhas3:10"></A><A class="pred" href="#rdf_has/3">rdf_has/3</A> 
can return duplicate answers if they use a different <VAR>TriplePred</VAR>.</DD>
<DT class="pubdef"><A NAME="rdf_has/3"><STRONG>rdf_has</STRONG>(<VAR>?Subject, 
?Predicate, ?Object</VAR>)</A></DT>
<DD class="defbody">
Same as <CODE>rdf_has(Subject, Predicate, Object, _)</CODE>.</DD>
<DT class="pubdef"><A NAME="rdf_reachable/3"><STRONG>rdf_reachable</STRONG>(<VAR>?Subject, 
+Predicate, ?Object</VAR>)</A></DT>
<DD class="defbody">
Is true if <VAR>Object</VAR> can be reached from <VAR>Subject</VAR> 
following the transitive predicate <VAR>Predicate</VAR> or a 
sub-property thereof. When used with either <VAR>Subject</VAR> or <VAR>Object</VAR> 
unbound, it first returns the origin, followed by the reachable nodes in 
breath-first search-order. It never generates the same node twice and is 
robust against cycles in the transitive relation. With all arguments 
instantiated it succeeds deterministically of the relation if a path can 
be found from <VAR>Subject</VAR> to <VAR>Object</VAR>. Searching starts 
at <VAR>Subject</VAR>, assuming the branching factor is normally lower. 
A call with both <VAR>Subject</VAR> and <VAR>Object</VAR> unbound raises 
an instantiation error. The following example generates all subclasses 
of <CODE>rdfs:Resource</CODE>:

<PRE class="code">
?- rdf_reachable(X, rdfs:subClassOf, rdfs:'Resource').

X = 'http://www.w3.org/2000/01/rdf-schema#Resource' ;

X = 'http://www.w3.org/2000/01/rdf-schema#Class' ;

X = 'http://www.w3.org/1999/02/22-rdf-syntax-ns#Property' ;

...
</PRE>

</DD>
<DT class="pubdef"><A NAME="rdf_subject/1"><STRONG>rdf_subject</STRONG>(<VAR>?Subject</VAR>)</A></DT>
<DD class="defbody">
Enumerate resources appearing as a subject in a triple. The main reason 
for this predicate is to generate the known subjects <EM>without 
duplicates</EM> as one gets using <CODE>rdf(Subject, _, _)</CODE>.</DD>
<DT class="pubdef"><A NAME="rdf_current_literal/1"><STRONG>rdf_current_literal</STRONG>(<VAR>-Literal</VAR>)</A></DT>
<DD class="defbody">
Enumerate all known literals. Like <A NAME="idx:rdfsubject1:11"></A><A class="pred" href="#rdf_subject/1">rdf_subject/1</A>, 
the motivation is to provide access to literals without generation 
duplicates. Otherwise the call is the same as <CODE>rdf(_,_,literal(Literal))</CODE>.
</DD>
</DL>

<H4><A NAME="sec:3.1.1"><SPAN class="sec-nr">3.1.1</SPAN> <SPAN class="sec-title">Literal 
matching and indexing</SPAN></A></H4>

<A NAME="sec:litindex"></A>

<P>Starting with version 2.5.0 of this library, literal values are 
ordered and indexed using a balanced binary tree (AVL tree). The aim of 
this index is threefold.

<P>
<UL>
<LI>Unlike hash-tables, binary trees allow for efficient
<EM>prefix</EM> matching. Prefix matching is very useful in interactive 
applications to provide feedback while typing such as auto-completion.

<P>
<LI>Having a table of unique literals we generate creation and 
destruction events (see <A NAME="idx:rdfmonitor2:12"></A><A class="pred" href="#rdf_monitor/2">rdf_monitor/2</A>). 
These events can be used to maintain additional indexing on literals, 
such as `by word'.

<P>
<LI>A binary table allow for fast interval matching on typed numeric 
literals.<SUP class="fn">4<SPAN class="fn-text">Not yet implemented</SPAN></SUP>
</UL>

<P>As string literal matching is most frequently used for searching 
purposes, the match is executed case-insensitive and after removal of 
diacritics. Case matching and diacritics removal is based on Unicode 
character properties and independent from the current locale. Case 
conversion is based on the `simple uppercase mapping' defined by Unicode 
and diacritic removal on the `decomposition type'. The approach is 
lightweight, but somewhat simpleminded for some languages. The tables 
are generated for Unicode characters upto 0x7fff. For more information, 
please check the source-code of the mapping-table generator
<CODE>unicode_map.pl</CODE> available in the sources of this package.

<P>Currently the total order of literals is first based on the type of 
literal using the ordering 
<BLOCKQUOTE><VAR>numeric &lt; string &lt; term</VAR></BLOCKQUOTE>
Numeric values (integer and float) are ordered by value, integers 
preceed floats if they represent the same value. strings are sorted 
alphabetically after case-mapping and diacritic removal as described 
above. If they match equal, uppercase preceeds lowercase and diacritics 
are ordered on their unicode value. If they still compare equal literals 
without any qualifier preceeds literals with a type qualifier which 
preceeds literals with a language qualifier. Same qualifiers (both type 
or both language) are sorted alphabetically.<SUP class="fn">5<SPAN class="fn-text">The 
ordering defined above may change in future versions to deal with new 
queries for literals.</SPAN></SUP>

<P>The ordered tree is used for indexed execution of
<CODE>literal(<CODE>prefix(Prefix)</CODE>, Literal)</CODE> as well as
<CODE>literal(<CODE>like(Like)</CODE>, Literal)</CODE> if <VAR>Like</VAR> 
does not start with a `*'. Note that results of queries that use the 
tree index are returned in alphabetical order.

<H3><A NAME="sec:3.2"><SPAN class="sec-nr">3.2</SPAN> <SPAN class="sec-title">Predicate 
properties</SPAN></A></H3>

<A NAME="sec:predproperty"></A>

<P>The predicates below form an experimental interface to provide more 
reasoning inside the kernel of the rdb_db engine. Note that
<CODE>symetric</CODE>, <CODE>inverse_of</CODE> and <CODE>transitive</CODE> 
are not yet supported by the rest of the engine.

<DL>
<DT class="pubdef"><A NAME="rdf_current_predicate/1"><STRONG>rdf_current_predicate</STRONG>(<VAR>?Predicate</VAR>)</A></DT>
<DD class="defbody">
Enumerate all defined predicates. Behaves as the code below, but much 
more efficient.

<PRE class="code">
rdf_current_predicate(Predicate) :-
        findall(P, rdf(_,P,_), Ps),
        sort(Ps, S),
        member(Predicate, S).
</PRE>

</DD>
<DT class="pubdef"><A NAME="rdf_set_predicate/2"><STRONG>rdf_set_predicate</STRONG>(<VAR>+Predicate, 
+Property</VAR>)</A></DT>
<DD class="defbody">
Define a property of the predicate. This predicate currently supports 
the properties <CODE>symmetric</CODE>, <CODE>inverse_of</CODE> and
<CODE>transitive</CODE> as defined with <A NAME="idx:rdfpredicateproperty2:13"></A><A class="pred" href="#rdf_predicate_property/2">rdf_predicate_property/2</A>. 
Adding an <VAR>A</VAR> inverse_of <VAR>B</VAR> also adds <VAR>B</VAR> 
inverse_of <VAR>A</VAR>. An inverse relation is deleted using <CODE>inverse_of([])</CODE>. 
`
</DD>
<DT class="pubdef"><A NAME="rdf_predicate_property/2"><STRONG>rdf_predicate_property</STRONG>(<VAR>?Predicate, 
-Property</VAR>)</A></DT>
<DD class="defbody">
Query properties of a defined predicate. Currently defined properties 
are given below.

<DL>
<DT><STRONG>symmetric</STRONG>(<VAR>Bool</VAR>)</DT>
<DD class="defbody">
True if the predicate is defined to be symetric. I.e. 
{A} P {B} implies {B} P {A}.</DD>
<DT><STRONG>inverse_of</STRONG>(<VAR>Inverse</VAR>)</DT>
<DD class="defbody">
True if this predicate is the inverse of <VAR>Inverse</VAR>.</DD>
<DT><STRONG>transitive</STRONG>(<VAR>Bool</VAR>)</DT>
<DD class="defbody">
True if this predicate is transitive.</DD>
<DT><STRONG>triples</STRONG>(<VAR>Triples</VAR>)</DT>
<DD class="defbody">
Unify <VAR>Triples</VAR> with the number of existing triples using this 
predicate as second argument. Reporting the number of triples is 
intended to support query optimization.</DD>
<DT><STRONG>rdf_subject_branch_factor</STRONG>(<VAR>-Float</VAR>)</DT>
<DD class="defbody">
Unify <VAR>Float</VAR> with the average number of triples associated 
with each unique value for the subject-side of this relation. If there 
are no triples the value 0.0 is returned. This value is cached with the 
predicate and recomputed only after substantial changes to the triple 
set associated to this relation. This property is indented for path 
optimalisation when solving conjunctions of <A NAME="idx:rdf3:14"></A><A class="pred" href="#rdf/3">rdf/3</A> 
goals.</DD>
<DT><STRONG>rdf_object_branch_factor</STRONG>(<VAR>-Float</VAR>)</DT>
<DD class="defbody">
Unify <VAR>Float</VAR> with the average number of triples associated 
with each unique value for the object-side of this relation. In addition 
to the comments with the subject_branch_factor property, uniqueness of 
the object value is computed from the hash key rather than the actual 
values.</DD>
<DT><STRONG>rdfs_subject_branch_factor</STRONG>(<VAR>-Float</VAR>)</DT>
<DD class="defbody">
Same as rdf_subject_branch_factor/1 , but also considering triples of 
`subPropertyOf' this relation. See also <A NAME="idx:rdfhas3:15"></A><A class="pred" href="#rdf_has/3">rdf_has/3</A>.</DD>
<DT><STRONG>rdfs_object_branch_factor</STRONG>(<VAR>-Float</VAR>)</DT>
<DD class="defbody">
Same as rdf_object_branch_factor/1 , but also considering triples of 
`subPropertyOf' this relation. See also <A NAME="idx:rdfhas3:16"></A><A class="pred" href="#rdf_has/3">rdf_has/3</A>.
</DD>
</DL>

</DD>
</DL>

<H3><A NAME="sec:3.3"><SPAN class="sec-nr">3.3</SPAN> <SPAN class="sec-title">Modifying 
the database</SPAN></A></H3>

<A NAME="sec:rdfmodify"></A>

<P>As depicted in <A class="fig" href="#fig:modules">figure 1</A>, there 
are two levels of modification. The <CODE>rdf_db</CODE> module simply 
modifies, where the <CODE>rdf_edit</CODE> library provides transactions 
and undo on top of this. Applications that wish to use the <CODE>rdf_edit</CODE> 
layer must <EM>never</EM> use the predicates from this section directly.

<H4><A NAME="sec:3.3.1"><SPAN class="sec-nr">3.3.1</SPAN> <SPAN class="sec-title">Modifying 
predicates</SPAN></A></H4>

<A NAME="sec:modpreds"></A>

<DL>
<DT class="pubdef"><A NAME="rdf_assert/3"><STRONG>rdf_assert</STRONG>(<VAR>+Subject, 
+Predicate, +Object</VAR>)</A></DT>
<DD class="defbody">
Assert a new triple into the database. This is equivalent to
<A NAME="idx:rdfassert4:17"></A><A class="pred" href="#rdf_assert/4">rdf_assert/4</A> 
using <VAR>SourceRef</VAR> <CODE>user</CODE>. <VAR>Subject</VAR> and
<VAR>Predicate</VAR> are resources. <VAR>Object</VAR> is either a 
resource or a term <CODE>literal(Value)</CODE>. See <A NAME="idx:rdf3:18"></A><A class="pred" href="#rdf/3">rdf/3</A> 
for an explanation of <VAR>Value</VAR> for typed and language qualified 
literals. All arguments are subject to name-space expansion (see <A class="sec" href="#sec:3.5">section 
3.5</A>).</DD>
<DT class="pubdef"><A NAME="rdf_assert/4"><STRONG>rdf_assert</STRONG>(<VAR>+Subject, 
+Predicate, +Object, +SourceRef</VAR>)</A></DT>
<DD class="defbody">
As <A NAME="idx:rdfassert3:19"></A><A class="pred" href="#rdf_assert/3">rdf_assert/3</A>, 
adding <VAR>SourceRef</VAR> to specify the orgin of the triple. <VAR>SourceRef</VAR> 
is either an atom or a term of the format
<VAR>Atom</VAR>:<VAR>Int</VAR> where <VAR>Atom</VAR> normally refers to 
a filename and <VAR>Int</VAR> to the line-number where the description 
starts.</DD>
<DT class="pubdef"><A NAME="rdf_retractall/3"><STRONG>rdf_retractall</STRONG>(<VAR>?Subject, 
?Predicate, ?Object</VAR>)</A></DT>
<DD class="defbody">
Removes all matching triples from the database. Previous Prolog 
implementations also provided a backtracking <SPAN class="pred-ext">rdf_retract/3</SPAN>, 
but this proved to be rarely used and could always be replaced with
<A NAME="idx:rdfretractall3:20"></A><A class="pred" href="#rdf_retractall/3">rdf_retractall/3</A>. 
As <A NAME="idx:rdfretractall4:21"></A><A class="pred" href="#rdf_retractall/4">rdf_retractall/4</A> 
using an unbound <VAR>SourceRef</VAR>.</DD>
<DT class="pubdef"><A NAME="rdf_retractall/4"><STRONG>rdf_retractall</STRONG>(<VAR>?Subject, 
?Predicate, ?Object, ?SourceRef</VAR>)</A></DT>
<DD class="defbody">
As <A NAME="idx:rdfretractall4:22"></A><A class="pred" href="#rdf_retractall/4">rdf_retractall/4</A>, 
also matching on the <VAR>SourceRef</VAR>. This is particulary useful to 
update all triples coming from a loaded file.</DD>
<DT class="pubdef"><A NAME="rdf_update/4"><STRONG>rdf_update</STRONG>(<VAR>+Subject, 
+Predicate, +Object, +Action</VAR>)</A></DT>
<DD class="defbody">
Replaces one of the three fields on the matching triples depending on <VAR>Action</VAR>:

<DL>
<DT><STRONG>subject</STRONG>(<VAR>Resource</VAR>)</DT>
<DD class="defbody">
Changes the first field of the triple.
</DD>
<DT><STRONG>predicate</STRONG>(<VAR>Resource</VAR>)</DT>
<DD class="defbody">
Changes the second field of the triple.
</DD>
<DT><STRONG>object</STRONG>(<VAR>Object</VAR>)</DT>
<DD class="defbody">
Changes the last field of the triple to the given resource or
<CODE>literal(Value)</CODE>.
</DD>
<DT><STRONG>source</STRONG>(<VAR>Source</VAR>)</DT>
<DD class="defbody">
Changes the source location (<EM>payload</EM>). Note that updating the 
source has no consequences for the semantics and therefore the
<EM>generation</EM> (see <A NAME="idx:rdfgeneration1:23"></A><A class="pred" href="#rdf_generation/1">rdf_generation/1</A>) 
is <EM>not</EM> updated.
</DD>
</DL>

</DD>
<DT class="pubdef"><A NAME="rdf_update/5"><STRONG>rdf_update</STRONG>(<VAR>+Subject, 
+Predicate, +Object, +Source,+Action</VAR>)</A></DT>
<DD class="defbody">
As <A NAME="idx:rdfupdate4:24"></A><A class="pred" href="#rdf_update/4">rdf_update/4</A> 
but allows for specifying the source.

<P></DD>
</DL>

<H4><A NAME="sec:3.3.2"><SPAN class="sec-nr">3.3.2</SPAN> <SPAN class="sec-title">Transactions</SPAN></A></H4>

<A NAME="transactions"></A>

<P><A NAME="idx:transaction:25"></A>The predicates from <A class="sec" href="#sec:3.3.1">section 
3.3.1</A> perform immediate and atomic modifications to the database. 
There are two cases where this is not desirable:

<P><OL>
<LI>If the database is modified using information based on reading the 
same database. A typical case is a forward reasoner examining the 
database and asserting new triples that can be deduced from the already 
existing ones. For example, <EM>if <VAR>length(X) &gt; 2</VAR> then 
size(X) is large</EM>:

<PRE class="code">
        (   rdf(X, length, literal(L)),
            atom_number(L, IL),
            IL &gt; 2,
            rdf_assert(X, size, large),
            fail
        ;   true
        ).
</PRE>

<P>Running this code without precautions causes an error because
<A NAME="idx:rdfassert3:26"></A><A class="pred" href="#rdf_assert/3">rdf_assert/3</A> 
tries to get a write lock on the database which has an a read operation 
(rdf/3 has choicepoints) in progress.

<P>
<LI>Multi-threaded access making multiple changes to the database that 
must be handled as a unit.
</OL>

<P>Where the second case is probably obvious, the first case is less so. 
The storage layer may require reindexing after adding or deleting 
triples. Such reindexing operatations however are not possible while 
there are active read operations in other threads or from choicepoints 
that can be in the same thread. For this reason we added
<A NAME="idx:rdftransaction2:27"></A><A class="pred" href="#rdf_transaction/2">rdf_transaction/2</A>. 
Note that, like the predicates from
<A class="sec" href="#sec:3.3.1">section 3.3.1</A>, <A NAME="idx:rdftransaction2:28"></A><A class="pred" href="#rdf_transaction/2">rdf_transaction/2</A> 
raises a permission error exception if the calling thread has active 
choicepoints on the database. The problem is illustrated below. The <A NAME="idx:rdf3:29"></A><A class="pred" href="#rdf/3">rdf/3</A> 
call leaves a choicepoint and as the read lock originates from the 
calling thread itself the system will deadlock if it would not generate 
an exception.

<PRE class="code">
1 ?- rdf_assert(a,b,c).
 
Yes
2 ?- rdf_assert(a,b,d).
 
Yes
3 ?- rdf(a,b,X), rdf_transaction(rdf_assert(a,b,e)).
ERROR: No permission to write rdf_db `default' (Operation would deadlock)
^  Exception: (8) rdf_db:rdf_transaction(rdf_assert(a, b, e)) ? no debug
4 ?-
</PRE>

<DL>
<DT class="pubdef"><A NAME="rdf_transaction/1"><STRONG>rdf_transaction</STRONG>(<VAR>:Goal</VAR>)</A></DT>
<DD class="defbody">
Same as <CODE>rdf_transaction(Goal, <CODE>user</CODE>)</CODE>.</DD>
<DT class="pubdef"><A NAME="rdf_transaction/2"><STRONG>rdf_transaction</STRONG>(<VAR>:Goal, 
+Id</VAR>)</A></DT>
<DD class="defbody">
After starting a transaction, all predicates from <A class="sec" href="#sec:3.3.1">section 
3.3.1</A> append their operation to the <EM>transaction</EM> instead of 
modifying the database. If <VAR>Goal</VAR> succeeds rdf_transaction cuts 
all choicepoints in <VAR>Goal</VAR> and executes all recorded 
operations. If
<VAR>Goal</VAR> fails or throws an exception, all recorded operations 
are discarded and <A NAME="idx:rdftransaction1:30"></A><A class="pred" href="#rdf_transaction/1">rdf_transaction/1</A> 
fails or re-throws the exception.

<P>On entry, <A NAME="idx:rdftransaction1:31"></A><A class="pred" href="#rdf_transaction/1">rdf_transaction/1</A> 
gains exclusive access to the database, but does allow readers to come 
in from all threads. After the successful completion of <VAR>Goal</VAR> <A NAME="idx:rdftransaction1:32"></A><A class="pred" href="#rdf_transaction/1">rdf_transaction/1</A> 
gains completely exclusive access while performing the database updates.

<P>Transactions may be nested. Committing a nested transactions merges 
its change records into the outer transaction, while discarding a nested 
transaction simply destroys the change records belonging to the nested 
transaction.

<P>The <VAR>Id</VAR> argument may be used to identify the transaction. 
It is passed to the begin/end events posted to hooks registered with
<A NAME="idx:rdfmonitor2:33"></A><A class="pred" href="#rdf_monitor/2">rdf_monitor/2</A>. 
The <VAR>Id</VAR> <CODE>log(Term)</CODE> can be used to enrich the 
journal files with additional history context. See <A class="sec" href="#sec:4.6.1">section 
4.6.1</A>.</DD>
<DT class="pubdef"><A NAME="rdf_active_transaction/1"><STRONG>rdf_active_transaction</STRONG>(<VAR>?Id</VAR>)</A></DT>
<DD class="defbody">
True if <VAR>Id</VAR> is the identifier of a currently active 
transaction (i.e. <A NAME="idx:rdfactivetransaction1:34"></A><A class="pred" href="#rdf_active_transaction/1">rdf_active_transaction/1</A> 
is called from <A NAME="idx:rdftransaction2:35"></A><A class="pred" href="#rdf_transaction/2">rdf_transaction/2</A> 
with matching <VAR>Id</VAR>). Note that transaction identifier is not 
copied and therefore need not be ground and can be further instantiated 
during the transaction. <VAR>Id</VAR> is first unified with the 
innermost transaction and backtracking with the identifier of other 
active transaction. Fails if there is no matching transaction active, 
which includes the case where there is no transaction in progress.
</DD>
</DL>

<H3><A NAME="sec:3.4"><SPAN class="sec-nr">3.4</SPAN> <SPAN class="sec-title">Loading 
and saving to file</SPAN></A></H3>

<A NAME="sec:rdffile"></A>

<P>The <CODE>rdf_db</CODE> module can read and write RDF-XML for import 
and export as well as a binary format built for quick load and save 
described in <A class="sec" href="#sec:3.4.3">section 3.4.3</A>. Here 
are the predicates for portable RDF load and save.

<DL>
<DT class="pubdef"><A NAME="rdf_load/1"><STRONG>rdf_load</STRONG>(<VAR>+InOrList</VAR>)</A></DT>
<DD class="defbody">
Load triples from <VAR>In</VAR>, which is either a stream opened for 
reading, an atom specifying a filename, a URL or a list of valid inputs. 
This predicate calls <A NAME="idx:processrdf3:36"></A><SPAN class="pred-ext">process_rdf/3</SPAN> 
to read the source one description at a time, avoiding limits to the 
size of the input. By default, this predicate provides for caching the 
results for quick-load using
<A NAME="idx:rdfloaddb1:37"></A><A class="pred" href="#rdf_load_db/1">rdf_load_db/1</A> 
described below. Caching strategy and options are description in <A class="sec" href="#sec:3.4.1">section 
3.4.1</A>.</DD>
<DT class="pubdef"><A NAME="rdf_load/2"><STRONG>rdf_load</STRONG>(<VAR>+FileOrList, 
+Options</VAR>)</A></DT>
<DD class="defbody">
As <A NAME="idx:rdfload1:38"></A><A class="pred" href="#rdf_load/1">rdf_load/1</A>, 
providing additional options. The options are handed to the RDF parser 
and implemented by <A NAME="idx:processrdf3:39"></A><SPAN class="pred-ext">process_rdf/3</SPAN>. 
In addition, the following options are provided:

<DL>
<DT><STRONG>db</STRONG>(<VAR>+DB</VAR>)</DT>
<DD class="defbody">
Load the data in the given named graph. The default is the URL of the 
source.</DD>
<DT><STRONG>cache</STRONG>(<VAR>+Bool</VAR>)</DT>
<DD class="defbody">
If <CODE>true</CODE> (default), try to use cached data or create a cache 
file. Otherwise load the source.</DD>
<DT><STRONG>format</STRONG>(<VAR>+Format</VAR>)</DT>
<DD class="defbody">
Specify the source format explicitly. Normally this is deduced from the 
filename extension or the mime-type. The core library understands the 
formats <CODE>xml</CODE> (RDF/XML) and <CODE>triples</CODE> (internal 
quick load and cache format).</DD>
<DT><STRONG>if</STRONG>(<VAR>+Condition</VAR>)</DT>
<DD class="defbody">
Condition under which to load the source. <VAR>Condition</VAR> is the 
same as for the Prolog <A NAME="idx:loadfiles2:40"></A><SPAN class="pred-ext">load_files/2</SPAN> 
predicate: <CODE>changed</CODE> (default) load the source if it was not 
loaded before or has changed; <CODE>true</CODE> (re-)loads the source 
unconditionally and <CODE>not_loaded</CODE> loads the source if it was 
not loaded, but does not check for modifications.</DD>
<DT><STRONG>silent</STRONG>(<VAR>+Bool</VAR>)</DT>
<DD class="defbody">
If <VAR>Bool</VAR> is <CODE>true</CODE>, the message reporting 
completion is printed using level <CODE>silent</CODE>. Otherwise the 
level is
<CODE>informational</CODE>. See also <A NAME="idx:printmessage2:41"></A><SPAN class="pred-ext">print_message/2</SPAN>.</DD>
<DT><STRONG>register_namespaces</STRONG>(<VAR>+Bool</VAR>)</DT>
<DD class="defbody">
If <CODE>true</CODE> (default <CODE>false</CODE>), register <CODE>xmlns:ns=url</CODE> 
namespace declarations as rdf_db:ns(ns,url) namespaces if there is no 
conflict.
</DD>
</DL>

</DD>
<DT class="pubdef"><A NAME="rdf_unload/1"><STRONG>rdf_unload</STRONG>(<VAR>+Spec</VAR>)</A></DT>
<DD class="defbody">
Remove all triples loaded from <VAR>Spec</VAR>. <VAR>Spec</VAR> is 
either a graph name or a source specificatipn. If <VAR>Spec</VAR> does 
not refer to a loaded database the predicate succeeds silently.</DD>
<DT class="pubdef"><A NAME="rdf_save/1"><STRONG>rdf_save</STRONG>(<VAR>+File</VAR>)</A></DT>
<DD class="defbody">
Save all known triples to the given <VAR>File</VAR>. Same as
<CODE>rdf_save(File,[])</CODE>.</DD>
<DT class="pubdef"><A NAME="rdf_save/2"><STRONG>rdf_save</STRONG>(<VAR>+File, 
+Options</VAR>)</A></DT>
<DD class="defbody">
Save with options. Provided options are:

<DL>
<DT><STRONG>db</STRONG>(<VAR>+FileRef</VAR>)</DT>
<DD class="defbody">
Save all triples whose file-part of their <VAR>SourceRef</VAR> matches
<VAR>FileRef</VAR> to the given <VAR>File</VAR>. Saving arbitrary 
selections is possible using predicates from <A class="sec" href="#sec:3.4.2">section 
3.4.2</A>.</DD>
<DT><STRONG>anon</STRONG>(<VAR>+Bool</VAR>)</DT>
<DD class="defbody">
if <CODE>anon(false)</CODE> is provided anonymous resources are only 
saved if the resource appears in the object field of another triple that 
is saved.</DD>
<DT><STRONG>base_uri</STRONG>(<VAR>+BaseURI</VAR>)</DT>
<DD class="defbody">
If provided, emit <CODE>xml:base</CODE>="<VAR>BaseURI</VAR>" in the 
header and emit all URIs that are relative to the base-uri. The <CODE>xml:base</CODE> 
declaration can be suppressed using the option
<CODE>write_xml_base(false)</CODE></DD>
<DT><STRONG>write_xml_base</STRONG>(<VAR>+Bool</VAR>)</DT>
<DD class="defbody">
If <CODE>false</CODE> (default <CODE>true</CODE>), do <EM>not</EM> emit 
the
<CODE>xml:base</CODE> declaration from the given <CODE>base_uri</CODE> 
option. The idea behind this option is to be able to create documents 
with URIs relative to the document itself:

<PRE class="code">
        ...,
        rdf_save(File,
                 [ base_uri(BaseURI),
                   write_xml_base(false)
                 ]),
        ...
</PRE>

</DD>
<DT><STRONG>convert_typed_literal</STRONG>(<VAR>:Converter</VAR>)</DT>
<DD class="defbody">
If present, raw literal values are first passed to <VAR>Converter</VAR> 
to apply the reverse of the <CODE>convert_typed_literal</CODE> option of 
the RDF parser. The <VAR>Converter</VAR> is called with the same 
arguments as in the RDF parser, but now with the last argument 
instantiated and the first two unbound. A proper convertor that can be 
used for both loading and saving must be a logical predicate.</DD>
<DT><STRONG>encoding</STRONG>(<VAR>+Encoding</VAR>)</DT>
<DD class="defbody">
Define the XML encoding used for the file. Defined values are
<CODE>utf8</CODE> (default), <CODE>iso_latin_1</CODE> and <CODE>ascii</CODE>. 
Using <CODE>iso_latin_1</CODE> or <CODE>ascii</CODE>, characters not 
covered by the encoding are emitted as XML character entities (<CODE>&amp;#...;</CODE>).</DD>
<DT><STRONG>document_language</STRONG>(<VAR>+XMLLang</VAR>)</DT>
<DD class="defbody">
The value <VAR>XMLLang</VAR> is used for the <CODE>xml:lang</CODE> 
attribute in the outermost <CODE>rdf:RDF</CODE> element. This language 
acts as a default, which implies that the <CODE>xml:lang</CODE> tag is 
only used for literals with a <EM>different</EM> language identifier. 
Please note that this option will cause all literals without language 
tag to be interpreted using <VAR>XMLLang</VAR>.</DD>
<DT><STRONG>namespaces</STRONG>(<VAR>+List</VAR>)</DT>
<DD class="defbody">
Explicitely specify saved namespace declarations. See <A NAME="idx:rdfsaveheader2:42"></A><A class="pred" href="#rdf_save_header/2">rdf_save_header/2</A> 
option namespaces for details.
</DD>
</DL>

</DD>
<DT class="pubdef"><A NAME="rdf_graph/1"><STRONG>rdf_graph</STRONG>(<VAR>?DB</VAR>)</A></DT>
<DD class="defbody">
True if <VAR>DB</VAR> is the name of a graph with at least one triple.</DD>
<DT class="pubdef"><A NAME="rdf_source/1"><STRONG>rdf_source</STRONG>(<VAR>?DB</VAR>)</A></DT>
<DD class="defbody">
Depricated. Use <A NAME="idx:rdfgraph1:43"></A><A class="pred" href="#rdf_graph/1">rdf_graph/1</A> 
or <A NAME="idx:rdfsource2:44"></A><A class="pred" href="#rdf_source/2">rdf_source/2</A> 
in new code.</DD>
<DT class="pubdef"><A NAME="rdf_source/2"><STRONG>rdf_source</STRONG>(<VAR>?DB, 
?SourceURL</VAR>)</A></DT>
<DD class="defbody">
True if the named graph <VAR>DB</VAR> was loaded from the source
<VAR>SourceURL</VAR>. A named graph is associated with a <VAR>SourceURL</VAR> 
by
<A NAME="idx:rdfload2:45"></A><A class="pred" href="#rdf_load/2">rdf_load/2</A>. 
The association is stored in the internal binary format, which ensures 
proper maintenance of the original source through caching and the 
persistency layer.</DD>
<DT class="pubdef"><A NAME="rdf_make/0"><STRONG>rdf_make</STRONG></A></DT>
<DD class="defbody">
Re-load all RDF sourcefiles (see <A NAME="idx:rdfsource1:46"></A><A class="pred" href="#rdf_source/1">rdf_source/1</A>) 
that have changed since they were loaded the last time. This implies all 
triples that originate from the file are removed and the file is 
re-loaded. If the file is cached a new cache-file is written. Please 
note that the new triples are added at the end of the database, possibly 
changing the order of (conflicting) triples.
</DD>
</DL>

<H4><A NAME="sec:3.4.1"><SPAN class="sec-nr">3.4.1</SPAN> <SPAN class="sec-title">Caching 
triples</SPAN></A></H4>

<A NAME="sec:rdfcache"></A>

<P>The library <CODE>library(semweb/rdf_cache)</CODE> defines the 
caching strategy for triples sources. When using large RDF sources, 
caching triples greatly speedup loading RDF documents. The cache library 
implements two caching strategies that are controlled by <A NAME="idx:rdfsetcacheoptions1:47"></A><A class="pred" href="#rdf_set_cache_options/1">rdf_set_cache_options/1</A>.

<P><B>Local caching</B> This approach applies to files only. Triples are 
cached in a sub-directory of the directory holding the source. This 
directory is called <CODE>.cache</CODE> (<CODE>_cache</CODE> on 
Windows). If the cache option <CODE>create_local_directory</CODE> is <CODE>true</CODE>, 
a cache directory is created if posible.

<P><B>Global caching</B> This approach applies to all sources, except 
for unnamed streams. Triples are cached in directory defined by the 
cache option <CODE>global_directory</CODE>.

<P>When loading an RDF file, the system scans the configured cache files 
unless <CODE>cache(false)</CODE> is specified as option to <A NAME="idx:rdfload2:48"></A><A class="pred" href="#rdf_load/2">rdf_load/2</A> 
or caching is disabled. If caching is enabled but no cache exists, the 
system will try to create a cache file. First it will try to do this 
locally. On failure it will try to configured global cache.

<DL>
<DT class="pubdef"><A NAME="rdf_set_cache_options/1"><STRONG>rdf_set_cache_options</STRONG>(<VAR>+Options</VAR>)</A></DT>
<DD class="defbody">
Set cache options. Defined options are:

<DL>
<DT><STRONG>enabled</STRONG>(<VAR>Bool</VAR>)</DT>
<DD class="defbody">
If <CODE>true</CODE> (default), caching is enabled.</DD>
<DT><STRONG>local_directory</STRONG>(<VAR>Atom</VAR>)</DT>
<DD class="defbody">
Local directory to use for caching. Default <CODE>.cache</CODE> 
(Windows: <CODE>_cache</CODE>).</DD>
<DT><STRONG>create_local_directory</STRONG>(<VAR>Bool</VAR>)</DT>
<DD class="defbody">
If <CODE>true</CODE> (default <CODE>false</CODE>), create a local cache 
directory if none exists and the directory can be created.</DD>
<DT><STRONG>global_directory</STRONG>(<VAR>Atom</VAR>)</DT>
<DD class="defbody">
Global directory to use for caching. The directory is created if the 
option <CODE>create_global_directory</CODE> is also given and set to
<CODE>true</CODE>. Sub-directories are created to speedup indexing on 
filesystems that perform poorly on directories with large numbers of 
files. Initially not defined.</DD>
<DT><STRONG>create_global_directory</STRONG>(<VAR>Bool</VAR>)</DT>
<DD class="defbody">
If <CODE>true</CODE> (default <CODE>false</CODE>), create a global cache 
directory if none exists.

<P></DD>
</DL>

</DD>
</DL>

<H4><A NAME="sec:3.4.2"><SPAN class="sec-nr">3.4.2</SPAN> <SPAN class="sec-title">Partial 
save</SPAN></A></H4>

<A NAME="sec:partsave"></A>

<P>Sometimes it is necessary to make more arbitrary selections of 
material to be saved or exchange RDF descriptions over an open network 
link. The predicates in this section provide for this. Character 
encoding issues are derived from the encoding of the <VAR>Stream</VAR>, 
providing support for
<CODE>utf8</CODE>, <CODE>iso_latin_1</CODE> and <CODE>ascii</CODE>.

<DL>
<DT class="pubdef"><A NAME="rdf_save_header/2"><STRONG>rdf_save_header</STRONG>(<VAR>+Stream, 
+Options</VAR>)</A></DT>
<DD class="defbody">
Save an RDF header, with the XML header, <CODE>DOCTYPE</CODE>,
<CODE>ENTITY</CODE> and opening the <CODE>rdf:RDF</CODE> element with 
appropriate namespace declarations. It uses the primitives from <A class="sec" href="#sec:3.5">section 
3.5</A> to generate the required namespaces and desired short-name. <VAR>Options</VAR> 
is one of:

<DL>
<DT><STRONG>db</STRONG>(<VAR>+FileRef</VAR>)</DT>
<DD class="defbody">
Only search for namespaces used in triples labeled with <VAR>FileRef</VAR>.</DD>
<DT><STRONG>namespaces</STRONG>(<VAR>+List</VAR>)</DT>
<DD class="defbody">
Where <VAR>List</VAR> is a list of namespace abbreviations (see
<A class="sec" href="#sec:3.5">section 3.5</A>). With this option, the 
expensive search for all namespaces that may be used by your data is 
omitted. The namespaces <CODE>rdf</CODE> and <CODE>rdfs</CODE> are added 
to the provided
<VAR>List</VAR>. If a namespace is not declared, the resource is emitted 
in non-abreviated form.
</DD>
</DL>

</DD>
<DT class="pubdef"><A NAME="rdf_save_footer/1"><STRONG>rdf_save_footer</STRONG>(<VAR>+Stream</VAR>)</A></DT>
<DD class="defbody">
Close the work opened with <A NAME="idx:rdfsaveheader2:49"></A><A class="pred" href="#rdf_save_header/2">rdf_save_header/2</A>.</DD>
<DT class="pubdef"><A NAME="rdf_save_subject/3"><STRONG>rdf_save_subject</STRONG>(<VAR>+Stream, 
+Subject, +FileRef</VAR>)</A></DT>
<DD class="defbody">
Save everything known about <VAR>Subject</VAR> that matches <VAR>FileRef</VAR>. 
Using an variable for <VAR>FileRef</VAR> saves all triples with
<VAR>Subject</VAR>.</DD>
<DT class="pubdef"><A NAME="rdf_quote_uri/2"><STRONG>rdf_quote_uri</STRONG>(<VAR>+URI, 
-Quoted</VAR>)</A></DT>
<DD class="defbody">
Quote a UNICODE <VAR>URI</VAR>. First the Unicode is represented as 
UTF-8 and then the unsafe characters are mapped to be represented as 
US-ASCII.
</DD>
</DL>

<H4><A NAME="sec:3.4.3"><SPAN class="sec-nr">3.4.3</SPAN> <SPAN class="sec-title">Fast 
loading and saving</SPAN></A></H4>

<A NAME="sec:rdffastfile"></A>

<P>Loading and saving RDF format is relatively slow. For this reason we 
designed a binary format that is more compact, avoids the complications 
of the RDF parser and avoids repetitive lookup of (URL) identifiers. 
Especially the speed improvement of about 25 times is worth-while when 
loading large databases. These predicates are used for caching by
<A NAME="idx:rdfload12:50"></A><A class="pred" href="#rdf_load/1">rdf_load/[1,2]</A> 
under certain conditions.

<DL>
<DT class="pubdef"><A NAME="rdf_save_db/1"><STRONG>rdf_save_db</STRONG>(<VAR>+File</VAR>)</A></DT>
<DD class="defbody">
Save all known triples into <VAR>File</VAR>. The saved version includes 
the
<VAR>SourceRef</VAR> information.</DD>
<DT class="pubdef"><A NAME="rdf_save_db/1"><STRONG>rdf_save_db</STRONG>(<VAR>+File, 
+FileRef</VAR>)</A></DT>
<DD class="defbody">
Save all triples with <VAR>SourceRef</VAR> <VAR>FileRef</VAR>, 
regardless of the line-number. For example, using <CODE>user</CODE> all 
information added using <A NAME="idx:rdfassert3:51"></A><A class="pred" href="#rdf_assert/3">rdf_assert/3</A> 
is stored in the database.</DD>
<DT class="pubdef"><A NAME="rdf_load_db/1"><STRONG>rdf_load_db</STRONG>(<VAR>+File</VAR>)</A></DT>
<DD class="defbody">
Load triples from <VAR>File</VAR>.
</DD>
</DL>

<H4><A NAME="sec:3.4.4"><SPAN class="sec-nr">3.4.4</SPAN> <SPAN class="sec-title">MD5 
digests</SPAN></A></H4>

<P>The <CODE>rdf_db</CODE> library provides for <EM>MD5 digests</EM>. An 
MD5 digest is a 128 bit long hash key computed from the triples based on 
the RFC-1321 standard. MD5 keys are computed for each individual triple 
and added together to compute the final key, resulting in a key that 
describes the triple-set but is independant from the order in which the 
triples appear. It is claimed that it is practically impossible for two 
different datasets to generate the same MD5 key. The Triple20 editor 
uses the MD5 key for detecting whether the triples associated to a file 
have changed as well as to maintain a directory with snapshots of 
versioned ontology files.

<DL>
<DT class="pubdef"><A NAME="rdf_md5/2"><STRONG>rdf_md5</STRONG>(<VAR>+Source, 
-MD5</VAR>)</A></DT>
<DD class="defbody">
Return the MD5 digest for all triples in the database associated to
<VAR>Source</VAR>. The <VAR>MD5</VAR> digest itself is represented as an 
atom holding a 32-character hexadecimal string. The library maintains 
the digest incrementally on <A NAME="idx:rdfload12:52"></A><A class="pred" href="#rdf_load/1">rdf_load/[1,2]</A>, <A NAME="idx:rdfloaddb1:53"></A><A class="pred" href="#rdf_load_db/1">rdf_load_db/1</A>, <A NAME="idx:rdfassert34:54"></A><A class="pred" href="#rdf_assert/3">rdf_assert/[3,4]</A> 
and <A NAME="idx:rdfretractall34:55"></A><A class="pred" href="#rdf_retractall/3">rdf_retractall/[3,4]</A>. 
Checking whether the digest has changed since the last <A NAME="idx:rdfload12:56"></A><A class="pred" href="#rdf_load/1">rdf_load/[1,2]</A> 
call provides a practical means for checking whether the file needs to 
be saved.</DD>
<DT class="pubdef"><A NAME="rdf_atom_md5/3"><STRONG>rdf_atom_md5</STRONG>(<VAR>+Text, 
+Times, -MD5</VAR>)</A></DT>
<DD class="defbody">
Computes the MD5 hash from <VAR>Text</VAR>, which is an atom, string or 
list of character codes. <VAR>Times</VAR> is an integer <VAR>&gt;= 1</VAR>. 
When
<VAR>&gt; 0</VAR>, the MD5 algorithm is repeated <VAR>Times</VAR> times 
on the generated hash. This can be used for password encryption 
algorithms to make generate-and-test loops slow.

<P>This predicate bears little relation to RDF handling. It is provided 
because the RDF library already contains the MD5 algorithm and semantic 
web services may involve security and consistency checking. This 
predicate provides a platform independant alternative to the
<CODE>library(crypt)</CODE> library provided with the <TT>clib</TT> 
package.
</DD>
</DL>

<H3><A NAME="sec:3.5"><SPAN class="sec-nr">3.5</SPAN> <SPAN class="sec-title">Namespace 
Handling</SPAN></A></H3>

<A NAME="sec:rdfns"></A>

<P>Prolog code often contains references to constant resources in a 
known XML namespace. For example,
<CODE>http://www.w3.org/2000/01/rdf-schema#Class</CODE> refers to the 
most general notion of a class. Readability and maintability concerns 
require for abstraction here. The dynamic and multifile predicate 
rdf_db:ns/2 maintains a mapping between short meaningful names and 
namespace locations very much like the XML <CODE>xmlns</CODE> construct. 
The initial mapping contains the namespaces required for the semantic 
web languages themselves:

<PRE class="code">
ns(rdf,  'http://www.w3.org/1999/02/22-rdf-syntax-ns#').
ns(rdfs, 'http://www.w3.org/2000/01/rdf-schema#').
ns(owl,  'http://www.w3.org/2002/7/owl#').
ns(xsd,  'http://www.w3.org/2000/10/XMLSchema#').
ns(dc,   'http://purl.org/dc/elements/1.1/').
ns(eor,  'http://dublincore.org/2000/03/13/eor#').
</PRE>

<P>All predicates for the semweb libraries use <A NAME="idx:goalexpansion2:57"></A><SPAN class="pred-ext">goal_expansion/2</SPAN> 
rules to make the SWI-Prolog compiler rewrite terms of the form
<CODE>Id : Local</CODE> into the fully qualified URL. In addition, the 
following predicates are supplied:

<DL>
<DT class="pubdef"><A NAME="rdf_equal/2"><STRONG>rdf_equal</STRONG>(<VAR>Resource1, 
Resource2</VAR>)</A></DT>
<DD class="defbody">
Defined as <CODE>Resource1 = Resource2</CODE>. As this predicate is 
subject to goal-expansion it can be used to obtain or test global URL 
values to readable values. The following goal unifies <VAR>X</VAR> with
<CODE>http://www.w3.org/2000/01/rdf-schema#Class</CODE> without more 
runtime overhead than normal Prolog unification.

<PRE class="code">
        rdf_equal(rdfs:'Class', X)
</PRE>

</DD>
<DT class="pubdef"><A NAME="rdf_register_ns/2"><STRONG>rdf_register_ns</STRONG>(<VAR>+Alias, 
+URL</VAR>)</A></DT>
<DD class="defbody">
Same as <CODE>rdf_register_ns(Alias, URL,[])</CODE>.</DD>
<DT class="pubdef"><A NAME="rdf_register_ns/2"><STRONG>rdf_register_ns</STRONG>(<VAR>+Alias, 
+URL, +Options</VAR>)</A></DT>
<DD class="defbody">
Register <VAR>Alias</VAR> as a shorthand for <VAR>URL</VAR>. Note that 
the registration must be done before loading any files using them as 
namespace aliases are handled at compiletime through <A NAME="idx:goalexpansion2:58"></A><SPAN class="pred-ext">goal_expansion/2</SPAN>. 
If <VAR>Alias</VAR> already exists the default is to raise a permission 
error. If the option <CODE>force(true)</CODE> is provided, the alias is 
silently modified. Rebinding an alias must be done <EM>before</EM> any 
code is compiled that relies on the alias. If the option
<CODE>keep(true)</CODE> is provided the new registration is silently 
ignored.</DD>
<DT class="pubdef"><A NAME="rdf_global_id/2"><STRONG>rdf_global_id</STRONG>(<VAR>?Alias:Local, 
?Global</VAR>)</A></DT>
<DD class="defbody">
Runtime translation between <VAR>Alias</VAR> and <VAR>Local</VAR> and a
<VAR>Global</VAR> URL. Expansion is normally done at compiletime. This 
predicate is often used to turn a global URL into a more readable term.</DD>
<DT class="pubdef"><A NAME="rdf_global_object/2"><STRONG>rdf_global_object</STRONG>(<VAR>?Object, 
?NameExpandedObject</VAR>)</A></DT>
<DD class="defbody">
As <A NAME="idx:rdfglobalid2:59"></A><A class="pred" href="#rdf_global_id/2">rdf_global_id/2</A>, 
but also expands the type field if the object is of the form <CODE>literal(<CODE>type(Type, 
Value)</CODE>)</CODE>. This predicate is used for goal expansion of the 
object fields in <A NAME="idx:rdf3:60"></A><A class="pred" href="#rdf/3">rdf/3</A> 
and similar goals.</DD>
<DT class="pubdef"><A NAME="rdf_global_term/2"><STRONG>rdf_global_term</STRONG>(<VAR>+Term0, 
-Term</VAR>)</A></DT>
<DD class="defbody">
Expands all <VAR>Alias</VAR>:<VAR>Local</VAR> in <VAR>Term0</VAR> and 
return the result in <VAR>Term</VAR>. Use infrequently for runtime 
expansion of namespace identifiers.</DD>
<DT class="pubdef"><A NAME="rdf_split_url/3"><STRONG>rdf_split_url</STRONG>(<VAR>?Base, 
?Local, ?URL</VAR>)</A></DT>
<DD class="defbody">
Split a URL into a prefix and local part if used in mode -,-,+ or simply 
behave as <A NAME="idx:atomconcat3:61"></A><SPAN class="pred-ext">atom_concat/3</SPAN> 
in other modes. The <VAR>URL</VAR> is split on the last <CODE>#</CODE> 
or <CODE>/</CODE> character.
</DD>
</DL>

<H4><A NAME="sec:3.5.1"><SPAN class="sec-nr">3.5.1</SPAN> <SPAN class="sec-title">Namespace 
handling for custom predicates</SPAN></A></H4>

<P>If we implement a new predicate based on one of the predicates of the 
semweb libraries that expands namespaces, namespace expansion is not 
automatically available to it. Consider the following code computing the 
number of distinct objects for a certain property on a certain object.

<PRE class="code">
cardinality(S, P, C) :-
        (   setof(O, rdf_has(S, P, O), Os)
        -&gt;  length(Os, C)
        ;   C = 0
        ).
</PRE>

<P>Now assume we want to write <A NAME="idx:labels2:62"></A><SPAN class="pred-ext">labels/2</SPAN> 
that returns the number of distict labels of a resource:

<PRE class="code">
labels(S, C) :-
        cardinality(S, rdfs:label, C).
</PRE>

<P>This code will <EM>not work</EM> as <CODE>rdfs:label</CODE> is not 
expanded at compile time. To make this work, we need to add an <A NAME="idx:rdfmeta1:63"></A><A class="pred" href="#rdf_meta/1">rdf_meta/1</A> 
declaration.

<PRE class="code">
:- rdf_meta
        cardinality(r,r,-).
</PRE>

<DL>
<DT class="pubdef"><A NAME="rdf_meta/1"><STRONG>rdf_meta</STRONG>(<VAR>Heads</VAR>)</A></DT>
<DD class="defbody">
This predicate defines the argument types of the named predicates, which 
will force compile time namespace expansion for these predicates.
<VAR>Heads</VAR> is a coma-separated list of callable terms. Defined 
argument properties are:

<DL>
<DT><STRONG>:</STRONG></DT>
<DD class="defbody">
Argument is a goal. The goal is processed using <A NAME="idx:expandgoal2:64"></A><SPAN class="pred-ext">expand_goal/2</SPAN>, 
recursively applying goal transformation on the argument.
</DD>
<DT><STRONG>+</STRONG></DT>
<DD class="defbody">
The argument is instantiated at entry. Nothing is changed.
</DD>
<DT><STRONG>-</STRONG></DT>
<DD class="defbody">
The argument is not instantiated at entry. Nothing is changed.
</DD>
<DT><STRONG>?</STRONG></DT>
<DD class="defbody">
The argument is unbound or instantiated at entry. Nothing is changed.
</DD>
<DT><STRONG>@</STRONG></DT>
<DD class="defbody">
The argument is not changed.
</DD>
<DT><STRONG>r</STRONG></DT>
<DD class="defbody">
The argument must be a resource. If it is a term &lt;<VAR>namespace</VAR>&gt;:&lt;<VAR>local</VAR>&gt; 
it is translated.
</DD>
<DT><STRONG>o</STRONG></DT>
<DD class="defbody">
The argument is an object or resource.
</DD>
<DT><STRONG>t</STRONG></DT>
<DD class="defbody">
The argument is a term that must be translated. Expansion will translate 
all occurences of &lt;<VAR>namespace</VAR>&gt;:&lt;<VAR>local</VAR>&gt; 
appearing anywhere in the term.
</DD>
</DL>

<P>As it is subject to <A NAME="idx:termexpansion2:65"></A><SPAN class="pred-ext">term_expansion/2</SPAN>, 
the <A NAME="idx:rdfmeta1:66"></A><A class="pred" href="#rdf_meta/1">rdf_meta/1</A> 
declaration can only be used as a <EM>directive</EM>. The directive must 
be processed before the definition of the predicates as well as before 
compiling code that uses the rdf meta-predicates. The atom <CODE>rdf_meta</CODE> 
is declared as an operator exported from library <CODE>rdf_db.pl</CODE>. 
Files using
<A NAME="idx:rdfmeta1:67"></A><A class="pred" href="#rdf_meta/1">rdf_meta/1</A> <EM>must</EM> 
explicitely load <CODE>rdf_db.pl</CODE>.

<P>Below are some examples from
<CODE>rdf_db.pl</CODE>

<PRE class="code">
:- rdf_meta
        rdf(r,r,o),
        rdf_source_location(r,-),
        rdf_transaction(:).
</PRE>

<P></DD>
</DL>

<H3><A NAME="sec:3.6"><SPAN class="sec-nr">3.6</SPAN> <SPAN class="sec-title">Monitoring 
the database</SPAN></A></H3>

<A NAME="sec:rdfmonitor"></A>

<P>Considering performance and modularity, we are working on a 
replacement of the <CODE>rdf_edit</CODE> (see <A class="sec" href="#sec:7">section 
7</A>) layered design to deal with updates, journalling, transactions, 
etc. Where the rdf_edit approach creates a single layer on top of rdf_db 
and code using the RDF database must select whether to use rdf_db.pl or 
rdf_edit.pl, the new approach allows to register <EM>monitors</EM>. This 
allows multiple modules to provide additional services, while these 
services will be used regardless of how the database is modified.

<P>Monitors are used by the persistency library (<A class="sec" href="#sec:4.6">section 
4.6</A>) and the literal indexing library (<A class="sec" href="#sec:4.4">section 
4.4</A>).

<DL>
<DT class="pubdef"><A NAME="rdf_monitor/2"><STRONG>rdf_monitor</STRONG>(<VAR>:Goal, 
+Mask</VAR>)</A></DT>
<DD class="defbody">
<VAR>Goal</VAR> is called for modifications of the database. It is 
called with a single argument that describes the modification. Defined 
events are:

<DL>
<DT><STRONG>assert</STRONG>(<VAR>+S, +P, +O, +DB</VAR>)</DT>
<DD class="defbody">
A triple has been asserted.
</DD>
<DT><STRONG>retract</STRONG>(<VAR>+S, +P, +O, +DB</VAR>)</DT>
<DD class="defbody">
A triple has been deleted.
</DD>
<DT><STRONG>update</STRONG>(<VAR>+S, +P, +O, +DB, +Action</VAR>)</DT>
<DD class="defbody">
A triple has been updated.
</DD>
<DT><STRONG>new_literal</STRONG>(<VAR>+Literal</VAR>)</DT>
<DD class="defbody">
A new literal has been created. <VAR>Literal</VAR> is the argument of
<CODE>literal(Arg)</CODE> of the triple's object. This event is 
introduced in version 2.5.0 of this library.
</DD>
<DT><STRONG>old_literal</STRONG>(<VAR>+Literal</VAR>)</DT>
<DD class="defbody">
The literal <VAR>Literal</VAR> is no longer used by any triple.
</DD>
<DT><STRONG>transaction</STRONG>(<VAR>+BeginOrEnd, +Id</VAR>)</DT>
<DD class="defbody">
Mark begin or end of the <EM>commit</EM> of a transaction started by
<A NAME="idx:rdftransaction2:68"></A><A class="pred" href="#rdf_transaction/2">rdf_transaction/2</A>. <VAR>BeginOrEnd</VAR> 
is <CODE>begin(Nesting)</CODE> or
<CODE>end(Nesting)</CODE>. <VAR>Nesting</VAR> expresses the nesting 
level of transactions, starting at `0' for a toplevel transaction. <VAR>Id</VAR> 
is the second argument of <A NAME="idx:rdftransaction2:69"></A><A class="pred" href="#rdf_transaction/2">rdf_transaction/2</A>. 
The following transaction Ids are pre-defined by the library:

<DL>
<DT><STRONG>parse</STRONG>(<VAR>Id</VAR>)</DT>
<DD class="defbody">
A file is loaded using <A NAME="idx:rdfload2:70"></A><A class="pred" href="#rdf_load/2">rdf_load/2</A>. <VAR>Id</VAR> 
is one of <CODE>file(Path)</CODE> or <CODE>stream(Stream)</CODE>.
</DD>
<DT><STRONG>unload</STRONG>(<VAR>DB</VAR>)</DT>
<DD class="defbody">
All triples with source <VAR>DB</VAR> are being unloaded using <A NAME="idx:rdfunload1:71"></A><A class="pred" href="#rdf_unload/1">rdf_unload/1</A>.
</DD>
<DT><STRONG>reset</STRONG></DT>
<DD class="defbody">
Issued by <A NAME="idx:rdfresetdb0:72"></A><A class="pred" href="#rdf_reset_db/0">rdf_reset_db/0</A>.
</DD>
</DL>

</DD>
<DT><STRONG>load</STRONG>(<VAR>+BeginOrEnd, +Spec</VAR>)</DT>
<DD class="defbody">
Mark begin or end of <A NAME="idx:rdfloaddb1:73"></A><A class="pred" href="#rdf_load_db/1">rdf_load_db/1</A> 
or load through <A NAME="idx:rdfload2:74"></A><A class="pred" href="#rdf_load/2">rdf_load/2</A> 
from a cached file. <VAR>Spec</VAR> is currently defined as <CODE>file(Path)</CODE>.
</DD>
<DT><STRONG>rehash</STRONG>(<VAR>+BeginOrEnd</VAR>)</DT>
<DD class="defbody">
Marks begin/end of a re-hash due to required re-indexing or garbage 
collection.
</DD>
</DL>

<P><VAR>Mask</VAR> is a list of events this monitor is interested in. 
Default (empty list) is to report all events. Otherwise each element is 
of the form +Event or -Event to include or exclude monitoring for 
certain events. The event-names are the functor names of the events 
described above. The special name <CODE>all</CODE> refers to all events 
and
<CODE>assert(load)</CODE> to assert events originating from <A NAME="idx:rdfloaddb1:75"></A><A class="pred" href="#rdf_load_db/1">rdf_load_db/1</A>. 
As loading triples using <A NAME="idx:rdfloaddb1:76"></A><A class="pred" href="#rdf_load_db/1">rdf_load_db/1</A> 
is very fast, monitoring this at the triple level may seriously harm 
performance.

<P>This predicate is intended to maintain derived data, such as a 
journal, information for <EM>undo</EM>, additional indexing in literals, 
etc. There is no way to remove registered monitors. If this is required 
one should register a monitor that maintains a dynamic list of 
subscribers like the XPCE broadcast library. A second subscription of 
the same hook predicate only re-assignes the mask.

<P>The monitor hooks are called in the order of registration and in the 
same thread that issued the database manipulation. To process all 
changes in one thread they should be send to a thread message queue. For 
all updating events, the monitor is called while the calling thread has 
a write lock on the RDF store. This implies that these events are 
processed strickly synchronous, even if modifications originate from 
multiple threads. In particular, the <CODE>transaction</CODE> <EM>begin</EM>, 
... <EM>updates</EM> ... <EM>end</EM> sequence is never interleaved with 
other events. Same for <CODE>load</CODE> and <CODE>parse</CODE>.
</DD>
</DL>

<H3><A NAME="sec:3.7"><SPAN class="sec-nr">3.7</SPAN> <SPAN class="sec-title">Miscellaneous 
predicates</SPAN></A></H3>

<P>This section describes the remaining predicates of the <CODE>rdf_db</CODE> 
module.

<DL>
<DT class="pubdef"><A NAME="rdf_node/1"><STRONG>rdf_node</STRONG>(<VAR>-Id</VAR>)</A></DT>
<DD class="defbody">
Generate a unique reference. The returned atom is guaranteed not to 
occur in the current database in any field of any triple.</DD>
<DT class="pubdef"><A NAME="rdf_bnode/1"><STRONG>rdf_bnode</STRONG>(<VAR>-Id</VAR>)</A></DT>
<DD class="defbody">
Generate a unique blank node reference. The returned atom is guaranteed 
not to occur in the current database in any field of any triple and 
starts with '__bnode'.</DD>
<DT class="pubdef"><A NAME="rdf_is_bnode/1"><STRONG>rdf_is_bnode</STRONG>(<VAR>+Id</VAR>)</A></DT>
<DD class="defbody">
Succeeds if <VAR>Id</VAR> is a blank node identifier (also called
<EM>anonymous resource</EM>). In the current implementation this implies 
it is an atom starting with a double underscore.</DD>
<DT class="pubdef"><A NAME="rdf_source_location/2"><STRONG>rdf_source_location</STRONG>(<VAR>+Subject, 
-SourceRef</VAR>)</A></DT>
<DD class="defbody">
Return the source-location as <VAR>File</VAR>:<VAR>Line</VAR> of the 
first triple that is about <VAR>Subject</VAR>.</DD>
<DT class="pubdef"><A NAME="rdf_generation/1"><STRONG>rdf_generation</STRONG>(<VAR>-Generation</VAR>)</A></DT>
<DD class="defbody">
Returns the <VAR>Generation</VAR> of the database. Each modification to 
the database increments the generation. It can be used to check the 
validity of cached results deduced from the database. Modifications 
changing multiple triples increment <VAR>Generation</VAR> with the 
number of triples modified, providing a heuristic for `how dirty' cached 
results may be.</DD>
<DT class="pubdef"><A NAME="rdf_estimate_complexity/4"><STRONG>rdf_estimate_complexity</STRONG>(<VAR>?Subject, 
?Predicate, ?Object, -Complexity</VAR>)</A></DT>
<DD class="defbody">
Return the number of alternatives as indicated by the database internal 
hashed indexing. This is a rough measure for the number of alternatives 
we can expect for an <A NAME="idx:rdfhas3:77"></A><A class="pred" href="#rdf_has/3">rdf_has/3</A> 
call using the given three arguments. When called with three variables, 
the total number of triples is returned. This estimate is used in query 
optimisation. See also <A NAME="idx:rdfpredicateproperty2:78"></A><A class="pred" href="#rdf_predicate_property/2">rdf_predicate_property/2</A> 
and <A NAME="idx:rdfstatistics1:79"></A><A class="pred" href="#rdf_statistics/1">rdf_statistics/1</A> 
for additional information to help optimisers.</DD>
<DT class="pubdef"><A NAME="rdf_statistics/1"><STRONG>rdf_statistics</STRONG>(<VAR>?Statistics</VAR>)</A></DT>
<DD class="defbody">
Report statistics collected by the <CODE>rdf_db</CODE> module. Defined 
values for <VAR>Statistics</VAR> are:

<DL>
<DT><STRONG>lookup</STRONG>(<VAR>?Index, -Count</VAR>)</DT>
<DD class="defbody">
Number of lookups using a pattern of instantiated fields. <VAR>Index</VAR> 
is a term <CODE>rdf(S,P,O)</CODE>, where <VAR>S</VAR>, <VAR>P</VAR> and <VAR>O</VAR> 
are either <CODE>+</CODE> or <CODE>-</CODE>. For example <CODE>rdf(+,+,-)</CODE> 
returns the lookups with subject and predicate specified and object 
unbound.</DD>
<DT><STRONG>properties</STRONG>(<VAR>-Count</VAR>)</DT>
<DD class="defbody">
Number of unique values for the second field of the triple set.</DD>
<DT><STRONG>sources</STRONG>(<VAR>-Count</VAR>)</DT>
<DD class="defbody">
Number of files loaded through <A NAME="idx:rdfload1:80"></A><A class="pred" href="#rdf_load/1">rdf_load/1</A>.</DD>
<DT><STRONG>subjects</STRONG>(<VAR>-Count</VAR>)</DT>
<DD class="defbody">
Number of unique values for the first field of the triple set.</DD>
<DT><STRONG>literals</STRONG>(<VAR>-Count</VAR>)</DT>
<DD class="defbody">
Total number of unique literal values in the database. See also
<A class="sec" href="#sec:3.1.1">section 3.1.1</A>.</DD>
<DT><STRONG>triples</STRONG>(<VAR>-Count</VAR>)</DT>
<DD class="defbody">
Total number of triples in the database.</DD>
<DT><STRONG>triples_by_file</STRONG>(<VAR>?File, -Count</VAR>)</DT>
<DD class="defbody">
Enumerate the number of triples associated to each file.</DD>
<DT><STRONG>searched_nodes</STRONG>(<VAR>-Count</VAR>)</DT>
<DD class="defbody">
Number of nodes explored in <A NAME="idx:rdfreachable3:81"></A><A class="pred" href="#rdf_reachable/3">rdf_reachable/3</A>.</DD>
<DT><STRONG>gc</STRONG>(<VAR>-Count, -Time</VAR>)</DT>
<DD class="defbody">
Number of garbage collections and time spent in seconds represented as a 
float.</DD>
<DT><STRONG>rehash</STRONG>(<VAR>-Count, -Time</VAR>)</DT>
<DD class="defbody">
Number of times the hash-tables were enlarged and time spent in seconds 
represented as a float.</DD>
<DT><STRONG>core</STRONG>(<VAR>-Bytes</VAR>)</DT>
<DD class="defbody">
Core used by the triple store. This includes all memory allocated on 
behalf of the library, but <EM>not</EM> the memory allocated in Prolog 
atoms referenced (only) by the triple store.
</DD>
</DL>

</DD>
<DT class="pubdef"><A NAME="rdf_match_label/3"><STRONG>rdf_match_label</STRONG>(<VAR>+Method, 
+Search, +Atom</VAR>)</A></DT>
<DD class="defbody">
True if <VAR>Search</VAR> matches <VAR>Atom</VAR> as defined by <VAR>Method</VAR>. 
All matching is performed case-insensitive. Defines methods are:

<DL>
<DT><STRONG>exact</STRONG></DT>
<DD class="defbody">
Perform exact, but case-insensitive match.
</DD>
<DT><STRONG>substring</STRONG></DT>
<DD class="defbody">
<VAR>Search</VAR> is a sub-string of <VAR>Text</VAR>.
</DD>
<DT><STRONG>word</STRONG></DT>
<DD class="defbody">
<VAR>Search</VAR> appears as a whole-word in <VAR>Text</VAR>.
</DD>
<DT><STRONG>prefix</STRONG></DT>
<DD class="defbody">
<VAR>Text</VAR> start with <VAR>Search</VAR>.
</DD>
<DT><STRONG>like</STRONG></DT>
<DD class="defbody">
<VAR>Text</VAR> matches <VAR>Search</VAR>, case insensitively, where the 
`*' character in <VAR>Search</VAR> matches zero or more characters.
</DD>
</DL>

</DD>
<DT class="pubdef"><A NAME="rdf_reset_db/0"><STRONG>rdf_reset_db</STRONG></A></DT>
<DD class="defbody">
Erase all triples from the database and reset all counts and statistics 
information.</DD>
<DT class="pubdef"><A NAME="rdf_version/1"><STRONG>rdf_version</STRONG>(<VAR>-Version</VAR>)</A></DT>
<DD class="defbody">
Unify <VAR>Version</VAR> with the library version number. This number 
is, like to the SWI-Prolog version flag, defined as <VAR>10,000 &times; 
Major + 100 &times; Minor + Patch</VAR>.
</DD>
</DL>

<H3><A NAME="sec:3.8"><SPAN class="sec-nr">3.8</SPAN> <SPAN class="sec-title">Issues 
with rdf_db</SPAN></A></H3>

<A NAME="sec:rdfissues"></A>

<P>This RDF low-level module has been created after two year 
experimenting with a plain Prolog based module and a brief evaluation of 
a second generation pure Prolog implementation. The aim was to be able 
to handle upto about 5 million triples on standard (notebook) hardware 
and deal efficiently with <CODE>subPropertyOf</CODE> which was 
identified as a crucial feature of RDFS to realise fusion of different 
data-sets.

<P>The following issues are identified and not solved in suitable 
manner.

<DL>
<DT><B><CODE>subPropertyOf</CODE> of <CODE>subPropertyOf</CODE></B></DT>
<DD>
is not supported.</DD>
<DT><B>Equivalence</B></DT>
<DD>
Similar to <CODE>subPropertyOf</CODE>, it is likely to be profitable to 
handle resource identity efficient. The current system has no support 
for it.
</DD>
</DL>

<H2><A NAME="sec:4"><SPAN class="sec-nr">4</SPAN> <SPAN class="sec-title">Plugin 
modules for rdf_db</SPAN></A></H2>

<A NAME="sec:plugin"></A>

<P>The <CODE>library(rdf_db)</CODE> module provides several hooks for 
extending its functionality. Database updates can be monitored and acted 
upon through the features described in <A class="sec" href="#sec:3.6">section 
3.6</A>. The predicate <A NAME="idx:rdfload2:82"></A><A class="pred" href="#rdf_load/2">rdf_load/2</A> 
can be hooked to deal with different formats such as <EM>turtle</EM>, 
different input sources (e.g. http) and different strategies for caching 
results.

<H3><A NAME="sec:4.1"><SPAN class="sec-nr">4.1</SPAN> <SPAN class="sec-title">Hooks 
into the RDF library</SPAN></A></H3>

<A NAME="sec:hooks"></A>

<P>The hooks below are used to add new RDF file formats and sources from 
which to load data to the library. They are used by the modules 
described below and distributed with the package. Please examine the 
source-code if you want to add new formats or locations.

<DL>
<DT><B><CODE>rdf_turtle.pl</CODE></B></DT>
<DD>
Load files in the Turtle format. See <A class="sec" href="#sec:4.7">section 
4.7</A>.
</DD>
<DT><B><CODE>rdf_zlib_plugin.pl</CODE></B></DT>
<DD>
Load <B>gzip</B> compressed files transparently. See <A class="sec" href="#sec:4.2">section 
4.2</A>.
</DD>
<DT><B><CODE>rdf_http_plugin.pl</CODE></B></DT>
<DD>
Load RDF documents from HTTP servers. See <A class="sec" href="#sec:4.3">section 
4.3</A>.
</DD>
</DL>

<DL>
<DT class="pubdef"><A NAME="rdf_db:rdf_open_hook/3"><STRONG>rdf_db:rdf_open_hook</STRONG>(<VAR>+Input, 
-Stream, -Format</VAR>)</A></DT>
<DD class="defbody">
Open an input. <VAR>Input</VAR> is one of <CODE>file(+Name)</CODE>,
<CODE>stream(+Stream)</CODE> or <CODE>url(Protocol, URL)</CODE>. If this 
hook succeeds, the RDF will be read from Stream using <A NAME="idx:rdfloadstream3:83"></A><SPAN class="pred-ext">rdf_load_stream/3</SPAN>. 
Otherwise the default open functionality for file and stream are used.</DD>
<DT class="pubdef"><A NAME="rdf_db:rdf_load_stream/3"><STRONG>rdf_db:rdf_load_stream</STRONG>(<VAR>+Format, 
+Stream, +Options</VAR>)</A></DT>
<DD class="defbody">
Actually load the RDF from <VAR>Stream</VAR> into the RDF database.
<VAR>Format</VAR> describes the format and is produced either by
<A NAME="idx:rdfinputinfo3:84"></A><SPAN class="pred-ext">rdf_input_info/3</SPAN> 
or <A NAME="idx:rdffiletype2:85"></A><SPAN class="pred-ext">rdf_file_type/2</SPAN>.</DD>
<DT class="pubdef"><A NAME="rdf_db:rdf_input_info/3"><STRONG>rdf_db:rdf_input_info</STRONG>(<VAR>+Input, 
-Modified, -Format</VAR>)</A></DT>
<DD class="defbody">
Gather information on <VAR>Input</VAR>. <VAR>Modified</VAR> is the last 
modification time of the source as a POSIX time-stamp (see <A NAME="idx:timefile2:86"></A><SPAN class="pred-ext">time_file/2</SPAN>).
<VAR>Format</VAR> is the RDF format of the file. See <A NAME="idx:rdffiletype2:87"></A><SPAN class="pred-ext">rdf_file_type/2</SPAN> 
for details. It is allowed to leave the output variables unbound. 
Ultimately the default modified time is `0' and the format is assumed to 
be
<CODE>xml</CODE>.</DD>
<DT class="pubdef"><A NAME="rdf_db:rdf_file_type/2"><STRONG>rdf_db:rdf_file_type</STRONG>(<VAR>?Extension, 
?Format</VAR>)</A></DT>
<DD class="defbody">
True if <VAR>Format</VAR> is the default RDF file format for files with 
the given extension. <VAR>Extension</VAR> is lowercase and without a 
'.'. E.g. <CODE>owl</CODE>. <VAR>Format</VAR> is either a built-in 
format (<CODE>xml</CODE> or <CODE>triples</CODE>) or a format understood 
by the <A NAME="idx:rdfloadstream3:88"></A><SPAN class="pred-ext">rdf_load_stream/3</SPAN> 
hook.</DD>
<DT class="pubdef"><A NAME="rdf_db:url_protocol/1"><STRONG>rdf_db:url_protocol</STRONG>(<VAR>?Protocol</VAR>)</A></DT>
<DD class="defbody">
True if <VAR>Protocol</VAR> is a URL protocol recognised by <A NAME="idx:rdfload2:89"></A><A class="pred" href="#rdf_load/2">rdf_load/2</A>.
</DD>
</DL>

<H3><A NAME="sec:4.2"><SPAN class="sec-nr">4.2</SPAN> <SPAN class="sec-title">Library 
semweb/rdf_zlib_plugin</SPAN></A></H3>

<A NAME="sec:zlib"></A>

<P><A NAME="idx:gzformat:90"></A><A NAME="idx:gzip:91"></A><A NAME="idx:compresseddata:92"></A>This 
module uses the <CODE>library(zlib)</CODE> library to load compressed 
files on the fly. The extension of the file must be <CODE>.gz</CODE>. 
The file format is deduced by the extension after stripping the <CODE>.gz</CODE> 
extension. E.g. <CODE>rdf_load('file.rdf.gz')</CODE>.

<H3><A NAME="sec:4.3"><SPAN class="sec-nr">4.3</SPAN> <SPAN class="sec-title">Library 
semweb/rdf_http_plugin</SPAN></A></H3>

<A NAME="sec:http"></A>

<P><A NAME="idx:xhtml:93"></A>This module allows for <CODE>rdf_load('http://...')</CODE>. 
It exploits the library <CODE>library(http/http_open.pl)</CODE>. The 
format of the URL is determined from the mime-type returned by the 
server if this is one of
<CODE>text/rdf+xml</CODE>, <CODE>application/x-turtle</CODE> or
<CODE>application/turtle</CODE>. As RDF mime-types are not yet widely 
supported, the plugin uses the extension of the URL if the claimed 
mime-type is not one of the above. In addition, it recognises
<CODE>text/html</CODE> and <CODE>application/xhtml+xml</CODE>, scanning 
the XML content for embedded RDF.

<H3><A NAME="sec:4.4"><SPAN class="sec-nr">4.4</SPAN> <SPAN class="sec-title">Library 
semweb/rdf_litindex: Indexing words in literals</SPAN></A></H3>

<A NAME="sec:rdflitindex"></A>

<P>The library <CODE>library(semweb/rdf_litindex.pl)</CODE> exploits the 
primitives of <A class="sec" href="#sec:4.5">section 4.5</A> and the NLP 
package to provide indexing on words inside literal constants. It also 
allows for fuzzy matching using stemming and `sounds-like' based on the <EM>double 
metaphone</EM> algorithm of the NLP package.

<DL>
<DT class="pubdef"><A NAME="rdf_find_literals/2"><STRONG>rdf_find_literals</STRONG>(<VAR>+Spec, 
-ListOfLiterals</VAR>)</A></DT>
<DD class="defbody">
Find literals (without type or language specification) that satisfy
<VAR>Spec</VAR>. The required indices are created as needed and kept 
up-to-date using hooks registered with <A NAME="idx:rdfmonitor2:94"></A><A class="pred" href="#rdf_monitor/2">rdf_monitor/2</A>. 
Numerical indexing is currently limited to integers in the range <VAR>&#177;2^30</VAR> 
(<VAR>&#177;2^62 on 64-bit platforms</VAR>). <VAR>Spec</VAR> is defined 
as:

<DL>
<DT><STRONG>and</STRONG>(<VAR>Spec1, Spec2</VAR>)</DT>
<DD class="defbody">
Intersection of both specifications.</DD>
<DT><STRONG>or</STRONG>(<VAR>Spec1, Spec2</VAR>)</DT>
<DD class="defbody">
Union of both specifications.</DD>
<DT><STRONG>not</STRONG>(<VAR>Spec</VAR>)</DT>
<DD class="defbody">
Negation of <VAR>Spec</VAR>. After translation of the full specification 
to
<EM>Disjunctive Normal Form</EM> (DNF), negations are only allowed 
inside a conjunction with at least one positive literal.</DD>
<DT><STRONG>case</STRONG>(<VAR>Word</VAR>)</DT>
<DD class="defbody">
Matches all literals containing the word <VAR>Word</VAR>, doing the 
match case insensitive and after removing diacritics.</DD>
<DT><STRONG>stem</STRONG>(<VAR>Like</VAR>)</DT>
<DD class="defbody">
Matches all literals containing at least one word that has the same stem 
as <VAR>Like</VAR> using the Porter stem algorithm. See NLP package for 
details.</DD>
<DT><STRONG>sounds</STRONG>(<VAR>Like</VAR>)</DT>
<DD class="defbody">
Matches all literals containing at least one word that `sounds like'
<VAR>Like</VAR> using the double metaphone algorithm. See NLP package 
for details.</DD>
<DT><STRONG>prefix</STRONG>(<VAR>Prefix</VAR>)</DT>
<DD class="defbody">
Matches all literals containing at least one word that starts with 
Prefix, discarding diacritics and case.</DD>
<DT><STRONG>between</STRONG>(<VAR>Low, High</VAR>)</DT>
<DD class="defbody">
Matches all literals containing an integer token in the range
<VAR>Low</VAR>..<VAR>High</VAR>, including the boundaries.</DD>
<DT><STRONG>ge</STRONG>(<VAR>Low</VAR>)</DT>
<DD class="defbody">
Matches all literals containing an integer token with value
<VAR>Low</VAR> or higher.</DD>
<DT><STRONG>le</STRONG>(<VAR>High</VAR>)</DT>
<DD class="defbody">
Matches all literals containing an integer token with value
<VAR>High</VAR> or lower.</DD>
<DT><STRONG>Token</STRONG></DT>
<DD class="defbody">
Matches all literals containing the given token. See <A NAME="idx:tokenizeatom2:95"></A><SPAN class="pred-ext">tokenize_atom/2</SPAN> 
of the NLP package for details.
</DD>
</DL>

</DD>
<DT class="pubdef"><A NAME="rdf_token_expansions/2"><STRONG>rdf_token_expansions</STRONG>(<VAR>+Spec, 
-Expansions</VAR>)</A></DT>
<DD class="defbody">
Uses the same database as <A NAME="idx:rdffindliterals2:96"></A><A class="pred" href="#rdf_find_literals/2">rdf_find_literals/2</A> 
to find possible expansions of <VAR>Spec</VAR>, i.e. which words `sound 
like', `have prefix', etc. <VAR>Spec</VAR> is a compound expression as 
in <A NAME="idx:rdffindliterals2:97"></A><A class="pred" href="#rdf_find_literals/2">rdf_find_literals/2</A>.
<VAR>Expansions</VAR> is unified to a list of terms <CODE>sounds(Like, 
Words)</CODE>, <CODE>stem(Like, Words)</CODE> or <CODE>prefix(Prefix, 
Words)</CODE>. On compound expressions, only combinations that provide 
literals are returned. Below is an example after loading the ULAN<SUP class="fn">6<SPAN class="fn-text">Unified 
List of Artist Names from the Getty Foundation.</SPAN></SUP> database 
and showing all words that sounds like `rembrandt' and appear together 
in a literal with the word `Rijn'. Finding this result from the 228,710 
literals contained in ULAN requires 0.54 milliseconds (AMD 1600+).

<PRE class="code">
?- rdf_token_expansions(and('Rijn', sounds(rembrandt)), L).

L = [sounds(rembrandt, ['Rambrandt', 'Reimbrant', 'Rembradt',
                        'Rembrand', 'Rembrandt', 'Rembrandtsz',
                        'Rembrant', 'Rembrants', 'Rijmbrand'])]
</PRE>

<P>Here is another example, illustrating handling of diacritics:
<BLOCKQUOTE>

<PRE class="code">
?- rdf_token_expansions(case(cafe), L).

L = [case(cafe, [cafe, caf\'e])]
</PRE>

</BLOCKQUOTE>
</DD>
<DT class="pubdef"><A NAME="rdf_tokenize_literal/2"><STRONG>rdf_tokenize_literal</STRONG>(<VAR>+Literal, 
-Tokens</VAR>)</A></DT>
<DD class="defbody">
Tokenize a literal, returning a list of atoms and integers in the range
<VAR>-1073741824 ... 1073741823</VAR>. As tokenization is in general 
domain and task-dependent this predicate first calls the hook
<CODE>rdf_litindex:tokenization(Literal, -Tokens)</CODE>. On failure it 
calls <A NAME="idx:tokenizeatom2:98"></A><SPAN class="pred-ext">tokenize_atom/2</SPAN> 
from the NLP package and deletes the following: atoms of length 1, 
floats, integers that are out of range and the english words <CODE>and</CODE>, <CODE>an</CODE>, <CODE>or</CODE>, <CODE>of</CODE>,
<CODE>on</CODE>, <CODE>in</CODE>, <CODE>this</CODE> and <CODE>the</CODE>. 
Deletion first calls the hook <CODE>rdf_litindex:exclude_from_index(token, 
X)</CODE>. This hook is called as follows:

<PRE class="code">
no_index_token(X) :-
        exclude_from_index(token, X), !.
no_index_token(X) :-
        ...
</PRE>

<P></DD>
</DL>

<H3><A NAME="sec:4.5"><SPAN class="sec-nr">4.5</SPAN> <SPAN class="sec-title">Literal 
maps: Creating additional indices on literals</SPAN></A></H3>

<A NAME="sec:rdflitmap"></A>

<P>`Literal maps' provide a relation between literal values, intended to 
create additional indexes on literals. The current implementation can 
only deal with integers and atoms (string literals). A literal map 
maintains an ordered set of <EM>keys</EM>. The ordering uses the same 
rules as described in <A class="sec" href="#sec:3.1.1">section 3.1.1</A>. 
Each key is associated with an ordered set of <EM>values</EM>. Literal 
map objects can be shared between threads, using a locking strategy that 
allows for multiple concurrent readers.

<P>Typically, this module is used together with <A NAME="idx:rdfmonitor2:99"></A><A class="pred" href="#rdf_monitor/2">rdf_monitor/2</A> 
on the channals <CODE>new_literal</CODE> and <CODE>old_literal</CODE> to 
maintain an index of words that appear in a literal. Further abstraction 
using Porter stemming or Metaphone can be used to create additional 
search indices. These can map either directly to the literal values, or 
indirectly to the plain word-map. The SWI-Prolog NLP package provides 
complimentary building blocks, such as a tokenizer, Porter stem and 
Double Metaphone.

<DL>
<DT class="pubdef"><A NAME="rdf_new_literal_map/1"><STRONG>rdf_new_literal_map</STRONG>(<VAR>-Map</VAR>)</A></DT>
<DD class="defbody">
Create a new literal map, returning an opaque handle.</DD>
<DT class="pubdef"><A NAME="rdf_destroy_literal_map/1"><STRONG>rdf_destroy_literal_map</STRONG>(<VAR>+Map</VAR>)</A></DT>
<DD class="defbody">
Destroy a literal map. After this call, further use of the <VAR>Map</VAR> 
handle is illegal. Additional synchronisation is needed if maps that are 
shared between threads are destroyed to guarantee the handle is no 
longer used. In some scenarios <A NAME="idx:rdfresetliteralmap1:100"></A><A class="pred" href="#rdf_reset_literal_map/1">rdf_reset_literal_map/1</A> 
provides a safe alternative.</DD>
<DT class="pubdef"><A NAME="rdf_reset_literal_map/1"><STRONG>rdf_reset_literal_map</STRONG>(<VAR>+Map</VAR>)</A></DT>
<DD class="defbody">
Delete all content from the literal map.</DD>
<DT class="pubdef"><A NAME="rdf_insert_literal_map/3"><STRONG>rdf_insert_literal_map</STRONG>(<VAR>+Map, 
+Key, +Value</VAR>)</A></DT>
<DD class="defbody">
Add a relation between <VAR>Key</VAR> and <VAR>Value</VAR> to the map. 
If this relation already exists no action is performed.</DD>
<DT class="pubdef"><A NAME="rdf_insert_literal_map/4"><STRONG>rdf_insert_literal_map</STRONG>(<VAR>+Map, 
+Key, +Value, -KeyCount</VAR>)</A></DT>
<DD class="defbody">
As <A NAME="idx:rdfinsertliteralmap3:101"></A><A class="pred" href="#rdf_insert_literal_map/3">rdf_insert_literal_map/3</A>. 
In addition, if <VAR>Key</VAR> is a new key in
<VAR>Map</VAR>, unify <VAR>KeyCount</VAR> with the number of keys in <VAR>Map</VAR>. 
This serves two purposes. Derived maps, such as the stem and metaphone 
maps need to know about new keys and it avoids additional foreign calls 
for doing the progress in <CODE>rdf_litindex.pl</CODE>.</DD>
<DT class="pubdef"><A NAME="rdf_delete_literal_map/2"><STRONG>rdf_delete_literal_map</STRONG>(<VAR>+Map, 
+Key</VAR>)</A></DT>
<DD class="defbody">
Delete <VAR>Key</VAR> and all associated values from the map. Succeeds 
always.</DD>
<DT class="pubdef"><A NAME="rdf_delete_literal_map/2"><STRONG>rdf_delete_literal_map</STRONG>(<VAR>+Map, 
+Key, +Value</VAR>)</A></DT>
<DD class="defbody">
Delete the association between <VAR>Key</VAR> and <VAR>Value</VAR> from 
the map. Succeeds always.</DD>
<DT class="pubdef"><A NAME="rdf_find_literal_map/3"><STRONG>rdf_find_literal_map</STRONG>(<VAR>+Map, 
+KeyList, -ValueList</VAR>)</A></DT>
<DD class="defbody">
Unify <VAR>ValueList</VAR> with an ordered set of values associated to 
all keys from <VAR>KeyList</VAR>. I.e. perform an <EM>intersection</EM> 
of the value-sets associated with the keys. Unifies <VAR>ValueList</VAR> 
with the empty list if no matches are found.</DD>
<DT class="pubdef"><A NAME="rdf_keys_in_literal_map/3"><STRONG>rdf_keys_in_literal_map</STRONG>(<VAR>+Map, 
+Spec, -Answer</VAR>)</A></DT>
<DD class="defbody">
Realises various queries on the key-set:

<DL>
<DT><STRONG>all</STRONG></DT>
<DD class="defbody">
Unify <VAR>Answer</VAR> with an ordered list of all keys.</DD>
<DT><STRONG>key</STRONG>(<VAR>+Key</VAR>)</DT>
<DD class="defbody">
Succeeds if <VAR>Key</VAR> is a key in the map and unify <VAR>Answer</VAR> 
with the number of values associated with the key. This provides a fast 
test of existence without fetching the possibly large associated value 
set as with <A NAME="idx:rdffindliteralmap3:102"></A><A class="pred" href="#rdf_find_literal_map/3">rdf_find_literal_map/3</A>.</DD>
<DT><STRONG>prefix</STRONG>(<VAR>+Prefix</VAR>)</DT>
<DD class="defbody">
Unify <VAR>Answer</VAR> with an ordered set of all keys that have the 
given prefix. See <A class="sec" href="#sec:3.1">section 3.1</A> for 
details on prefix matching.
<VAR>Prefix</VAR> must be an atom. This call is intended for 
auto-completion in user interfaces.</DD>
<DT><STRONG>ge</STRONG>(<VAR>+Min</VAR>)</DT>
<DD class="defbody">
Unify <VAR>Answer</VAR> with all keys that are larger or equal to the 
integer <VAR>Min</VAR>.</DD>
<DT><STRONG>le</STRONG>(<VAR>+Max</VAR>)</DT>
<DD class="defbody">
Unify <VAR>Answer</VAR> with all keys that are smaller or equal to the 
integer <VAR>Max</VAR>.</DD>
<DT><STRONG>between</STRONG>(<VAR>+Min, +Max</VAR>)</DT>
<DD class="defbody">
Unify <VAR>Answer</VAR> with all keys between <VAR>Min</VAR> and <VAR>Max</VAR> 
(including).
</DD>
</DL>

</DD>
<DT class="pubdef"><A NAME="rdf_statistics_literal_map/2"><STRONG>rdf_statistics_literal_map</STRONG>(<VAR>+Map, 
+Key(-Arg...)</VAR>)</A></DT>
<DD class="defbody">
Query some statistics of the map. Provides keys are:

<DL>
<DT><STRONG>size</STRONG>(<VAR>-Keys, -Relations</VAR>)</DT>
<DD class="defbody">
Unify <VAR>Keys</VAR> with the total key-count of the index and
<VAR>Relation</VAR> with the total <VAR>Key</VAR>-<VAR>Value</VAR> 
count.
</DD>
</DL>

</DD>
</DL>

<H3><A NAME="sec:4.6"><SPAN class="sec-nr">4.6</SPAN> <SPAN class="sec-title">Module 
semweb/rdf_persistency</SPAN></A></H3>

<A NAME="sec:persistency"></A>

<P><A NAME="idx:Persistentstore:103"></A>The <CODE>library(semweb/rdf_persistency)</CODE> 
provides reliable persistent storage for the RDF data. The store uses a 
directory with files for each source (see <A NAME="idx:rdfsource1:104"></A><A class="pred" href="#rdf_source/1">rdf_source/1</A>) 
present in the database. Each source is represented by two files, one in 
binary format (see <A NAME="idx:rdfsavedb2:105"></A><SPAN class="pred-ext">rdf_save_db/2</SPAN>) 
representing the base state and one represented as Prolog terms 
representing the changes made since the base state. The latter is called 
the <EM>journal</EM>.

<DL>
<DT class="pubdef"><A NAME="rdf_attach_db/2"><STRONG>rdf_attach_db</STRONG>(<VAR>+Directory, 
+Options</VAR>)</A></DT>
<DD class="defbody">
Attach <VAR>Directory</VAR> as the persistent database. If <VAR>Directory</VAR> 
does not exist it is created. Otherwise all sources defined in the 
directory are loaded into the RDF database. Loading a source means 
loading the base state (if any) and replaying the journal (if any). The 
current implementation does not synchronise triples that are in the 
store before attaching a database. They are not removed from the 
database, nor added to the presistent store. Different merging options 
may be supported through the <VAR>Options</VAR> argument later. 
Currently defined options are:

<DL>
<DT><STRONG>concurrency</STRONG>(<VAR>+PosInt</VAR>)</DT>
<DD class="defbody">
Number of threads used to reload databased and journals from the files 
in <VAR>Directory</VAR>. Default is the number of physical CPUs 
determined by the Prolog flag <CODE>cpu_count</CODE> or 1 (one) on 
systems where this number is unknown. See also <A NAME="idx:concurrent3:106"></A><SPAN class="pred-ext">concurrent/3</SPAN>.</DD>
<DT><STRONG>max_open_journals</STRONG>(<VAR>+PosInt</VAR>)</DT>
<DD class="defbody">
The library maintains a pool of open journal files. This option 
specifies the size of this pool. The default is 10. Raising the option 
can make sense if many writes occur on many different named graphs. The 
value can be lowered for scenarios where write operations are very 
infrequent.</DD>
<DT><STRONG>silent</STRONG>(<VAR>Boolean</VAR>)</DT>
<DD class="defbody">
If <CODE>true</CODE>, supress loading messages from <A NAME="idx:rdfattachdb2:107"></A><A class="pred" href="#rdf_attach_db/2">rdf_attach_db/2</A>.</DD>
<DT><STRONG>log_nested_transactions</STRONG>(<VAR>Boolean</VAR>)</DT>
<DD class="defbody">
If <CODE>true</CODE>, nested <EM>log</EM> transactions are added to the 
journal information. By default (<CODE>false</CODE>), no log-term is 
added for nested transactions.
</DD>
</DL>

<P>The database is locked against concurrent access using a file
<CODE>lock</CODE> in <VAR>Directory</VAR>. An attempt to attach to a 
locked database raises a <CODE>permission_error</CODE> exception. The 
error context contains a term <CODE>rdf_locked(Args)</CODE>, where args 
is a list containing <CODE>time(Stamp)</CODE> and <CODE>pid(PID)</CODE>. 
The error can be caught by the application. Otherwise it prints:

<PRE class="code">
ERROR: No permission to lock rdf_db `/home/jan/src/pl/packages/semweb/DB'
ERROR: locked at Wed Jun 27 15:37:35 2007 by process id 1748
</PRE>

</DD>
<DT class="pubdef"><A NAME="rdf_detach_db/0"><STRONG>rdf_detach_db</STRONG></A></DT>
<DD class="defbody">
Detaches the persistent store. No triples are removed from the RDF 
triple store.</DD>
<DT class="pubdef"><A NAME="rdf_current_db/1"><STRONG>rdf_current_db</STRONG>(<VAR>-Directory</VAR>)</A></DT>
<DD class="defbody">
Unify <VAR>Directory</VAR> with the current database directory. Fails if 
no persistent database is attached.</DD>
<DT class="pubdef"><A NAME="rdf_persistency/2"><STRONG>rdf_persistency</STRONG>(<VAR>+DB, 
+Bool</VAR>)</A></DT>
<DD class="defbody">
Change presistency of named database (4th argument of <A NAME="idx:rdf4:108"></A><A class="pred" href="#rdf/4">rdf/4</A>). 
By default all databases are presistent. Using <CODE>false</CODE>, the 
journal and snapshot for the database are deleted and further changes to 
triples associated with <VAR>DB</VAR> are not recorded. If <VAR>Bool</VAR> 
is <CODE>true</CODE> a snapshot is created for the current state and 
further modifications are monitored. Switching persistency does not 
affect the triples in the in-memory RDF database.</DD>
<DT class="pubdef"><A NAME="rdf_flush_journals/1"><STRONG>rdf_flush_journals</STRONG>(<VAR>+Options</VAR>)</A></DT>
<DD class="defbody">
Flush dirty journals. With the option <CODE>min_size(KB)</CODE> only 
journals larger than <VAR>KB</VAR> Kbytes are merged with the base 
state. Flushing a journal takes the following steps, ensuring a stable 
state can be recovered at any moment.
<OL>
<LI>Save the current database in a new file using the extension <CODE>.new</CODE>.
<LI>On success, delete the journal
<LI>On success, atomically move the <CODE>.new</CODE> file over the base 
state.
</OL>

<P>Note that journals are <EM>not</EM> merged automatically for two 
reasons. First of all, some applications may decide never to merge as 
the journal contains a complete <EM>changelog</EM> of the database. 
Second, merging large databases can be slow and the application may wish 
to schedule such actions at quiet times or scheduled maintenance 
periods.
</DD>
</DL>

<H4><A NAME="sec:4.6.1"><SPAN class="sec-nr">4.6.1</SPAN> <SPAN class="sec-title">Enriching 
the journals</SPAN></A></H4>

<A NAME="sec:enrich"></A>

<P>The above predicates suffice for most applications. The predicates in 
this section provide access to the journal files and the base state 
files and are intented to provide additional services, such as reasoning 
about the journals, loaded files, etc.<SUP class="fn">7<SPAN class="fn-text">A 
library <CODE>library(rdf_history)</CODE> is under development 
exploiting these features supporting wiki style editing of RDF.</SPAN></SUP>

<P>Using <CODE>rdf_transaction(Goal, log(Message))</CODE>, we can add 
additional records to enrich the journal of affected databases with <VAR>Term</VAR> 
and some additional bookkeeping information. Such a transaction adds a 
term
<CODE>begin(Id, Nest, Time, Message)</CODE> before the change operations 
on each affected database and <CODE>end(Id, Nest, Affected)</CODE> after 
the change operations. Here is an example call and content of the 
journal file <CODE>mydb.jrn</CODE>. A full explanation of the terms that 
appear in the journal is in the description of <A NAME="idx:rdfjournalfile2:109"></A><A class="pred" href="#rdf_journal_file/2">rdf_journal_file/2</A>.

<PRE class="code">
?- rdf_transaction(rdf_assert(s,p,o,mydb), log(by(jan))).
</PRE>

<PRE class="code">
start([time(1183540570)]).
begin(1, 0, 1183540570.36, by(jan)).
assert(s, p, o).
end(1, 0, []).
end([time(1183540578)]).
</PRE>

<P>Using <CODE>rdf_transaction(Goal, log(Message, DB))</CODE>, where <VAR>DB</VAR> 
is an atom denoting a (possibly empty) named graph, the system 
guarantees that a non-empty transaction will leave a possibly empty 
transaction record in DB. This feature assumes named graphs are named 
after the user making the changes. If a user action does not affect the 
user's graph, such as deleting a triple from another graph, we still 
find record of all actions performed by some user in the journal of that 
user.

<DL>
<DT class="pubdef"><A NAME="rdf_journal_file/2"><STRONG>rdf_journal_file</STRONG>(<VAR>?DB, 
?JournalFile</VAR>)</A></DT>
<DD class="defbody">
True if
<VAR>File</VAR> is the absolute file name of an existing named graph
<VAR>DB</VAR>. A journal file contains a sequence of Prolog terms of the 
following format.<SUP class="fn">8<SPAN class="fn-text">Future versions 
of this library may use an XML based language neutral format.</SPAN></SUP>

<DL>
<DT><STRONG>start</STRONG>(<VAR>Attributes</VAR>)</DT>
<DD class="defbody">
Journal has been opened. Currently <VAR>Attributes</VAR> contains a term <CODE>time(Stamp)</CODE>.</DD>
<DT><STRONG>end</STRONG>(<VAR>Attributes</VAR>)</DT>
<DD class="defbody">
Journal was closed. Currently <VAR>Attributes</VAR> contains a term <CODE>time(Stamp)</CODE>.</DD>
<DT><STRONG>assert</STRONG>(<VAR>Subject, Predicate, Object</VAR>)</DT>
<DD class="defbody">
A triple {Subject, Predicate, Object} was added to the database.</DD>
<DT><STRONG>assert</STRONG>(<VAR>Subject, Predicate, Object, Line</VAR>)</DT>
<DD class="defbody">
A triple {Subject, Predicate, Object} was added to the database with 
given <VAR>Line</VAR> context.</DD>
<DT><STRONG>retract</STRONG>(<VAR>Subject, Predicate, Object</VAR>)</DT>
<DD class="defbody">
A triple {Subject, Predicate, Object} was deleted from the database. 
Note that an <A NAME="idx:rdfretractall3:110"></A><A class="pred" href="#rdf_retractall/3">rdf_retractall/3</A> 
call can retract multiple triples. Each of them have a record in the 
journal. This allows for `undo'.</DD>
<DT><STRONG>retract</STRONG>(<VAR>Subject, Predicate, Object, Line</VAR>)</DT>
<DD class="defbody">
Same as above, for a triple with associated line info.</DD>
<DT><STRONG>update</STRONG>(<VAR>Subject, Predicate, Object, Action</VAR>)</DT>
<DD class="defbody">
See <A NAME="idx:rdfupdate4:111"></A><A class="pred" href="#rdf_update/4">rdf_update/4</A>.</DD>
<DT><STRONG>begin</STRONG>(<VAR>Id, Nest, Time, Message</VAR>)</DT>
<DD class="defbody">
Added before the changes in each database affected by a transaction with 
transaction identifier <CODE>log(Message)</CODE>. <VAR>Id</VAR> is an 
integer counting the logged transactions to this database. Numbers are 
increasing and designed for binary search within the journal file.
<VAR>Nest</VAR> is the nesting level, where `0' is a toplevel 
transaction.
<VAR>Time</VAR> is a time-stamp, currently using float notation with two 
fractional digits. <VAR>Message</VAR> is the term provided by the user 
as argument of the <CODE>log(Message)</CODE> transaction.</DD>
<DT><STRONG>end</STRONG>(<VAR>Id, Nest, Others</VAR>)</DT>
<DD class="defbody">
Added after the changes in each database affected by a transaction with 
transaction identifier <CODE>log(Message)</CODE>. <VAR>Id</VAR> and <VAR>Nest</VAR> 
match the begin-term. <VAR>Others</VAR> gives a list of other databases 
affected by this transaction and the <VAR>Id</VAR> of these records. The 
terms in this list have the format <VAR>DB</VAR>:<VAR>Id</VAR>.
</DD>
</DL>

</DD>
<DT class="pubdef"><A NAME="rdf_db_to_file/2"><STRONG>rdf_db_to_file</STRONG>(<VAR>?DB, 
?FileBase</VAR>)</A></DT>
<DD class="defbody">
Convert between <VAR>DB</VAR> (see <A NAME="idx:rdfsource1:112"></A><A class="pred" href="#rdf_source/1">rdf_source/1</A>) 
and file base-file used for storing information on this database. The 
full file is located in the directory described by <A NAME="idx:rdfcurrentdb1:113"></A><A class="pred" href="#rdf_current_db/1">rdf_current_db/1</A> 
and has the extension
<CODE>.trp</CODE> for the base state and <CODE>.jrn</CODE> for the 
journal.
</DD>
</DL>

<H3><A NAME="sec:4.7"><SPAN class="sec-nr">4.7</SPAN> <SPAN class="sec-title">Module 
semweb/rdf_turtle</SPAN></A></H3>

<A NAME="sec:turtle"></A>

<P><A NAME="idx:turtle:114"></A>The module <CODE>library(semweb/rdf_turtle)</CODE> 
provides a parser for the alternative RDF Turtle syntax.<SUP class="fn">9<SPAN class="fn-text"><A class="url" href="http://www.ilrt.bris.ac.uk/discovery/2004/01/turtle/">http://www.ilrt.bris.ac.uk/discovery/2004/01/turtle/</A></SPAN></SUP> 
The Turtle syntax is the basis for the SPARQL query language and much 
easier to read and write by humans<SUP class="fn">10<SPAN class="fn-text">And 
computers ...</SPAN></SUP> than the RDF/XML syntax.

<P>This module acts as a <EM>plugin</EM> to <CODE>library(rdf_db.pl)</CODE>, 
enabling
<A NAME="idx:loadrdf2:115"></A><SPAN class="pred-ext">load_rdf/2</SPAN> 
to load Turtle data transparently. The default extension for a turtle 
file is <CODE>.ttl</CODE>.

<DL>
<DT class="pubdef"><A NAME="rdf_load_turtle/3"><STRONG>rdf_load_turtle</STRONG>(<VAR>+Input, 
-Triples, +Options</VAR>)</A></DT>
<DD class="defbody">
Parse Turtle data from Input, returning a list of <CODE>rdf(S,P,O)</CODE> 
triples. Input is either a term <CODE>stream(Stream)</CODE> or a 
specification for <A NAME="idx:absolutefilename3:116"></A><SPAN class="pred-ext">absolute_file_name/3</SPAN>. 
Processed options are:

<DL>
<DT><STRONG>base_url</STRONG>(<VAR>+BaseURI</VAR>)</DT>
<DD class="defbody">
Define the base URI. When processing a file the default is constructed 
from <CODE>file://</CODE> and the filename.</DD>
<DT><STRONG>anon_prefix</STRONG>(<VAR>+Prefix</VAR>)</DT>
<DD class="defbody">
Prefix used for blank notes. Must start with <CODE>__</CODE>. Default is 
constructed from the base URI.
</DD>
</DL>

</DD>
<DT class="pubdef"><A NAME="rdf_process_turtle/3"><STRONG>rdf_process_turtle</STRONG>(<VAR>+Input, 
:OnTriples, +Options</VAR>)</A></DT>
<DD class="defbody">
Similar to <A NAME="idx:rdfloadturtle3:117"></A><A class="pred" href="#rdf_load_turtle/3">rdf_load_turtle/3</A>, 
but processes the file in call-back mode. See also <A NAME="idx:processrdf3:118"></A><SPAN class="pred-ext">process_rdf/3</SPAN>. <VAR>OnTriples</VAR> 
is called with two arguments. The first argument is a non-empty list of 
triples and the second is a term &lt;<VAR>DB</VAR>&gt;:&lt;<VAR>Line</VAR>&gt;, 
indicating the source location of the triples. In addition to the 
options described with <A NAME="idx:rdfloadturtle3:119"></A><A class="pred" href="#rdf_load_turtle/3">rdf_load_turtle/3</A> 
it accepts the option <CODE>db(DB)</CODE>, specifying the named graph. 
Default is the base URI.
</DD>
</DL>

<H2><A NAME="sec:5"><SPAN class="sec-nr">5</SPAN> <SPAN class="sec-title">Module 
semweb/rdfs</SPAN></A></H2>

<A NAME="sec:rdfs"></A>

<P><A NAME="idx:RDFSchema:120"></A>The <CODE>library(semweb/rdfs)</CODE> 
library adds interpretation of the triple store in terms of concepts 
from RDF-Schema (RDFS). There are two ways to provide support for more 
high level languages in RDF. One is to view such languages as a set of <EM>entailment 
rules</EM>. In this model the rdfs library would provide a predicate <SPAN class="pred-ext">rdfs/3</SPAN> 
providing the same functionality as <A NAME="idx:rdf3:121"></A><A class="pred" href="#rdf/3">rdf/3</A> 
on union of the raw graph and triples that can be derived by applying 
the RDFS entailment rules.

<P>Alternatively, RDFS provides a view on the RDF store in terms of 
individuals, classes, properties, etc., and we can provide predicates 
that query the database with this view in mind. This is the approach 
taken in the <CODE>library(semweb/rdfs.p)</CODE>l library, providing 
calls like
<CODE>rdfs_individual_of(?Resource, ?Class)</CODE>.<SUP class="fn">11<SPAN class="fn-text">The 
SeRQL language is based on querying the deductive closure of the triple 
set. The SWI-Prolog SeRQL library provides <EM>entailment modules</EM> 
that take the approach outlined above.</SPAN></SUP>

<H3><A NAME="sec:5.1"><SPAN class="sec-nr">5.1</SPAN> <SPAN class="sec-title">Hierarchy 
and class-individual relations</SPAN></A></H3>

<P>The predicates in this section explore the <CODE>rdfs:subPropertyOf</CODE>,
<CODE>rdfs:subClassOf</CODE> and <CODE>rdf:type</CODE> relations. Note 
that the most fundamental of these, <CODE>rdfs:subPropertyOf</CODE>, is 
also used by <A NAME="idx:rdfhas34:122"></A><A class="pred" href="#rdf_has/3">rdf_has/[3,4]</A>.

<DL>
<DT class="pubdef"><A NAME="rdfs_subproperty_of/2"><STRONG>rdfs_subproperty_of</STRONG>(<VAR>?SubProperty, 
?Property</VAR>)</A></DT>
<DD class="defbody">
True if <VAR>SubProperty</VAR> is equal to <VAR>Property</VAR> or <VAR>Property</VAR> 
can be reached from <VAR>SubProperty</VAR> following the
<CODE>rdfs:subPropertyOf</CODE> relation. It can be used to test as well 
as generate sub-properties or super-properties. Note that the commonly 
used semantics of this predicate is wired into <A NAME="idx:rdfhas34:123"></A><A class="pred" href="#rdf_has/3">rdf_has/[3,4]</A>.<SUP class="fn">bug<SPAN class="fn-text">The 
current implementation cannot deal with cycles</SPAN></SUP>.<SUP class="fn">bug<SPAN class="fn-text">The 
current implementation cannot deal with predicates that are an <CODE>rdfs:subPropertyOf</CODE> 
of <CODE>rdfs:subPropertyOf</CODE>, such as <CODE>owl:samePropertyAs</CODE>.</SPAN></SUP></DD>
<DT class="pubdef"><A NAME="rdfs_subclass_of/2"><STRONG>rdfs_subclass_of</STRONG>(<VAR>?SubClass, 
?Class</VAR>)</A></DT>
<DD class="defbody">
True if <VAR>SubClass</VAR> is equal to <VAR>Class</VAR> or <VAR>Class</VAR> 
can be reached from <VAR>SubClass</VAR> following the
<CODE>rdfs:subClassOf</CODE> relation. It can be used to test as well as 
generate sub-classes or super-classes.<SUP class="fn">bug<SPAN class="fn-text">The 
current implementation cannot deal with cycles</SPAN></SUP>.</DD>
<DT class="pubdef"><A NAME="rdfs_class_property/2"><STRONG>rdfs_class_property</STRONG>(<VAR>+Class, 
?Property</VAR>)</A></DT>
<DD class="defbody">
True if the domain of <VAR>Property</VAR> includes <VAR>Class</VAR>. 
Used to generate all properties that apply to a class.</DD>
<DT class="pubdef"><A NAME="rdfs_individual_of/2"><STRONG>rdfs_individual_of</STRONG>(<VAR>?Resource, 
?Class</VAR>)</A></DT>
<DD class="defbody">
True if <VAR>Resource</VAR> is an indivisual of <VAR>Class</VAR>. This 
implies
<VAR>Resource</VAR> has an <CODE>rdf:type</CODE> property that refers to
<VAR>Class</VAR> or a sub-class thereof. Can be used to test, generate 
classes <VAR>Resource</VAR> belongs to or generate individuals described 
by <VAR>Class</VAR>.
</DD>
</DL>

<H3><A NAME="sec:5.2"><SPAN class="sec-nr">5.2</SPAN> <SPAN class="sec-title">Collections 
and Containers</SPAN></A></H3>

<P><A NAME="idx:parseTypeCollection:124"></A><A NAME="idx:CollectionparseType:125"></A>The 
RDF construct <CODE>rdf:parseType</CODE>=<CODE>Collection</CODE> 
constructs a list using the <CODE>rdf:first</CODE> and <CODE>rdf:next</CODE> 
relations.

<DL>
<DT class="pubdef"><A NAME="rdfs_member/2"><STRONG>rdfs_member</STRONG>(<VAR>?Resource, 
+Set</VAR>)</A></DT>
<DD class="defbody">
Test or generate the members of <VAR>Set</VAR>. <VAR>Set</VAR> is either 
an individual of <CODE>rdf:List</CODE> or <CODE>rdf:Container</CODE>.</DD>
<DT class="pubdef"><A NAME="rdfs_list_to_prolog_list/2"><STRONG>rdfs_list_to_prolog_list</STRONG>(<VAR>+Set, 
-List</VAR>)</A></DT>
<DD class="defbody">
Convert <VAR>Set</VAR>, which must be an individual of <CODE>rdf:List</CODE> 
into a Prolog list of objects.</DD>
<DT class="pubdef"><A NAME="rdfs_assert_list/2"><STRONG>rdfs_assert_list</STRONG>(<VAR>+List, 
-Resource</VAR>)</A></DT>
<DD class="defbody">
Equivalent to <A NAME="idx:rdfsassertlist3:126"></A><A class="pred" href="#rdfs_assert_list/3">rdfs_assert_list/3</A> 
using <VAR>DB</VAR> = <CODE>user</CODE>.</DD>
<DT class="pubdef"><A NAME="rdfs_assert_list/3"><STRONG>rdfs_assert_list</STRONG>(<VAR>+List, 
-Resource, +DB</VAR>)</A></DT>
<DD class="defbody">
If <VAR>List</VAR> is a list of resources, create an RDF list <VAR>Resource</VAR> 
that reflects these resources. <VAR>Resource</VAR> and the sublist 
resources are generated with <A NAME="idx:rdfbnode1:127"></A><A class="pred" href="#rdf_bnode/1">rdf_bnode/1</A>. 
The new triples are associated with the database <VAR>DB</VAR>.
</DD>
</DL>

<H3><A NAME="sec:5.3"><SPAN class="sec-nr">5.3</SPAN> <SPAN class="sec-title">Labels 
and textual search</SPAN></A></H3>

<P>Textual search is partly handled by the predicates from the
<CODE>library(rdf_db)</CODE> module and its underlying C-library. For 
example, literal objects are hashed case-insensitive to speed up the 
commonly used case-insensitive search.

<DL>
<DT class="pubdef"><A NAME="rdfs_label/3"><STRONG>rdfs_label</STRONG>(<VAR>?Resource, 
?Language, ?Label</VAR>)</A></DT>
<DD class="defbody">
Extract the label from <VAR>Resource</VAR> or generate all resources 
with the given <VAR>Label</VAR>. The label is either associated using a 
sub-property of <CODE>rdfs:label</CODE> or it is extracted from the URL 
using <A NAME="idx:rdfspliturl3:128"></A><A class="pred" href="#rdf_split_url/3">rdf_split_url/3</A>. <VAR>Language</VAR> 
is unified to the value of the <CODE>xml:lang</CODE> attribute of the 
label or a variable if the label has no language specified.</DD>
<DT class="pubdef"><A NAME="rdfs_label/2"><STRONG>rdfs_label</STRONG>(<VAR>?Resource, 
?Label</VAR>)</A></DT>
<DD class="defbody">
Defined as <CODE>rdfs_label(Resource, _, Label)</CODE>.</DD>
<DT class="pubdef"><A NAME="rdfs_ns_label/3"><STRONG>rdfs_ns_label</STRONG>(<VAR>?Resource, 
?Language, ?Label</VAR>)</A></DT>
<DD class="defbody">
Similar to <A NAME="idx:rdfslabel2:129"></A><A class="pred" href="#rdfs_label/2">rdfs_label/2</A>, 
but prefixes the result using the declared namespace alias (see <A class="sec" href="#sec:3.5">section 
3.5</A>) to facilitate user-friendly labels in applications using 
multiple namespaces that may lead to confusion.</DD>
<DT class="pubdef"><A NAME="rdfs_ns_label/2"><STRONG>rdfs_ns_label</STRONG>(<VAR>?Resource, 
?Label</VAR>)</A></DT>
<DD class="defbody">
Defined as <CODE>rdfs_ns_label(Resource, _, Label)</CODE>.</DD>
<DT class="pubdef"><A NAME="rdfs_find/5"><STRONG>rdfs_find</STRONG>(<VAR>+String, 
+Description, ?Properties, +Method, -Subject</VAR>)</A></DT>
<DD class="defbody">
<A NAME="idx:search:130"></A>Find (on backtracking) <VAR>Subject</VAR>s 
that satisfy a search specification for textual attributes. <VAR>String</VAR> 
is the string searched for. <VAR>Description</VAR> is an OWL description 
(see <A class="sec" href="#sec:6">section 6</A>) specifying candidate 
resources. <VAR>Properties</VAR> is a list of properties to search for 
literal objects, <VAR>Method</VAR> defines the textual matching 
algorithm. All textual mapping is performed case-insensitive. The 
matching-methods are described with <A NAME="idx:rdfmatchlabel3:131"></A><A class="pred" href="#rdf_match_label/3">rdf_match_label/3</A>. 
If
<VAR>Properties</VAR> is unbound, the search is performed in any 
property and
<VAR>Properties</VAR> is unified with a list holding the property on 
which the match was found.
</DD>
</DL>

<H2><A NAME="sec:6"><SPAN class="sec-nr">6</SPAN> <SPAN class="sec-title">OWL</SPAN></A></H2>

<A NAME="sec:owl"></A>

<P><A NAME="idx:OWL:132"></A>The current SemWeb library distributed with 
SWI-Prolog does not yet contain an OWL module. A module <CODE>owl.pl</CODE> 
is part of the
<A class="url" href="http://www.swi-prolog.org/packages/Triple20/">Triple20</A> 
triple browser and editor provides limited support for OWL reasoning.

<H2><A NAME="sec:7"><SPAN class="sec-nr">7</SPAN> <SPAN class="sec-title">Module 
semweb/rdf_edit</SPAN></A></H2>

<A NAME="sec:rdfedit"></A>
<BLOCKQUOTE><EM>It is anticipated that this library will eventually be 
superseeded by facilities running on top of the native <A NAME="idx:rdftransaction2:133"></A><A class="pred" href="#rdf_transaction/2">rdf_transaction/2</A> 
and
<A NAME="idx:rdfmonitor2:134"></A><A class="pred" href="#rdf_monitor/2">rdf_monitor/2</A> 
facilities. See <A class="sec" href="#sec:3.6">section 3.6</A>.
</EM></BLOCKQUOTE>

<P><A NAME="idx:undo:135"></A><A NAME="idx:journal:136"></A><A NAME="idx:transactions:137"></A>The 
module <CODE>rdf_edit.pl</CODE> is a layer than encasulates the 
modification predicates from <A class="sec" href="#sec:3.3">section 3.3</A> 
for use from a (graphical) editor of the triple store. It adds the 
following features:

<P>
<UL>
<LI><I>Transaction management</I><BR>
Modifications are grouped into <EM>transactions</EM> to safeguard the 
system from failing operations as well as provide meaningfull chunks for 
undo and journalling.

<P>
<LI><I>Undo</I><BR>
Undo and redo-transactions using a single mechanism to support 
user-friendly editing.

<P>
<LI><I>Journalling</I><BR>
Record all actions to support analysis, versioning, crash-recovery and 
an alternative to saving.
</UL>

<H3><A NAME="sec:7.1"><SPAN class="sec-nr">7.1</SPAN> <SPAN class="sec-title">Transaction 
management</SPAN></A></H3>

<P>Transactions group low-level modification actions together.

<DL>
<DT class="pubdef"><A NAME="rdfe_transaction/1"><STRONG>rdfe_transaction</STRONG>(<VAR>:Goal</VAR>)</A></DT>
<DD class="defbody">
Run <VAR>Goal</VAR>, recording all modifications to the triple store 
made through <A class="sec" href="#sec:7.3">section 7.3</A>. Execution 
is performed as in <A NAME="idx:once1:138"></A><SPAN class="pred-ext">once/1</SPAN>. 
If
<VAR>Goal</VAR> succeeds the changes are committed. If <VAR>Goal</VAR> 
fails or throws an exception the changes are reverted.

<P>Transactions may be nested. A failing nested transaction only reverts 
the actions performed inside the nested transaction. If the outer 
transaction succeeds it is committed normally. Contrary, if the outer 
transaction fails, comitted nested transactions are reverted as well. If 
any of the modifications inside the transaction modifies a protected 
file (see <A NAME="idx:rdfesetfileproperty2:139"></A><A class="pred" href="#rdfe_set_file_property/2">rdfe_set_file_property/2</A>) 
the transaction is reverted and <A NAME="idx:rdfetransaction1:140"></A><A class="pred" href="#rdfe_transaction/1">rdfe_transaction/1</A> 
throws a permission error.

<P>A successful outer transaction (`level-0') may be undone using
<A NAME="idx:rdfeundo0:141"></A><A class="pred" href="#rdfe_undo/0">rdfe_undo/0</A>.</DD>
<DT class="pubdef"><A NAME="rdfe_transaction/2"><STRONG>rdfe_transaction</STRONG>(<VAR>:Goal, 
+Name</VAR>)</A></DT>
<DD class="defbody">
As <A NAME="idx:rdfetransaction1:142"></A><A class="pred" href="#rdfe_transaction/1">rdfe_transaction/1</A>, 
naming the transaction <VAR>Name</VAR>. Transaction naming is intended 
for the GUI to give the user an idea of the next undo action. See also <A NAME="idx:rdfesettransactionname1:143"></A><A class="pred" href="#rdfe_set_transaction_name/1">rdfe_set_transaction_name/1</A> 
and
<A NAME="idx:rdfetransactionname2:144"></A><A class="pred" href="#rdfe_transaction_name/2">rdfe_transaction_name/2</A>.</DD>
<DT class="pubdef"><A NAME="rdfe_set_transaction_name/1"><STRONG>rdfe_set_transaction_name</STRONG>(<VAR>+Name</VAR>)</A></DT>
<DD class="defbody">
Set the `name' of the current transaction to <VAR>Name</VAR>.</DD>
<DT class="pubdef"><A NAME="rdfe_transaction_name/2"><STRONG>rdfe_transaction_name</STRONG>(<VAR>?TID, 
?Name</VAR>)</A></DT>
<DD class="defbody">
Query assigned transaction names.</DD>
<DT class="pubdef"><A NAME="rdfe_transaction_member/2"><STRONG>rdfe_transaction_member</STRONG>(<VAR>+TID, 
-Action</VAR>)</A></DT>
<DD class="defbody">
Enumerate the actions that took place inside a transaction. This can be 
used by a GUI to optimise the MVC (Model-View-Controller) feedback loop. <VAR>Action</VAR> 
is one of:

<DL>
<DT><STRONG>assert</STRONG>(<VAR>Subject, Predicate, Object</VAR>)</DT>
<DD class="defbody">
</DD>
<DT><STRONG>retract</STRONG>(<VAR>Subject, Predicate, Object</VAR>)</DT>
<DD class="defbody">
</DD>
<DT><STRONG>update</STRONG>(<VAR>Subject, Predicate, Object, Action</VAR>)</DT>
<DD class="defbody">
</DD>
<DT><STRONG>file</STRONG>(<VAR>load(Path)</VAR>)</DT>
<DD class="defbody">
</DD>
<DT><STRONG>file</STRONG>(<VAR>unload(Path)</VAR>)</DT>
<DD class="defbody">
</DD>
</DL>

</DD>
</DL>

<H3><A NAME="sec:7.2"><SPAN class="sec-nr">7.2</SPAN> <SPAN class="sec-title">File 
management</SPAN></A></H3>

<A NAME="sec:file"></A>

<DL>
<DT class="pubdef"><A NAME="rdfe_is_modified/1"><STRONG>rdfe_is_modified</STRONG>(<VAR>?File</VAR>)</A></DT>
<DD class="defbody">
Enumerate/test whether <VAR>File</VAR> is modified sinds it was loaded 
or sinds the last call to <A NAME="idx:rdfeclearmodified1:145"></A><A class="pred" href="#rdfe_clear_modified/1">rdfe_clear_modified/1</A>. 
Whether or not a file is modified is determined by the MD5 checksum of 
all triples belonging to the file.</DD>
<DT class="pubdef"><A NAME="rdfe_clear_modified/1"><STRONG>rdfe_clear_modified</STRONG>(<VAR>+File</VAR>)</A></DT>
<DD class="defbody">
Set the <EM>unmodified-MD5</EM> to the current MD5 checksum. See also
<A NAME="idx:rdfeismodified1:146"></A><A class="pred" href="#rdfe_is_modified/1">rdfe_is_modified/1</A>.</DD>
<DT class="pubdef"><A NAME="rdfe_set_file_property/2"><STRONG>rdfe_set_file_property</STRONG>(<VAR>+File, 
+Property</VAR>)</A></DT>
<DD class="defbody">
Control access right and default destination of new triples.
<VAR>Property</VAR> is one of

<DL>
<DT><STRONG>access</STRONG>(<VAR>+Access</VAR>)</DT>
<DD class="defbody">
Where access is one of <CODE>ro</CODE> or <CODE>rw</CODE>. Access <CODE>ro</CODE> 
is default when a file is loaded for which the user has no write access. 
If a transaction (see <A NAME="idx:rdfetransaction1:147"></A><A class="pred" href="#rdfe_transaction/1">rdfe_transaction/1</A>) 
modifies a file with access <CODE>ro</CODE> the transaction is reversed.</DD>
<DT><STRONG>default</STRONG>(<VAR>+Default</VAR>)</DT>
<DD class="defbody">
Set this file to be the default destination of triples. If
<VAR>Default</VAR> is <CODE>fallback</CODE> it is only the default for 
triples that have no clear default destination. If it is <CODE>all</CODE> 
all new triples are added to this file.
</DD>
</DL>

</DD>
<DT class="pubdef"><A NAME="rdfe_get_file_property/2"><STRONG>rdfe_get_file_property</STRONG>(<VAR>?File, 
?Property</VAR>)</A></DT>
<DD class="defbody">
Query properties set with <A NAME="idx:rdfesetfileproperty2:148"></A><A class="pred" href="#rdfe_set_file_property/2">rdfe_set_file_property/2</A>.
</DD>
</DL>

<H3><A NAME="sec:7.3"><SPAN class="sec-nr">7.3</SPAN> <SPAN class="sec-title">Encapsulated 
predicates</SPAN></A></H3>

<A NAME="sec:rdfeencap"></A>

<P>The following predicates encapsulate predicates from the <CODE>rdf_db</CODE> 
module that modify the triple store. These predicates can only be called 
when inside a <EM>transaction</EM>. See <A NAME="idx:rdfetransaction1:149"></A><A class="pred" href="#rdfe_transaction/1">rdfe_transaction/1</A>.

<DL>
<DT class="pubdef"><A NAME="rdfe_assert/3"><STRONG>rdfe_assert</STRONG>(<VAR>+Subject, 
+Predicate, +Object</VAR>)</A></DT>
<DD class="defbody">
Encapsulates <A NAME="idx:rdfassert3:150"></A><A class="pred" href="#rdf_assert/3">rdf_assert/3</A>.
</DD>
<DT class="pubdef"><A NAME="rdfe_retractall/3"><STRONG>rdfe_retractall</STRONG>(<VAR>?Subject, 
?Predicate, ?Object</VAR>)</A></DT>
<DD class="defbody">
Encapsulates <A NAME="idx:rdfretractall3:151"></A><A class="pred" href="#rdf_retractall/3">rdf_retractall/3</A>.
</DD>
<DT class="pubdef"><A NAME="rdfe_update/4"><STRONG>rdfe_update</STRONG>(<VAR>+Subject, 
+Predicate, +Object, +Action</VAR>)</A></DT>
<DD class="defbody">
Encapsulates <A NAME="idx:rdfupdate4:152"></A><A class="pred" href="#rdf_update/4">rdf_update/4</A>.
</DD>
<DT class="pubdef"><A NAME="rdfe_load/1"><STRONG>rdfe_load</STRONG>(<VAR>+In</VAR>)</A></DT>
<DD class="defbody">
Encapsulates <A NAME="idx:rdfload1:153"></A><A class="pred" href="#rdf_load/1">rdf_load/1</A>.
</DD>
<DT class="pubdef"><A NAME="rdfe_unload/1"><STRONG>rdfe_unload</STRONG>(<VAR>+In</VAR>)</A></DT>
<DD class="defbody">
Encapsulates <A NAME="idx:rdfunload1:154"></A><A class="pred" href="#rdf_unload/1">rdf_unload/1</A>.
</DD>
</DL>

<H3><A NAME="sec:7.4"><SPAN class="sec-nr">7.4</SPAN> <SPAN class="sec-title">High-level 
modification predicates</SPAN></A></H3>

<A NAME="sec:rdfeedit"></A>

<P>This section describes a (yet very incomplete) set of more high-level 
operations one would like to be able to perform. Eventually this set may 
include operations based on RDFS and OWL.

<DL>
<DT class="pubdef"><A NAME="rdfe_delete/1"><STRONG>rdfe_delete</STRONG>(<VAR>+Resource</VAR>)</A></DT>
<DD class="defbody">
Delete all traces of <VAR>resource</VAR>. This implies all triples where
<VAR>Resource</VAR> appears as <EM>subject</EM>, <EM>predicate</EM> or
<EM>object</EM>. This predicate starts a transation.
</DD>
</DL>

<H3><A NAME="sec:7.5"><SPAN class="sec-nr">7.5</SPAN> <SPAN class="sec-title">Undo</SPAN></A></H3>

<P><A NAME="idx:undo:155"></A>Undo aims at user-level undo operations 
from a (graphical) editor.

<DL>
<DT class="pubdef"><A NAME="rdfe_undo/0"><STRONG>rdfe_undo</STRONG></A></DT>
<DD class="defbody">
Revert the last outermost (`level 0') transaction (see
<A NAME="idx:rdfetransaction1:156"></A><A class="pred" href="#rdfe_transaction/1">rdfe_transaction/1</A>). 
Successive calls go further back in history. Fails if there is no more 
undo information.</DD>
<DT class="pubdef"><A NAME="rdfe_redo/0"><STRONG>rdfe_redo</STRONG></A></DT>
<DD class="defbody">
Revert the last <A NAME="idx:rdfeundo0:157"></A><A class="pred" href="#rdfe_undo/0">rdfe_undo/0</A>. 
Successive calls revert more <A NAME="idx:rdfeundo0:158"></A><A class="pred" href="#rdfe_undo/0">rdfe_undo/0</A> 
operations. Fails if there is no more redo information.</DD>
<DT class="pubdef"><A NAME="rdfe_can_undo/1"><STRONG>rdfe_can_undo</STRONG>(<VAR>-TID</VAR>)</A></DT>
<DD class="defbody">
Test if there is another transaction that can be reverted. Used for 
activating menus in a graphical environment. <VAR>TID</VAR> is unified 
to the transaction id of the action that will be reverted.</DD>
<DT class="pubdef"><A NAME="rdfe_can_redo/1"><STRONG>rdfe_can_redo</STRONG>(<VAR>-TID</VAR>)</A></DT>
<DD class="defbody">
Test if there is another undo that can be reverted. Used for activating 
menus in a graphical environment. <VAR>TID</VAR> is unified to the 
transaction id of the action that will be reverted.
</DD>
</DL>

<H3><A NAME="sec:7.6"><SPAN class="sec-nr">7.6</SPAN> <SPAN class="sec-title">Journalling</SPAN></A></H3>

<P><A NAME="idx:journal:159"></A>Optionally, every action through this 
module is immediately send to a
<EM>journal-file</EM>. The journal provides a full log of all actions 
with a time-stamp that may be used for inspection of behaviour, version 
management, crash-recovery or an alternative to regular save operations.

<DL>
<DT class="pubdef"><A NAME="rdfe_open_journal/2"><STRONG>rdfe_open_journal</STRONG>(<VAR>+File, 
+Mode</VAR>)</A></DT>
<DD class="defbody">
Open a existing or new journal. If <VAR>Mode</VAR> equala <CODE>append</CODE> 
and <VAR>File</VAR> exists, the journal is first replayed. See
<A NAME="idx:rdfereplayjournal1:160"></A><A class="pred" href="#rdfe_replay_journal/1">rdfe_replay_journal/1</A>. 
If <VAR>Mode</VAR> is <CODE>write</CODE> the journal is truncated if it 
exists.</DD>
<DT class="pubdef"><A NAME="rdfe_close_journal/0"><STRONG>rdfe_close_journal</STRONG></A></DT>
<DD class="defbody">
Close the currently open journal.</DD>
<DT class="pubdef"><A NAME="rdfe_current_journal/1"><STRONG>rdfe_current_journal</STRONG>(<VAR>-Path</VAR>)</A></DT>
<DD class="defbody">
Test whether there is a journal and to which file the actions are 
journalled.</DD>
<DT class="pubdef"><A NAME="rdfe_replay_journal/1"><STRONG>rdfe_replay_journal</STRONG>(<VAR>+File</VAR>)</A></DT>
<DD class="defbody">
Read a journal, replaying all actions in it. To do so, the system reads 
the journal a transaction at a time. If the transaction is closed with a <EM>commit</EM> 
it executes the actions inside the journal. If it is closed with a <EM>rollback</EM> 
or not closed at all due to a crash the actions inside the journal are 
discarded. Using this predicate only makes sense to inspect the state at 
the end of a journal without modifying the journal. Normally a journal 
is replayed using the
<CODE>append</CODE> mode of <A NAME="idx:rdfeopenjournal2:161"></A><A class="pred" href="#rdfe_open_journal/2">rdfe_open_journal/2</A>.
</DD>
</DL>

<H3><A NAME="sec:7.7"><SPAN class="sec-nr">7.7</SPAN> <SPAN class="sec-title">Broadcasting 
change events</SPAN></A></H3>

<P><A NAME="idx:event:162"></A><A NAME="idx:broadcast:163"></A>To 
realise a modular graphical interface for editing the triple store, the 
system must use some sort of <EM>event</EM> mechanism. This is 
implemented by the XPCE library <CODE>library(broadcast)</CODE> which is 
described in the <A class="url" href="http://hcs.science.uva.nl/projects/xpce/UserGuide/libbroadcast.html">XPCE 
User Guide</A>. In this section we describe the terms brodcasted by the 
library.

<DL>
<DT><STRONG>rdf_transaction</STRONG>(<VAR>+Id</VAR>)</DT>
<DD class="defbody">
A `level-0' transaction has been committed. The system passes the 
identifier of the transaction in <VAR>Id</VAR>. In the current 
implementation there is no way to find out what happened inside the 
transaction. This is likely to change in time.

<P>If a transaction is reverted due to failure or exception <EM>no</EM> 
event is broadcasted. The initiating GUI element is supposed to handle 
this possibility itself and other components are not affected as the 
triple store is not changed.</DD>
<DT><STRONG>rdf_undo</STRONG>(<VAR>+Type, +Id</VAR>)</DT>
<DD class="defbody">
This event is broadcasted after an <A NAME="idx:rdfeundo0:164"></A><A class="pred" href="#rdfe_undo/0">rdfe_undo/0</A> 
or <A NAME="idx:rdferedo0:165"></A><A class="pred" href="#rdfe_redo/0">rdfe_redo/0</A>.
<VAR>Type</VAR> is one of <CODE>undo</CODE> or <CODE>redo</CODE> and <VAR>Id</VAR> 
identifies the transaction as above.
</DD>
</DL>

<H2><A NAME="sec:8"><SPAN class="sec-nr">8</SPAN> <SPAN class="sec-title">Related 
packages and issues</SPAN></A></H2>

<P><A NAME="idx:Sesame:166"></A><A NAME="idx:SeRQL:167"></A>The 
SWI-Prolog SemWeb package is designed to provide access to the Semantic 
Web languages from Prolog. It consists of the low level
<CODE>rdf_db.pl</CODE> store with layers such as <CODE>library(semweb/rdfs.pl)</CODE> 
to provide more high level querying of a triple set with relations such 
as
<A NAME="idx:rdfsindividualof2:168"></A><A class="pred" href="#rdfs_individual_of/2">rdfs_individual_of/2</A>, <A NAME="idx:rdfssubclassof2:169"></A><A class="pred" href="#rdfs_subclass_of/2">rdfs_subclass_of/2</A>, 
etc.
<A class="url" href="http://www.openrdf.org">SeRQL</A> is a semantic web 
query language taking another route. Instead of providing alternative 
relations SeRQL defines a graph query on de <EM>deductive closure</EM> 
of the triple set. For example, under assumption of RDFS entailment 
rules this makes the query <CODE>rdf(S, rdf:type, Class)</CODE> 
equivalent to
<CODE>rdfs_individual_of(S, Class)</CODE>.

<P><A NAME="idx:optimisingquery:170"></A>We developed a parser for SeRQL 
which compiles SeRQL path expressions into Prolog conjunctions of <CODE>rdf(Subject, 
Predicate, Object)</CODE> calls. <EM>Entailment modules</EM> realise a 
fully logical implementation of <A NAME="idx:rdf3:171"></A><A class="pred" href="#rdf/3">rdf/3</A> 
including the entailment reasoning required to deal with a Semantic Web 
language or application specific reasoning. The infra structure is 
completed with a query optimiser and an HTTP server compliant to the <A class="url" href="http://www.openrdf.org">Sesame</A> 
implementation of the SeRQL language. The Sesame Java client can be used 
to access Prolog servers from Java, while the Prolog client can be used 
to access the Sesame SeRQL server. For further details, see the
<A class="url" href="http://gollem.science.uva.nl/twiki/pl/bin/view/Library/SeRQL">project 
home</A>.

<H2>Acknowledgements</H2>

<P>This research was supported by the following projects: MIA and 
MultimediaN project (www.multimedian.nl) funded through the BSIK 
programme of the Dutch Government, the FP-6 project HOPS of the European 
Commision.

<P>The implementation of AVL trees is based on libavl by Brad Appleton. 
See the source file <CODE>avl.c</CODE> for details.

<H1><A NAME="document-index">Index</A></H1>

<DL>
<DT><STRONG>A</STRONG></DT>
<DD>
</DD>
<DT>absolute_file_name/3</DT>
<DD>
<A class="idx" href="#idx:absolutefilename3:116">4.7</A></DD>
<DT>atom_concat/3</DT>
<DD>
<A class="idx" href="#idx:atomconcat3:61">3.5</A></DD>
<DT><STRONG>B</STRONG></DT>
<DD>
</DD>
<DT>broadcast</DT>
<DD>
<A class="idx" href="#idx:broadcast:163">7.7</A></DD>
<DT><STRONG>C</STRONG></DT>
<DD>
</DD>
<DT>Collection,parseType</DT>
<DD>
<A class="idx" href="#idx:CollectionparseType:125">5.2</A></DD>
<DT>compressed data</DT>
<DD>
<A class="idx" href="#idx:compresseddata:92">4.2</A></DD>
<DT>concurrent/3</DT>
<DD>
<A class="idx" href="#idx:concurrent3:106">4.6</A></DD>
<DT><STRONG>E</STRONG></DT>
<DD>
</DD>
<DT>event</DT>
<DD>
<A class="idx" href="#idx:event:162">7.7</A></DD>
<DT>expand_goal/2</DT>
<DD>
<A class="idx" href="#idx:expandgoal2:3">3.1</A> <A class="idx" href="#idx:expandgoal2:64">3.5.1</A></DD>
<DT><STRONG>G</STRONG></DT>
<DD>
</DD>
<DT>goal_expansion/2</DT>
<DD>
<A class="idx" href="#idx:goalexpansion2:57">3.5</A> <A class="idx" href="#idx:goalexpansion2:58">3.5</A></DD>
<DT>gz, format</DT>
<DD>
<A class="idx" href="#idx:gzformat:90">4.2</A></DD>
<DT>gzip</DT>
<DD>
<A class="idx" href="#idx:gzip:91">4.2</A></DD>
<DT><STRONG>J</STRONG></DT>
<DD>
</DD>
<DT>journal</DT>
<DD>
<A class="idx" href="#idx:journal:136">7</A> <A class="idx" href="#idx:journal:159">7.6</A></DD>
<DT><STRONG>L</STRONG></DT>
<DD>
</DD>
<DT>labels/2</DT>
<DD>
<A class="idx" href="#idx:labels2:62">3.5.1</A></DD>
<DT>load_files/2</DT>
<DD>
<A class="idx" href="#idx:loadfiles2:40">3.4</A></DD>
<DT>load_rdf/2</DT>
<DD>
<A class="idx" href="#idx:loadrdf2:115">4.7</A></DD>
<DT><STRONG>O</STRONG></DT>
<DD>
</DD>
<DT>once/1</DT>
<DD>
<A class="idx" href="#idx:once1:138">7.1</A></DD>
<DT>optimising,query</DT>
<DD>
<A class="idx" href="#idx:optimisingquery:170">8</A></DD>
<DT>OWL</DT>
<DD>
<A class="idx" href="#idx:OWL:132">6</A></DD>
<DT><STRONG>P</STRONG></DT>
<DD>
</DD>
<DT>parseType,Collection</DT>
<DD>
<A class="idx" href="#idx:parseTypeCollection:124">5.2</A></DD>
<DT>Persistent store</DT>
<DD>
<A class="idx" href="#idx:Persistentstore:103">4.6</A></DD>
<DT>print_message/2</DT>
<DD>
<A class="idx" href="#idx:printmessage2:41">3.4</A></DD>
<DT>process_rdf/3</DT>
<DD>
<A class="idx" href="#idx:processrdf3:36">3.4</A> <A class="idx" href="#idx:processrdf3:39">3.4</A> <A class="idx" href="#idx:processrdf3:118">4.7</A></DD>
<DT><STRONG>R</STRONG></DT>
<DD>
</DD>
<DT><A class="idx" href="#rdf/3">rdf/3</A></DT>
<DD>
<A class="idx" href="#idx:rdf3:2">3</A> <A class="idx" href="#idx:rdf3:5">3.1</A> <A class="idx" href="#idx:rdf3:6">3.1</A> <A class="idx" href="#idx:rdf3:7">3.1</A> <A class="idx" href="#idx:rdf3:8">3.1</A> <A class="idx" href="#idx:rdf3:14">3.2</A> <A class="idx" href="#idx:rdf3:18">3.3.1</A> <A class="idx" href="#idx:rdf3:29">3.3.2</A> <A class="idx" href="#idx:rdf3:60">3.5</A> <A class="idx" href="#idx:rdf3:121">5</A> <A class="idx" href="#idx:rdf3:171">8</A></DD>
<DT><A class="idx" href="#rdf/4">rdf/4</A></DT>
<DD>
<A class="idx" href="#idx:rdf4:4">3.1</A> <A class="idx" href="#idx:rdf4:108">4.6</A></DD>
<DT><A class="idx" href="#rdf_active_transaction/1">rdf_active_transaction/1</A></DT>
<DD>
<A class="idx" href="#idx:rdfactivetransaction1:34">3.3.2</A></DD>
<DT><A class="idx" href="#rdf_assert/3">rdf_assert/3</A></DT>
<DD>
<A class="idx" href="#idx:rdfassert3:19">3.3.1</A> <A class="idx" href="#idx:rdfassert3:26">3.3.2</A> <A class="idx" href="#idx:rdfassert3:51">3.4.3</A> <A class="idx" href="#idx:rdfassert3:150">7.3</A></DD>
<DT><A class="idx" href="#rdf_assert/4">rdf_assert/4</A></DT>
<DD>
<A class="idx" href="#idx:rdfassert4:17">3.3.1</A></DD>
<DT>rdf_assert/[3,4]</DT>
<DD>
<A class="idx" href="#idx:rdfassert34:54">3.4.4</A></DD>
<DT><A class="idx" href="#rdf_atom_md5/3">rdf_atom_md5/3</A></DT>
<DD>
</DD>
<DT><A class="idx" href="#rdf_attach_db/2">rdf_attach_db/2</A></DT>
<DD>
<A class="idx" href="#idx:rdfattachdb2:107">4.6</A></DD>
<DT><A class="idx" href="#rdf_bnode/1">rdf_bnode/1</A></DT>
<DD>
<A class="idx" href="#idx:rdfbnode1:127">5.2</A></DD>
<DT><A class="idx" href="#rdf_current_db/1">rdf_current_db/1</A></DT>
<DD>
<A class="idx" href="#idx:rdfcurrentdb1:113">4.6.1</A></DD>
<DT><A class="idx" href="#rdf_current_literal/1">rdf_current_literal/1</A></DT>
<DD>
</DD>
<DT><A class="idx" href="#rdf_current_predicate/1">rdf_current_predicate/1</A></DT>
<DD>
</DD>
<DT><A class="idx" href="#rdf_db:rdf_file_type/2">rdf_db:rdf_file_type/2</A></DT>
<DD>
</DD>
<DT><A class="idx" href="#rdf_db:rdf_input_info/3">rdf_db:rdf_input_info/3</A></DT>
<DD>
</DD>
<DT><A class="idx" href="#rdf_db:rdf_load_stream/3">rdf_db:rdf_load_stream/3</A></DT>
<DD>
</DD>
<DT><A class="idx" href="#rdf_db:rdf_open_hook/3">rdf_db:rdf_open_hook/3</A></DT>
<DD>
</DD>
<DT><A class="idx" href="#rdf_db_to_file/2">rdf_db_to_file/2</A></DT>
<DD>
</DD>
<DT><A class="idx" href="#rdf_db:url_protocol/1">rdf_db:url_protocol/1</A></DT>
<DD>
</DD>
<DT><A class="idx" href="#rdf_delete_literal_map/2">rdf_delete_literal_map/2</A></DT>
<DD>
</DD>
<DT><A class="idx" href="#rdf_destroy_literal_map/1">rdf_destroy_literal_map/1</A></DT>
<DD>
</DD>
<DT><A class="idx" href="#rdf_detach_db/0">rdf_detach_db/0</A></DT>
<DD>
</DD>
<DT><A class="idx" href="#rdfe_assert/3">rdfe_assert/3</A></DT>
<DD>
</DD>
<DT><A class="idx" href="#rdfe_can_redo/1">rdfe_can_redo/1</A></DT>
<DD>
</DD>
<DT><A class="idx" href="#rdfe_can_undo/1">rdfe_can_undo/1</A></DT>
<DD>
</DD>
<DT><A class="idx" href="#rdfe_clear_modified/1">rdfe_clear_modified/1</A></DT>
<DD>
<A class="idx" href="#idx:rdfeclearmodified1:145">7.2</A></DD>
<DT><A class="idx" href="#rdfe_close_journal/0">rdfe_close_journal/0</A></DT>
<DD>
</DD>
<DT><A class="idx" href="#rdfe_current_journal/1">rdfe_current_journal/1</A></DT>
<DD>
</DD>
<DT><A class="idx" href="#rdfe_delete/1">rdfe_delete/1</A></DT>
<DD>
</DD>
<DT><A class="idx" href="#rdfe_get_file_property/2">rdfe_get_file_property/2</A></DT>
<DD>
</DD>
<DT><A class="idx" href="#rdfe_is_modified/1">rdfe_is_modified/1</A></DT>
<DD>
<A class="idx" href="#idx:rdfeismodified1:146">7.2</A></DD>
<DT><A class="idx" href="#rdfe_load/1">rdfe_load/1</A></DT>
<DD>
</DD>
<DT><A class="idx" href="#rdfe_open_journal/2">rdfe_open_journal/2</A></DT>
<DD>
<A class="idx" href="#idx:rdfeopenjournal2:161">7.6</A></DD>
<DT><A class="idx" href="#rdf_equal/2">rdf_equal/2</A></DT>
<DD>
</DD>
<DT><A class="idx" href="#rdfe_redo/0">rdfe_redo/0</A></DT>
<DD>
<A class="idx" href="#idx:rdferedo0:165">7.7</A></DD>
<DT><A class="idx" href="#rdfe_replay_journal/1">rdfe_replay_journal/1</A></DT>
<DD>
<A class="idx" href="#idx:rdfereplayjournal1:160">7.6</A></DD>
<DT><A class="idx" href="#rdfe_retractall/3">rdfe_retractall/3</A></DT>
<DD>
</DD>
<DT><A class="idx" href="#rdfe_set_file_property/2">rdfe_set_file_property/2</A></DT>
<DD>
<A class="idx" href="#idx:rdfesetfileproperty2:139">7.1</A> <A class="idx" href="#idx:rdfesetfileproperty2:148">7.2</A></DD>
<DT><A class="idx" href="#rdfe_set_transaction_name/1">rdfe_set_transaction_name/1</A></DT>
<DD>
<A class="idx" href="#idx:rdfesettransactionname1:143">7.1</A></DD>
<DT><A class="idx" href="#rdf_estimate_complexity/4">rdf_estimate_complexity/4</A></DT>
<DD>
</DD>
<DT><A class="idx" href="#rdfe_transaction/1">rdfe_transaction/1</A></DT>
<DD>
<A class="idx" href="#idx:rdfetransaction1:140">7.1</A> <A class="idx" href="#idx:rdfetransaction1:142">7.1</A> <A class="idx" href="#idx:rdfetransaction1:147">7.2</A> <A class="idx" href="#idx:rdfetransaction1:149">7.3</A> <A class="idx" href="#idx:rdfetransaction1:156">7.5</A></DD>
<DT><A class="idx" href="#rdfe_transaction/2">rdfe_transaction/2</A></DT>
<DD>
</DD>
<DT><A class="idx" href="#rdfe_transaction_member/2">rdfe_transaction_member/2</A></DT>
<DD>
</DD>
<DT><A class="idx" href="#rdfe_transaction_name/2">rdfe_transaction_name/2</A></DT>
<DD>
<A class="idx" href="#idx:rdfetransactionname2:144">7.1</A></DD>
<DT><A class="idx" href="#rdfe_undo/0">rdfe_undo/0</A></DT>
<DD>
<A class="idx" href="#idx:rdfeundo0:141">7.1</A> <A class="idx" href="#idx:rdfeundo0:157">7.5</A> <A class="idx" href="#idx:rdfeundo0:158">7.5</A> <A class="idx" href="#idx:rdfeundo0:164">7.7</A></DD>
<DT><A class="idx" href="#rdfe_unload/1">rdfe_unload/1</A></DT>
<DD>
</DD>
<DT><A class="idx" href="#rdfe_update/4">rdfe_update/4</A></DT>
<DD>
</DD>
<DT>rdf_file_type/2</DT>
<DD>
<A class="idx" href="#idx:rdffiletype2:85">4.1</A> <A class="idx" href="#idx:rdffiletype2:87">4.1</A></DD>
<DT><A class="idx" href="#rdf_find_literal_map/3">rdf_find_literal_map/3</A></DT>
<DD>
<A class="idx" href="#idx:rdffindliteralmap3:102">4.5</A></DD>
<DT><A class="idx" href="#rdf_find_literals/2">rdf_find_literals/2</A></DT>
<DD>
<A class="idx" href="#idx:rdffindliterals2:96">4.4</A> <A class="idx" href="#idx:rdffindliterals2:97">4.4</A></DD>
<DT><A class="idx" href="#rdf_flush_journals/1">rdf_flush_journals/1</A></DT>
<DD>
</DD>
<DT><A class="idx" href="#rdf_generation/1">rdf_generation/1</A></DT>
<DD>
<A class="idx" href="#idx:rdfgeneration1:23">3.3.1</A></DD>
<DT><A class="idx" href="#rdf_global_id/2">rdf_global_id/2</A></DT>
<DD>
<A class="idx" href="#idx:rdfglobalid2:59">3.5</A></DD>
<DT><A class="idx" href="#rdf_global_object/2">rdf_global_object/2</A></DT>
<DD>
</DD>
<DT><A class="idx" href="#rdf_global_term/2">rdf_global_term/2</A></DT>
<DD>
</DD>
<DT><A class="idx" href="#rdf_graph/1">rdf_graph/1</A></DT>
<DD>
<A class="idx" href="#idx:rdfgraph1:43">3.4</A></DD>
<DT><A class="idx" href="#rdf_has/3">rdf_has/3</A></DT>
<DD>
<A class="idx" href="#idx:rdfhas3:10">3.1</A> <A class="idx" href="#idx:rdfhas3:15">3.2</A> <A class="idx" href="#idx:rdfhas3:16">3.2</A> <A class="idx" href="#idx:rdfhas3:77">3.7</A></DD>
<DT><A class="idx" href="#rdf_has/4">rdf_has/4</A></DT>
<DD>
<A class="idx" href="#idx:rdfhas4:1">3</A> <A class="idx" href="#idx:rdfhas4:9">3.1</A></DD>
<DT>rdf_has/[3,4]</DT>
<DD>
<A class="idx" href="#idx:rdfhas34:122">5.1</A> <A class="idx" href="#idx:rdfhas34:123">5.1</A></DD>
<DT>rdf_input_info/3</DT>
<DD>
<A class="idx" href="#idx:rdfinputinfo3:84">4.1</A></DD>
<DT><A class="idx" href="#rdf_insert_literal_map/3">rdf_insert_literal_map/3</A></DT>
<DD>
<A class="idx" href="#idx:rdfinsertliteralmap3:101">4.5</A></DD>
<DT><A class="idx" href="#rdf_insert_literal_map/4">rdf_insert_literal_map/4</A></DT>
<DD>
</DD>
<DT><A class="idx" href="#rdf_is_bnode/1">rdf_is_bnode/1</A></DT>
<DD>
</DD>
<DT><A class="idx" href="#rdf_journal_file/2">rdf_journal_file/2</A></DT>
<DD>
<A class="idx" href="#idx:rdfjournalfile2:109">4.6.1</A></DD>
<DT><A class="idx" href="#rdf_keys_in_literal_map/3">rdf_keys_in_literal_map/3</A></DT>
<DD>
</DD>
<DT><A class="idx" href="#rdf_load/1">rdf_load/1</A></DT>
<DD>
<A class="idx" href="#idx:rdfload1:38">3.4</A> <A class="idx" href="#idx:rdfload1:80">3.7</A> <A class="idx" href="#idx:rdfload1:153">7.3</A></DD>
<DT><A class="idx" href="#rdf_load/2">rdf_load/2</A></DT>
<DD>
<A class="idx" href="#idx:rdfload2:45">3.4</A> <A class="idx" href="#idx:rdfload2:48">3.4.1</A> <A class="idx" href="#idx:rdfload2:70">3.6</A> <A class="idx" href="#idx:rdfload2:74">3.6</A> <A class="idx" href="#idx:rdfload2:82">4</A> <A class="idx" href="#idx:rdfload2:89">4.1</A></DD>
<DT>rdf_load/[1,2]</DT>
<DD>
<A class="idx" href="#idx:rdfload12:50">3.4.3</A> <A class="idx" href="#idx:rdfload12:52">3.4.4</A> <A class="idx" href="#idx:rdfload12:56">3.4.4</A></DD>
<DT><A class="idx" href="#rdf_load_db/1">rdf_load_db/1</A></DT>
<DD>
<A class="idx" href="#idx:rdfloaddb1:37">3.4</A> <A class="idx" href="#idx:rdfloaddb1:53">3.4.4</A> <A class="idx" href="#idx:rdfloaddb1:73">3.6</A> <A class="idx" href="#idx:rdfloaddb1:75">3.6</A> <A class="idx" href="#idx:rdfloaddb1:76">3.6</A></DD>
<DT>rdf_load_stream/3</DT>
<DD>
<A class="idx" href="#idx:rdfloadstream3:83">4.1</A> <A class="idx" href="#idx:rdfloadstream3:88">4.1</A></DD>
<DT><A class="idx" href="#rdf_load_turtle/3">rdf_load_turtle/3</A></DT>
<DD>
<A class="idx" href="#idx:rdfloadturtle3:117">4.7</A> <A class="idx" href="#idx:rdfloadturtle3:119">4.7</A></DD>
<DT><A class="idx" href="#rdf_make/0">rdf_make/0</A></DT>
<DD>
</DD>
<DT><A class="idx" href="#rdf_match_label/3">rdf_match_label/3</A></DT>
<DD>
<A class="idx" href="#idx:rdfmatchlabel3:131">5.3</A></DD>
<DT><A class="idx" href="#rdf_md5/2">rdf_md5/2</A></DT>
<DD>
</DD>
<DT><A class="idx" href="#rdf_meta/1">rdf_meta/1</A></DT>
<DD>
<A class="idx" href="#idx:rdfmeta1:63">3.5.1</A> <A class="idx" href="#idx:rdfmeta1:66">3.5.1</A> <A class="idx" href="#idx:rdfmeta1:67">3.5.1</A></DD>
<DT><A class="idx" href="#rdf_monitor/2">rdf_monitor/2</A></DT>
<DD>
<A class="idx" href="#idx:rdfmonitor2:12">3.1.1</A> <A class="idx" href="#idx:rdfmonitor2:33">3.3.2</A> <A class="idx" href="#idx:rdfmonitor2:94">4.4</A> <A class="idx" href="#idx:rdfmonitor2:99">4.5</A> <A class="idx" href="#idx:rdfmonitor2:134">7</A></DD>
<DT><A class="idx" href="#rdf_new_literal_map/1">rdf_new_literal_map/1</A></DT>
<DD>
</DD>
<DT><A class="idx" href="#rdf_node/1">rdf_node/1</A></DT>
<DD>
</DD>
<DT><A class="idx" href="#rdf_persistency/2">rdf_persistency/2</A></DT>
<DD>
</DD>
<DT><A class="idx" href="#rdf_predicate_property/2">rdf_predicate_property/2</A></DT>
<DD>
<A class="idx" href="#idx:rdfpredicateproperty2:13">3.2</A> <A class="idx" href="#idx:rdfpredicateproperty2:78">3.7</A></DD>
<DT><A class="idx" href="#rdf_process_turtle/3">rdf_process_turtle/3</A></DT>
<DD>
</DD>
<DT><A class="idx" href="#rdf_quote_uri/2">rdf_quote_uri/2</A></DT>
<DD>
</DD>
<DT><A class="idx" href="#rdf_reachable/3">rdf_reachable/3</A></DT>
<DD>
<A class="idx" href="#idx:rdfreachable3:81">3.7</A></DD>
<DT><A class="idx" href="#rdf_register_ns/2">rdf_register_ns/2</A></DT>
<DD>
</DD>
<DT><A class="idx" href="#rdf_reset_db/0">rdf_reset_db/0</A></DT>
<DD>
<A class="idx" href="#idx:rdfresetdb0:72">3.6</A></DD>
<DT><A class="idx" href="#rdf_reset_literal_map/1">rdf_reset_literal_map/1</A></DT>
<DD>
<A class="idx" href="#idx:rdfresetliteralmap1:100">4.5</A></DD>
<DT><A class="idx" href="#rdf_retractall/3">rdf_retractall/3</A></DT>
<DD>
<A class="idx" href="#idx:rdfretractall3:20">3.3.1</A> <A class="idx" href="#idx:rdfretractall3:110">4.6.1</A> <A class="idx" href="#idx:rdfretractall3:151">7.3</A></DD>
<DT><A class="idx" href="#rdf_retractall/4">rdf_retractall/4</A></DT>
<DD>
<A class="idx" href="#idx:rdfretractall4:21">3.3.1</A> <A class="idx" href="#idx:rdfretractall4:22">3.3.1</A></DD>
<DT>rdf_retractall/[3,4]</DT>
<DD>
<A class="idx" href="#idx:rdfretractall34:55">3.4.4</A></DD>
<DT><A class="idx" href="#rdfs_assert_list/2">rdfs_assert_list/2</A></DT>
<DD>
</DD>
<DT><A class="idx" href="#rdfs_assert_list/3">rdfs_assert_list/3</A></DT>
<DD>
<A class="idx" href="#idx:rdfsassertlist3:126">5.2</A></DD>
<DT><A class="idx" href="#rdf_save/1">rdf_save/1</A></DT>
<DD>
</DD>
<DT><A class="idx" href="#rdf_save/2">rdf_save/2</A></DT>
<DD>
</DD>
<DT><A class="idx" href="#rdf_save_db/1">rdf_save_db/1</A></DT>
<DD>
</DD>
<DT>rdf_save_db/2</DT>
<DD>
<A class="idx" href="#idx:rdfsavedb2:105">4.6</A></DD>
<DT><A class="idx" href="#rdf_save_footer/1">rdf_save_footer/1</A></DT>
<DD>
</DD>
<DT><A class="idx" href="#rdf_save_header/2">rdf_save_header/2</A></DT>
<DD>
<A class="idx" href="#idx:rdfsaveheader2:42">3.4</A> <A class="idx" href="#idx:rdfsaveheader2:49">3.4.2</A></DD>
<DT><A class="idx" href="#rdf_save_subject/3">rdf_save_subject/3</A></DT>
<DD>
</DD>
<DT>RDF-Schema</DT>
<DD>
<A class="idx" href="#idx:RDFSchema:120">5</A></DD>
<DT><A class="idx" href="#rdfs_class_property/2">rdfs_class_property/2</A></DT>
<DD>
</DD>
<DT><A class="idx" href="#rdf_set_cache_options/1">rdf_set_cache_options/1</A></DT>
<DD>
<A class="idx" href="#idx:rdfsetcacheoptions1:47">3.4.1</A></DD>
<DT><A class="idx" href="#rdf_set_predicate/2">rdf_set_predicate/2</A></DT>
<DD>
</DD>
<DT><A class="idx" href="#rdfs_find/5">rdfs_find/5</A></DT>
<DD>
</DD>
<DT><A class="idx" href="#rdfs_individual_of/2">rdfs_individual_of/2</A></DT>
<DD>
<A class="idx" href="#idx:rdfsindividualof2:168">8</A></DD>
<DT><A class="idx" href="#rdfs_label/2">rdfs_label/2</A></DT>
<DD>
<A class="idx" href="#idx:rdfslabel2:129">5.3</A></DD>
<DT><A class="idx" href="#rdfs_label/3">rdfs_label/3</A></DT>
<DD>
</DD>
<DT><A class="idx" href="#rdfs_list_to_prolog_list/2">rdfs_list_to_prolog_list/2</A></DT>
<DD>
</DD>
<DT><A class="idx" href="#rdfs_member/2">rdfs_member/2</A></DT>
<DD>
</DD>
<DT><A class="idx" href="#rdfs_ns_label/2">rdfs_ns_label/2</A></DT>
<DD>
</DD>
<DT><A class="idx" href="#rdfs_ns_label/3">rdfs_ns_label/3</A></DT>
<DD>
</DD>
<DT><A class="idx" href="#rdf_source/1">rdf_source/1</A></DT>
<DD>
<A class="idx" href="#idx:rdfsource1:46">3.4</A> <A class="idx" href="#idx:rdfsource1:104">4.6</A> <A class="idx" href="#idx:rdfsource1:112">4.6.1</A></DD>
<DT><A class="idx" href="#rdf_source/2">rdf_source/2</A></DT>
<DD>
<A class="idx" href="#idx:rdfsource2:44">3.4</A></DD>
<DT><A class="idx" href="#rdf_source_location/2">rdf_source_location/2</A></DT>
<DD>
</DD>
<DT><A class="idx" href="#rdf_split_url/3">rdf_split_url/3</A></DT>
<DD>
<A class="idx" href="#idx:rdfspliturl3:128">5.3</A></DD>
<DT><A class="idx" href="#rdfs_subclass_of/2">rdfs_subclass_of/2</A></DT>
<DD>
<A class="idx" href="#idx:rdfssubclassof2:169">8</A></DD>
<DT><A class="idx" href="#rdfs_subproperty_of/2">rdfs_subproperty_of/2</A></DT>
<DD>
</DD>
<DT><A class="idx" href="#rdf_statistics/1">rdf_statistics/1</A></DT>
<DD>
<A class="idx" href="#idx:rdfstatistics1:79">3.7</A></DD>
<DT><A class="idx" href="#rdf_statistics_literal_map/2">rdf_statistics_literal_map/2</A></DT>
<DD>
</DD>
<DT><A class="idx" href="#rdf_subject/1">rdf_subject/1</A></DT>
<DD>
<A class="idx" href="#idx:rdfsubject1:11">3.1</A></DD>
<DT><A class="idx" href="#rdf_token_expansions/2">rdf_token_expansions/2</A></DT>
<DD>
</DD>
<DT><A class="idx" href="#rdf_tokenize_literal/2">rdf_tokenize_literal/2</A></DT>
<DD>
</DD>
<DT><A class="idx" href="#rdf_transaction/1">rdf_transaction/1</A></DT>
<DD>
<A class="idx" href="#idx:rdftransaction1:30">3.3.2</A> <A class="idx" href="#idx:rdftransaction1:31">3.3.2</A> <A class="idx" href="#idx:rdftransaction1:32">3.3.2</A></DD>
<DT><A class="idx" href="#rdf_transaction/2">rdf_transaction/2</A></DT>
<DD>
<A class="idx" href="#idx:rdftransaction2:27">3.3.2</A> <A class="idx" href="#idx:rdftransaction2:28">3.3.2</A> <A class="idx" href="#idx:rdftransaction2:35">3.3.2</A> <A class="idx" href="#idx:rdftransaction2:68">3.6</A> <A class="idx" href="#idx:rdftransaction2:69">3.6</A> <A class="idx" href="#idx:rdftransaction2:133">7</A></DD>
<DT><A class="idx" href="#rdf_unload/1">rdf_unload/1</A></DT>
<DD>
<A class="idx" href="#idx:rdfunload1:71">3.6</A> <A class="idx" href="#idx:rdfunload1:154">7.3</A></DD>
<DT><A class="idx" href="#rdf_update/4">rdf_update/4</A></DT>
<DD>
<A class="idx" href="#idx:rdfupdate4:24">3.3.1</A> <A class="idx" href="#idx:rdfupdate4:111">4.6.1</A> <A class="idx" href="#idx:rdfupdate4:152">7.3</A></DD>
<DT><A class="idx" href="#rdf_update/5">rdf_update/5</A></DT>
<DD>
</DD>
<DT><A class="idx" href="#rdf_version/1">rdf_version/1</A></DT>
<DD>
</DD>
<DT><STRONG>S</STRONG></DT>
<DD>
</DD>
<DT>search</DT>
<DD>
<A class="idx" href="#idx:search:130">5.3</A></DD>
<DT>SeRQL</DT>
<DD>
<A class="idx" href="#idx:SeRQL:167">8</A></DD>
<DT>Sesame</DT>
<DD>
<A class="idx" href="#idx:Sesame:166">8</A></DD>
<DT><STRONG>T</STRONG></DT>
<DD>
</DD>
<DT>term_expansion/2</DT>
<DD>
<A class="idx" href="#idx:termexpansion2:65">3.5.1</A></DD>
<DT>time_file/2</DT>
<DD>
<A class="idx" href="#idx:timefile2:86">4.1</A></DD>
<DT>tokenize_atom/2</DT>
<DD>
<A class="idx" href="#idx:tokenizeatom2:95">4.4</A> <A class="idx" href="#idx:tokenizeatom2:98">4.4</A></DD>
<DT>transaction</DT>
<DD>
<A class="idx" href="#idx:transaction:25">3.3.2</A></DD>
<DT>transactions</DT>
<DD>
<A class="idx" href="#idx:transactions:137">7</A></DD>
<DT>turtle</DT>
<DD>
<A class="idx" href="#idx:turtle:114">4.7</A></DD>
<DT><STRONG>U</STRONG></DT>
<DD>
</DD>
<DT>undo</DT>
<DD>
<A class="idx" href="#idx:undo:135">7</A> <A class="idx" href="#idx:undo:155">7.5</A></DD>
<DT><STRONG>X</STRONG></DT>
<DD>
</DD>
<DT>xhtml</DT>
<DD>
<A class="idx" href="#idx:xhtml:93">4.3</A></DD>
</DL>

</BODY></HTML>
<!-- Текст скачан с сервера Все скрипты : cgi.ru
Публикация данного текста без согласия автора в любых СМИ запрещена -->
<HTML><HEAD><TITLE>Безопасность файловой системы EXT2(часть 1)</TITLE></head>
<h2>Безопасность файловой системы EXT2(часть 1)</h2>
<BODY><PRE>
Если попросить назвать пять 
наиболее значимых особенностей ядра Linux с точки зрения обеспечения 
безопасности, то большинство администраторов, вероятно, не упомянут 
дополнительные атрибуты для файлов и каталогов, которые поддерживает 
файловая система ext2. Несмотря на то, что концепция большинства полезных 
флагов была реализована еще в ядрах начиная с серии 1.1, эти относительно 
простые дополнительные возможности используется редко. В основном в 
экзотических и недавно появившихся утилитах для поддержки целостности 
системы, таких как LIDS, Tripwire и т.д.
<B>Что такое атрибуты файловой системы ext2?</B> В файловой системе 
Linux присутствует поддержка дополнительных флагов или по другому 
"атрибутов" для файлов, начиная в ядрах начиная с серии 1.1.Файловая 
система в ядрах серий 2.2 и 2.4. позволяет работать со следующим набором 
атрибутов: <PRE> <CODE>
A Atimeсистема не апдейтит atime(access time) для данного файла. 

S Sync система фиксирует все изменения, происходящие в данном
 файле на физическиом диске синхронно с приложением
 изменяющим данный файл.
					
a Append система позволяет открывать данный файл с целью его
 дополнения и не позволяет никаким процессам 
 перезаписывать или усекать его.Если данный атрибут 
 применяется к директории процесс может создавать
 или модифицировать файлы в этой директории , но не
 удалять их.
 
i Immutable система запрещает любые изменения данного файла. 
 В случае директории, процессы могут модифицировать
 файлы уже содержащиеся в данной директории, но не 
 могут удалять файлы или создавать новые.

d No Dumpпрограмме создающей дампы дается указание 
 игнорировать данный файл во время создания backup.

c Compress система применяет прозрачную компрессию для данного
 файла. Т.е. чтение из него даетуже декомпрессованые
 данные и предварительно перед записью на диск 
 производится их сжатие.

s Secure Deletionудаление такого файла сопровождается
 перезаписью блоков диска,на которых он располагался
 нулями.

u Undeleteкогда приложение запрашивает файл на удаление,
 система должна сохранить блоки на диске, на которых
 расположен данный файл, чтобы потом его можно было
 восстановить.
 </CODE>
</PRE>Несмотря на то, что файловая система поддерживает данный набор 
атрибутов, у ядра и различных приложений остается выбор, учитывать или не 
учитывать их. В зависимости от своих версий, приложения могут по разному 
работать с этими атрибутами. В таблице ниже приведено 
соответствие, как различные версии ядра учитывают каждый атрибут: <PRE><CODE>*позволяет
устанавливать флаг и учитывает его значение
iпозволяет устанавливать флаг,но игнорирует его значение
-полностью игнорирует флаг

 1.0 1.2 2.0 2.2 2.4
A - - * * *
S * * * * *
a - * * * *
i - * * * *
d - * * * *
c i i i i i
s * * i i i
u i i i i i
 </CODE></PRE>Хотя ядра более ранних версий учитывают флаг 'secure 
deletion', но во время создания серии 1.3 разработчики исключили этот 
атрибут из последующих серий, поскольку, на их взгляд, его использование 
повышает общую безопасность лишь незначительно. А в худшем случае создает 
ложное чувство безопасности у пользователей незнакомых с проблемами 
свойственными для любой схемы 'secure deletion'. Флаг 'A' 
или 'atime' для определенных файлов может дать некоторую прибавку 
производительности, так как избавляет систему от необходимости апдейтить 
access time для этих файлов каждый раз, когда их открывают на чтение. 
Атрибут 'S' или 'synchronous предоставляет новый уровень поддержки целостности данных.
Но поскольку все 
изменения в файлах немедленно сохраняются на диске несколько понижается 
производиельность. Основное внимание мы уделим 
флагу 'a' ('append only') и 'i' ('immutable'), так как их использование 
дает наиболее ощутимые приемущества в плане обеспечения безопасности и 
целостности файловой системы. Различные open source BSD 
системы, такие как FreeBSD и OpenBSD, с некоторых пор поддерживают 
аналогичные флаги в своих файловых системах (UFS и FFS соответственно) и 
частично решение о реализации аналогичных спецвозможностей в Linux 
основывается на этом положительном опыте. <B>Какие 
команды используются для установки и чтения атрибутов в ext2?</B> Стандартная команда
ls не показывает эти расширенные атрибуты. 
Наборе утилит для ext2, однако, содержит две утилиты специально 
предназначенные для установки и чтения данных атрибутов: chattr и lsattr. 
Поскольку ext2 
рассматривается как основная рабочая файловая система Linux, почти все 
дистрибутивы содержат package 'e2fsprogs', инсталлированый по умолчанию. 
Если по какой-либо причине конкретная инсталляция Linux не содержит этих 
утилит, то вот URL ,где можно взять исходники: The Ext2fs 
Home Page: http://e2fsprogs.sourceforge.net/ext2.html Команда lsattr поддерживает
очень небольшой набор опций, вот 
наиболее важные: -a вывод листинга всех 
директорий и файлов<BR>-d листинга директорий, но без вывода их 
содержимого Результа использования этих 
опций похож на команду ls. Я обычно создаю шел alias, делая 'la' 
эквивалентным 'lsattr -a', поскольку последняя становится ндной в случае 
частого использования. Команда chattr может 
использоваться тремя различными способами: <XMP>chattr +Si test.txt-- установить флаги
sync иimmutable для файла test.txt

chattr -ai test.txt--убрать флаги append-only и immutableу test.txt

chattr =aiA test.txt -- установить ограничение на использование только флагов a, i и A 
</XMP>Наконец, обе команды поддерживают опцию -R ,т.е. рекурсивная работа. 
<B>Как отличаются атрибуты 
ext2 от обычных прав доступа?</B> Большинство 
администраторов хорошо знакомы со стандартным управлением правами доступа 
в unix:<BR>[root@typhoid shaffer]# ls -al test* -rw-rw-r-- 
1 shaffer users 0 Nov 17 17:02 test.conf<BR>-rw-rw-r-- 1 shaffer users 0 
Nov 17 17:02 test.logM<BR>-rw-rw-r-- 1 shaffer users 0 Nov 16 19:41 
test.txt Вывод команды ls показывает, 
что владелец всех файлов test* - shaffer и члены группы имеют право на 
чтение и запись в эти файлы. Прочим пользователям эти файлы доступны для 
чтения. Команда lsattr примененая к той же группе файлов выдаст уже другие 
данные: [root@typhoid shaffer]# 
lsattr -a test*<BR>---i-------- test.conf<BR>----a------- 
test.log<BR>------------ test.txt Она показывает, что 
test.log имеет флаг append-only, а test.conf имеет флаг immutable.<BR>
<B>&nbsp; <A href="mailto:operator@void.ru">ya_mun</A></B> 
</PRE></BODY></HTML>

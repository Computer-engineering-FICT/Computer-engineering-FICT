*       EB01 PWM MODEL FEATURES INCLUDE:
*
*   1 PULSE BY PULSE TIME DOMAIN PERFORMANCE
*   2 OUTPUT RESISTANCE AND CAPACITANCE
*   3 ACCURATE CATCH DIODE I V CHARACTERISTIC
*   4 ACCURATE RON AND VON
*   5 SCHMITT TRIGGER LOGIC INPUTS
*   6 EMITTER OUTPUT FOR CURRENT SENSE
*   7 ACCURATE SUPPLY RANGES
*   8 VCC UNDERVOLTAGE SENSING W HYSTERESIS
*   9 CYCLE BY CYCLE EDGE TRIGGERED SHUTDOWN
*
*****   SOME NOTES ON USING SPICE FOR PWM SIMULATION  *****
*
*
*  REQUIRES BERKELEY SPICE 3E.3P OR LATER. YOUR SIMULATOR
*  MUST SUPPORT THE BERKELEY STANDARD VOLTAGE CONTROLLED
*  SWITCH ELEMENT (S)
*  OR
*  REQUIRES PSPICE 4.04 OR LATER
*
*  BE PREPARED FOR LONG SIMULATIONS
*
*  NOTE: BERKELEY SIMULATORS TYPICALLY RUN THESE
*  PWM MODELS ABOUT TWO TO FOUR TIMES FASTER THAN
*  PSPICE TYPE SIMULATORS AS THE BERKELEY SWITCH
*  ELEMENT DOES NOT INVOKE AS BIG A COMPUTATIONAL
*  BURDEN
*
*  IF YOUR SIMULATION STOPS DUE TO "TIMESTEP TOO SMALL"
*  ERRORS YOU MAY WANT TO INCREASE ITL4 TO 100, INCREASE
*  RELTOL TO 0.003 TO 0.01, INCREASE ABSTOL TO 1E-11 TO
*  1E-9, INCREASE GMIN TO 1E-11 TO 1E-7, INCREASE VNTOL
*  TO 1E-5 TO 1E-4, OR INCREASE CHGTOL TO 1E-11 TO 1E-9.
*  ANY OR ALL OF THESE SIMULATOR OPTIONS MAY BE REQUIRED
*  DEPENDING ON YOUR SIMULATOR. NEWER SIMULATORS USUALLY
*  REQUIRE FEWER OF THEM.
*
*  TO AID THE INITIAL TRANSIENT CONVERGANCE, SET UP THE
*  INITIAL VALUES OF HIN, LIN, AND SD AT ZERO VOLTS.
*
*  TO AID THE INITIAL DC CONVERGANCE SET ITL1 TO 500.
*
*  A GOOD WAY TO TEST SIMULATION ACCURACY IS TO FIX THE
*  PWM SIGNAL INPUT TO A FIXED DUTY FACTOR THAT IS KNOWN.
*  RUN A SIMULATION THAT HAS TIME FOR OUTPUT FILTER
*  SETTLING. IF THE OUTPUT VOLTAGE WANDERS AROUND RATHER
*  THAN STAYS SETTLED TO LESS THAN ONE PERCENT YOU SHOULD
*  REDUCE THE TIMESTEP MAX (TMAX) PARAMETER IN THE TRAN
*  LINE. THIS IS THE FOURTH TIME PARAMETER ON THAT LINE
*  AND IS OPTIONAL LIKE THE TSTART PARAMETER (THIRD TIME
*  PARAMETER ON THAT LINE). IF YOU ARE NOT USING TSTART
*  YOU MUST SET IT TO ZERO SO THE SIMULATOR WILL RECOGNIZE
*  TMAX AS TMAX RATHER THAN TSTART. FOR BERKELEY SPICE 3
*  TMAX WILL USUALLY BE IN THE 500 TO 150 NS RANGE. FOR
*  PSPICE TMAX WILL USUALLY BE IN THE 250 TO 50 NS RANGE.
*
*  BECAUSE THE SPICE OUTPUT DATA IS A SAMPLED SYSTEM,
*  ALIASING CAN TAKE PLACE. IF THE WAVEFORM YOU ARE
*  LOOKING AT IS REPETATIVE BUT SEEMS TO HAVE INADEQUATE
*  P-P AMPLITUDE, YOU MAY WANT TO SAMPLE THE DATA MORE
*  OFTEN OR CHANGE THE RATIONALITY BETWEEN THE PWM CLOCK
*  PERIOD AND YOUR SAMPLING PERIOD.
*
*  IF YOUR SIMULATION CANNOT GET PAST INITIAL CONVERGANCE
*  FOR THE TRANSIENT ANALYSIS, RAMP HV AND/OR VDD UP FROM
*  ZERO VOLTS TO NORMAL IN THE FIRST 10 MICROSECONDS OR SO.
*  THIS WILL NOT ONLY HELP THE TRAN ANALYSIS GET STARTED
*  BUT WILL ALLOW YOU TO SEE THE INITIAL VOLTAGES AND
*  CURRENTS FOR LATER SETTING OF NODESETS. LOOK FOR
*  OUTPUT FILTER INDUCTOR CURRENTS AND CAPACITOR VOLTAGES
*  TO ALLOW SETTING UP INITIAL CONDITIONS ON THOSE PARTS.
*  SETTING INITIAL CONDITIONS CAN ALLOW YOUR OUTPUT FILTER
*  TO GET TO OPERATING CONDITIONS MORE QUICKLY. DON'T
*  FORGET TO USE THE UIC OPTION IN THE TRAN LINE TO FORCE
*  USE OF INITIAL CONDITIONS.
*
*EB01 MODEL FOR PSPICE
*PINOUT ORDER VCC VDD HIN LIN SD VSS HV OUT E HVRTN
*PINOUT        1   2   3   4   5  6   7  8  9   10
.SUBCKT EB01_AM 1 2 3 4 5 6 7 8 9 10
RGN 23 0 1E15
R1 61 82 1E3
R2 27 49 50E3
R3 34 14 50E3
R4 61 49 1E3
R5 26 35 50E3
R6 82 21 50E3
I2 1 6 10E-3
R8 35 60 50E3
R9 34 11 50E3
R10 49 12 50E3
R11 61 28 1E3
R13 61 15 100E3
R14 15 13 100E3
R15 15 35 100E3
R16 61 18 100E3
R17 18 13 100E3
R18 18 34 100E3
R7 35 61 1E3
R12 34 61 1E3
SI1 35 13 3 15 SI1M
E4 13 0 6 0 1
R19 3 13 51E3
E3 23 13 61 5 1
C3 3 13 5E-12
R20 5 13 51E3
C4 5 13 5E-12
E5 61 0 2 0 1
Q1 82 14 13 Q1D
Q2 82 27 13 Q1D
Q3 49 21 13 Q1D
Q4 49 26 13 Q1D
Q5 28 12 13 Q1D
Q6 28 11 13 Q1D
Q7 28 60 13 Q1D
Q8 38 39 13 Q1D
Q9 28 30 13 Q1D
Q10 38 41 13 Q1D
Q11 43 45 13 Q1D
Q12 43 46 13 Q1D
Q13 44 53 13 Q1D
Q14 44 54 13 Q1D
Q15 44 55 13 Q1D
Q16 44 66 13 Q1D
S2 7 32 31 13 S2M
R55 78 42 10E6
R25 33 31 10E3
R59 32 25 10E6
R21 29 30 50E3
C5 31 13 24E-12
D5 33 31 D5M
R22 25 8 0.0198
D8 8 7 D8M
C1 7 36 150E-12
R23 36 32 1
R26 61 38 1E3
R27 41 43 50E3
R28 34 39 50E3
R29 61 43 1E3
R30 46 47 50E3
R31 38 45 50E3
D11 32 25 D11M
E7 33 13 63 13 1
R32 47 55 50E3
R33 34 54 50E3
R34 43 53 50E3
R35 61 44 1E3
SI2 34 13 23 18 SI1M
R36 47 61 1E3
R37 51 52 10E3
D18 78 42 D11M
C7 52 13 24E-12
D6 51 52 D5M
E8 51 13 71 13 1
SI3 47 13 4 57 SI1M
R38 61 57 100E3
R39 57 13 100E3
R40 57 47 100E3
D7 48 8 D7M
C8 8 48 180E-12
D12 48 62 D12M
M1 62 10 10 10 MOSN
R44 4 13 51E3
C2 4 13 5E-12
C9 50 10 2.8E-12
R42 8 48 120E3
R43 48 62 10E6
S3 29 61 81 13 S3M
R46 29 66 50E3
S4 8 78 52 13 S2M
C10 10 84 12E-12
R41 10 84 1E9
RN1 84 0 10
R45 50 62 3E3
R50 62 10 10E6
R47 42 9 0.0198
D16 9 8 D8M
C6 8 75 150E-12
R48 75 78 1
D13 63 64 D1M
D14 6 2 D14M
D15 67 63 D1M
V13 70 64 0.9
I1 2 6 10E-3
V16 67 13 0.9
E9 69 13 28 13 1
R51 69 63 1E3
V17 70 13 5
D17 71 72 D1M
D19 73 71 D1M
V18 74 72 0.9
V19 73 13 0.9
E10 76 13 44 13 1
R52 76 71 1E3
V22 74 13 5
R53 29 13 100E3
R60 1 0 1E9
R54 77 80 10E3
R56 77 81 385E3
CFB 77 81 1E-12
V23 80 13 8.4
R57 83 81 1E3
SC1 81 13 79 77 SI1M
V27 83 13 15
R58 1 79 10E3
C11 79 81 1E-12
.MODEL Q1D NPN (CJC=1E-12)
.MODEL D1M D (CJO=1E-12 TT=5E-9)
.MODEL D5M D
.MODEL D7M D (BV=12 CJO=540E-12 IBV=0.01 RS=0.25 TT=50E-9)
.MODEL D8M D (IS=2.645E-15 M=0.333 RS=0.083 VJ=0.75)
.MODEL D11M D (IS=6.452E-13 N=1.5)
.MODEL D12M D (CJO=1.2E-12 IS=1E-15 RS=1.0 TT=5E-9)
.MODEL D14M D (BV=12 CJO=25E-12 IBV=0.01 RS=0.25 TT=50E-9)
.MODEL MOSN NMOS (KP=1E-2 LAMBDA=1E-3 RD=4.5E3 RS=1.5E3 VTO=-3)
.MODEL S2M VSWITCH RON=0.01 ROFF=1E6 VON=2.5 VOFF=2.4
.MODEL S3M VSWITCH RON=1E3 ROFF=1E6 VON=8 VOFF=7
.MODEL SI1M VSWITCH RON=10 ROFF=100E3 VON=0.001 VOFF=0
.ENDS
*END OF MODEL EB01
**********
*       SA01 PWM MODEL FEATURES INCLUDE:
*
*   1 PULSE BY PULSE TIME DOMAIN PERFORMANCE
*   2 OUTPUT RESISTANCE AND CAPACITANCE
*   3 ACCURATE CATCH DIODE I V CHARACTERISTIC
*   4 ACCURATE RON TEMPERATURE COEFFICIENT
*   5 INCREASING IQ ON THE VS SUPPLY VS FREQUENCY
*   6 DEADTIME BETWEEN SWITCH ON TIMES
*   7 INTERNAL ERROR AMPLIFIER WITH ACCURATE
*     BODE PLOT, SLEW, CMRR, INPUT AND OUTPUT
*     IMPEDANCES, INPUT BIAS AND OFFSET CURRENTS,
*     AND NON-SYMETRICAL OUTPUT CURRENT LIMIT
*   8 REFERENCE OUTPUT
*   9 REALISTIC REFERENCE OUTPUT IMPEDANCE
*  10 REFERENCE OUTPUT CURRENT LIMIT
*  11 ILIM / SHUTDOWN FUNCTIONS
*
*     NOTE: THERMAL SHUTDOWN IS NOT MODELED
*     NOTE: HIGH SIDE CURRENT LIMIT IS NOT MODELED
*
*       SOME NOTES ON USING SPICE FOR PWM SIMULATION
*
*  REQUIRES BERKELEY SPICE 3E.3P OR LATER. YOUR SIMULATOR
*  MUST SUPPORT THE BERKELEY STANDARD VOLTAGE CONTROLLED
*  SWITCH ELEMENT (S)
*  OR
*  REQUIRES PSPICE 4.04 OR LATER
*
*  BE PREPARED FOR LONG SIMULATIONS
*
*  NOTE: BERKELEY SIMULATORS TYPICALLY RUN THESE
*  PWM MODELS ABOUT TWO TO FOUR TIMES FASTER THAN
*  PSPICE TYPE SIMULATORS AS THE BERKELEY SWITCH
*  ELEMENT DOES NOT INVOKE AS BIG A COMPUTATIONAL
*  BURDEN
*
*  IF YOUR SIMULATION STOPS DUE TO "TIMESTEP TOO SMALL"
*  ERRORS YOU MAY WANT TO INCREASE ITL4 TO 100, INCREASE
*  RELTOL TO 0.003 TO 0.01, INCREASE ABSTOL TO 1E-11 TO
*  1E-9, INCREASE GMIN TO 1E-11 TO 1E-7, INCREASE VNTOL
*  TO 1E-5 TO 1E-4, OR INCREASE CHGTOL TO 1E-11 TO 1E-9.
*  ANY OR ALL OF THESE SIMULATOR OPTIONS MAY BE REQUIRED
*  DEPENDING ON YOUR SIMULATOR. NEWER SIMULATORS USUALLY
*  REQUIRE FEWER OF THEM.
*
*  TO AID THE INITIAL DC CONVERGANCE SET ITL1 TO 500.
*
*  A GOOD WAY TO TEST SIMULATION ACCURACY IS TO FIX THE
*  PWM SIGNAL INPUT TO A FIXED VOLTAGE THAT IS EQUIVALENT
*  TO HALFWAY BETWEEN 50-50 DUTY FACTOR AND 100 PERCENT
*  DUTY FACTOR. RUN A SIMULATION THAT HAS TIME FOR OUTPUT
*  FILTER SETTLING. IF THE OUTPUT VOLTAGE WANDERS AROUND
*  RATHER THAN STAYS SETTLED TO LESS THAN ONE PERCENT YOU
*  SHOULD REDUCE THE TIMESTEP MAX (TMAX) PARAMETER IN THE
*  TRAN LINE. THIS IS THE FOURTH TIME PARAMETER ON THAT
*  LINE AND IS OPTIONAL LIKE THE TSTART PARAMETER (THIRD
*  TIME PARAMETER ON THAT LINE). IF YOU ARE NOT USING
*  TSTART YOU MUST SET IT TO ZERO SO THE SIMULATOR WILL
*  RECOGNIZE TMAX AS TMAX RATHER THAN TSTART. FOR BERKELEY
*  SPICE 3 TMAX WILL USUALLY BE IN THE 500 TO 150 NS RANGE.
*  FOR PSPICE TMAX WILL USUALLY BE IN THE 250 TO 50 NS
*  RANGE.
*
*  BECAUSE THE SPICE OUTPUT DATA IS A SAMPLED SYSTEM,
*  ALIASING CAN TAKE PLACE. IF THE WAVEFORM YOU ARE
*  LOOKING AT IS REPETATIVE BUT SEEMS TO HAVE INADEQUATE
*  P-P AMPLITUDE, YOU MAY WANT TO SAMPLE THE DATA MORE
*  OFTEN OR CHANGE THE RATIONALITY BETWEEN THE PWM CLOCK
*  PERIOD AND YOUR SAMPLING PERIOD.
*
*  IF YOUR SIMULATION CANNOT GET PAST INITIAL CONVERGANCE
*  FOR THE TRANSIENT ANALYSIS, RAMP VCC AND VS UP FROM
*  ZERO VOLTS TO NORMAL IN THE FIRST 10 MICROSECONDS OR SO.
*  THIS WILL NOT ONLY HELP THE TRAN ANALYSIS GET STARTED
*  BUT WILL ALLOW YOU TO SEE THE INITIAL VOLTAGES AND
*  CURRENTS FOR LATER SETTING OF NODESETS. LOOK FOR
*  OUTPUT FILTER INDUCTOR CURRENTS AND CAPACITOR VOLTAGES
*  TO ALLOW SETTING UP INITIAL CONDITIONS ON THOSE PARTS.
*  SETTING INITIAL CONDITIONS CAN ALLOW YOUR OUTPUT FILTER
*  TO GET TO OPERATING CONDITIONS MORE QUICKLY. DON'T
*  FORGET TO USE THE UIC OPTION IN THE TRAN LINE TO FORCE
*  USE OF INITIAL CONDITIONS.
*
*BEGIN MODEL SA01 FOR PSPICE
*PINOUT ORDER -IN +IN EA GND REF AOUT +VS ISEN BOUT SHDN
*PINOUT        1   2   3  4   5    6   7    8    9   10
.SUBCKT SA01_AM 1 2 3 4 5 6 7 8 9 10
RER1 50 0 1E9
RER2 38 0 1E9
RER3 57 0 1E9
RER4 79 0 1E9
E1 14 4 22 72 1
E4 29 4 72 26 1
R13 60 4 100
R14 30 22 13E3
R1 42 6 R1M 0.2
R2 11 9 R1M 0.2
R15 22 76 500
R16 76 26 500
R3 39 8 R3M 0.08
R4 63 8 R3M 0.08
D1 6 7 D1M
D4 74 75 D4M
R17 26 5 13E3
V5 30 4 0
D2 46 47 D4M
D3 48 46 D4M
S1 7 42 13 4 S1M
V15 27 4 12.6
S2 7 11 60 4 S1M
C4 7 34 450E-12
E9 16 4 24 25 1000
V7 72 4 5 PULSE 2.5 7.5 0 11.9U 11.9U 10N 23.82U
V9 28 4 0.1
C5 7 37 450E-12
C6 6 35 350E-12
C7 9 33 350E-12
R10 34 6 0.7
D5 8 6 D5M
D6 8 9 D5M
Q2 70 54 4 Q1M
R12 35 8 0.7
R18 37 9 0.7
R20 33 8 0.7
E3 40 4 50 76 1
E5 41 4 76 38 1
E7 43 4 41 4 -1
E8 44 4 40 4 -1
V2 38 4 7.45
V8 50 4 2.55
Q3 59 55 4 Q1M
Q4 59 51 4 Q1M
V14 27 73 0.9
V18 74 4 2.9
V19 75 1 1.5E-3
C10 24 4 1000E-12
R21 24 10 1E3
C17 2 4 2E-12
R22 46 16 1E3
V10 48 4 0.8
V11 47 0 4.1
D8 86 27 D4M
R23 28 25 1E3
R24 70 25 1E6
R25 70 49 1E3
R26 59 49 1E3
R27 52 25 100E3
R19 13 4 100
C8 70 52 5E-12
V13 56 4 5
Q1 70 53 4 Q1M
R43 2 4 300E6
R44 75 4 300E6
C18 75 4 2E-12
R28 53 46 50E3
R29 54 59 50E3
R30 55 15 50E3
R31 51 70 50E3
C9 53 4 1E-12
C11 51 4 1E-12
C12 55 4 1E-12
C13 54 4 1E-12
I2 27 58 60E-6
Q5 27 58 5 QON
Q6 4 65 58 QOP
V17 57 4 7.5
R33 5 4 42E3
R46 75 2 35E6
R35 23 4 1E6
S3 6 39 60 4 S1M
S7 49 15 72 4 S7M
V16 49 4 5
R36 15 4 500
D7 9 7 D1M
V23 68 4 0.8
V24 67 4 12
R34 69 65 1E3
C19 75 2 3E-12
G2 4 78 2 79 7E-5
C15 5 71 0.01E-6
D14 65 67 D4M
D15 4 87 D4M
D16 68 65 D4M
G1 4 69 57 5 0.01
R37 4 69 400E3
S4 9 63 13 4 S1M
C16 77 69 10E-12
R38 71 4 1
S5 23 31 44 4 S5M
S6 23 32 43 4 S5M
S9 31 13 41 4 S5M
S10 32 60 40 4 S5M
S11 56 23 70 4 S11M
S12 31 13 14 4 S5M
S13 32 60 29 4 S5M
R39 4 77 10E3
R47 78 4 2E9
E11 80 4 81 4 1.0
R48 78 81 7E3
C22 81 4 5E-12
G3 4 91 81 4 0.001
R49 91 4 1000
C23 91 4 10E-12
G4 4 82 91 4 0.001
R50 82 4 1E3
C24 82 4 3E-12
R51 2 83 1E9
R52 75 83 1E9
D9 75 73 D4M
D10 2 73 D4M
D11 74 2 D4M
G6 4 84 83 4 7E-6
R53 84 85 1
L3 85 4 1.6E-4
E12 75 79 84 4 1
D12 80 78 D4M
D13 78 80 D4M
V20 86 81 1.9
V21 81 87 0.8
R54 85 4 500
I6 27 88 11E-5
I7 89 4 50E-5
R55 3 90 25
Q23 27 82 89 QON
Q24 27 88 90 QON
Q26 4 82 88 QOP
Q27 4 89 90 QOP
R57 3 76 10
I1 4 1 0.5E-6
I3 4 2 0.4E-6
S8 62 12 61 4 S8M
R58 12 4 1E6
R59 7 4 1E6
I4 7 4 0.025
R60 70 61 100E3
S16 61 4 41 4 S16M
S17 61 4 40 4 S16M
V22 62 0 -1
GB2 4 7 VALUE = {V(12)*0.017*SQRT(SQRT(ABS(V(7))))}
.MODEL R1M RES (TC1=5.797E-3 TC2=3.768E-6)
.MODEL R3M RES (TC1=7.374E-3 TC2=2.598E-5)
.MODEL D1M D (IS=2E-18 M=0.333 N=1.61 RS=0.08 VJ=0.75)
.MODEL D4M D (BV=100 CJO=4E-12 IS=7E-09
+ M=0.45 N=2.0 RS=0.8 TT=6E-9 VJ=0.6V)
.MODEL D5M D (IS=3.274E-12 M=0.333 N=1 RS=0.0246 VJ=0.75)
.MODEL QON NPN
.MODEL QOP PNP
.MODEL Q1M NPN (IS=1.5E-15 CJC=1E-12 NC=1.7)
.MODEL S1M VSWITCH RON=0.06 ROFF=1E6 VON=2.55 VOFF=2.0
.MODEL S5M VSWITCH RON=0.1 ROFF=1E6 VON=0.001 VOFF=0
.MODEL S7M VSWITCH RON=5 ROFF=100E3 VON=5.1 VOFF=4.9
.MODEL S8M VSWITCH RON=1 ROFF=1E6 VON=2.65 VOFF=2.35
.MODEL S11M VSWITCH RON=0.1 ROFF=1E6 VON=2.51 VOFF=2.49
.MODEL S16M VSWITCH RON=10E3 ROFF=1E6 VON=0.001 VOFF=0
.ENDS
*END OF MODEL SA01
*************
*     SA01TOOL STATE AVERAGE PWM MODEL FEATURES INCLUDE:
* 1 AVERAGE VALUE, TIME AND FREQUENCY DOMAIN PERFORMANCE
* 2 OUTPUT RESISTANCE FOR 100 DEGREE C JUNCTIONS
* 3 CURRENT SENSE PIN OUTPUTS
* 4 VS LOADING DUE TO OUTPUT CURRENT ONLY
* 5 SYMBOL COMPATABILITY WITH THE PULSE BY PULSE MODEL
* 6 PIN NUMBERS CORRESPOND TO THE HARDWARE
* 7 A FLAG OUTPUT SHOWS INPUT VOLTAGE OUTSIDE THE MODULATION RANGE
*
* WITH NO SWITCHING, THIS MODEL RUNS MANY TIMES FASTER THAN THE PULSE
* BY PULSE MODEL AND IT CAN RUN AN AC SWEEP, MAKING SIMULATION OF
* FEEDBACK LOOPS QUICK (RAISE OR ELIMINATE STEP CEILING).  
*
* BEWARE: LACK OF SWITCHING ELIMINATES SOME DISTORTION ELEMENTS FOUND
* IN THE PULSE BY PULSE MODEL AND THE HARDWARE. ALSO, LACK OF DEAD
* TIME ALLOWS LINEAR OPERATION ALL THE WAY TO 0 OR 100% MODULATION, 
* WHICH IS NOT POSSIBLE WITH THE HARDWARE.
* 
* THE SHDN/FILTER FUNCTION IS NOT MODELED.
*
*BEGIN MODEL SA01TOOL FOR PSPICE.
*PINOUT ORDER -IN +IN EAOUT GND REF AOUT  VS ISENS BOUT SHDN
*PINOUT        1   2    3    4   5    6    7   8     9   10
.SUBCKT SA01TOOL_AM 1 2 3 4 5 6 7 8 9 10
* SET UP HIGH, LOW AND P-P RAMP VALUES
V123 123 0 7.5 
V125 125 0 2.5 
E124 124 0 123 125 1 
* S123 & S125 LIMIT MODULATOR DRIVE TO 0/100%
S123 129 123 3 123 SM1 
S125 125 129 125 3 SM1 
R129 3 129 10K 
.MODEL SM1 VSWITCH (RON=1 ROFF=100MEG VON=.001 VOFF=-.001)
* E119 SHOWS ONLY INTEGRATOR VOLTAGE OUTSIDE MODULATION RANGE
E119 128 0 129 3 -1 
R128 128 10 10 
R110 10 0 1meg 
* 130 SERIES PARTS ARE THE NON-INVERTING OUT, 140 ARE INVERTING
* E130 & E140 GIVE MODULATION VOLTAGES; 0=0 OUT, VP-P=VS OUT
E130 130 0 129 125 1 
E140 140 0 123 129 1 
* E131 & E141 GENERATE OUTPUTS; V(MODULATE)*PWM GAIN [VS/VP-P]
E131 131 0 VALUE={V(130)*V(7)/V(124)} 
E141 141 0 VALUE={V(140)*V(7)/V(124)} 
* R132 & 142 SET ZOUT (ABOUT 100DEGREES C) AND MEASURE IOUT
R132 131 6 .18 
R142 141 9 .18 
* E132 & E142 SENSE OUTPUT CURRENT & MULTIPLY BY FRACTION OF MODULATION
* FRACTION IS 0 @ VOUT=0 AND 1 @ VOUT=VS
E132 135 0 VALUE={(V(131)-V(6))*V(130)/V(124)} 
E142 145 0 VALUE={(V(141)-V(9))*V(140)/V(124)} 
* G135 & G145 REFLECT OUTPUT CURRENT INTO VSENSE PINS
G135 208 0 135 0 -5.556 
G145 208 0 145 0 -5.556 
VSENS 208 8 0 
* F125 REFLECTS CURRENT INTO VS PIN
F125 7 0 VSENS 1 
*
VREF 5 0 7.5 
R105 5 0 1meg 
*
* CATCH DIODES-FILTER/LOAD PHASE SHIFT CAN MAKE CURRENT FLOW BACKWARDS
D130 6 7 D1M 
D131 0 6 D1M 
D140 9 7 D1M 
D141 0 9 D1M 
.MODEL D1M D (IS=2.832E-12 M=0.333 N=1.00 RS=0.043 VJ=0.75)
*
D120 1 99 D1N4148 
D122 0 1 D1N4148 
D121 2 99 D1N4148 
D123 0 2 D1N4148 
.MODEL D1N4148  D(IS=0.1P RS=16 CJO=2P TT=12N BV=100 IBV=0.1P)  
*
R104 4 0 1meg 
*
V103 99 0 12 
*
*X1 2 1 99 0 3 SA01ERR 
*PINOUT ORDER +IN -IN  +V -V OUT
*PINOUT        2   1   99  0  3
*.SUBCKT SAERR 2 1 99 0 3
I1 0 1 0.5E-6
I2 0 2 0.4E-6
V5 16 1 1.5E-3
D1 96 16 D2M 
D2 16 89 D2M
D3 2 89 D2M
D4 96 2 D2M
C1 2 0 2E-12
R1 2 0 300E6
R2 16 0 300E6
C2 16 0 2E-12
R3 16 2 35E6
C3 16 2 3E-12
V3 99 89 0.9
V4 96 0 2.9
D5 12 91 D2M
D6 91 12 D2M
I6 99 17 11E-5
I7 18 0 50E-5
G2 0 91 2 27 7E-5
R8 91 0 2E9
R18 25 0 500
R7 3 98 25
E1 12 0 13 0 1.0
R9 91 13 7E3
C6 13 0 5E-12
G3 0 14 13 0 0.001
R10 14 0 1000
C7 14 0 10E-12
G4 0 15 14 0 0.001
R11 15 0 1000
C8 15 0 3E-12
R14 2 24 1E9
R15 16 24 1E9
G6 0 26 24 0 7E-6
D8 34 99 D8M
V9 34 13 1.9
R16 26 25 1
L1 25 0 1.6E-4
E3 16 27 26 0 1
Q23 99 15 18 QON
Q24 99 17 98 QON
Q26 0 15 17 QOP
Q27 0 18 98 QOP
D15 0 36 D8M
V12 13 36 0.8
.MODEL QON NPN
.MODEL QOP PNP
.MODEL D8M D IS=1E-15
.MODEL D2M D CJO=4E-12 IS=7E-9 M=0.45 N=2
+ RS=0.8 TT=6E-9 VJ=0.6V
.ENDS
*END OF MODEL SA01TOOL
**********
*       SA03 PWM MODEL FEATURES INCLUDE:
*
*   1 PULSE BY PULSE TIME DOMAIN PERFORMANCE
*   2 OUTPUT RESISTANCE AND CAPACITANCE
*   3 ACCURATE CATCH DIODE I V CHARACTERISTIC
*   4 ACCURATE RON TEMPERATURE COEFFICIENT
*   5 INCREASING IQ ON THE VS SUPPLY VS FREQUENCY
*   6 DEADTIME BETWEEN SWITCH ON TIMES
*   7 ACCURATE IQ ON THE VCC LINE
*   8 REDUCTION IN IQ VCC IN SHUTDOWN
*   9 INTERNAL CMOS BUFFER ON THE CLK IN PIN
*  10 ILIM / SHUTDOWN FUNCTIONS
*
*     NOTE: THERMAL SHUTDOWN IS NOT MODELED
*     NOTE: HIGH SIDE CURRENT LIMIT IS NOT MODELED
*
*       SOME NOTES ON USING SPICE FOR PWM SIMULATION
*
*  REQUIRES BERKELEY SPICE 3E.3P OR LATER. YOUR SIMULATOR
*  MUST SUPPORT THE BERKELEY STANDARD VOLTAGE CONTROLLED
*  SWITCH ELEMENT (S)
*  OR
*  REQUIRES PSPICE 4.04 OR LATER
*
*  BE PREPARED FOR LONG SIMULATIONS
*
*  NOTE: BERKELEY SIMULATORS TYPICALLY RUN THESE
*  PWM MODELS ABOUT TWO TO FOUR TIMES FASTER THAN
*  PSPICE TYPE SIMULATORS AS THE BERKELEY SWITCH
*  ELEMENT DOES NOT INVOKE AS BIG A COMPUTATIONAL
*  BURDEN
*
*  IF YOUR SIMULATION STOPS DUE TO "TIMESTEP TOO SMALL"
*  ERRORS YOU MAY WANT TO INCREASE ITL4 TO 100, INCREASE
*  RELTOL TO 0.003 TO 0.01, INCREASE ABSTOL TO 1E-11 TO
*  1E-9, INCREASE GMIN TO 1E-11 TO 1E-7, INCREASE VNTOL
*  TO 1E-5 TO 1E-4, OR INCREASE CHGTOL TO 1E-11 TO 1E-9.
*  ANY OR ALL OF THESE SIMULATOR OPTIONS MAY BE REQUIRED
*  DEPENDING ON YOUR SIMULATOR. NEWER SIMULATORS USUALLY
*  REQUIRE FEWER OF THEM.
*
*  TO AID THE INITIAL TRANSIENT CONVERGANCE, SET UP THE
*  INITIAL VALUE OF CLOCK IN AS FOLLOWS:
*        IF PWM IN > 5V, CLOCK IN INITIAL = 5 VOLTS
*        IF PWM IN < 5V, CLOCK IN INITIAL = 0 VOLTS
*
*  TO AID THE INITIAL DC CONVERGANCE SET ITL1 TO 500.
*
*  THE CLOCK IS A GENERATOR STATEMENT INSIDE THE MODEL.
*  WHERE THE REAL PART HAS AN OSCILLATOR FOLLOWED BY A
*  DIGITAL DIVIDE BY TWO, THE MODEL HAS THE GENERATOR
*  AT HALF OF THE CLOCK FREQUENCY. IF YOU NEED TO SYNCH-
*  RONIZE THE PWM CLOCK TO AN EXTERNAL SOURCE, LOOK IN
*  YOUR SIMULATOR LIBRARY FOR A SIMPLE FAST RUNNING
*  BEHAVIORAL FREQUENCY DIVIDER OR DFLOP. BECAUSE THE
*  EXTENTIONS THAT ALLOW BEHAVIORAL MODELS VARY WIDELY
*  AMONG VENDORS NONE ARE INCLUDED HERE. AT THE BOTTOM
*  OF THIS LIBRARY FILE YOU WILL FIND A COMPONENT LEVEL
*  FREQUENCY DIVIDER SUBCIRCUIT (FDIV) WILL WORK WITH
*  ALL SIMULATORS. IT WORKS AT FIVE VOLTS (PROVIDE 5V
*  AND GROUND ON THE SUPPLIES OF FDIV) AND CAN PROVIDE
*  FREQUENCY DIVISION BY 2 TO GO BETWEEN YOUR EXTERNAL
*  SYNCH SIGNAL AND THE CLOCK INPUT OF THE PWM MODEL.
*  BECAUSE FDIV IS COMPONENT LEVEL IT IS SLOW AND WILL
*  EXTEND THE EXECUTION TIME BY AS MUCH AS 2 TO 1.
*
*  A GOOD WAY TO TEST SIMULATION ACCURACY IS TO FIX THE
*  PWM SIGNAL INPUT TO A FIXED VOLTAGE THAT IS EQUIVALENT
*  TO HALFWAY BETWEEN 50-50 DUTY FACTOR AND 100 PERCENT
*  DUTY FACTOR. RUN A SIMULATION THAT HAS TIME FOR OUTPUT
*  FILTER SETTLING. IF THE OUTPUT VOLTAGE WANDERS AROUND
*  RATHER THAN STAYS SETTLED TO LESS THAN ONE PERCENT YOU
*  SHOULD REDUCE THE TIMESTEP MAX (TMAX) PARAMETER IN THE
*  TRAN LINE. THIS IS THE FOURTH TIME PARAMETER ON THAT
*  LINE AND IS OPTIONAL LIKE THE TSTART PARAMETER (THIRD
*  TIME PARAMETER ON THAT LINE). IF YOU ARE NOT USING
*  TSTART YOU MUST SET IT TO ZERO SO THE SIMULATOR WILL
*  RECOGNIZE TMAX AS TMAX RATHER THAN TSTART. FOR BERKELEY
*  SPICE 3 TMAX WILL USUALLY BE IN THE 500 TO 150 NS RANGE.
*  FOR PSPICE TMAX WILL USUALLY BE IN THE 250 TO 50 NS
*  RANGE.
*
*  BECAUSE THE SPICE OUTPUT DATA IS A SAMPLED SYSTEM,
*  ALIASING CAN TAKE PLACE. IF THE WAVEFORM YOU ARE
*  LOOKING AT IS REPETATIVE BUT SEEMS TO HAVE INADEQUATE
*  P-P AMPLITUDE, YOU MAY WANT TO SAMPLE THE DATA MORE
*  OFTEN OR CHANGE THE RATIONALITY BETWEEN THE PWM CLOCK
*  PERIOD AND YOUR SAMPLING PERIOD.
*
*  IF YOUR SIMULATION CANNOT GET PAST INITIAL CONVERGANCE
*  FOR THE TRANSIENT ANALYSIS, RAMP VCC AND VS UP FROM
*  ZERO VOLTS TO NORMAL IN THE FIRST 10 MICROSECONDS OR SO.
*  THIS WILL NOT ONLY HELP THE TRAN ANALYSIS GET STARTED
*  BUT WILL ALLOW YOU TO SEE THE INITIAL VOLTAGES AND
*  CURRENTS FOR LATER SETTING OF NODESETS. LOOK FOR
*  OUTPUT FILTER INDUCTOR CURRENTS AND CAPACITOR VOLTAGES
*  TO ALLOW SETTING UP INITIAL CONDITIONS ON THOSE PARTS.
*  SETTING INITIAL CONDITIONS CAN ALLOW YOUR OUTPUT FILTER
*  TO GET TO OPERATING CONDITIONS MORE QUICKLY. DON'T
*  FORGET TO USE THE UIC OPTION IN THE TRAN LINE TO FORCE
*  USE OF INITIAL CONDITIONS.
*
*  BECAUSE THIS MODEL MUST BE CAPABLE OF RUNNING AT ANY
*  CLOCK RATE UP TO THE SPECIFICATION, THE MODEL MEASURES
*  THE CLOCK FREQUENCY AND FILTERS THE ANALOG RESULT AND
*  USES IT AS PART OF THE MODELING THAT CREATES THE
*  FREQUENCY DEPENDENT PART OF IQ(VSS). THE FILTER HAS A
*  TIME CONSTANT OF 300 USEC. DURING SHUTDOWN THE IQ(VSS)
*  IS SET TO A LOWER VALUE VIA THIS TIME CONSTANT AND
*  IQ(VCC) IS SET TO A LOWER VALUE WITH NO TIME CONSTANT.
*
*BEGIN MODEL SA03 FOR PSPICE
*PINOUT ORDER CKIN CKOUT +PWM -PWM GND ILIM ISENB BOUT +VS VCC AOUT ISENA
*PINOUT         1    2     3    4   5    6    7     8   9   10  11    12
.SUBCKT SA03_AM 1 2 3 4 5 6 7 8 9 10 11 12
V7 44 5 0 PULSE 0 5 0 10N 10N 22.22U 44.44U 
RE2 41 5 1E9
E1 14 5 23 4 1
D5 12 11 D1M 
R13 27 5 10
R42 5 14 1E9
R39 67 63 10E3
C17 63 5 28E-12
R46 27 13 10E3
C18 13 5 28E-12
R1 40 11 R1M 0.09
R2 19 8 R1M 0.09
R3 64 12 R1M 0.09
R4 39 7 R1M 0.09
D4 13 27 D2M 
D8 63 67 D2M 
R14 32 23 1E3
R37 23 27 143E9
E4 32 5 66 5 1
E3 5 31 41 27 -1
R43 44 2 100
C22 2 5 10E-12
V2 41 5 4.5
D1 11 9 D1M 
E9 16 5 65 25 1000
D6 7 8 D1M
D7 8 9 D1M
V9 28 5 0.1
C4 9 34 350E-12
C5 9 37 350E-12
C6 11 35 350E-12
C7 8 33 350E-12
R10 34 11 0.47
R12 35 12 0.47
R18 37 8 0.47
R20 33 7 0.47
S5 61 27 14 5 S5M  
C19 15 5 1000E-12
C20 29 5 2000E-12
R15 26 29 10
E13 43 5 42 38 1
R16 43 30 300
C21 30 5 1E-6
R17 3 15 50
R45 30 5 1E9
C10 65 5 1000E-12
R21 65 6 1E3
D2 46 47 DN
D3 48 46 DN
R22 46 16 1E3
V10 48 5 0.8
V11 47 0 4.1
R23 28 25 1E3
R24 57 25 1E6
R25 57 50 1E3
R26 59 50 1E3
R27 52 25 100E3
R19 60 5 1
C8 57 52 5E-12
V13 56 5 5
V8 22 5 2.5
Q1 57 53 5 QFN 
Q2 57 54 5 QFN 
Q3 59 55 5 QFN 
Q4 59 51 5 QFN 
R28 53 46 50E3
R29 54 59 50E3
R30 55 49 50E3
R31 51 57 50E3
C9 53 5 1E-12
C11 51 5 1E-12
C12 55 5 1E-12
C13 54 5 1E-12
R33 58 4 55E3
C15 4 5 470E-12
M1 49 62 5 5 M1M
M2 49 62 50 50 M2M
R34 62 1 50
C16 62 5 5E-12
E10 58 5 49 0 2
V12 50 5 5
R35 61 5 1E9
S7 26 42 22 13 S7M
S8 26 60 13 22 S7M
R36 66 5 10E6
R38 38 42 1
V4 38 5 10
G1 5 10 30 5 0.36
R40 10 69 500
S10 69 5 57 5 S1M
I2 10 5 0.05
GQ1 5 9 VALUE = {(-0.05)*((0.13+(V(9)/69))*(0.28+V(30)*(-1600)))}
R49 65 5 10E6
R51 15 66 50
R52 67 5 10
S1 9 40 13 5 S1M
S2 9 19 63 5 S1M
S3 11 64 63 5 S1M
S4 8 39 13 5 S1M
S6 67 31 57 5 S6M
S9 56 61 57 5 S1M
.MODEL R1M RES (TC1=7.374E-3 TC2=2.598E-5)
.MODEL QFN NPN (BF=100 NE=1.5 EG=1.11
+ IS=1.5E-15 NC=1.7 FC=0.5 CJC=1E-12)
.MODEL M1M NMOS (CBD=17E-12 CBS=17E-12 CGBO=26E-9
+ CGDO=18E-9 CGSO=20E-9 IS=31E-15 KP=4.3E-3 RD=50
+ RS=50 VTO=2.25)
.MODEL M2M PMOS (CBD=17E-12 CBS=17E-12 CGBO=26E-9
+ CGDO=18E-9 CGSO=20E-9 IS=31E-15 KP=4.3E-3 RD=50
+ RS=50 VTO=-2.25)
.MODEL S1M  VSWITCH RON=0.01 ROFF=1E6 VON=2.55 VOFF=2.0
.MODEL S5M  VSWITCH RON=1 ROFF=1E3 VON=0.001 VOFF=0
.MODEL S6M  VSWITCH RON=0.1 ROFF=1E4 VON=2.51 VOFF=0
.MODEL S7M  VSWITCH RON=1 ROFF=1E5 VON=0.1 VOFF=0
.MODEL D1M D (IS=6.365E-12 M=0.333 N=1.00 RS=0.02685 VJ=0.75)
.MODEL D2M D (IS=1.68E-08 M=0.333 N=1.89 RS=0.452 VJ=0.75)
.MODEL DN D (BV=100 CJO=4E-12 IS=7E-9 M=0.45 N=2 RS=0.8 TT=6E-9 VJ=0.6)
.ENDS
*END OF MODEL SA03
*************
*     SA03TOOL STATE AVERAGE PWM MODEL FEATURES INCLUDE:
* 1 AVERAGE VALUE, TIME AND FREQUENCY DOMAIN PERFORMANCE
* 2 OUTPUT RESISTANCE FOR 100 DEGREE C JUNCTIONS
* 3 CURRENT SENSE PIN OUTPUTS
* 4 VS LOADING DUE TO OUTPUT CURRENT ONLY
* 5 SYMBOL COMPATABILITY WITH THE PULSE BY PULSE MODEL
* 6 PIN NUMBERS CORRESPOND TO THE HARDWARE
* 7 A FLAG OUTPUT SHOWS INPUT VOLTAGE OUTSIDE THE MODULATION RANGE
*
* WITH NO SWITCHING, THIS MODEL RUNS MANY TIMES FASTER THAN THE PULSE
* BY PULSE MODEL AND IT CAN RUN AN AC SWEEP, MAKING SIMULATION OF
* FEEDBACK LOOPS QUICK (RAISE OR ELIMINATE STEP CEILING).  
*
* BEWARE: LACK OF SWITCHING ELIMINATES SOME DISTORTION ELEMENTS FOUND
* IN THE PULSE BY PULSE MODEL AND THE HARDWARE. ALSO, LACK OF DEAD
* TIME ALLOWS LINEAR OPERATION ALL THE WAY TO 0 OR 100% MODULATION, 
* WHICH IS NOT POSSIBLE WITH THE HARDWARE.
* 
* THE ILIM/SHDN FUNCTION IS NOT MODELED.
*
*BEGIN MODEL SA03TOOL FOR PSPICE.
*PINS CLKIN CLKOUT +PWM -PWM GND ILIM/SDN ISENB BOUT VS VCC AOUT ISENA
*PINS   1      2     3    4   5      6      7     8   9  10  11    12
.SUBCKT SA03TOOL_AM 1 2 3 4 5 6 7 8 9 10 11 12
* R110 & C110 DUPLICATE HARDWARE
R110 3 127 50
C110 127 0 .01U
* SET UP HIGH, LOW AND P-P RAMP VALUES
E124 124 0 123 125 1 
V123 123 0 7 
V125 125 0 3 
* S123 & S125 LIMIT MODULATOR DRIVE TO 0/100%
S123 129 123 127 123 SM1 
S125 125 129 125 127 SM1 
R129 127 129 10K 
.MODEL SM1 VSWITCH (RON=1 ROFF=100MEG VON=.001 VOFF=-.001)
* E119 SHOWS ONLY INTEGRATOR VOLTAGE OUTSIDE MODULATION RANGE
E119 128 0 129 127 -1 
R128 128 6 10 
R6 3 0 1meg 
* 130 SERIES PARTS ARE THE NON-INVERTING OUT, 140 ARE INVERTING
* E130 & E140 GIVE MODULATION VOLTAGES; 0=0 OUT, VP-P=VS OUT
E130 130 0 129 125 1 
E140 140 0 123 129 1 
* E131 & E141 GENERATE OUTPUTS; V(MODULATE)*PWM GAIN [VS/VP-P]
E141 141 0 VALUE={V(140)*V(9)/V(124)} 
E131 131 0 VALUE={V(130)*V(9)/V(124)} 
* R132 & 142 SET ZOUT (ABOUT 100DEGREES C) AND MEASURE IOUT
R132 131 11 .114 
R142 141 8 .114 
* E132 & E142 SENSE OUTPUT CURRENT & MULTIPLY BY FRACTION OF MODULATION
* FRACTION IS 0 @ VOUT=0 AND 1 @ VOUT=VS
E132 135 0 VALUE={(V(131)-V(11))*V(130)/V(124)} 
E142 145 0 VALUE={(V(141)-V(8))*V(140)/V(124)}
* G135 & G145 REFLECT OUTPUT CURRENT INTO VSENSE PINS
G135 208 0 135 0 -8.772
G145 212 0 145 0 -8.772
V135 208 7 0 
V145 212 12 0 
* F135 & F145 REFLECT CURRENT INTO VS PIN
F135 9 0 V135 1 
F145 9 0 V145 1 
* 
R1 1 0 1meg 
R2 2 0 1meg 
R4 4 0 1meg 
R5 5 0 1meg 
* CATCH DIODES-FILTER/LOAD PHASE SHIFT CAN MAKE CURRENT FLOW BACKWARDS
D130 11 9 D1M 
D131 0 11 D1M 
D140 8 9 D1M 
D141 0 8 D1M 
.MODEL D1M D (IS=2.832E-12 M=0.333 N=1.00 RS=0.043 VJ=0.75)
*
D120 127 10 D1N4148 
D121 0 127 D1N4148
.MODEL D1N4148  D(IS=0.1P RS=16 CJO=2P TT=12N BV=100 IBV=0.1P)  
.ENDS
*END OF MODEL SA03TOOL
**********
*       SA04 PWM MODEL FEATURES INCLUDE:
*
*   1 PULSE BY PULSE TIME DOMAIN PERFORMANCE
*   2 OUTPUT RESISTANCE AND CAPACITANCE
*   3 ACCURATE CATCH DIODE I V CHARACTERISTIC
*   4 ACCURATE RON TEMPERATURE COEFFICIENT
*   5 INCREASING IQ ON THE VS SUPPLY VS FREQUENCY
*   6 DEADTIME BETWEEN SWITCH ON TIMES
*   7 ACCURATE IQ ON THE VCC LINE
*   8 REDUCTION IN IQ VCC IN SHUTDOWN
*   9 INTERNAL CMOS BUFFER ON THE CLK IN PIN
*  10 ILIM / SHUTDOWN FUNCTIONS
*
*     NOTE: THERMAL SHUTDOWN IS NOT MODELED
*     NOTE: HIGH SIDE CURRENT LIMIT IS NOT MODELED
*
*       SOME NOTES ON USING SPICE FOR PWM SIMULATION
*
*  REQUIRES BERKELEY SPICE 3E.3P OR LATER. YOUR SIMULATOR
*  MUST SUPPORT THE BERKELEY STANDARD VOLTAGE CONTROLLED
*  SWITCH ELEMENT (S)
*  OR
*  REQUIRES PSPICE 4.04 OR LATER
*
*  BE PREPARED FOR LONG SIMULATIONS
*
*  NOTE: BERKELEY SIMULATORS TYPICALLY RUN THESE
*  PWM MODELS ABOUT TWO TO FOUR TIMES FASTER THAN
*  PSPICE TYPE SIMULATORS AS THE BERKELEY SWITCH
*  ELEMENT DOES NOT INVOKE AS BIG A COMPUTATIONAL
*  BURDEN
*
*  IF YOUR SIMULATION STOPS DUE TO "TIMESTEP TOO SMALL"
*  ERRORS YOU MAY WANT TO INCREASE ITL4 TO 100, INCREASE
*  RELTOL TO 0.003 TO 0.01, INCREASE ABSTOL TO 1E-11 TO
*  1E-9, INCREASE GMIN TO 1E-11 TO 1E-7, INCREASE VNTOL
*  TO 1E-5 TO 1E-4, OR INCREASE CHGTOL TO 1E-11 TO 1E-9.
*  ANY OR ALL OF THESE SIMULATOR OPTIONS MAY BE REQUIRED
*  DEPENDING ON YOUR SIMULATOR. NEWER SIMULATORS USUALLY
*  REQUIRE FEWER OF THEM.
*
*  TO AID THE INITIAL TRANSIENT CONVERGANCE, SET UP THE
*  INITIAL VALUE OF CLOCK IN AS FOLLOWS:
*        IF PWM IN > 5V, CLOCK IN INITIAL = 5 VOLTS
*        IF PWM IN < 5V, CLOCK IN INITIAL = 0 VOLTS
*
*  TO AID THE INITIAL DC CONVERGANCE SET ITL1 TO 500.
*
*  THE CLOCK IS A GENERATOR STATEMENT INSIDE THE MODEL.
*  WHERE THE REAL PART HAS AN OSCILLATOR FOLLOWED BY A
*  DIGITAL DIVIDE BY TWO, THE MODEL HAS THE GENERATOR
*  AT HALF OF THE CLOCK FREQUENCY. IF YOU NEED TO SYNCH-
*  RONIZE THE PWM CLOCK TO AN EXTERNAL SOURCE, LOOK IN
*  YOUR SIMULATOR LIBRARY FOR A SIMPLE FAST RUNNING
*  BEHAVIORAL FREQUENCY DIVIDER OR DFLOP. BECAUSE THE
*  EXTENTIONS THAT ALLOW BEHAVIORAL MODELS VARY WIDELY
*  AMONG VENDORS NONE ARE INCLUDED HERE. AT THE BOTTOM
*  OF THIS LIBRARY FILE YOU WILL FIND A COMPONENT LEVEL
*  FREQUENCY DIVIDER SUBCIRCUIT (FDIV) WILL WORK WITH
*  ALL SIMULATORS. IT WORKS AT FIVE VOLTS (PROVIDE 5V
*  AND GROUND ON THE SUPPLIES OF FDIV) AND CAN PROVIDE
*  FREQUENCY DIVISION BY 2 TO GO BETWEEN YOUR EXTERNAL
*  SYNCH SIGNAL AND THE CLOCK INPUT OF THE PWM MODEL.
*  BECAUSE FDIV IS COMPONENT LEVEL IT IS SLOW AND WILL
*  EXTEND THE EXECUTION TIME BY AS MUCH AS 2 TO 1.
*
*  A GOOD WAY TO TEST SIMULATION ACCURACY IS TO FIX THE
*  PWM SIGNAL INPUT TO A FIXED VOLTAGE THAT IS EQUIVALENT
*  TO HALFWAY BETWEEN 50-50 DUTY FACTOR AND 100 PERCENT
*  DUTY FACTOR. RUN A SIMULATION THAT HAS TIME FOR OUTPUT
*  FILTER SETTLING. IF THE OUTPUT VOLTAGE WANDERS AROUND
*  RATHER THAN STAYS SETTLED TO LESS THAN ONE PERCENT YOU
*  SHOULD REDUCE THE TIMESTEP MAX (TMAX) PARAMETER IN THE
*  TRAN LINE. THIS IS THE FOURTH TIME PARAMETER ON THAT
*  LINE AND IS OPTIONAL LIKE THE TSTART PARAMETER (THIRD
*  TIME PARAMETER ON THAT LINE). IF YOU ARE NOT USING
*  TSTART YOU MUST SET IT TO ZERO SO THE SIMULATOR WILL
*  RECOGNIZE TMAX AS TMAX RATHER THAN TSTART. FOR BERKELEY
*  SPICE 3 TMAX WILL USUALLY BE IN THE 500 TO 150 NS RANGE.
*  FOR PSPICE TMAX WILL USUALLY BE IN THE 250 TO 50 NS
*  RANGE.
*
*  BECAUSE THE SPICE OUTPUT DATA IS A SAMPLED SYSTEM,
*  ALIASING CAN TAKE PLACE. IF THE WAVEFORM YOU ARE
*  LOOKING AT IS REPETATIVE BUT SEEMS TO HAVE INADEQUATE
*  P-P AMPLITUDE, YOU MAY WANT TO SAMPLE THE DATA MORE
*  OFTEN OR CHANGE THE RATIONALITY BETWEEN THE PWM CLOCK
*  PERIOD AND YOUR SAMPLING PERIOD.
*
*  IF YOUR SIMULATION CANNOT GET PAST INITIAL CONVERGANCE
*  FOR THE TRANSIENT ANALYSIS, RAMP VCC AND VS UP FROM
*  ZERO VOLTS TO NORMAL IN THE FIRST 10 MICROSECONDS OR SO.
*  THIS WILL NOT ONLY HELP THE TRAN ANALYSIS GET STARTED
*  BUT WILL ALLOW YOU TO SEE THE INITIAL VOLTAGES AND
*  CURRENTS FOR LATER SETTING OF NODESETS. LOOK FOR
*  OUTPUT FILTER INDUCTOR CURRENTS AND CAPACITOR VOLTAGES
*  TO ALLOW SETTING UP INITIAL CONDITIONS ON THOSE PARTS.
*  SETTING INITIAL CONDITIONS CAN ALLOW YOUR OUTPUT FILTER
*  TO GET TO OPERATING CONDITIONS MORE QUICKLY. DON'T
*  FORGET TO USE THE UIC OPTION IN THE TRAN LINE TO FORCE
*  USE OF INITIAL CONDITIONS.
*
*  BECAUSE THIS MODEL MUST BE CAPABLE OF RUNNING AT ANY
*  CLOCK RATE UP TO THE SPECIFICATION, THE MODEL MEASURES
*  THE CLOCK FREQUENCY AND FILTERS THE ANALOG RESULT AND
*  USES IT AS PART OF THE MODELING THAT CREATES THE
*  FREQUENCY DEPENDENT PART OF IQ(VSS). THE FILTER HAS A
*  TIME CONSTANT OF 300 USEC. DURING SHUTDOWN THE IQ(VSS)
*  IS SET TO A LOWER VALUE VIA THIS TIME CONSTANT AND
*  IQ(VCC) IS SET TO A LOWER VALUE WITH NO TIME CONSTANT.
*
*BEGIN MODEL SA04 FOR PSPICE
*PINOUT ORDER CKIN CKOUT +PWM -PWM GND ILIM ISENB BOUT +VS VCC AOUT ISENA
*PINOUT         1    2     3    4   5    6    7     8   9   10  11    12
.SUBCKT SA04_AM 1 2 3 4 5 6 7 8 9 10 11 12
V7 44 5 0 PULSE 0 5 0 10N 10N 22.22U 44.44U
RE2 41 5 1E9
E1 14 5 23 4 1
D5 12 11 D1M 
R13 27 5 10
R42 5 14 1E9
R39 67 63 10E3
C17 63 5 28E-12
R46 27 13 10E3
C18 13 5 28E-12
R1 40 11 R1M 0.121
R2 19 8 R1M 0.121
R3 64 12 R1M 0.121
R4 39 7 R1M 0.121
D4 13 27 D2M 
D8 63 67 D2M 
R14 32 23 1E3
R37 23 27 143E9
E4 32 5 66 5 1
E3 5 31 41 27 -1
R43 44 2 100
C22 2 5 10E-12
V2 41 5 4.5
D1 11 9 D1M 
E9 16 5 65 25 1000
D6 7 8 D1M
D7 8 9 D1M
V9 28 5 0.1
C4 9 34 220E-12
C5 9 37 220E-12
C6 11 35 220E-12
C7 8 33 220E-12
R10 34 11 0.70
R12 35 12 0.70
R18 37 8 0.70
R20 33 7 0.70
S5 61 27 14 5 S5M
C19 15 5 1000E-12
C20 29 5 2000E-12
R15 26 29 10
E13 43 5 42 38 1
R16 43 30 300
C21 30 5 1E-6
R17 3 15 50
R45 30 5 1E9
C10 65 5 1000E-12
R21 65 6 1E3
D2 46 47 DN
D3 48 46 DN
R22 46 16 1E3
V10 48 5 0.8
V11 47 0 4.1
R23 28 25 1E3
R24 57 25 1E6
R25 57 50 1E3
R26 59 50 1E3
R27 52 25 100E3
R19 60 5 1
C8 57 52 5E-12
V13 56 5 5
V8 22 5 2.5
Q1 57 53 5 QFN
Q2 57 54 5 QFN
Q3 59 55 5 QFN
Q4 59 51 5 QFN
R28 53 46 50E3
R29 54 59 50E3
R30 55 49 50E3
R31 51 57 50E3
C9 53 5 1E-12
C11 51 5 1E-12
C12 55 5 1E-12
C13 54 5 1E-12
R33 58 4 55E3
C15 4 5 470E-12
M1 49 62 5 5 M1M
M2 49 62 50 50 M2M
R34 62 1 50
C16 62 5 5E-12
E10 58 5 49 0 2
V12 50 5 5
R35 61 5 1E9
S7 26 42 22 13 S7M
S8 26 60 13 22 S7M
R36 66 5 10E6
R38 38 42 1
V4 38 5 10
G1 5 10 30 5 0.36
R40 10 69 500
S10 69 5 57 5 S1M
I2 10 5 0.05
GQ1 5 9 VALUE = {(-0.05)*((0.29+(V(9)/175))*(0.1+V(30)*(-2000)))}
R49 65 5 10E6
R51 15 66 50
R52 67 5 10
S1 9 40 13 5 S1M
S2 9 19 63 5 S1M
S3 11 64 63 5 S1M
S4 8 39 13 5 S1M
S6 67 31 57 5 S6M
S9 56 61 57 5 S1M
.MODEL R1M RES (TC1=7.374E-3 TC2=2.598E-5)
.MODEL QFN NPN (BF=100 NE=1.5 EG=1.11
+ IS=1.5E-15 NC=1.7 FC=0.5 CJC=1E-12)
.MODEL M1M NMOS (CBD=17E-12 CBS=17E-12 CGBO=26E-9
+ CGDO=18E-9 CGSO=20E-9 IS=31E-15 KP=4.3E-3 RD=50
+ RS=50 VTO=2.25)
.MODEL M2M PMOS (CBD=17E-12 CBS=17E-12 CGBO=26E-9
+ CGDO=18E-9 CGSO=20E-9 IS=31E-15 KP=4.3E-3 RD=50
+ RS=50 VTO=-2.25)
.MODEL S1M  VSWITCH RON=0.01 ROFF=1E6 VON=2.55 VOFF=2.0
.MODEL S5M  VSWITCH RON=1 ROFF=1E3 VON=0.001 VOFF=0
.MODEL S6M  VSWITCH RON=0.1 ROFF=1E4 VON=2.51 VOFF=0
.MODEL S7M  VSWITCH RON=1 ROFF=1E5 VON=0.1 VOFF=0
.MODEL D1M D (IS=5.414E-12 M=0.333 N=1.00 RS=0.0348 VJ=0.75)
.MODEL D2M D (IS=1.68E-08 M=0.333 N=1.89 RS=0.452 VJ=0.75)
.MODEL DN D (BV=100 CJO=4E-12 IS=7E-9 M=0.45 N=2 RS=0.8 TT=6E-9 VJ=0.6)
.ENDS
*END OF MODEL SA04
*************
*     SA04TOOL STATE AVERAGE PWM MODEL FEATURES INCLUDE:
* 1 AVERAGE VALUE, TIME AND FREQUENCY DOMAIN PERFORMANCE
* 2 OUTPUT RESISTANCE FOR 100 DEGREE C JUNCTIONS
* 3 CURRENT SENSE PIN OUTPUTS
* 4 VS LOADING DUE TO OUTPUT CURRENT ONLY
* 5 SYMBOL COMPATABILITY WITH THE PULSE BY PULSE MODEL
* 6 PIN NUMBERS CORRESPOND TO THE HARDWARE
* 7 A FLAG OUTPUT SHOWS INPUT VOLTAGE OUTSIDE THE MODULATION RANGE
*
* WITH NO SWITCHING, THIS MODEL RUNS MANY TIMES FASTER THAN THE PULSE
* BY PULSE MODEL AND IT CAN RUN AN AC SWEEP, MAKING SIMULATION OF
* FEEDBACK LOOPS QUICK (RAISE OR ELIMINATE STEP CEILING).  
*
* BEWARE: LACK OF SWITCHING ELIMINATES SOME DISTORTION ELEMENTS FOUND
* IN THE PULSE BY PULSE MODEL AND THE HARDWARE. ALSO, LACK OF DEAD
* TIME ALLOWS LINEAR OPERATION ALL THE WAY TO 0 OR 100% MODULATION, 
* WHICH IS NOT POSSIBLE WITH THE HARDWARE.
* 
* THE ILIM/SHDN FUNCTION IS NOT MODELED.
*
*BEGIN MODEL SA04TOOL FOR PSPICE.
*PINS CLKIN CLKOUT +PWM -PWM GND ILIM/SDN ISENB BOUT VS VCC AOUT ISENA
*PINS   1      2     3    4   5      6      7     8   9  10  11    12
.SUBCKT SA04TOOL_AM 1 2 3 4 5 6 7 8 9 10 11 12
* R110 & C110 DUPLICATE HARDWARE
R110 3 127 50
C110 127 0 .01U
* SET UP HIGH, LOW AND P-P RAMP VALUES
E124 124 0 123 125 1 
V123 123 0 7 
V125 125 0 3 
* S123 & S125 LIMIT MODULATOR DRIVE TO 0/100%
S123 129 123 127 123 SM1 
S125 125 129 125 127 SM1 
R129 127 129 10K 
.MODEL SM1 VSWITCH (RON=1 ROFF=100MEG VON=.001 VOFF=-.001)
* E119 SHOWS ONLY INTEGRATOR VOLTAGE OUTSIDE MODULATION RANGE
E119 128 0 129 127 -1 
R128 128 6 10 
R6 3 0 1meg 
* 130 SERIES PARTS ARE THE NON-INVERTING OUT, 140 ARE INVERTING
* E130 & E140 GIVE MODULATION VOLTAGES; 0=0 OUT, VP-P=VS OUT
E130 130 0 129 125 1 
E140 140 0 123 129 1 
* E131 & E141 GENERATE OUTPUTS; V(MODULATE)*PWM GAIN [VS/VP-P]
E141 141 0 VALUE={V(140)*V(9)/V(124)} 
E131 131 0 VALUE={V(130)*V(9)/V(124)} 
* R132 & 142 SET ZOUT (ABOUT 100DEGREES C) AND MEASURE IOUT
R132 131 11 .16 
R142 141 8 .16 
* E132 & E142 SENSE OUTPUT CURRENT & MULTIPLY BY FRACTION OF MODULATION
* FRACTION IS 0 @ VOUT=0 AND 1 @ VOUT=VS
E132 135 0 VALUE={(V(131)-V(11))*V(130)/V(124)} 
E142 145 0 VALUE={(V(141)-V(8))*V(140)/V(124)}
* G135 & G145 REFLECT OUTPUT CURRENT INTO VSENSE PINS
G135 208 0 135 0 -6.25 
G145 212 0 145 0 -6.25 
V135 208 7 0 
V145 212 12 0 
* F135 & F145 REFLECT CURRENT INTO VS PIN
F135 9 0 V135 1 
F145 9 0 V145 1 
* 
R1 1 0 1meg 
R2 2 0 1meg 
R4 4 0 1meg 
R5 5 0 1meg 
* CATCH DIODES-FILTER/LOAD PHASE SHIFT CAN MAKE CURRENT FLOW BACKWARDS
D130 11 9 D1M 
D131 0 11 D1M 
D140 8 9 D1M 
D141 0 8 D1M 
.MODEL D1M D (IS=2.832E-12 M=0.333 N=1.00 RS=0.043 VJ=0.75)
*
D120 127 10 D1N4148 
D121 0 127 D1N4148
.MODEL D1N4148  D(IS=0.1P RS=16 CJO=2P TT=12N BV=100 IBV=0.1P)  
.ENDS
*END OF MODEL SA04TOOL
************
*       SA06 PWM MODEL FEATURES INCLUDE:
*
*   1 PULSE BY PULSE TIME DOMAIN PERFORMANCE
*   2 OUTPUT RESISTANCE AND CAPACITANCE
*   3 ACCURATE CATCH DIODE I V CHARACTERISTIC
*   4 ACCURATE RON TEMPERATURE COEFFICIENT
*   5 INCREASING IQ ON THE VS SUPPLY VS FREQUENCY
*   6 DEADTIME BETWEEN SWITCH ON TIMES
*   7 ACCURATE IQ ON THE VCC LINE
*   8 REDUCTION IN IQ VCC IN SHUTDOWN
*   9 INTERNAL CMOS BUFFER ON THE CLK IN PIN
*  10 ILIM / SHUTDOWN FUNCTIONS
*
*     NOTE: THERMAL SHUTDOWN IS NOT MODELED
*     NOTE: HIGH SIDE CURRENT LIMIT IS NOT MODELED
*
*       SOME NOTES ON USING SPICE FOR PWM SIMULATION
*
*  REQUIRES BERKELEY SPICE 3E.3P OR LATER. YOUR SIMULATOR
*  MUST SUPPORT THE BERKELEY STANDARD VOLTAGE CONTROLLED
*  SWITCH ELEMENT (S)
*  OR
*  REQUIRES PSPICE 4.04 OR LATER
*
*  BE PREPARED FOR LONG SIMULATIONS
*
*  NOTE: BERKELEY SIMULATORS TYPICALLY RUN THESE
*  PWM MODELS ABOUT TWO TO FOUR TIMES FASTER THAN
*  PSPICE TYPE SIMULATORS AS THE BERKELEY SWITCH
*  ELEMENT DOES NOT INVOKE AS BIG A COMPUTATIONAL
*  BURDEN
*
*  IF YOUR SIMULATION STOPS DUE TO "TIMESTEP TOO SMALL"
*  ERRORS YOU MAY WANT TO INCREASE ITL4 TO 100, INCREASE
*  RELTOL TO 0.003 TO 0.01, INCREASE ABSTOL TO 1E-11 TO
*  1E-9, INCREASE GMIN TO 1E-11 TO 1E-7, INCREASE VNTOL
*  TO 1E-5 TO 1E-4, OR INCREASE CHGTOL TO 1E-11 TO 1E-9.
*  ANY OR ALL OF THESE SIMULATOR OPTIONS MAY BE REQUIRED
*  DEPENDING ON YOUR SIMULATOR. NEWER SIMULATORS USUALLY
*  REQUIRE FEWER OF THEM.
*
*  TO AID THE INITIAL TRANSIENT CONVERGANCE, SET UP THE
*  INITIAL VALUE OF CLOCK IN AS FOLLOWS:
*        IF PWM IN > 5V, CLOCK IN INITIAL = 5 VOLTS
*        IF PWM IN < 5V, CLOCK IN INITIAL = 0 VOLTS
*
*  TO AID THE INITIAL DC CONVERGANCE SET ITL1 TO 500.
*
*  THE CLOCK IS A GENERATOR STATEMENT INSIDE THE MODEL.
*  WHERE THE REAL PART HAS AN OSCILLATOR FOLLOWED BY A
*  DIGITAL DIVIDE BY TWO, THE MODEL HAS THE GENERATOR
*  AT HALF OF THE CLOCK FREQUENCY. IF YOU NEED TO SYNCH-
*  RONIZE THE PWM CLOCK TO AN EXTERNAL SOURCE, LOOK IN
*  YOUR SIMULATOR LIBRARY FOR A SIMPLE FAST RUNNING
*  BEHAVIORAL FREQUENCY DIVIDER OR DFLOP. BECAUSE THE
*  EXTENTIONS THAT ALLOW BEHAVIORAL MODELS VARY WIDELY
*  AMONG VENDORS NONE ARE INCLUDED HERE. AT THE BOTTOM
*  OF THIS LIBRARY FILE YOU WILL FIND A COMPONENT LEVEL
*  FREQUENCY DIVIDER SUBCIRCUIT (FDIV) WILL WORK WITH
*  ALL SIMULATORS. IT WORKS AT FIVE VOLTS (PROVIDE 5V
*  AND GROUND ON THE SUPPLIES OF FDIV) AND CAN PROVIDE
*  FREQUENCY DIVISION BY 2 TO GO BETWEEN YOUR EXTERNAL
*  SYNCH SIGNAL AND THE CLOCK INPUT OF THE PWM MODEL.
*  BECAUSE FDIV IS COMPONENT LEVEL IT IS SLOW AND WILL
*  EXTEND THE EXECUTION TIME BY AS MUCH AS 2 TO 1.
*
*  A GOOD WAY TO TEST SIMULATION ACCURACY IS TO FIX THE
*  PWM SIGNAL INPUT TO A FIXED VOLTAGE THAT IS EQUIVALENT
*  TO HALFWAY BETWEEN 50-50 DUTY FACTOR AND 100 PERCENT
*  DUTY FACTOR. RUN A SIMULATION THAT HAS TIME FOR OUTPUT
*  FILTER SETTLING. IF THE OUTPUT VOLTAGE WANDERS AROUND
*  RATHER THAN STAYS SETTLED TO LESS THAN ONE PERCENT YOU
*  SHOULD REDUCE THE TIMESTEP MAX (TMAX) PARAMETER IN THE
*  TRAN LINE. THIS IS THE FOURTH TIME PARAMETER ON THAT
*  LINE AND IS OPTIONAL LIKE THE TSTART PARAMETER (THIRD
*  TIME PARAMETER ON THAT LINE). IF YOU ARE NOT USING
*  TSTART YOU MUST SET IT TO ZERO SO THE SIMULATOR WILL
*  RECOGNIZE TMAX AS TMAX RATHER THAN TSTART. FOR BERKELEY
*  SPICE 3 TMAX WILL USUALLY BE IN THE 500 TO 150 NS RANGE.
*  FOR PSPICE TMAX WILL USUALLY BE IN THE 250 TO 50 NS
*  RANGE.
*
*  BECAUSE THE SPICE OUTPUT DATA IS A SAMPLED SYSTEM,
*  ALIASING CAN TAKE PLACE. IF THE WAVEFORM YOU ARE
*  LOOKING AT IS REPETATIVE BUT SEEMS TO HAVE INADEQUATE
*  P-P AMPLITUDE, YOU MAY WANT TO SAMPLE THE DATA MORE
*  OFTEN OR CHANGE THE RATIONALITY BETWEEN THE PWM CLOCK
*  PERIOD AND YOUR SAMPLING PERIOD.
*
*  IF YOUR SIMULATION CANNOT GET PAST INITIAL CONVERGANCE
*  FOR THE TRANSIENT ANALYSIS, RAMP VCC AND VS UP FROM
*  ZERO VOLTS TO NORMAL IN THE FIRST 10 MICROSECONDS OR SO.
*  THIS WILL NOT ONLY HELP THE TRAN ANALYSIS GET STARTED
*  BUT WILL ALLOW YOU TO SEE THE INITIAL VOLTAGES AND
*  CURRENTS FOR LATER SETTING OF NODESETS. LOOK FOR
*  OUTPUT FILTER INDUCTOR CURRENTS AND CAPACITOR VOLTAGES
*  TO ALLOW SETTING UP INITIAL CONDITIONS ON THOSE PARTS.
*  SETTING INITIAL CONDITIONS CAN ALLOW YOUR OUTPUT FILTER
*  TO GET TO OPERATING CONDITIONS MORE QUICKLY. DON'T
*  FORGET TO USE THE UIC OPTION IN THE TRAN LINE TO FORCE
*  USE OF INITIAL CONDITIONS.
*
*  BECAUSE THIS MODEL MUST BE CAPABLE OF RUNNING AT ANY
*  CLOCK RATE UP TO THE SPECIFICATION, THE MODEL MEASURES
*  THE CLOCK FREQUENCY AND FILTERS THE ANALOG RESULT AND
*  USES IT AS PART OF THE MODELING THAT CREATES THE
*  FREQUENCY DEPENDENT PART OF IQ(VSS). THE FILTER HAS A
*  TIME CONSTANT OF 300 USEC. DURING SHUTDOWN THE IQ(VSS)
*  IS SET TO A LOWER VALUE VIA THIS TIME CONSTANT AND
*  IQ(VCC) IS SET TO A LOWER VALUE WITH NO TIME CONSTANT.
*
*BEGIN MODEL SA06 FOR PSPICE
*PINOUT ORDER CKIN CKOUT +PWM -PWM GND ILIM ISENB BOUT +VS VCC AOUT ISENA
*PINOUT ORDER   1    2     3    4   5    6    7    8    9  10   11   12
.SUBCKT SA06_AM 1 2 3 4 5 6 7 8 9 10 11 12
V7 44 5 0 PULSE 0 5 0 10N 10N 22.22U 44.44U
RE2 41 5 1E9
E1 14 5 23 4 1
D5 12 11 D1M 
R13 27 5 10
R42 5 14 1E9
R39 67 63 10E3
C17 63 5 28E-12
R46 27 13 10E3
C18 13 5 28E-12
R1 40 11 R1M 0.59
R2 19 8 R1M 0.59
R3 64 12 R1M 0.59
R4 39 7 R1M 0.59
D4 13 27 D2M 
D8 63 67 D2M 
R14 32 23 1E3
R37 23 27 143E9
E4 32 5 66 5 1
E3 5 31 41 27 -1
R43 44 2 100
C22 2 5 10E-12
V2 41 5 4.5
D1 11 9 D1M 
E9 16 5 65 25 1000
D6 7 8 D1M
D7 8 9 D1M
V9 28 5 0.1
C4 9 34 120E-12
C5 9 37 120E-12
C6 11 35 120E-12
C7 8 33 120E-12
R10 34 11 1.4
R12 35 12 1.4
R18 37 8 1.4
R20 33 7 1.4
S5 61 27 14 5 S5M  
C19 15 5 1000E-12
C20 29 5 2000E-12
R15 26 29 10
E13 43 5 42 38 1
R16 43 30 300
C21 30 5 1E-6
R17 3 15 50
R45 30 5 1E9
C10 65 5 1000E-12
R21 65 6 1E3
D2 46 47 DN
D3 48 46 DN
R22 46 16 1E3
V10 48 5 0.8
V11 47 0 4.1
R23 28 25 1E3
R24 57 25 1E6
R25 57 50 1E3
R26 59 50 1E3
R27 52 25 100E3
R19 60 5 1
C8 57 52 5E-12
V13 56 5 5
V8 22 5 2.5
Q1 57 53 5 QFN 
Q2 57 54 5 QFN 
Q3 59 55 5 QFN 
Q4 59 51 5 QFN 
R28 53 46 50E3
R29 54 59 50E3
R30 55 49 50E3
R31 51 57 50E3
C9 53 5 1E-12
C11 51 5 1E-12
C12 55 5 1E-12
C13 54 5 1E-12
R33 58 4 55E3
C15 4 5 470E-12
M1 49 62 5 5 M1M 
M2 49 62 50 50 M2M 
R34 62 1 50
C16 62 5 5E-12
E10 58 5 49 0 2
V12 50 5 5
R35 61 5 1E9
S7 26 42 22 13 S7M  
S8 26 60 13 22 S7M  
R36 66 5 10E6
R38 38 42 1
V4 38 5 10
G1 5 10 30 5 0.36
R40 10 69 500
S10 69 5 57 5 S1M
I2 10 5 0.05
GQ1 5 9 VALUE = {(-0.09)*((0.55+(V(9)/625))*(0.1+V(30)*(-2000)))}
R49 65 5 10E6
R51 15 66 50
R52 67 5 10
S1 9 40 13 5 S1M  
S2 9 19 63 5 S1M  
S3 11 64 63 5 S1M  
S4 8 39 13 5 S1M  
S6 67 31 57 5 S6M  
S9 56 61 57 5 S1M  
.MODEL R1M RES (TC1=7.374E-3 TC2=2.598E-5)
.MODEL QFN NPN (BF=100 NE=1.5 EG=1.11
+ IS=1.5E-15 NC=1.7 FC=0.5 CJC=1E-12)
.MODEL M1M NMOS CBD=17E-12 CBS=17E-12 CGBO=26E-9
+ CGDO=18E-9 CGSO=20E-9 IS=31E-15 KP=4.3E-3 RD=50
+ RS=50 VTO=2.25
.MODEL M2M PMOS CBD=17E-12 CBS=17E-12 CGBO=26E-9
+ CGDO=18E-9 CGSO=20E-9 IS=31E-15 KP=4.3E-3 RD=50
+ RS=50 VTO=-2.25
.MODEL S1M  VSWITCH RON=0.01 ROFF=1E6 VON=2.55 VOFF=2.0
.MODEL S5M  VSWITCH RON=1 ROFF=1E3 VON=0.001 VOFF=0
.MODEL S6M  VSWITCH RON=0.1 ROFF=1E4 VON=2.51 VOFF=0
.MODEL S7M  VSWITCH RON=1 ROFF=1E5 VON=0.1 VOFF=0
.MODEL D1M D (IS=4.118E-12 M=0.333 N=1.00 RS=0.0608 VJ=0.75)
.MODEL D2M D (IS=1.68E-08 M=0.333 N=1.89 RS=0.452 VJ=0.75)
.MODEL DN D (BV=100 CJO=4E-12 IS=7E-9 M=0.45 N=2 RS=0.8 TT=6E-9 VJ=0.6)
.ENDS
*END OF MODEL SA06
*************
*     SA06TOOL STATE AVERAGE PWM MODEL FEATURES INCLUDE:
* 1 AVERAGE VALUE, TIME AND FREQUENCY DOMAIN PERFORMANCE
* 2 OUTPUT RESISTANCE FOR 100 DEGREE C JUNCTIONS
* 3 CURRENT SENSE PIN OUTPUTS
* 4 VS LOADING DUE TO OUTPUT CURRENT ONLY
* 5 SYMBOL COMPATABILITY WITH THE PULSE BY PULSE MODEL
* 6 PIN NUMBERS CORRESPOND TO THE HARDWARE
* 7 A FLAG OUTPUT SHOWS INPUT VOLTAGE OUTSIDE THE MODULATION RANGE
*
* WITH NO SWITCHING, THIS MODEL RUNS MANY TIMES FASTER THAN THE PULSE
* BY PULSE MODEL AND IT CAN RUN AN AC SWEEP, MAKING SIMULATION OF
* FEEDBACK LOOPS QUICK (RAISE OR ELIMINATE STEP CEILING).  
*
* BEWARE: LACK OF SWITCHING ELIMINATES SOME DISTORTION ELEMENTS FOUND
* IN THE PULSE BY PULSE MODEL AND THE HARDWARE. ALSO, LACK OF DEAD
* TIME ALLOWS LINEAR OPERATION ALL THE WAY TO 0 OR 100% MODULATION, 
* WHICH IS NOT POSSIBLE WITH THE HARDWARE.
* 
* THE ILIM/SHDN FUNCTION IS NOT MODELED.
*
*BEGIN MODEL SA06TOOL FOR PSPICE.
*PINS CLKIN CLKOUT +PWM -PWM GND ILIM/SDN ISENB BOUT VS VCC AOUT ISENA
*PINS   1      2     3    4   5      6      7     8   9  10  11    12
.SUBCKT SA06TOOL_AM 1 2 3 4 5 6 7 8 9 10 11 12
* R110 & C110 DUPLICATE HARDWARE
R110 3 127 50
C110 127 0 .01U
* SET UP HIGH, LOW AND P-P RAMP VALUES
E124 124 0 123 125 1 
V123 123 0 7 
V125 125 0 3 
* S123 & S125 LIMIT MODULATOR DRIVE TO 0/100%
S123 129 123 127 123 SM1 
S125 125 129 125 127 SM1 
R129 127 129 10K 
.MODEL SM1 VSWITCH (RON=1 ROFF=100MEG VON=.001 VOFF=-.001)
* E119 SHOWS ONLY INTEGRATOR VOLTAGE OUTSIDE MODULATION RANGE
E119 128 0 129 127 -1 
R128 128 6 10 
R6 3 0 1meg 
* 130 SERIES PARTS ARE THE NON-INVERTING OUT, 140 ARE INVERTING
* E130 & E140 GIVE MODULATION VOLTAGES; 0=0 OUT, VP-P=VS OUT
E130 130 0 129 125 1 
E140 140 0 123 129 1 
* E131 & E141 GENERATE OUTPUTS; V(MODULATE)*PWM GAIN [VS/VP-P]
E141 141 0 VALUE={V(140)*V(9)/V(124)} 
E131 131 0 VALUE={V(130)*V(9)/V(124)} 
* R132 & 142 SET ZOUT (ABOUT 100DEGREES C) AND MEASURE IOUT
R132 131 11 .735 
R142 141 8 .735 
* E132 & E142 SENSE OUTPUT CURRENT & MULTIPLY BY FRACTION OF MODULATION
* FRACTION IS 0 @ VOUT=0 AND 1 @ VOUT=VS
E132 135 0 VALUE={(V(131)-V(11))*V(130)/V(124)} 
E142 145 0 VALUE={(V(141)-V(8))*V(140)/V(124)}
* G135 & G145 REFLECT OUTPUT CURRENT INTO VSENSE PINS
G135 208 0 135 0 -1.361
G145 212 0 145 0 -1.361
V135 208 7 0 
V145 212 12 0 
* F135 & F145 REFLECT CURRENT INTO VS PIN
F135 9 0 V135 1 
F145 9 0 V145 1 
* 
R1 1 0 1meg 
R2 2 0 1meg 
R4 4 0 1meg 
R5 5 0 1meg 
* CATCH DIODES-FILTER/LOAD PHASE SHIFT CAN MAKE CURRENT FLOW BACKWARDS
D130 11 9 D1M 
D131 0 11 D1M 
D140 8 9 D1M 
D141 0 8 D1M 
.MODEL D1M D (IS=2.832E-12 M=0.333 N=1.00 RS=0.043 VJ=0.75)
*
D120 127 10 D1N4148 
D121 0 127 D1N4148
.MODEL D1N4148  D(IS=0.1P RS=16 CJO=2P TT=12N BV=100 IBV=0.1P)  
.ENDS
*END OF MODEL SA06TOOL
************
*       SA07 PWM MODEL FEATURES INCLUDE:
*
*   1 PULSE BY PULSE TIME DOMAIN PERFORMANCE
*   2 OUTPUT RESISTANCE AND CAPACITANCE
*   3 ACCURATE CATCH DIODE I V CHARACTERISTIC
*   4 ACCURATE RON TEMPERATURE COEFFICIENT
*   5 INCREASING IQ ON THE VS SUPPLY VS FREQUENCY
*   6 DEADTIME BETWEEN SWITCH ON TIMES
*   7 INTERNAL ERROR AMPLIFIER WITH ACCURATE
*     BODE PLOT, SLEW, CMRR, INPUT AND OUTPUT
*     IMPEDANCES, INPUT BIAS AND OFFSET CURRENTS,
*     AND NON-SYMETRICAL OUTPUT CURRENT LIMIT
*   8 REFERENCE OUTPUT
*   9 REALISTIC REFERENCE OUTPUT IMPEDANCE
*  10 REFERENCE OUTPUT CURRENT LIMIT
*  11 ILIM / SHUTDOWN FUNCTIONS
*
*     NOTE: THERMAL SHUTDOWN IS NOT MODELED
*     NOTE: HIGH SIDE CURRENT LIMIT IS NOT MODELED
*
*       SOME NOTES ON USING SPICE FOR PWM SIMULATION
*
*  REQUIRES BERKELEY SPICE 3E.3P OR LATER. YOUR SIMULATOR
*  MUST SUPPORT THE BERKELEY STANDARD VOLTAGE CONTROLLED
*  SWITCH ELEMENT (S)
*  OR
*  REQUIRES PSPICE 4.04 OR LATER
*
*  BE PREPARED FOR LONG SIMULATIONS
*
*  NOTE: BERKELEY SIMULATORS TYPICALLY RUN THESE
*  PWM MODELS ABOUT TWO TO FOUR TIMES FASTER THAN
*  PSPICE TYPE SIMULATORS AS THE BERKELEY SWITCH
*  ELEMENT DOES NOT INVOKE AS BIG A COMPUTATIONAL
*  BURDEN
*
*  IF YOUR SIMULATION STOPS DUE TO "TIMESTEP TOO SMALL"
*  ERRORS YOU MAY WANT TO INCREASE ITL4 TO 100, INCREASE
*  RELTOL TO 0.003 TO 0.01, INCREASE ABSTOL TO 1E-11 TO
*  1E-9, INCREASE GMIN TO 1E-11 TO 1E-7, INCREASE VNTOL
*  TO 1E-5 TO 1E-4, OR INCREASE CHGTOL TO 1E-11 TO 1E-9.
*  ANY OR ALL OF THESE SIMULATOR OPTIONS MAY BE REQUIRED
*  DEPENDING ON YOUR SIMULATOR. NEWER SIMULATORS USUALLY
*  REQUIRE FEWER OF THEM.
*
*  TO AID THE INITIAL DC CONVERGANCE SET ITL1 TO 500.
*
*  A GOOD WAY TO TEST SIMULATION ACCURACY IS TO FIX THE
*  PWM SIGNAL INPUT TO A FIXED VOLTAGE THAT IS EQUIVALENT
*  TO HALFWAY BETWEEN 50-50 DUTY FACTOR AND 100 PERCENT
*  DUTY FACTOR. RUN A SIMULATION THAT HAS TIME FOR OUTPUT
*  FILTER SETTLING. IF THE OUTPUT VOLTAGE WANDERS AROUND
*  RATHER THAN STAYS SETTLED TO LESS THAN ONE PERCENT YOU
*  SHOULD REDUCE THE TIMESTEP MAX (TMAX) PARAMETER IN THE
*  TRAN LINE. THIS IS THE FOURTH TIME PARAMETER ON THAT
*  LINE AND IS OPTIONAL LIKE THE TSTART PARAMETER (THIRD
*  TIME PARAMETER ON THAT LINE). IF YOU ARE NOT USING
*  TSTART YOU MUST SET IT TO ZERO SO THE SIMULATOR WILL
*  RECOGNIZE TMAX AS TMAX RATHER THAN TSTART. FOR BERKELEY
*  SPICE 3 TMAX WILL USUALLY BE IN THE 500 TO 150 NS RANGE.
*  FOR PSPICE TMAX WILL USUALLY BE IN THE 250 TO 50 NS
*  RANGE.
*
*  BECAUSE THE SPICE OUTPUT DATA IS A SAMPLED SYSTEM,
*  ALIASING CAN TAKE PLACE. IF THE WAVEFORM YOU ARE
*  LOOKING AT IS REPETATIVE BUT SEEMS TO HAVE INADEQUATE
*  P-P AMPLITUDE, YOU MAY WANT TO SAMPLE THE DATA MORE
*  OFTEN OR CHANGE THE RATIONALITY BETWEEN THE PWM CLOCK
*  PERIOD AND YOUR SAMPLING PERIOD.
*
*  IF YOUR SIMULATION CANNOT GET PAST INITIAL CONVERGANCE
*  FOR THE TRANSIENT ANALYSIS, RAMP VCC AND VS UP FROM
*  ZERO VOLTS TO NORMAL IN THE FIRST 10 MICROSECONDS OR SO.
*  THIS WILL NOT ONLY HELP THE TRAN ANALYSIS GET STARTED
*  BUT WILL ALLOW YOU TO SEE THE INITIAL VOLTAGES AND
*  CURRENTS FOR LATER SETTING OF NODESETS. LOOK FOR
*  OUTPUT FILTER INDUCTOR CURRENTS AND CAPACITOR VOLTAGES
*  TO ALLOW SETTING UP INITIAL CONDITIONS ON THOSE PARTS.
*  SETTING INITIAL CONDITIONS CAN ALLOW YOUR OUTPUT FILTER
*  TO GET TO OPERATING CONDITIONS MORE QUICKLY. DON'T
*  FORGET TO USE THE UIC OPTION IN THE TRAN LINE TO FORCE
*  USE OF INITIAL CONDITIONS.
*
*BEGIN MODEL SA07 FOR PSPICE
*PINS 5V -INT +INT INTO +PWM -PWM GND VCC ISA AO VS BO ISB ILIM CIN CO
*PINS  1   2    3    4    5    6   7   10  11 12 13 14  15  16   17 18
.SUBCKT SA07_AM 1 2 3 4 5 6 7 10 11 12 13 14 15 16 17 18
V7 21 7 5 PULSE 5 0 0 10N 10N 1U 2U
RX1 55 0 1E9
RX2 75 0 1E9
RX3 102 0 1E9
RX4 2 0 1E9
RX5 3 0 1E9
RX6 4 0 1E9
RX7 5 0 1E9
RX8 6 0 1E9
RX9 17 0 1E9
V13 48 7 5
D1 12 13 D1M
D5 11 12 D1M
D6 15 14 D1M
D7 14 13 D1M
E9 27 7 28 29 1000
V9 30 7 0.1
C10 28 7 1E-9
R21 28 16 1E3
D2 32 33 D1N
D3 34 32 D1N
CI1 2 7 3E-12
CI2 3 7 3E-12
R22 32 27 1E3
V10 34 7 0.8
V11 33 0 4.1
R23 30 29 1E3
R24 35 29 1E6
R25 35 36 1E3
R26 37 36 1E3
R27 38 29 100E3
C8 35 38 5E-12
R1 100 12 R1M 0.29
R2 95 14 R1M 0.29
R3 66 11 R1M 0.29
R4 57 15 R1M 0.29
C4 13 23 75E-12
C5 13 24 75E-12
C6 12 25 75E-12
C7 14 22 75E-12
R10 23 12 2.8
R12 25 11 2.8
R18 24 14 2.8
R20 22 15 2.8
Q1 35 39 7 Q1M
Q2 35 40 7 Q1M
Q3 37 41 7 Q1M
Q4 37 42 7 Q1M
R28 39 32 50E3
R29 40 37 50E3
R30 41 43 50E3
R31 42 35 50E3
C9 39 7 1E-12
C11 42 7 1E-12
C12 41 7 1E-12
C13 40 7 1E-12
R33 45 6 8.9E3
C15 6 7 100E-12
M1 43 47 7 7 M1M
M2 43 47 36 36 M2M
R34 47 17 1600
C16 47 7 5E-12
E10 45 7 43 7 1
V12 36 7 5
R35 26 7 1E9
E1 49 7 50 6 10
R13 51 7 10
R42 7 49 1E9
R39 52 46 10E3
C17 46 7 6.2E-12
R46 51 71 10E3
C18 71 7 6.2E-12
D4 71 51 D4M
D8 46 52 D4M
R14 53 50 1E3
R37 50 51 143E9
E3 7 54 55 51 -1
V2 55 7 4.5
S5 26 51 49 7 S5M
C19 56 7 0.01E-6
E4 53 7 56 7 1
C20 60 7 500E-12
R15 59 60 10
E13 62 7 61 63 1
R16 62 64 300
C21 64 7 0.1E-6
R45 64 7 1E9
R19 65 7 1
V8 58 7 2.5
S7 59 61 58 71 S7M
S8 59 65 71 58 S7M
R38 63 61 1
V4 63 7 10
G1 7 10 64 7 10.5
I2 10 7 0.01
R43 21 18 100
C22 18 7 10E-12
GQ1 7 13 VALUE={(-0.09)*((0.02+(v(13)/40.8))*(0.02+v(64)*(-339)))}
R49 28 7 10E6
R17 5 56 100
R52 52 7 10
R53 10 69 1200
S10 7 69 35 7 S10M
V20 70 2 0.7E-3
R59 72 73 35E6
G3 7 74 73 75 6E-5
R60 74 7 600E6
E2 76 7 77 7 1.0
R61 74 77 34E3
C26 77 7 1E-12
G5 7 78 77 7 0.001
R62 78 7 1000
C27 78 7 9.7E-12
G7 7 79 78 7 0.001
R63 79 7 1000
C28 79 7 4E-12
R65 73 81 1E9
R66 72 81 1E9
G8 7 82 81 7 1E-3
R67 82 83 1
L3 83 7 3E-5
E5 72 75 82 7 1
E12 107 7 1 7 1
V22 84 85 0.62
V17 107 80 0
V23 77 87 0.62
R68 83 7 50
I3 80 88 250E-6
I4 89 7 250E-6
R69 4 90 40
Q5 80 79 89 QON
Q6 80 88 90 QON
Q7 7 79 88 QOP
Q8 7 89 90 QOP
E7 86 7 91 7 -1
E8 85 77 91 7 -1
F1 10 7 V17 1
I5 7 91 2.7E-5
Q9 92 93 94 QI1
I7 93 94 2E-5
Q10 72 3 96 Q6M
Q11 73 70 97 Q6M
R72 92 96 135
R73 92 97 135
R74 72 7 200
R75 73 7 200
V26 98 94 2
E11 80 98 91 7 -1
I19 94 70 10E-9
I6 10 99 60E-6
Q24 10 99 1 QON
Q26 7 101 99 QOP
V15 102 7 5
R40 1 7 16E3
V16 103 7 0.8
R54 104 101 1E3
C23 1 105 0.01E-6
G2 7 104 102 1 0.01
R56 7 104 400E3
C24 106 104 10E-12
R57 7 106 10E3
R58 105 7 1
S1 52 54 35 7 S1M
S2 48 26 35 7 S2M
S3 13 100 71 7 S3M
S4 12 66 46 7 S3M
S6 13 95 46 7 S3M
S9 14 57 71 7 S3M
D15 84 80 D15M
D17 86 87 D15M
D18 91 7 D15M
D19 76 74 D15M
D20 74 76 D15M
D21 101 10 D15M
D22 103 101 D15M
.MODEL R1M RES (TC1=7.374E-3 TC2=2.598E-5)
.MODEL S1M VSWITCH RON=0.1 ROFF=1E3 VON=2.75 VOFF=2.5
.MODEL S2M VSWITCH RON=0.1 ROFF=1E6 VON=2.75 VOFF=2.5
.MODEL S3M VSWITCH RON=0.01 ROFF=1E6 VON=2.5 VOFF=2
.MODEL S5M VSWITCH RON=1 ROFF=1E3 VON=0.001 VOFF=0
.MODEL S7M VSWITCH RON=1 ROFF=100E3 VON=0.15 VOFF=0.05
.MODEL S10M VSWITCH RON=0.01 ROFF=1E6 VON=2.5 VOFF=2
.MODEL QI1 PNP
.MODEL QOP PNP
.MODEL QON NPN
.MODEL Q1M NPN (CJC=1E-12)
.MODEL Q6M PNP (BF=12000)
.MODEL M1M NMOS (CBD=17E-12 CBS=17E-12 CGBO=26E-9
+ CGDO=18E-9 CGSO=20E-9 IS=31E-15 KP=4.3E-3 RD=50 RS=50 VTO=2.25)
.MODEL M2M PMOS (CBD=17E-12 CBS=17E-12 CGBO=26E-9
+ CGDO=18E-9 CGSO=20E-9 IS=31E-15 KP=4.3E-3 RD=50 RS=50 VTO=-2.25)
.MODEL D4M D (CJO=2E-12 IS=1E-15 M=0.33 RS=0.5 TT=10E-9)
.MODEL D1N D (IS=1E-15)
.MODEL D15M D (IS=1E-15)
.MODEL D1M D (CJO=5E-12 IS=6.792E-13 M=0.33 N=1 RS=0.3226 VJ=0.75)
.ENDS
*END OF MODEL SA07
*************
*     SA07TOOL STATE AVERAGE PWM MODEL FEATURES INCLUDE:
* 1 AVERAGE VALUE, TIME AND FREQUENCY DOMAIN PERFORMANCE
* 2 OUTPUT RESISTANCE FOR 100 DEGREE C JUNCTIONS
* 3 CURRENT SENSE PIN OUTPUTS
* 4 VS LOADING DUE TO OUTPUT CURRENT ONLY
* 5 SYMBOL COMPATABILITY WITH THE PULSE BY PULSE MODEL
* 6 PIN NUMBERS CORRESPOND TO THE HARDWARE
* 7 A FLAG OUTPUT SHOWS INPUT VOLTAGE OUTSIDE THE MODULATION RANGE
*
* WITH NO SWITCHING, THIS MODEL RUNS MANY TIMES FASTER THAN THE PULSE
* BY PULSE MODEL AND IT CAN RUN AN AC SWEEP, MAKING SIMULATION OF
* FEEDBACK LOOPS QUICK (RAISE OR ELIMINATE STEP CEILING).  
*
* BEWARE: LACK OF SWITCHING ELIMINATES SOME DISTORTION ELEMENTS FOUND
* IN THE PULSE BY PULSE MODEL AND THE HARDWARE. ALSO, LACK OF DEAD
* TIME ALLOWS LINEAR OPERATION ALL THE WAY TO 0 OR 100% MODULATION, 
* WHICH IS NOT POSSIBLE WITH THE HARDWARE.
* 
* THE SHDN/FILTER FUNCTION IS NOT MODELED,PIN IS OVER MODULATION FLAG.
*
*BEGIN MODEL SA07TOOL FOR PSPICE.
*PINS 5V -INT +INT INTO +PWM -PWM GND VCC ISA AO VS BO ISB ILIM CIN CO
*PINS  1   2    3    4    5    6   7   10  11 12 13 14  15  16   17 18
.SUBCKT SA07TOOL_AM 1 2 3 4 5 6 7 10 11 12 13 14 15 16 17 18
* SET UP HIGH, LOW AND P-P RAMP VALUES
V123 123 0 3.75
V125 125 0 1.25
E124 124 0 123 125 1 
* S123 & S125 LIMIT MODULATOR DRIVE TO 0/100%
S123 129 123 108 123 SM1 
S125 125 129 125 108 SM1 
R129 108 129 10K 
*R108 & C108 ARE REAL PARTS IN SA07.
R108 5 108 100
C108 108 0 .01E-6
.MODEL SM1 VSWITCH (RON=1 ROFF=100MEG VON=.001 VOFF=-.001)
* E119 SHOWS ONLY INTEGRATOR VOLTAGE OUTSIDE MODULATION RANGE
E119 128 0 129 108 -1 
R128 128 16 10 
R116 16 0 1MEG 
* 130 SERIES PARTS ARE THE NON-INVERTING OUT, 140 ARE INVERTING
* E130 & E140 GIVE MODULATION VOLTAGES; 0=0 OUT, VP-P=VS OUT
E130 130 0 129 125 1 
E140 140 0 123 129 1 
* E131 & E141 GENERATE OUTPUTS; V(MODULATE)*PWM GAIN [VS/VP-P]
E131 131 0 VALUE={V(130)*V(13)/V(124)} 
E141 141 0 VALUE={V(140)*V(13)/V(124)} 
* R132 & 142 SET ZOUT (ABOUT 100DEGREES C) AND MEASURE IOUT
R132 131 12 .386 
R142 141 14 .386 
* E132 & E142 SENSE OUTPUT CURRENT & MULTIPLY BY FRACTION OF MODULATION
* FRACTION IS 0 @ VOUT=0 AND 1 @ VOUT=VS
E132 135 0 VALUE={(V(131)-V(12))*V(130)/V(124)} 
E142 145 0 VALUE={(V(141)-V(14))*V(140)/V(124)} 
* G135 & G145 REFLECT OUTPUT CURRENT INTO VSENSE PINS
G135 215 0 135 0 -2.591
G145 211 0 145 0 -2.591
V135 215 15 0 
V145 211 11 0 
* F135 & F145 REFLECT CURRENT INTO VS PIN
F135 13 0 V135 1 
F145 13 0 V145 1 
*
VREF 1 0 5 
R101 1 0 1MEG 
*
* CATCH DIODES-FILTER/LOAD PHASE SHIFT CAN MAKE CURRENT FLOW BACKWARDS
D130 12 13 D1M 
D131 0 12 D1M 
D140 14 13 D1M 
D141 0 14 D1M 
.MODEL D1M D (CJO=5E-12 IS=6.792E-13 M=0.33 N=1 RS=0.3226 VJ=0.75)
*
D120 2 1 D1N4148 
D122 0 2 D1N4148 
D121 1 3 D1N4148 
D123 0 3 D1N4148 
.MODEL D1N4148  D(IS=0.1P RS=16 CJO=2P TT=12N BV=100 IBV=0.1P)  
*
R106 6 0 1MEG
R107 7 0 1MEG 
R110 10 0 1MEG 
R117 17 0 1MEG 
R118 18 0 1MEG 
*
* SA07 ERROR AMP
* PINOUT +IN -IN +V -V OUT
* PINOUT  3   2   1  0  4
*.SUBCKT EA07 3 2 1 0 4
E5 51 0 55 0 -1
E6 61 62 55 0 -1
D1 55 0 DE1
I3 0 55 2.7E-5
Q5 56 57 58 QI1
I4 57 58 2E-5
Q6 52 2 53 Q6M
Q7 50 28 54 Q6M
R7 56 53 135
R8 56 54 135
R9 52 0 200
R10 50 0 200
V13 28 3 0.7E-3
R6 52 50 35E6
G1 0 22 50 60 -6E-5
R12 22 0 600E6
E2 21 0 62 0 1.0
R13 22 62 34E3
C11 62 0 1E-12
G5 0 23 62 0 0.001
R19 23 0 1E3
C12 23 0 9.7E-12
V12 59 58 2
G7 0 24 23 0 0.001
R20 24 0 1000
C13 24 0 4E-12
R22 50 19 1E9
R23 52 19 1E9
G8 0 20 19 0 1E-3
R24 20 27 1
L3 27 0 3E-5
E4 52 60 20 0 1
D9 25 1 DE1
V15 25 61 0.62
D10 51 26 DE1
V16 62 26 0.62
D14 21 22 DE1
D16 22 21 DE1
R25 27 0 50
I1 1 31 250E-6
I2 30 0 250E-6
R26 4 29 40
Q1 1 24 30 QON
Q2 1 31 29 QON
Q3 0 24 31 QOP
Q4 0 30 29 QOP
E9 1 59 55 0 -1
I19 58 28 10E-9
.MODEL QON NPN
.MODEL QOP PNP
.MODEL QI1 PNP
.MODEL Q6M PNP (BF=12E3)
.MODEL DE1 D (IS=1E-15)
.ENDS
*END OF SA07 ERROR AMP
*END OF MODEL SA07TOOL
**********
*       SA08 PWM MODEL FEATURES INCLUDE:
*
*   1 PULSE BY PULSE TIME DOMAIN PERFORMANCE
*   2 OUTPUT RESISTANCE AND CAPACITANCE
*   3 ACCURATE CATCH DIODE I V CHARACTERISTIC
*   4 ACCURATE RON AND VON
*   5 INCREASING IQ ON THE VS SUPPLY VS FREQUENCY
*   6 DEADTIME BETWEEN SWITCH ON TIMES
*   7 ACCURATE IQ ON THE VCC LINE
*   8 REDUCTION IN IQ VCC IN SHUTDOWN
*   9 INTERNAL CMOS BUFFER ON THE CLK IN PIN
*  10 ILIM / SHUTDOWN FUNCTIONS
*
*     NOTE: THIS MODEL DOES NOT SUPPORT THE FLAG PIN
*     NOTE: THERMAL SHUTDOWN IS NOT MODELED
*     NOTE: HIGH SIDE CURRENT LIMIT IS NOT MODELED
*
*****   SOME NOTES ON USING SPICE FOR PWM SIMULATION  *****
*
*
*  REQUIRES BERKELEY SPICE 3E.3P OR LATER. YOUR SIMULATOR
*  MUST SUPPORT THE BERKELEY STANDARD VOLTAGE CONTROLLED
*  SWITCH ELEMENT (S)
*  OR
*  REQUIRES PSPICE 4.04 OR LATER
*
*  BE PREPARED FOR LONG SIMULATIONS
*
*  NOTE: BERKELEY SIMULATORS TYPICALLY RUN THESE
*  PWM MODELS ABOUT TWO TO FOUR TIMES FASTER THAN
*  PSPICE TYPE SIMULATORS AS THE BERKELEY SWITCH
*  ELEMENT DOES NOT INVOKE AS BIG A COMPUTATIONAL
*  BURDEN
*
*  IF YOUR SIMULATION STOPS DUE TO "TIMESTEP TOO SMALL"
*  ERRORS YOU MAY WANT TO INCREASE ITL4 TO 100, INCREASE
*  RELTOL TO 0.003 TO 0.01, INCREASE ABSTOL TO 1E-11 TO
*  1E-9, INCREASE GMIN TO 1E-11 TO 1E-7, INCREASE VNTOL
*  TO 1E-5 TO 1E-4, OR INCREASE CHGTOL TO 1E-11 TO 1E-9.
*  ANY OR ALL OF THESE SIMULATOR OPTIONS MAY BE REQUIRED
*  DEPENDING ON YOUR SIMULATOR. NEWER SIMULATORS USUALLY
*  REQUIRE FEWER OF THEM.
*
*  TO AID THE INITIAL TRANSIENT CONVERGANCE, SET UP THE
*  INITIAL VALUE OF CLOCK IN AS FOLLOWS:
*        IF PWM IN > 5V, CLOCK IN INITIAL = 5 VOLTS
*        IF PWM IN < 5V, CLOCK IN INITIAL = 0 VOLTS
*
*  TO AID THE INITIAL DC CONVERGANCE SET ITL1 TO 500.
*
*  THE CLOCK IS A GENERATOR STATEMENT INSIDE THE MODEL.
*  WHERE THE REAL PART HAS AN OSCILLATOR FOLLOWED BY A
*  DIGITAL DIVIDE BY TWO, THE MODEL HAS THE GENERATOR
*  AT HALF OF THE CLOCK FREQUENCY. IF YOU NEED TO SYNCH-
*  RONIZE THE PWM CLOCK TO AN EXTERNAL SOURCE, LOOK IN
*  YOUR SIMULATOR LIBRARY FOR A SIMPLE FAST RUNNING
*  BEHAVIORAL FREQUENCY DIVIDER OR DFLOP. BECAUSE THE
*  EXTENTIONS THAT ALLOW BEHAVIORAL MODELS VARY WIDELY
*  AMONG VENDORS NONE ARE INCLUDED HERE. AT THE BOTTOM
*  OF THIS LIBRARY FILE YOU WILL FIND A COMPONENT LEVEL
*  FREQUENCY DIVIDER SUBCIRCUIT (FDIV) WILL WORK WITH
*  ALL SIMULATORS. IT WORKS AT FIVE VOLTS (PROVIDE 5V
*  AND GROUND ON THE SUPPLIES OF FDIV) AND CAN PROVIDE
*  FREQUENCY DIVISION BY 2 TO GO BETWEEN YOUR EXTERNAL
*  SYNCH SIGNAL AND THE CLOCK INPUT OF THE PWM MODEL.
*  BECAUSE FDIV IS COMPONENT LEVEL IT IS SLOW AND WILL
*  EXTEND THE EXECUTION TIME BY AS MUCH AS 2 TO 1.
*
*  A GOOD WAY TO TEST SIMULATION ACCURACY IS TO FIX THE
*  PWM SIGNAL INPUT TO A FIXED VOLTAGE THAT IS EQUIVALENT
*  TO HALFWAY BETWEEN 50-50 DUTY FACTOR AND 100 PERCENT
*  DUTY FACTOR. RUN A SIMULATION THAT HAS TIME FOR OUTPUT
*  FILTER SETTLING. IF THE OUTPUT VOLTAGE WANDERS AROUND
*  RATHER THAN STAYS SETTLED TO LESS THAN ONE PERCENT YOU
*  SHOULD REDUCE THE TIMESTEP MAX (TMAX) PARAMETER IN THE
*  TRAN LINE. THIS IS THE FOURTH TIME PARAMETER ON THAT
*  LINE AND IS OPTIONAL LIKE THE TSTART PARAMETER (THIRD
*  TIME PARAMETER ON THAT LINE). IF YOU ARE NOT USING
*  TSTART YOU MUST SET IT TO ZERO SO THE SIMULATOR WILL
*  RECOGNIZE TMAX AS TMAX RATHER THAN TSTART. FOR BERKELEY
*  SPICE 3 TMAX WILL USUALLY BE IN THE 500 TO 150 NS RANGE.
*  FOR PSPICE TMAX WILL USUALLY BE IN THE 250 TO 50 NS
*  RANGE.
*
*  BECAUSE THE SPICE OUTPUT DATA IS A SAMPLED SYSTEM,
*  ALIASING CAN TAKE PLACE. IF THE WAVEFORM YOU ARE
*  LOOKING AT IS REPETATIVE BUT SEEMS TO HAVE INADEQUATE
*  P-P AMPLITUDE, YOU MAY WANT TO SAMPLE THE DATA MORE
*  OFTEN OR CHANGE THE RATIONALITY BETWEEN THE PWM CLOCK
*  PERIOD AND YOUR SAMPLING PERIOD.
*
*  IF YOUR SIMULATION CANNOT GET PAST INITIAL CONVERGANCE
*  FOR THE TRANSIENT ANALYSIS, RAMP VCC AND VS UP FROM
*  ZERO VOLTS TO NORMAL IN THE FIRST 10 MICROSECONDS OR SO.
*  THIS WILL NOT ONLY HELP THE TRAN ANALYSIS GET STARTED
*  BUT WILL ALLOW YOU TO SEE THE INITIAL VOLTAGES AND
*  CURRENTS FOR LATER SETTING OF NODESETS. LOOK FOR
*  OUTPUT FILTER INDUCTOR CURRENTS AND CAPACITOR VOLTAGES
*  TO ALLOW SETTING UP INITIAL CONDITIONS ON THOSE PARTS.
*  SETTING INITIAL CONDITIONS CAN ALLOW YOUR OUTPUT FILTER
*  TO GET TO OPERATING CONDITIONS MORE QUICKLY. DON'T
*  FORGET TO USE THE UIC OPTION IN THE TRAN LINE TO FORCE
*  USE OF INITIAL CONDITIONS.
*
*  BECAUSE THIS MODEL MUST BE CAPABLE OF RUNNING AT ANY
*  CLOCK RATE UP TO THE SPECIFICATION, THE MODEL MEASURES
*  THE CLOCK FREQUENCY AND FILTERS THE ANALOG RESULT AND
*  USES IT AS PART OF THE MODELING THAT CREATES THE
*  FREQUENCY DEPENDENT PART OF IQ(VSS). THE FILTER HAS A
*  TIME CONSTANT OF 300 USEC. DURING SHUTDOWN THE IQ(VSS)
*  IS SET TO A LOWER VALUE VIA THIS TIME CONSTANT AND
*  IQ(VCC) IS SET TO A LOWER VALUE WITH NO TIME CONSTANT.
*
*BEGIN MODEL SA08 FOR PSPICE
*PINOUT ORDER CKIN CKOUT PWM GND ILIM ISENB BOUT +VS VCC AOUT ISENA
*PINOUT         1    2    3   5    6    7     8   9   10  11    12
.SUBCKT SA08_AM 1 2 3 5 6 7 8 9 10 11 12
V7 44 5 0 PULSE 0 5 0 10N 10N 22.22U 44.44U
RE2 41 5 1E9
E1 14 5 23 15 1
D5 12 11 D1M
R13 27 5 10
R42 5 14 1E9
R39 67 63 10E3
C17 63 5 28E-12
R46 27 13 10E3
C18 13 5 28E-12
R1 40 11 0.085
R2 19 8 0.085
R3 64 12 0.085
R4 39 7 0.085
D4 13 27 D2M
D8 63 67 D2M
R14 32 23 1E3
R37 23 27 143E9
E4 32 5 68 5 1
E3 5 31 41 27 -1
R43 44 2 100
C22 2 5 10E-12
V2 41 5 4.5
D1 11 9 D1M
E9 16 5 65 25 1000
D6 7 8 D1M
D7 8 9 D1M
V9 28 5 0.1
C4 9 34 300E-12
C5 9 37 300E-12
C6 11 35 300E-12
C7 8 33 300E-12
R10 34 11 0.7
R12 35 12 0.7
R18 37 8 0.7
R20 33 7 0.7
S5 61 27 14 5 S5M
C19 66 5 1000E-12
C20 29 5 2000E-12
R15 26 29 10
E13 43 5 42 38 1
R16 43 30 300
C21 30 5 1E-6
R45 30 5 1E9
C10 65 5 1000E-12
R21 65 6 1E3
D2 46 47 DN
D3 48 46 DN
R22 46 16 1E3
V10 48 5 0.8
V11 47 0 4.1
R23 28 25 1E3
R24 57 25 1E6
R25 57 50 1E3
R26 59 50 1E3
R27 52 25 100E3
R19 60 5 1
C8 57 52 5E-12
V13 56 5 5
V8 22 5 2.5
Q1 57 53 5 QFN
Q2 57 54 5 QFN
Q3 59 55 5 QFN
Q4 59 51 5 QFN
R28 53 46 50E3
R29 54 59 50E3
R30 55 49 50E3
R31 51 57 50E3
C9 53 5 1E-12
C11 51 5 1E-12
C12 55 5 1E-12
C13 54 5 1E-12
R33 58 15 55E3
C15 15 5 470E-12
M1 49 62 5 5 M1M
M2 49 62 50 50 M2M
R34 62 1 50
C16 62 5 5E-12
E10 58 5 49 0 2
V12 50 5 5
R35 61 5 1E9
S7 26 42 22 13 S7M
S8 26 60 13 22 S7M
R36 68 5 10E6
R38 38 42 1
V4 38 5 10
G1 5 10 30 5 0.36
R40 10 69 500
S10 69 5 57 5 S1M
I2 10 5 0.05
GQ1 5 9 VALUE = {(-0.09)*((0.6+(V(9)/600))*(0.45+V(30)*(-1000)))}
R49 65 5 10E6
R51 66 68 50
R52 3 66 50
R53 67 5 10
VD1 9 71 0.85
VD2 9 72 0.85
VD3 11 73 0.85
VD4 8 74 0.85
S1 71 40 13 5 S1M
S2 72 19 63 5 S1M
S3 73 64 63 5 S1M
S4 74 39 13 5 S1M
S6 67 31 57 5 S6M
S9 56 61 57 5 S1M
.MODEL QFN NPN (BF=100 NE=1.5 EG=1.11
+ IS=1.5E-15 NC=1.7 FC=0.5 CJC=1E-12)
.MODEL M1M NMOS (CBD=17E-12 CBS=17E-12 CGBO=26E-9
+ CGDO=18E-9 CGSO=20E-9 IS=31E-15 KP=4.3E-3 RD=50
+ RS=50 VTO=2.25)
.MODEL M2M PMOS (CBD=17E-12 CBS=17E-12 CGBO=26E-9
+ CGDO=18E-9 CGSO=20E-9 IS=31E-15 KP=4.3E-3 RD=50
+ RS=50 VTO=-2.25)
.MODEL S1M VSWITCH RON=0.01 ROFF=1E6 VON=2.55 VOFF=2.0
.MODEL S5M VSWITCH RON=1 ROFF=1E3 VON=0.001 VOFF=0
.MODEL S6M VSWITCH RON=0.1 ROFF=1E4 VON=2.91 VOFF=2.5
.MODEL S7M VSWITCH RON=1 ROFF=1E5 VON=0.1 VOFF=0
.MODEL D1M D (IS=2.645E-15 M=0.333 N=1.00 RS=0.086 VJ=0.75)
.MODEL D2M D (IS=1.68E-08 M=0.333 N=1.89 RS=0.452 VJ=0.75)
.MODEL DN D (BV=100 CJO=4E-12 IS=7E-09 M=0.45 N=2 RS=0.8 TT=6E-9 VJ=0.6)
.ENDS
*END OF MODEL SA08
*************
*     SA08TOOL STATE AVERAGE PWM MODEL FEATURES INCLUDE:
* 1 AVERAGE VALUE, TIME AND FREQUENCY DOMAIN PERFORMANCE
* 2 OUTPUT RESISTANCE FOR 100 DEGREE C JUNCTIONS
* 3 CURRENT SENSE PIN OUTPUTS
* 4 VS LOADING DUE TO OUTPUT CURRENT ONLY
* 5 SYMBOL COMPATABILITY WITH THE PULSE BY PULSE MODEL
* 6 PIN NUMBERS CORRESPOND TO THE HARDWARE
* 7 A FLAG OUTPUT SHOWS INPUT VOLTAGE OUTSIDE THE MODULATION RANGE
*
* WITH NO SWITCHING, THIS MODEL RUNS MANY TIMES FASTER THAN THE PULSE
* BY PULSE MODEL AND IT CAN RUN AN AC SWEEP, MAKING SIMULATION OF
* FEEDBACK LOOPS QUICK (RAISE OR ELIMINATE STEP CEILING).  
*
* BEWARE: LACK OF SWITCHING ELIMINATES SOME DISTORTION ELEMENTS FOUND
* IN THE PULSE BY PULSE MODEL AND THE HARDWARE. ALSO, LACK OF DEAD
* TIME ALLOWS LINEAR OPERATION ALL THE WAY TO 0 OR 100% MODULATION, 
* WHICH IS NOT POSSIBLE WITH THE HARDWARE.
* 
* THE ILIM/SHDN FUNCTION IS NOT MODELED.
*
*BEGIN MODEL SA08TOOL FOR PSPICE.
*PINS CLKIN CLKOUT +PWM GND ILIM/SDN ISENB BOUT VS VCC AOUT ISENA
*PINS   1      2     3   5      6      7     8   9  10  11    12
.SUBCKT SA08TOOL_AM 1 2 3 5 6 7 8 9 10 11 12
* R110 & C110 DUPLICATE HARDWARE
R110 3 127 50
C110 127 0 .01U
* SET UP HIGH, LOW AND P-P RAMP VALUES
E124 124 0 123 125 1 
V123 123 0 7 
V125 125 0 3 
* S123 & S125 LIMIT MODULATOR DRIVE TO 0/100%
S123 129 123 127 123 SM1 
S125 125 129 125 127 SM1 
R129 127 129 10K 
.MODEL SM1 VSWITCH (RON=1 ROFF=100MEG VON=.001 VOFF=-.001)
* E119 SHOWS ONLY INTEGRATOR VOLTAGE OUTSIDE MODULATION RANGE
E119 128 0 129 127 -1 
R128 128 6 10 
R6 3 0 1meg 
* 130 SERIES PARTS ARE THE NON-INVERTING OUT, 140 ARE INVERTING
* E130 & E140 GIVE MODULATION VOLTAGES; 0=0 OUT, VP-P=VS OUT
E130 130 0 129 125 1 
E140 140 0 123 129 1 
* E131 & E141 GENERATE OUTPUTS; V(MODULATE)*PWM GAIN [VS/VP-P]
E141 141 0 VALUE={V(140)*V(9)/V(124)} 
E131 131 0 VALUE={V(130)*V(9)/V(124)} 
* R132 & 142 SET ZOUT (ABOUT 100DEGREES C) AND MEASURE IOUT
R132 131 11 .1375 
R142 141 8 .1375 
* E132 & E142 SENSE OUTPUT CURRENT & MULTIPLY BY FRACTION OF MODULATION
* FRACTION IS 0 @ VOUT=0 AND 1 @ VOUT=VS
E132 135 0 VALUE={(V(131)-V(11))*V(130)/V(124)} 
E142 145 0 VALUE={(V(141)-V(8))*V(140)/V(124)} 
* G135 & G145 REFLECT OUTPUT CURRENT INTO VSENSE PINS
G135 208 0 135 0 -7.273
G145 212 0 145 0 -7.273
V135 208 7 0 
V145 212 12 0 
* F135 & F145 REFLECT CURRENT INTO VS PIN
F135 9 0 V135 1 
F145 9 0 V145 1 
* 
R1 1 0 1meg 
R2 2 0 1meg 
R5 5 0 1meg 
* CATCH DIODES-FILTER/LOAD PHASE SHIFT CAN MAKE CURRENT FLOW BACKWARDS
D130 11 9 D1M 
D131 0 11 D1M 
D140 8 9 D1M 
D141 0 8 D1M 
.MODEL D1M D (IS=2.832E-12 M=0.333 N=1.00 RS=0.043 VJ=0.75)
*
D120 127 10 D1N4148 
D121 0 127 D1N4148
.MODEL D1N4148  D(IS=0.1P RS=16 CJO=2P TT=12N BV=100 IBV=0.1P)  
.ENDS
*END OF MODEL SA08TOOL
**********
*       SA12 PWM MODEL FEATURES INCLUDE:
*
*   1 PULSE BY PULSE TIME DOMAIN PERFORMANCE
*   2 OUTPUT RESISTANCE AND CAPACITANCE
*   3 ACCURATE CATCH DIODE I V CHARACTERISTIC
*   4 ACCURATE RON TEMPERATURE COEFFICIENT
*   5 INCREASING IQ ON THE VS SUPPLY VS FREQUENCY
*   6 DEADTIME BETWEEN SWITCH ON TIMES
*   7 ACCURATE IQ ON THE VCC LINE
*   8 REDUCTION IN IQ VCC IN SHUTDOWN
*   9 INTERNAL CMOS BUFFER ON THE CLK IN PIN
*  10 ILIM / SHUTDOWN FUNCTIONS
*
*     NOTE: THERMAL SHUTDOWN IS NOT MODELED
*     NOTE: HIGH SIDE CURRENT LIMIT IS NOT MODELED
*
*       SOME NOTES ON USING SPICE FOR PWM SIMULATION
*
*  REQUIRES BERKELEY SPICE 3E.3P OR LATER. YOUR SIMULATOR
*  MUST SUPPORT THE BERKELEY STANDARD VOLTAGE CONTROLLED
*  SWITCH ELEMENT (S)
*  OR
*  REQUIRES PSPICE 4.04 OR LATER
*
*  BE PREPARED FOR LONG SIMULATIONS
*
*  NOTE: BERKELEY SIMULATORS TYPICALLY RUN THESE
*  PWM MODELS ABOUT TWO TO FOUR TIMES FASTER THAN
*  PSPICE TYPE SIMULATORS AS THE BERKELEY SWITCH
*  ELEMENT DOES NOT INVOKE AS BIG A COMPUTATIONAL
*  BURDEN
*
*  IF YOUR SIMULATION STOPS DUE TO "TIMESTEP TOO SMALL"
*  ERRORS YOU MAY WANT TO INCREASE ITL4 TO 100, INCREASE
*  RELTOL TO 0.003 TO 0.01, INCREASE ABSTOL TO 1E-11 TO
*  1E-9, INCREASE GMIN TO 1E-11 TO 1E-7, INCREASE VNTOL
*  TO 1E-5 TO 1E-4, OR INCREASE CHGTOL TO 1E-11 TO 1E-9.
*  ANY OR ALL OF THESE SIMULATOR OPTIONS MAY BE REQUIRED
*  DEPENDING ON YOUR SIMULATOR. NEWER SIMULATORS USUALLY
*  REQUIRE FEWER OF THEM.
*
*  TO AID THE INITIAL TRANSIENT CONVERGANCE, SET UP THE
*  INITIAL VALUE OF CLOCK IN AS FOLLOWS:
*        IF PWM IN > 5V, CLOCK IN INITIAL = 5 VOLTS
*        IF PWM IN < 5V, CLOCK IN INITIAL = 0 VOLTS
*
*  TO AID THE INITIAL DC CONVERGANCE SET ITL1 TO 500.
*
*  THE CLOCK IS A GENERATOR STATEMENT INSIDE THE MODEL.
*  WHERE THE REAL PART HAS AN OSCILLATOR FOLLOWED BY A
*  DIGITAL DIVIDE BY TWO, THE MODEL HAS THE GENERATOR
*  AT HALF OF THE CLOCK FREQUENCY. IF YOU NEED TO SYNCH-
*  RONIZE THE PWM CLOCK TO AN EXTERNAL SOURCE, LOOK IN
*  YOUR SIMULATOR LIBRARY FOR A SIMPLE FAST RUNNING
*  BEHAVIORAL FREQUENCY DIVIDER OR DFLOP. BECAUSE THE
*  EXTENTIONS THAT ALLOW BEHAVIORAL MODELS VARY WIDELY
*  AMONG VENDORS NONE ARE INCLUDED HERE. AT THE BOTTOM
*  OF THIS LIBRARY FILE YOU WILL FIND A COMPONENT LEVEL
*  FREQUENCY DIVIDER SUBCIRCUIT (FDIV) WILL WORK WITH
*  ALL SIMULATORS. IT WORKS AT FIVE VOLTS (PROVIDE 5V
*  AND GROUND ON THE SUPPLIES OF FDIV) AND CAN PROVIDE
*  FREQUENCY DIVISION BY 2 TO GO BETWEEN YOUR EXTERNAL
*  SYNCH SIGNAL AND THE CLOCK INPUT OF THE PWM MODEL.
*  BECAUSE FDIV IS COMPONENT LEVEL IT IS SLOW AND WILL
*  EXTEND THE EXECUTION TIME BY AS MUCH AS 2 TO 1.
*
*  A GOOD WAY TO TEST SIMULATION ACCURACY IS TO FIX THE
*  PWM SIGNAL INPUT TO A FIXED VOLTAGE THAT IS EQUIVALENT
*  TO HALFWAY BETWEEN 50-50 DUTY FACTOR AND 100 PERCENT
*  DUTY FACTOR. RUN A SIMULATION THAT HAS TIME FOR OUTPUT
*  FILTER SETTLING. IF THE OUTPUT VOLTAGE WANDERS AROUND
*  RATHER THAN STAYS SETTLED TO LESS THAN ONE PERCENT YOU
*  SHOULD REDUCE THE TIMESTEP MAX (TMAX) PARAMETER IN THE
*  TRAN LINE. THIS IS THE FOURTH TIME PARAMETER ON THAT
*  LINE AND IS OPTIONAL LIKE THE TSTART PARAMETER (THIRD
*  TIME PARAMETER ON THAT LINE). IF YOU ARE NOT USING
*  TSTART YOU MUST SET IT TO ZERO SO THE SIMULATOR WILL
*  RECOGNIZE TMAX AS TMAX RATHER THAN TSTART. FOR BERKELEY
*  SPICE 3 TMAX WILL USUALLY BE IN THE 500 TO 150 NS RANGE.
*  FOR PSPICE TMAX WILL USUALLY BE IN THE 250 TO 50 NS
*  RANGE.
*
*  BECAUSE THE SPICE OUTPUT DATA IS A SAMPLED SYSTEM,
*  ALIASING CAN TAKE PLACE. IF THE WAVEFORM YOU ARE
*  LOOKING AT IS REPETATIVE BUT SEEMS TO HAVE INADEQUATE
*  P-P AMPLITUDE, YOU MAY WANT TO SAMPLE THE DATA MORE
*  OFTEN OR CHANGE THE RATIONALITY BETWEEN THE PWM CLOCK
*  PERIOD AND YOUR SAMPLING PERIOD.
*
*  IF YOUR SIMULATION CANNOT GET PAST INITIAL CONVERGANCE
*  FOR THE TRANSIENT ANALYSIS, RAMP VCC AND VS UP FROM
*  ZERO VOLTS TO NORMAL IN THE FIRST 10 MICROSECONDS OR SO.
*  THIS WILL NOT ONLY HELP THE TRAN ANALYSIS GET STARTED
*  BUT WILL ALLOW YOU TO SEE THE INITIAL VOLTAGES AND
*  CURRENTS FOR LATER SETTING OF NODESETS. LOOK FOR
*  OUTPUT FILTER INDUCTOR CURRENTS AND CAPACITOR VOLTAGES
*  TO ALLOW SETTING UP INITIAL CONDITIONS ON THOSE PARTS.
*  SETTING INITIAL CONDITIONS CAN ALLOW YOUR OUTPUT FILTER
*  TO GET TO OPERATING CONDITIONS MORE QUICKLY. DON'T
*  FORGET TO USE THE UIC OPTION IN THE TRAN LINE TO FORCE
*  USE OF INITIAL CONDITIONS.
*
*  BECAUSE THIS MODEL MUST BE CAPABLE OF RUNNING AT ANY
*  CLOCK RATE UP TO THE SPECIFICATION, THE MODEL MEASURES
*  THE CLOCK FREQUENCY AND FILTERS THE ANALOG RESULT AND
*  USES IT AS PART OF THE MODELING THAT CREATES THE
*  FREQUENCY DEPENDENT PART OF IQ(VSS). THE FILTER HAS A
*  TIME CONSTANT OF 300 USEC. DURING SHUTDOWN THE IQ(VSS)
*  IS SET TO A LOWER VALUE VIA THIS TIME CONSTANT AND
*  IQ(VCC) IS SET TO A LOWER VALUE WITH NO TIME CONSTANT.
*
*BEGIN MODEL SA12 FOR PSPICE
*PINOUT ORDER CKIN CKOUT +PWM -PWM GND ILIM ISENB BOUT +VS VCC AOUT ISENA
*PINOUT         1    2     3    4   5    6    7     8   9   10  11    12
.SUBCKT SA12_AM 1 2 3 4 5 6 7 8 9 10 11 12
V7 44 5 0 PULSE 0 5 0 10N 10N 2.5U 5U 
RE2 41 5 1E9
E1 14 5 23 4 1
D5 12 11 D5M
R13 27 5 10
R42 5 14 1E9
R39 67 63 10E3
C17 63 5 28E-12
R46 27 13 10E3
C18 13 5 28E-12
R1 40 11 R1M 0.49
R2 19 8 R1M 0.49
R3 64 12 R1M 0.49
R4 39 7 R1M 0.49
D4 13 27 D2M 
D8 63 67 D2M 
R14 32 23 1E3
R37 23 27 143E9
E4 32 5 66 5 1
E3 5 31 41 27 -1
R43 44 2 100
C22 2 5 10E-12
V2 41 5 4.5
D1 11 9 D1M
E9 16 5 65 25 1000
D6 7 8 D1M
D7 8 9 D1M
V9 28 5 0.1
C4 9 34 225E-12
C5 9 37 225E-12
C6 11 35 225E-12
C7 8 33 225E-12
R10 34 11 0.93
R12 35 12 0.93
R18 37 8 0.93
R20 33 7 0.93
S5 61 27 14 5 S5M
C19 15 5 1000E-12
C20 29 5 2000E-12
R15 26 29 10
E13 43 5 42 38 1
R16 43 30 300
C21 30 5 1E-6
R17 3 15 50
R45 30 5 1E9
C10 65 5 1000E-12
R21 65 6 1E3
D2 46 47 DN
D3 48 46 DN
R22 46 16 1E3
V10 48 5 0.8
V11 47 0 4.1
R23 28 25 1E3
R24 57 25 1E6
R25 57 50 1E3
R26 59 50 1E3
R27 52 25 100E3
R19 60 5 1
C8 57 52 5E-12
V13 56 5 5
V8 22 5 2.5
Q1 57 53 5 QFN
Q2 57 54 5 QFN
Q3 59 55 5 QFN
Q4 59 51 5 QFN
R28 53 46 50E3
R29 54 59 50E3
R30 55 49 50E3
R31 51 57 50E3
C9 53 5 1E-12
C11 51 5 1E-12
C12 55 5 1E-12
C13 54 5 1E-12
R33 58 4 28.1E3
C15 4 5 102E-12
M1 49 62 5 5 M1M
M2 49 62 50 50 M2M
R34 62 1 50
C16 62 5 5E-12
E10 58 5 49 0 2
V12 50 5 5
R35 61 5 1E9
S7 26 42 22 13 S7M
S8 26 60 13 22 S7M
R36 66 5 10E6
R38 38 42 1
V4 38 5 10
G1 5 10 30 5 0.36
R40 10 69 500
S10 69 5 57 5 S1M
I2 10 5 0.05
GQ1 5 9 VALUE = {(-0.2)*((0.4+(V(9)/200))*(0.1+V(30)*(-225)))}
R49 65 5 10E6
R51 15 66 50
R52 67 5 10
S1 9 40 13 5 S1M
S2 9 19 63 5 S1M
S3 11 64 63 5 S1M
S4 8 39 13 5 S1M
S6 67 31 57 5 S6M
S9 56 61 57 5 S1M
.MODEL R1M RES (TC1=7.374E-3 TC2=2.598E-5)
.MODEL QFN NPN (BF=100 NE=1.5 EG=1.11
+ IS=1.5E-15 NC=1.7 FC=0.5 CJC=1E-12)
.MODEL M1M NMOS (CBD=17E-12 CBS=17E-12 CGBO=26E-9
+ CGDO=18E-9 CGSO=20E-9 IS=31E-15 KP=4.3E-3 RD=50
+ RS=50 VTO=2.25)
.MODEL M2M PMOS (CBD=17E-12 CBS=17E-12 CGBO=26E-9
+ CGDO=18E-9 CGSO=20E-9 IS=31E-15 KP=4.3E-3 RD=50
+ RS=50 VTO=-2.25)
.MODEL S1M  VSWITCH RON=0.01 ROFF=1E6 VON=2.55 VOFF=2.0
.MODEL S5M  VSWITCH RON=1 ROFF=1E3 VON=0.001 VOFF=0
.MODEL S6M  VSWITCH RON=0.1 ROFF=1E4 VON=2.51 VOFF=0
.MODEL S7M  VSWITCH RON=1 ROFF=1E5 VON=0.1 VOFF=0
.MODEL D1M D (IS=2.832E-12 M=0.333 N=1.00 RS=0.043 VJ=0.75)
.MODEL D2M D (IS=1.68E-08 M=0.333 N=1.89 RS=0.452 VJ=0.75)
.MODEL D5M D (IS=2.832E-12 M=0.333 N=1.00 RS=0.043 VJ=0.75)
.MODEL DN D (BV=100 CJO=4E-12 IS=7E-9 M=0.45 N=2 RS=0.8 TT=6E-9 VJ=0.6)
.ENDS
*END OF MODEL SA12
*************
*     SA12TOOL STATE AVERAGE PWM MODEL FEATURES INCLUDE:
* 1 AVERAGE VALUE, TIME AND FREQUENCY DOMAIN PERFORMANCE
* 2 OUTPUT RESISTANCE FOR 100 DEGREE C JUNCTIONS
* 3 CURRENT SENSE PIN OUTPUTS
* 4 VS LOADING DUE TO OUTPUT CURRENT ONLY
* 5 SYMBOL COMPATABILITY WITH THE PULSE BY PULSE MODEL
* 6 PIN NUMBERS CORRESPOND TO THE HARDWARE
* 7 A FLAG OUTPUT SHOWS INPUT VOLTAGE OUTSIDE THE MODULATION RANGE
*
* WITH NO SWITCHING, THIS MODEL RUNS MANY TIMES FASTER THAN THE PULSE
* BY PULSE MODEL AND IT CAN RUN AN AC SWEEP, MAKING SIMULATION OF
* FEEDBACK LOOPS QUICK (RAISE OR ELIMINATE STEP CEILING).  
*
* BEWARE: LACK OF SWITCHING ELIMINATES SOME DISTORTION ELEMENTS FOUND
* IN THE PULSE BY PULSE MODEL AND THE HARDWARE. ALSO, LACK OF DEAD
* TIME ALLOWS LINEAR OPERATION ALL THE WAY TO 0 OR 100% MODULATION, 
* WHICH IS NOT POSSIBLE WITH THE HARDWARE.
* 
* THE ILIM/SHDN FUNCTION IS NOT MODELED.
*
*BEGIN MODEL SA12TOOL FOR PSPICE.
*PINS CLKIN CLKOUT +PWM -PWM GND ILIM/SDN ISENB BOUT VS VCC AOUT ISENA
*PINS   1      2     3    4   5      6      7     8   9  10  11    12
.SUBCKT SA12TOOL_AM 1 2 3 4 5 6 7 8 9 10 11 12
* R110 & C110 DUPLICATE HARDWARE
R110 3 127 50
C110 127 0 .001U
* SET UP HIGH, LOW AND P-P RAMP VALUES
E124 124 0 123 125 1 
V123 123 0 7 
V125 125 0 3 
* S123 & S125 LIMIT MODULATOR DRIVE TO 0/100%
S123 129 123 127 123 SM1 
S125 125 129 125 127 SM1 
R129 127 129 10K 
.MODEL SM1 VSWITCH (RON=1 ROFF=100MEG VON=.001 VOFF=-.001)
* E119 SHOWS ONLY INTEGRATOR VOLTAGE OUTSIDE MODULATION RANGE
E119 128 0 129 127 -1 
R128 128 6 10 
R6 3 0 1meg 
* 130 SERIES PARTS ARE THE NON-INVERTING OUT, 140 ARE INVERTING
* E130 & E140 GIVE MODULATION VOLTAGES; 0=0 OUT, VP-P=VS OUT
E130 130 0 129 125 1 
E140 140 0 123 129 1 
* E131 & E141 GENERATE OUTPUTS; V(MODULATE)*PWM GAIN [VS/VP-P]
E141 141 0 VALUE={V(140)*V(9)/V(124)} 
E131 131 0 VALUE={V(130)*V(9)/V(124)} 
* R132 & 142 SET ZOUT (ABOUT 100DEGREES C) AND MEASURE IOUT
R132 131 11 .305 
R142 141 8 .305 
* E132 & E142 SENSE OUTPUT CURRENT & MULTIPLY BY FRACTION OF MODULATION
* FRACTION IS 0 @ VOUT=0 AND 1 @ VOUT=VS
E132 135 0 VALUE={(V(131)-V(11))*V(130)/V(124)} 
E142 145 0 VALUE={(V(141)-V(8))*V(140)/V(124)}
* G135 & G145 REFLECT OUTPUT CURRENT INTO VSENSE PINS
G135 208 0 135 0 -3.2787
G145 212 0 145 0 -3.2787
V135 208 7 0 
V145 212 12 0 
* F135 & F145 REFLECT CURRENT INTO VS PIN
F135 9 0 V135 1 
F145 9 0 V145 1 
* 
R1 1 0 1meg 
R2 2 0 1meg 
R4 4 0 1meg 
R5 5 0 1meg 
* CATCH DIODES-FILTER/LOAD PHASE SHIFT CAN MAKE CURRENT FLOW BACKWARDS
D130 11 9 D1M 
D131 0 11 D1M 
D140 8 9 D1M 
D141 0 8 D1M 
.MODEL D1M D (IS=2.832E-12 M=0.333 N=1.00 RS=0.043 VJ=0.75)
*
D120 127 10 D1N4148 
D121 0 127 D1N4148
.MODEL D1N4148  D(IS=0.1P RS=16 CJO=2P TT=12N BV=100 IBV=0.1P)  
.ENDS
*END OF MODEL SA12TOOL
**********
*       SA13 PWM MODEL FEATURES INCLUDE:
*
*   1 PULSE BY PULSE TIME DOMAIN PERFORMANCE
*   2 OUTPUT RESISTANCE AND CAPACITANCE
*   3 ACCURATE CATCH DIODE I V CHARACTERISTIC
*   4 ACCURATE RON TEMPERATURE COEFFICIENT
*   5 INCREASING IQ ON THE VS SUPPLY VS FREQUENCY
*   6 DEADTIME BETWEEN SWITCH ON TIMES
*   7 ACCURATE IQ ON THE VCC LINE
*   8 REDUCTION IN IQ VCC IN SHUTDOWN
*   9 INTERNAL CMOS BUFFER ON THE CLK IN PIN
*  10 ILIM / SHUTDOWN FUNCTIONS
*
*     NOTE: THERMAL SHUTDOWN IS NOT MODELED
*     NOTE: HIGH SIDE CURRENT LIMIT IS NOT MODELED
*
*       SOME NOTES ON USING SPICE FOR PWM SIMULATION
*
*  REQUIRES BERKELEY SPICE 3E.3P OR LATER. YOUR SIMULATOR
*  MUST SUPPORT THE BERKELEY STANDARD VOLTAGE CONTROLLED
*  SWITCH ELEMENT (S)
*  OR
*  REQUIRES PSPICE 4.04 OR LATER
*
*  BE PREPARED FOR LONG SIMULATIONS
*
*  NOTE: BERKELEY SIMULATORS TYPICALLY RUN THESE
*  PWM MODELS ABOUT TWO TO FOUR TIMES FASTER THAN
*  PSPICE TYPE SIMULATORS AS THE BERKELEY SWITCH
*  ELEMENT DOES NOT INVOKE AS BIG A COMPUTATIONAL
*  BURDEN
*
*  IF YOUR SIMULATION STOPS DUE TO "TIMESTEP TOO SMALL"
*  ERRORS YOU MAY WANT TO INCREASE ITL4 TO 100, INCREASE
*  RELTOL TO 0.003 TO 0.01, INCREASE ABSTOL TO 1E-11 TO
*  1E-9, INCREASE GMIN TO 1E-11 TO 1E-7, INCREASE VNTOL
*  TO 1E-5 TO 1E-4, OR INCREASE CHGTOL TO 1E-11 TO 1E-9.
*  ANY OR ALL OF THESE SIMULATOR OPTIONS MAY BE REQUIRED
*  DEPENDING ON YOUR SIMULATOR. NEWER SIMULATORS USUALLY
*  REQUIRE FEWER OF THEM.
*
*  TO AID THE INITIAL TRANSIENT CONVERGANCE, SET UP THE
*  INITIAL VALUE OF CLOCK IN AS FOLLOWS:
*        IF PWM IN > 5V, CLOCK IN INITIAL = 5 VOLTS
*        IF PWM IN < 5V, CLOCK IN INITIAL = 0 VOLTS
*
*  TO AID THE INITIAL DC CONVERGANCE SET ITL1 TO 500.
*
*  THE CLOCK IS A GENERATOR STATEMENT INSIDE THE MODEL.
*  WHERE THE REAL PART HAS AN OSCILLATOR FOLLOWED BY A
*  DIGITAL DIVIDE BY TWO, THE MODEL HAS THE GENERATOR
*  AT HALF OF THE CLOCK FREQUENCY. IF YOU NEED TO SYNCH-
*  RONIZE THE PWM CLOCK TO AN EXTERNAL SOURCE, LOOK IN
*  YOUR SIMULATOR LIBRARY FOR A SIMPLE FAST RUNNING
*  BEHAVIORAL FREQUENCY DIVIDER OR DFLOP. BECAUSE THE
*  EXTENTIONS THAT ALLOW BEHAVIORAL MODELS VARY WIDELY
*  AMONG VENDORS NONE ARE INCLUDED HERE. AT THE BOTTOM
*  OF THIS LIBRARY FILE YOU WILL FIND A COMPONENT LEVEL
*  FREQUENCY DIVIDER SUBCIRCUIT (FDIV) WILL WORK WITH
*  ALL SIMULATORS. IT WORKS AT FIVE VOLTS (PROVIDE 5V
*  AND GROUND ON THE SUPPLIES OF FDIV) AND CAN PROVIDE
*  FREQUENCY DIVISION BY 2 TO GO BETWEEN YOUR EXTERNAL
*  SYNCH SIGNAL AND THE CLOCK INPUT OF THE PWM MODEL.
*  BECAUSE FDIV IS COMPONENT LEVEL IT IS SLOW AND WILL
*  EXTEND THE EXECUTION TIME BY AS MUCH AS 2 TO 1.
*
*  A GOOD WAY TO TEST SIMULATION ACCURACY IS TO FIX THE
*  PWM SIGNAL INPUT TO A FIXED VOLTAGE THAT IS EQUIVALENT
*  TO HALFWAY BETWEEN 50-50 DUTY FACTOR AND 100 PERCENT
*  DUTY FACTOR. RUN A SIMULATION THAT HAS TIME FOR OUTPUT
*  FILTER SETTLING. IF THE OUTPUT VOLTAGE WANDERS AROUND
*  RATHER THAN STAYS SETTLED TO LESS THAN ONE PERCENT YOU
*  SHOULD REDUCE THE TIMESTEP MAX (TMAX) PARAMETER IN THE
*  TRAN LINE. THIS IS THE FOURTH TIME PARAMETER ON THAT
*  LINE AND IS OPTIONAL LIKE THE TSTART PARAMETER (THIRD
*  TIME PARAMETER ON THAT LINE). IF YOU ARE NOT USING
*  TSTART YOU MUST SET IT TO ZERO SO THE SIMULATOR WILL
*  RECOGNIZE TMAX AS TMAX RATHER THAN TSTART. FOR BERKELEY
*  SPICE 3 TMAX WILL USUALLY BE IN THE 500 TO 150 NS RANGE.
*  FOR PSPICE TMAX WILL USUALLY BE IN THE 250 TO 50 NS
*  RANGE.
*
*  BECAUSE THE SPICE OUTPUT DATA IS A SAMPLED SYSTEM,
*  ALIASING CAN TAKE PLACE. IF THE WAVEFORM YOU ARE
*  LOOKING AT IS REPETATIVE BUT SEEMS TO HAVE INADEQUATE
*  P-P AMPLITUDE, YOU MAY WANT TO SAMPLE THE DATA MORE
*  OFTEN OR CHANGE THE RATIONALITY BETWEEN THE PWM CLOCK
*  PERIOD AND YOUR SAMPLING PERIOD.
*
*  IF YOUR SIMULATION CANNOT GET PAST INITIAL CONVERGANCE
*  FOR THE TRANSIENT ANALYSIS, RAMP VCC AND VS UP FROM
*  ZERO VOLTS TO NORMAL IN THE FIRST 10 MICROSECONDS OR SO.
*  THIS WILL NOT ONLY HELP THE TRAN ANALYSIS GET STARTED
*  BUT WILL ALLOW YOU TO SEE THE INITIAL VOLTAGES AND
*  CURRENTS FOR LATER SETTING OF NODESETS. LOOK FOR
*  OUTPUT FILTER INDUCTOR CURRENTS AND CAPACITOR VOLTAGES
*  TO ALLOW SETTING UP INITIAL CONDITIONS ON THOSE PARTS.
*  SETTING INITIAL CONDITIONS CAN ALLOW YOUR OUTPUT FILTER
*  TO GET TO OPERATING CONDITIONS MORE QUICKLY. DON'T
*  FORGET TO USE THE UIC OPTION IN THE TRAN LINE TO FORCE
*  USE OF INITIAL CONDITIONS.
*
*  BECAUSE THIS MODEL MUST BE CAPABLE OF RUNNING AT ANY
*  CLOCK RATE UP TO THE SPECIFICATION, THE MODEL MEASURES
*  THE CLOCK FREQUENCY AND FILTERS THE ANALOG RESULT AND
*  USES IT AS PART OF THE MODELING THAT CREATES THE
*  FREQUENCY DEPENDENT PART OF IQ(VSS). THE FILTER HAS A
*  TIME CONSTANT OF 300 USEC. DURING SHUTDOWN THE IQ(VSS)
*  IS SET TO A LOWER VALUE VIA THIS TIME CONSTANT AND
*  IQ(VCC) IS SET TO A LOWER VALUE WITH NO TIME CONSTANT.
*
*BEGIN MODEL SA13 FOR PSPICE
*PINOUT ORDER CKIN CKOUT +PWM -PWM SGND SHTDN PGND  OUT +VS VCC
*PINOUT         1    2     3    4    5    6     7    8   9   10
.SUBCKT SA13_AM 1 2 3 4 5 6 7 8 9 10
V7 44 5 0 PULSE 0 5 0 10N 10N 22.22U 44.44U
RE2 41 5 1E9
E1 14 5 23 4 1
D5 7 8 D1M
R13 27 5 10
R42 5 14 1E9
R39 67 63 10E3
C17 63 5 28E-12
R46 27 13 10E3
C18 13 5 28E-12
R1 40 8 R1M 0.09
R3 64 7 R1M 0.09
D4 13 27 D2M
D8 63 67 D2M
R14 32 23 1E3
R37 23 27 143E9
E4 32 5 68 5 1
E3 5 31 41 27 -1
R43 44 2 100
C22 2 5 10E-12
V2 41 5 4.5
D1 8 9 D1M
E9 16 5 65 25 1000
V9 28 5 0.1
C4 9 34 350E-12
C6 8 35 350E-12
R10 34 8 0.47
R12 35 7 0.47
S5 61 27 14 5 S5M
C19 66 5 1000E-12
C20 29 5 2000E-12
R15 26 29 10
E13 43 5 42 38 1
R16 43 30 300
C21 30 5 1E-6
R45 30 5 1E9
C10 65 5 1000E-12
R21 65 6 1E3
D2 46 47 DN
D3 48 46 DN
R22 46 16 1E3
V10 48 5 0.8
V11 47 0 4.1
R23 28 25 1E3
R24 57 25 1E6
R25 57 50 1E3
R26 59 50 1E3
R27 52 25 100E3
R19 60 5 1
C8 57 52 5E-12
V13 56 5 5
V8 22 5 2.5
Q1 57 53 5 QFN
Q2 57 54 5 QFN
Q3 59 55 5 QFN
Q4 59 51 5 QFN
R28 53 46 50E3
R29 54 59 50E3
R30 55 49 50E3
R31 51 57 50E3
C9 53 5 1E-12
C11 51 5 1E-12
C12 55 5 1E-12
C13 54 5 1E-12
R33 58 4 55E3
C15 4 5 470E-12
M1 49 62 5 5 M1M
M2 49 62 50 50 M2M
R34 62 1 50
C16 62 5 5E-12
E10 58 5 49 0 2
V12 50 5 5
R35 61 5 1E9
S7 26 42 22 13 S7M
S8 26 60 13 22 S7M
R36 68 5 10E6
R38 38 42 1
V4 38 5 10
G1 5 10 30 5 0.36
R40 10 69 500
S10 69 5 57 5 S1M
I2 10 5 0.05
GQ1 5 9 VALUE = {(-0.025)*((0.13+(V(9)/69))*(0.28+V(30)*(-1600)))}
R49 65 5 10E6
R51 66 68 50
R52 3 66 50
R53 67 5 10
VD1 9 71 0
VD3 8 73 0
S1 71 40 63 5 S1M
S3 73 64 13 5 S1M
S6 67 31 57 5 S6M
S9 56 61 57 5 S1M
.MODEL R1M RES (TC1=7.374E-3 TC2=2.598E-5)
.MODEL QFN NPN (BF=100 NE=1.5 EG=1.11
+ IS=1.5E-15 NC=1.7 FC=0.5 CJC=1E-12)
.MODEL M1M NMOS (CBD=17E-12 CBS=17E-12 CGBO=26E-9
+ CGDO=18E-9 CGSO=20E-9 IS=31E-15 KP=4.3E-3 RD=50
+ RS=50 VTO=2.25)
.MODEL M2M PMOS (CBD=17E-12 CBS=17E-12 CGBO=26E-9
+ CGDO=18E-9 CGSO=20E-9 IS=31E-15 KP=4.3E-3 RD=50
+ RS=50 VTO=-2.25)
.MODEL S1M VSWITCH RON=0.01 ROFF=1E6 VON=2.55 VOFF=2.0
.MODEL S5M VSWITCH RON=1 ROFF=1E3 VON=0.001 VOFF=0
.MODEL S6M VSWITCH RON=0.1 ROFF=1E4 VON=2.91 VOFF=2.5
.MODEL S7M VSWITCH RON=1 ROFF=1E5 VON=0.1 VOFF=0
.MODEL D1M D (IS=6.365E-12 M=0.333 N=1.00 RS=0.02685 VJ=0.75)
.MODEL D2M D (IS=1.68E-08 M=0.333 N=1.89 RS=0.452 VJ=0.75)
.MODEL DN D (BV=100 CJO=4E-12 IS=7E-09 M=0.45 N=2 RS=0.8 TT=6E-9 VJ=0.6)
.ENDS
*END OF MODEL SA13
*************
*     SA13TOOL STATE AVERAGE PWM MODEL FEATURES INCLUDE:
* 1 AVERAGE VALUE, TIME AND FREQUENCY DOMAIN PERFORMANCE
* 2 OUTPUT RESISTANCE FOR 100 DEGREE C JUNCTIONS
* 3 CURRENT SENSE PIN OUTPUTS
* 4 VS LOADING DUE TO OUTPUT CURRENT ONLY
* 5 SYMBOL COMPATABILITY WITH THE PULSE BY PULSE MODEL
* 6 PIN NUMBERS CORRESPOND TO THE HARDWARE
* 7 A FLAG OUTPUT SHOWS INPUT VOLTAGE OUTSIDE THE MODULATION RANGE
*
* WITH NO SWITCHING, THIS MODEL RUNS MANY TIMES FASTER THAN THE PULSE
* BY PULSE MODEL AND IT CAN RUN AN AC SWEEP, MAKING SIMULATION OF
* FEEDBACK LOOPS QUICK (RAISE OR ELIMINATE STEP CEILING).  
*
* BEWARE: LACK OF SWITCHING ELIMINATES SOME DISTORTION ELEMENTS FOUND
* IN THE PULSE BY PULSE MODEL AND THE HARDWARE. ALSO, LACK OF DEAD
* TIME ALLOWS LINEAR OPERATION ALL THE WAY TO 0 OR 100% MODULATION, 
* WHICH IS NOT POSSIBLE WITH THE HARDWARE.
* 
* THE ILIM/SHDN FUNCTION IS NOT MODELED.
*
*BEGIN MODEL SA13TOOL FOR PSPICE.
*PINS CLKIN CLKOUT +PWM -PWM SIGGND SHDN PWRGND OUT VS VCC 
*PINS   1      2     3    4     5     6     7    8   9  10  
.SUBCKT SA13TOOL_AM 1 2 3 4 5 6 7 8 9 10 
* R110 & C110 DUPLICATE HARDWARE
R110 3 127 50
C110 127 0 .01U
* SET UP HIGH, LOW AND P-P RAMP VALUES
E124 124 0 123 125 1 
V123 123 0 7 
V125 125 0 3 
* S123 & S125 LIMIT MODULATOR DRIVE TO 0/100%
S123 129 123 127 123 SM1 
S125 125 129 125 127 SM1 
R129 127 129 10K 
.MODEL SM1 VSWITCH (RON=1 ROFF=100MEG VON=.001 VOFF=-.001)
* E119 SHOWS ONLY INTEGRATOR VOLTAGE OUTSIDE MODULATION RANGE
E119 128 0 129 127 -1 
R128 128 6 10 
R6 3 0 1meg 
* 130 SERIES PARTS ARE THE NON-INVERTING OUT, 140 ARE INVERTING
* E130 & E140 GIVE MODULATION VOLTAGES; 0=0 OUT, VP-P=VS OUT
E130 130 0 129 125 1 
E140 140 0 123 129 1 
* E141 GENERATES OUTPUT; V(MODULATE)*PWM GAIN [VS/VP-P]
E141 141 0 VALUE={V(140)*V(9)/V(124)} 
* R142 SETS ZOUT (ABOUT 100DEGREES C) AND MEASURE IOUT
R142 141 8 .114 
* E142 SENSES OUTPUT CURRENT & MULTIPLY BY FRACTION OF MODULATION
* FRACTION IS 1 @ VOUT=0 AND 0 @ VOUT=VS
E142 145 0 VALUE={(V(141)-V(8))*V(130)/V(124)} 
* G145 REFLECTS OUTPUT CURRENT INTO VSENSE PINS
G145 212 0 145 0 8.772
V145 212 7 0 
* F145 REFLECTS CURRENT INTO VS PIN
F145 9 0 V145 -1 
* 
R1 1 0 1meg 
R2 2 0 1meg 
R4 4 0 1meg 
R5 5 0 1meg 
* CATCH DIODES-FILTER/LOAD PHASE SHIFT CAN MAKE CURRENT FLOW BACKWARDS
D140 8 9 D1M 
D141 0 8 D1M 
.MODEL D1M D (IS=2.832E-12 M=0.333 N=1.00 RS=0.043 VJ=0.75)
*
D120 127 10 D1N4148 
D121 0 127 D1N4148
.MODEL D1N4148  D(IS=0.1P RS=16 CJO=2P TT=12N BV=100 IBV=0.1P)  
.ENDS
*END OF MODEL SA13TOOL
**********
*       SA14 PWM MODEL FEATURES INCLUDE:
*
*   1 PULSE BY PULSE TIME DOMAIN PERFORMANCE
*   2 OUTPUT RESISTANCE AND CAPACITANCE
*   3 ACCURATE CATCH DIODE I V CHARACTERISTIC
*   4 ACCURATE RON TEMPERATURE COEFFICIENT
*   5 INCREASING IQ ON THE VS SUPPLY VS FREQUENCY
*   6 DEADTIME BETWEEN SWITCH ON TIMES
*   7 ACCURATE IQ ON THE VCC LINE
*   8 REDUCTION IN IQ VCC IN SHUTDOWN
*   9 INTERNAL CMOS BUFFER ON THE CLK IN PIN
*  10 ILIM / SHUTDOWN FUNCTIONS
*
*     NOTE: THERMAL SHUTDOWN IS NOT MODELED
*     NOTE: HIGH SIDE CURRENT LIMIT IS NOT MODELED
*
*       SOME NOTES ON USING SPICE FOR PWM SIMULATION
*
*  REQUIRES BERKELEY SPICE 3E.3P OR LATER. YOUR SIMULATOR
*  MUST SUPPORT THE BERKELEY STANDARD VOLTAGE CONTROLLED
*  SWITCH ELEMENT (S)
*  OR
*  REQUIRES PSPICE 4.04 OR LATER
*
*  BE PREPARED FOR LONG SIMULATIONS
*
*  NOTE: BERKELEY SIMULATORS TYPICALLY RUN THESE
*  PWM MODELS ABOUT TWO TO FOUR TIMES FASTER THAN
*  PSPICE TYPE SIMULATORS AS THE BERKELEY SWITCH
*  ELEMENT DOES NOT INVOKE AS BIG A COMPUTATIONAL
*  BURDEN
*
*  IF YOUR SIMULATION STOPS DUE TO "TIMESTEP TOO SMALL"
*  ERRORS YOU MAY WANT TO INCREASE ITL4 TO 100, INCREASE
*  RELTOL TO 0.003 TO 0.01, INCREASE ABSTOL TO 1E-11 TO
*  1E-9, INCREASE GMIN TO 1E-11 TO 1E-7, INCREASE VNTOL
*  TO 1E-5 TO 1E-4, OR INCREASE CHGTOL TO 1E-11 TO 1E-9.
*  ANY OR ALL OF THESE SIMULATOR OPTIONS MAY BE REQUIRED
*  DEPENDING ON YOUR SIMULATOR. NEWER SIMULATORS USUALLY
*  REQUIRE FEWER OF THEM.
*
*  TO AID THE INITIAL TRANSIENT CONVERGANCE, SET UP THE
*  INITIAL VALUE OF CLOCK IN AS FOLLOWS:
*        IF PWM IN > 5V, CLOCK IN INITIAL = 5 VOLTS
*        IF PWM IN < 5V, CLOCK IN INITIAL = 0 VOLTS
*
*  TO AID THE INITIAL DC CONVERGANCE SET ITL1 TO 500.
*
*  THE CLOCK IS A GENERATOR STATEMENT INSIDE THE MODEL.
*  WHERE THE REAL PART HAS AN OSCILLATOR FOLLOWED BY A
*  DIGITAL DIVIDE BY TWO, THE MODEL HAS THE GENERATOR
*  AT HALF OF THE CLOCK FREQUENCY. IF YOU NEED TO SYNCH-
*  RONIZE THE PWM CLOCK TO AN EXTERNAL SOURCE, LOOK IN
*  YOUR SIMULATOR LIBRARY FOR A SIMPLE FAST RUNNING
*  BEHAVIORAL FREQUENCY DIVIDER OR DFLOP. BECAUSE THE
*  EXTENTIONS THAT ALLOW BEHAVIORAL MODELS VARY WIDELY
*  AMONG VENDORS NONE ARE INCLUDED HERE. AT THE BOTTOM
*  OF THIS LIBRARY FILE YOU WILL FIND A COMPONENT LEVEL
*  FREQUENCY DIVIDER SUBCIRCUIT (FDIV) WILL WORK WITH
*  ALL SIMULATORS. IT WORKS AT FIVE VOLTS (PROVIDE 5V
*  AND GROUND ON THE SUPPLIES OF FDIV) AND CAN PROVIDE
*  FREQUENCY DIVISION BY 2 TO GO BETWEEN YOUR EXTERNAL
*  SYNCH SIGNAL AND THE CLOCK INPUT OF THE PWM MODEL.
*  BECAUSE FDIV IS COMPONENT LEVEL IT IS SLOW AND WILL
*  EXTEND THE EXECUTION TIME BY AS MUCH AS 2 TO 1.
*
*  A GOOD WAY TO TEST SIMULATION ACCURACY IS TO FIX THE
*  PWM SIGNAL INPUT TO A FIXED VOLTAGE THAT IS EQUIVALENT
*  TO HALFWAY BETWEEN 50-50 DUTY FACTOR AND 100 PERCENT
*  DUTY FACTOR. RUN A SIMULATION THAT HAS TIME FOR OUTPUT
*  FILTER SETTLING. IF THE OUTPUT VOLTAGE WANDERS AROUND
*  RATHER THAN STAYS SETTLED TO LESS THAN ONE PERCENT YOU
*  SHOULD REDUCE THE TIMESTEP MAX (TMAX) PARAMETER IN THE
*  TRAN LINE. THIS IS THE FOURTH TIME PARAMETER ON THAT
*  LINE AND IS OPTIONAL LIKE THE TSTART PARAMETER (THIRD
*  TIME PARAMETER ON THAT LINE). IF YOU ARE NOT USING
*  TSTART YOU MUST SET IT TO ZERO SO THE SIMULATOR WILL
*  RECOGNIZE TMAX AS TMAX RATHER THAN TSTART. FOR BERKELEY
*  SPICE 3 TMAX WILL USUALLY BE IN THE 500 TO 150 NS RANGE.
*  FOR PSPICE TMAX WILL USUALLY BE IN THE 250 TO 50 NS
*  RANGE.
*
*  BECAUSE THE SPICE OUTPUT DATA IS A SAMPLED SYSTEM,
*  ALIASING CAN TAKE PLACE. IF THE WAVEFORM YOU ARE
*  LOOKING AT IS REPETATIVE BUT SEEMS TO HAVE INADEQUATE
*  P-P AMPLITUDE, YOU MAY WANT TO SAMPLE THE DATA MORE
*  OFTEN OR CHANGE THE RATIONALITY BETWEEN THE PWM CLOCK
*  PERIOD AND YOUR SAMPLING PERIOD.
*
*  IF YOUR SIMULATION CANNOT GET PAST INITIAL CONVERGANCE
*  FOR THE TRANSIENT ANALYSIS, RAMP VCC AND VS UP FROM
*  ZERO VOLTS TO NORMAL IN THE FIRST 10 MICROSECONDS OR SO.
*  THIS WILL NOT ONLY HELP THE TRAN ANALYSIS GET STARTED
*  BUT WILL ALLOW YOU TO SEE THE INITIAL VOLTAGES AND
*  CURRENTS FOR LATER SETTING OF NODESETS. LOOK FOR
*  OUTPUT FILTER INDUCTOR CURRENTS AND CAPACITOR VOLTAGES
*  TO ALLOW SETTING UP INITIAL CONDITIONS ON THOSE PARTS.
*  SETTING INITIAL CONDITIONS CAN ALLOW YOUR OUTPUT FILTER
*  TO GET TO OPERATING CONDITIONS MORE QUICKLY. DON'T
*  FORGET TO USE THE UIC OPTION IN THE TRAN LINE TO FORCE
*  USE OF INITIAL CONDITIONS.
*
*  BECAUSE THIS MODEL MUST BE CAPABLE OF RUNNING AT ANY
*  CLOCK RATE UP TO THE SPECIFICATION, THE MODEL MEASURES
*  THE CLOCK FREQUENCY AND FILTERS THE ANALOG RESULT AND
*  USES IT AS PART OF THE MODELING THAT CREATES THE
*  FREQUENCY DEPENDENT PART OF IQ(VSS). THE FILTER HAS A
*  TIME CONSTANT OF 300 USEC. DURING SHUTDOWN THE IQ(VSS)
*  IS SET TO A LOWER VALUE VIA THIS TIME CONSTANT AND
*  IQ(VCC) IS SET TO A LOWER VALUE WITH NO TIME CONSTANT.
*
*BEGIN MODEL SA14 FOR PSPICE
*PINOUT ORDER CKIN CKOUT +PWM -PWM SGND SHTDN PGND  OUT +VS VCC
*PINOUT         1    2     3    4    5    6     7    8   9   10
.SUBCKT SA14_AM 1 2 3 4 5 6 7 8 9 10
V7 44 5 0 PULSE 0 5 0 10N 10N 22.22U 44.44U
RE2 41 5 1E9
E1 14 5 23 4 1
D5 7 8 D1M
R13 27 5 10
R42 5 14 1E9
R39 67 63 10E3
C17 63 5 28E-12
R46 27 13 10E3
C18 13 5 28E-12
R1 40 8 R1M 0.121
R3 64 7 R1M 0.121
D4 13 27 D2M
D8 63 67 D2M
R14 32 23 1E3
R37 23 27 143E9
E4 32 5 68 5 1
E3 5 31 41 27 -1
R43 44 2 100
C22 2 5 10E-12
V2 41 5 4.5
D1 8 9 D1M
E9 16 5 65 25 1000
V9 28 5 0.1
C4 9 34 220E-12
C6 8 35 220E-12
R10 34 8 0.70
R12 35 7 0.70
S5 61 27 14 5 S5M
C19 66 5 1000E-12
C20 29 5 2000E-12
R15 26 29 10
E13 43 5 42 38 1
R16 43 30 300
C21 30 5 1E-6
R45 30 5 1E9
C10 65 5 1000E-12
R21 65 6 1E3
D2 46 47 DN
D3 48 46 DN
R22 46 16 1E3
V10 48 5 0.8
V11 47 0 4.1
R23 28 25 1E3
R24 57 25 1E6
R25 57 50 1E3
R26 59 50 1E3
R27 52 25 100E3
R19 60 5 1
C8 57 52 5E-12
V13 56 5 5
V8 22 5 2.5
Q1 57 53 5 QFN
Q2 57 54 5 QFN
Q3 59 55 5 QFN
Q4 59 51 5 QFN
R28 53 46 50E3
R29 54 59 50E3
R30 55 49 50E3
R31 51 57 50E3
C9 53 5 1E-12
C11 51 5 1E-12
C12 55 5 1E-12
C13 54 5 1E-12
R33 58 4 55E3
C15 4 5 470E-12
M1 49 62 5 5 M1M
M2 49 62 50 50 M2M
R34 62 1 50
C16 62 5 5E-12
E10 58 5 49 0 2
V12 50 5 5
R35 61 5 1E9
S7 26 42 22 13 S7M
S8 26 60 13 22 S7M
R36 68 5 10E6
R38 38 42 1
V4 38 5 10
G1 5 10 30 5 0.36
R40 10 69 500
S10 69 5 57 5 S1M
I2 10 5 0.05
GQ1 5 9 VALUE = {(-0.025)*((0.29+(V(9)/175))*(0.1+V(30)*(-2000)))}
R49 65 5 10E6
R51 66 68 50
R52 3 66 50
R53 67 5 10
VD1 9 71 0
VD3 8 73 0
S1 71 40 63 5 S1M
S3 73 64 13 5 S1M
S6 67 31 57 5 S6M
S9 56 61 57 5 S1M
.MODEL R1M RES (TC1=7.374E-3 TC2=2.598E-5)
.MODEL QFN NPN (BF=100 NE=1.5 EG=1.11
+ IS=1.5E-15 NC=1.7 FC=0.5 CJC=1E-12)
.MODEL M1M NMOS (CBD=17E-12 CBS=17E-12 CGBO=26E-9
+ CGDO=18E-9 CGSO=20E-9 IS=31E-15 KP=4.3E-3 RD=50
+ RS=50 VTO=2.25)
.MODEL M2M PMOS (CBD=17E-12 CBS=17E-12 CGBO=26E-9
+ CGDO=18E-9 CGSO=20E-9 IS=31E-15 KP=4.3E-3 RD=50
+ RS=50 VTO=-2.25)
.MODEL S1M VSWITCH RON=0.01 ROFF=1E6 VON=2.55 VOFF=2.0
.MODEL S5M VSWITCH RON=1 ROFF=1E3 VON=0.001 VOFF=0
.MODEL S6M VSWITCH RON=0.1 ROFF=1E4 VON=2.91 VOFF=2.5
.MODEL S7M VSWITCH RON=1 ROFF=1E5 VON=0.1 VOFF=0
.MODEL D1M D (IS=5.414E-12 M=0.333 N=1.00 RS=0.0348 VJ=0.75)
.MODEL D2M D (IS=1.68E-08 M=0.333 N=1.89 RS=0.452 VJ=0.75)
.MODEL DN D (BV=100 CJO=4E-12 IS=7E-09 M=0.45 N=2 RS=0.8 TT=6E-9 VJ=0.6)
.ENDS
*END OF MODEL SA14
*************
*     SA14TOOL STATE AVERAGE PWM MODEL FEATURES INCLUDE:
* 1 AVERAGE VALUE, TIME AND FREQUENCY DOMAIN PERFORMANCE
* 2 OUTPUT RESISTANCE FOR 100 DEGREE C JUNCTIONS
* 3 CURRENT SENSE PIN OUTPUTS
* 4 VS LOADING DUE TO OUTPUT CURRENT ONLY
* 5 SYMBOL COMPATABILITY WITH THE PULSE BY PULSE MODEL
* 6 PIN NUMBERS CORRESPOND TO THE HARDWARE
* 7 A FLAG OUTPUT SHOWS INPUT VOLTAGE OUTSIDE THE MODULATION RANGE
*
* WITH NO SWITCHING, THIS MODEL RUNS MANY TIMES FASTER THAN THE PULSE
* BY PULSE MODEL AND IT CAN RUN AN AC SWEEP, MAKING SIMULATION OF
* FEEDBACK LOOPS QUICK (RAISE OR ELIMINATE STEP CEILING).  
*
* BEWARE: LACK OF SWITCHING ELIMINATES SOME DISTORTION ELEMENTS FOUND
* IN THE PULSE BY PULSE MODEL AND THE HARDWARE. ALSO, LACK OF DEAD
* TIME ALLOWS LINEAR OPERATION ALL THE WAY TO 0 OR 100% MODULATION, 
* WHICH IS NOT POSSIBLE WITH THE HARDWARE.
* 
* THE ILIM/SHDN FUNCTION IS NOT MODELED.
*
*BEGIN MODEL SA14TOOL FOR PSPICE.
*PINS CLKIN CLKOUT +PWM -PWM SIGGND SHDN PWRGND OUT VS VCC 
*PINS   1      2     3    4     5     6     7    8   9  10  
.SUBCKT SA14TOOL_AM 1 2 3 4 5 6 7 8 9 10 
* R110 & C110 DUPLICATE HARDWARE
R110 3 127 50
C110 127 0 .01U
* SET UP HIGH, LOW AND P-P RAMP VALUES
E124 124 0 123 125 1 
V123 123 0 7 
V125 125 0 3 
* S123 & S125 LIMIT MODULATOR DRIVE TO 0/100%
S123 129 123 127 123 SM1 
S125 125 129 125 127 SM1 
R129 127 129 10K 
.MODEL SM1 VSWITCH (RON=1 ROFF=100MEG VON=.001 VOFF=-.001)
* E119 SHOWS ONLY INTEGRATOR VOLTAGE OUTSIDE MODULATION RANGE
E119 128 0 129 127 -1 
R128 128 6 10 
R6 3 0 1meg 
* 130 SERIES PARTS ARE THE NON-INVERTING OUT, 140 ARE INVERTING
* E130 & E140 GIVE MODULATION VOLTAGES; 0=0 OUT, VP-P=VS OUT
E130 130 0 129 125 1 
E140 140 0 123 129 1 
* E141 GENERATES OUTPUT; V(MODULATE)*PWM GAIN [VS/VP-P]
E141 141 0 VALUE={V(140)*V(9)/V(124)} 
* R142 SETS ZOUT (ABOUT 100DEGREES C) AND MEASURE IOUT
R142 141 8 .16 
* E142 SENSES OUTPUT CURRENT & MULTIPLY BY FRACTION OF MODULATION
* FRACTION IS 1 @ VOUT=0 AND 0 @ VOUT=VS
E142 145 0 VALUE={(V(141)-V(8))*V(130)/V(124)} 
* G145 REFLECTS OUTPUT CURRENT INTO VSENSE PINS
G145 212 0 145 0 6.25 
V145 212 7 0 
* F145 REFLECTS CURRENT INTO VS PIN
F145 9 0 V145 -1 
* 
R1 1 0 1meg 
R2 2 0 1meg 
R4 4 0 1meg 
R5 5 0 1meg 
* CATCH DIODES-FILTER/LOAD PHASE SHIFT CAN MAKE CURRENT FLOW BACKWARDS
D140 8 9 D1M 
D141 0 8 D1M 
.MODEL D1M D (IS=2.832E-12 M=0.333 N=1.00 RS=0.043 VJ=0.75)
*
D120 127 10 D1N4148 
D121 0 127 D1N4148
.MODEL D1N4148  D(IS=0.1P RS=16 CJO=2P TT=12N BV=100 IBV=0.1P)  
.ENDS
*END OF MODEL SA14TOOL
************
*       SA16 PWM MODEL FEATURES INCLUDE:
*
*   1 PULSE BY PULSE TIME DOMAIN PERFORMANCE
*   2 OUTPUT RESISTANCE AND CAPACITANCE
*   3 ACCURATE CATCH DIODE I V CHARACTERISTIC
*   4 ACCURATE RON TEMPERATURE COEFFICIENT
*   5 INCREASING IQ ON THE VS SUPPLY VS FREQUENCY
*   6 DEADTIME BETWEEN SWITCH ON TIMES
*   7 ACCURATE IQ ON THE VCC LINE
*   8 REDUCTION IN IQ VCC IN SHUTDOWN
*   9 INTERNAL CMOS BUFFER ON THE CLK IN PIN
*  10 ILIM / SHUTDOWN FUNCTIONS
*
*     NOTE: THERMAL SHUTDOWN IS NOT MODELED
*     NOTE: HIGH SIDE CURRENT LIMIT IS NOT MODELED
*
*       SOME NOTES ON USING SPICE FOR PWM SIMULATION
*
*  REQUIRES BERKELEY SPICE 3E.3P OR LATER. YOUR SIMULATOR
*  MUST SUPPORT THE BERKELEY STANDARD VOLTAGE CONTROLLED
*  SWITCH ELEMENT (S)
*  OR
*  REQUIRES PSPICE 4.04 OR LATER
*
*  BE PREPARED FOR LONG SIMULATIONS
*
*  NOTE: BERKELEY SIMULATORS TYPICALLY RUN THESE
*  PWM MODELS ABOUT TWO TO FOUR TIMES FASTER THAN
*  PSPICE TYPE SIMULATORS AS THE BERKELEY SWITCH
*  ELEMENT DOES NOT INVOKE AS BIG A COMPUTATIONAL
*  BURDEN
*
*  IF YOUR SIMULATION STOPS DUE TO "TIMESTEP TOO SMALL"
*  ERRORS YOU MAY WANT TO INCREASE ITL4 TO 100, INCREASE
*  RELTOL TO 0.003 TO 0.01, INCREASE ABSTOL TO 1E-11 TO
*  1E-9, INCREASE GMIN TO 1E-11 TO 1E-7, INCREASE VNTOL
*  TO 1E-5 TO 1E-4, OR INCREASE CHGTOL TO 1E-11 TO 1E-9.
*  ANY OR ALL OF THESE SIMULATOR OPTIONS MAY BE REQUIRED
*  DEPENDING ON YOUR SIMULATOR. NEWER SIMULATORS USUALLY
*  REQUIRE FEWER OF THEM.
*
*  TO AID THE INITIAL TRANSIENT CONVERGANCE, SET UP THE
*  INITIAL VALUE OF CLOCK IN AS FOLLOWS:
*        IF PWM IN > 5V, CLOCK IN INITIAL = 5 VOLTS
*        IF PWM IN < 5V, CLOCK IN INITIAL = 0 VOLTS
*
*  TO AID THE INITIAL DC CONVERGANCE SET ITL1 TO 500.
*
*  THE CLOCK IS A GENERATOR STATEMENT INSIDE THE MODEL.
*  WHERE THE REAL PART HAS AN OSCILLATOR FOLLOWED BY A
*  DIGITAL DIVIDE BY TWO, THE MODEL HAS THE GENERATOR
*  AT HALF OF THE CLOCK FREQUENCY. IF YOU NEED TO SYNCH-
*  RONIZE THE PWM CLOCK TO AN EXTERNAL SOURCE, LOOK IN
*  YOUR SIMULATOR LIBRARY FOR A SIMPLE FAST RUNNING
*  BEHAVIORAL FREQUENCY DIVIDER OR DFLOP. BECAUSE THE
*  EXTENTIONS THAT ALLOW BEHAVIORAL MODELS VARY WIDELY
*  AMONG VENDORS NONE ARE INCLUDED HERE. AT THE BOTTOM
*  OF THIS LIBRARY FILE YOU WILL FIND A COMPONENT LEVEL
*  FREQUENCY DIVIDER SUBCIRCUIT (FDIV) WILL WORK WITH
*  ALL SIMULATORS. IT WORKS AT FIVE VOLTS (PROVIDE 5V
*  AND GROUND ON THE SUPPLIES OF FDIV) AND CAN PROVIDE
*  FREQUENCY DIVISION BY 2 TO GO BETWEEN YOUR EXTERNAL
*  SYNCH SIGNAL AND THE CLOCK INPUT OF THE PWM MODEL.
*  BECAUSE FDIV IS COMPONENT LEVEL IT IS SLOW AND WILL
*  EXTEND THE EXECUTION TIME BY AS MUCH AS 2 TO 1.
*
*  A GOOD WAY TO TEST SIMULATION ACCURACY IS TO FIX THE
*  PWM SIGNAL INPUT TO A FIXED VOLTAGE THAT IS EQUIVALENT
*  TO HALFWAY BETWEEN 50-50 DUTY FACTOR AND 100 PERCENT
*  DUTY FACTOR. RUN A SIMULATION THAT HAS TIME FOR OUTPUT
*  FILTER SETTLING. IF THE OUTPUT VOLTAGE WANDERS AROUND
*  RATHER THAN STAYS SETTLED TO LESS THAN ONE PERCENT YOU
*  SHOULD REDUCE THE TIMESTEP MAX (TMAX) PARAMETER IN THE
*  TRAN LINE. THIS IS THE FOURTH TIME PARAMETER ON THAT
*  LINE AND IS OPTIONAL LIKE THE TSTART PARAMETER (THIRD
*  TIME PARAMETER ON THAT LINE). IF YOU ARE NOT USING
*  TSTART YOU MUST SET IT TO ZERO SO THE SIMULATOR WILL
*  RECOGNIZE TMAX AS TMAX RATHER THAN TSTART. FOR BERKELEY
*  SPICE 3 TMAX WILL USUALLY BE IN THE 500 TO 150 NS RANGE.
*  FOR PSPICE TMAX WILL USUALLY BE IN THE 250 TO 50 NS
*  RANGE.
*
*  BECAUSE THE SPICE OUTPUT DATA IS A SAMPLED SYSTEM,
*  ALIASING CAN TAKE PLACE. IF THE WAVEFORM YOU ARE
*  LOOKING AT IS REPETATIVE BUT SEEMS TO HAVE INADEQUATE
*  P-P AMPLITUDE, YOU MAY WANT TO SAMPLE THE DATA MORE
*  OFTEN OR CHANGE THE RATIONALITY BETWEEN THE PWM CLOCK
*  PERIOD AND YOUR SAMPLING PERIOD.
*
*  IF YOUR SIMULATION CANNOT GET PAST INITIAL CONVERGANCE
*  FOR THE TRANSIENT ANALYSIS, RAMP VCC AND VS UP FROM
*  ZERO VOLTS TO NORMAL IN THE FIRST 10 MICROSECONDS OR SO.
*  THIS WILL NOT ONLY HELP THE TRAN ANALYSIS GET STARTED
*  BUT WILL ALLOW YOU TO SEE THE INITIAL VOLTAGES AND
*  CURRENTS FOR LATER SETTING OF NODESETS. LOOK FOR
*  OUTPUT FILTER INDUCTOR CURRENTS AND CAPACITOR VOLTAGES
*  TO ALLOW SETTING UP INITIAL CONDITIONS ON THOSE PARTS.
*  SETTING INITIAL CONDITIONS CAN ALLOW YOUR OUTPUT FILTER
*  TO GET TO OPERATING CONDITIONS MORE QUICKLY. DON'T
*  FORGET TO USE THE UIC OPTION IN THE TRAN LINE TO FORCE
*  USE OF INITIAL CONDITIONS.
*
*  BECAUSE THIS MODEL MUST BE CAPABLE OF RUNNING AT ANY
*  CLOCK RATE UP TO THE SPECIFICATION, THE MODEL MEASURES
*  THE CLOCK FREQUENCY AND FILTERS THE ANALOG RESULT AND
*  USES IT AS PART OF THE MODELING THAT CREATES THE
*  FREQUENCY DEPENDENT PART OF IQ(VSS). THE FILTER HAS A
*  TIME CONSTANT OF 300 USEC. DURING SHUTDOWN THE IQ(VSS)
*  IS SET TO A LOWER VALUE VIA THIS TIME CONSTANT AND
*  IQ(VCC) IS SET TO A LOWER VALUE WITH NO TIME CONSTANT.
*
*BEGIN MODEL SA16 FOR PSPICE
*PINOUT ORDER CKIN CKOUT +PWM -PWM SGND SHTDN PGND  OUT +VS VCC
*PINOUT ORDER   1    2     3    4    5    6     7    8   9   10
.SUBCKT SA16_AM 1 2 3 4 5 6 7 8 9 10
V7 44 5 0 PULSE 0 5 0 10N 10N 22.22U 44.44U
RE2 41 5 1E9
E1 14 5 23 4 1
D5 7 8 D1M
R13 27 5 10
R42 5 14 1E9
R39 67 63 10E3
C17 63 5 28E-12
R46 27 13 10E3
C18 13 5 28E-12
R1 40 8 R1M 0.59
R3 64 7 R1M 0.59
D4 13 27 D2M
D8 63 67 D2M
R14 32 23 1E3
R37 23 27 143E9
E4 32 5 68 5 1
E3 5 31 41 27 -1
R43 44 2 100
C22 2 5 10E-12
V2 41 5 4.5
D1 8 9 D1M
E9 16 5 65 25 1000
V9 28 5 0.1
C4 9 34 120E-12
C6 8 35 120E-12
R10 34 8 1.4
R12 35 7 1.4
S5 61 27 14 5 S5M
C19 66 5 1000E-12
C20 29 5 2000E-12
R15 26 29 10
E13 43 5 42 38 1
R16 43 30 300
C21 30 5 1E-6
R45 30 5 1E9
C10 65 5 1000E-12
R21 65 6 1E3
D2 46 47 DN
D3 48 46 DN
R22 46 16 1E3
V10 48 5 0.8
V11 47 0 4.1
R23 28 25 1E3
R24 57 25 1E6
R25 57 50 1E3
R26 59 50 1E3
R27 52 25 100E3
R19 60 5 1
C8 57 52 5E-12
V13 56 5 5
V8 22 5 2.5
Q1 57 53 5 QFN
Q2 57 54 5 QFN
Q3 59 55 5 QFN
Q4 59 51 5 QFN
R28 53 46 50E3
R29 54 59 50E3
R30 55 49 50E3
R31 51 57 50E3
C9 53 5 1E-12
C11 51 5 1E-12
C12 55 5 1E-12
C13 54 5 1E-12
R33 58 4 55E3
C15 4 5 470E-12
M1 49 62 5 5 M1M
M2 49 62 50 50 M2M
R34 62 1 50
C16 62 5 5E-12
E10 58 5 49 0 2
V12 50 5 5
R35 61 5 1E9
S7 26 42 22 13 S7M
S8 26 60 13 22 S7M
R36 68 5 10E6
R38 38 42 1
V4 38 5 10
G1 5 10 30 5 0.36
R40 10 69 500
S10 69 5 57 5 S1M
I2 10 5 0.05
GQ1 5 9 VALUE = {(-0.045)*((0.55+(V(9)/625))*(0.1+V(30)*(-2000)))}
R49 65 5 10E6
R51 66 68 50
R52 3 66 50
R53 67 5 10
VD1 9 71 0
VD3 8 73 0
S1 71 40 63 5 S1M
S3 73 64 13 5 S1M
S6 67 31 57 5 S6M
S9 56 61 57 5 S1M
.MODEL R1M RES (TC1=7.374E-3 TC2=2.598E-5)
.MODEL QFN NPN (BF=100 NE=1.5 EG=1.11
+ IS=1.5E-15 NC=1.7 FC=0.5 CJC=1E-12)
.MODEL M1M NMOS (CBD=17E-12 CBS=17E-12 CGBO=26E-9
+ CGDO=18E-9 CGSO=20E-9 IS=31E-15 KP=4.3E-3 RD=50
+ RS=50 VTO=2.25)
.MODEL M2M PMOS (CBD=17E-12 CBS=17E-12 CGBO=26E-9
+ CGDO=18E-9 CGSO=20E-9 IS=31E-15 KP=4.3E-3 RD=50
+ RS=50 VTO=-2.25)
.MODEL S1M VSWITCH RON=0.01 ROFF=1E6 VON=2.55 VOFF=2.0
.MODEL S5M VSWITCH RON=1 ROFF=1E3 VON=0.001 VOFF=0
.MODEL S6M VSWITCH RON=0.1 ROFF=1E4 VON=2.91 VOFF=2.5
.MODEL S7M VSWITCH RON=1 ROFF=1E5 VON=0.1 VOFF=0
.MODEL D1M D (IS=4.118E-12 M=0.333 N=1.00 RS=0.0608 VJ=0.75)
.MODEL D2M D (IS=1.68E-08 M=0.333 N=1.89 RS=0.452 VJ=0.75)
.MODEL DN D (BV=100 CJO=4E-12 IS=7E-09 M=0.45 N=2 RS=0.8 TT=6E-9 VJ=0.6)
.ENDS
*END OF MODEL SA16
*************
*     SA16TOOL STATE AVERAGE PWM MODEL FEATURES INCLUDE:
* 1 AVERAGE VALUE, TIME AND FREQUENCY DOMAIN PERFORMANCE
* 2 OUTPUT RESISTANCE FOR 100 DEGREE C JUNCTIONS
* 3 CURRENT SENSE PIN OUTPUTS
* 4 VS LOADING DUE TO OUTPUT CURRENT ONLY
* 5 SYMBOL COMPATABILITY WITH THE PULSE BY PULSE MODEL
* 6 PIN NUMBERS CORRESPOND TO THE HARDWARE
* 7 A FLAG OUTPUT SHOWS INPUT VOLTAGE OUTSIDE THE MODULATION RANGE
*
* WITH NO SWITCHING, THIS MODEL RUNS MANY TIMES FASTER THAN THE PULSE
* BY PULSE MODEL AND IT CAN RUN AN AC SWEEP, MAKING SIMULATION OF
* FEEDBACK LOOPS QUICK (RAISE OR ELIMINATE STEP CEILING).  
*
* BEWARE: LACK OF SWITCHING ELIMINATES SOME DISTORTION ELEMENTS FOUND
* IN THE PULSE BY PULSE MODEL AND THE HARDWARE. ALSO, LACK OF DEAD
* TIME ALLOWS LINEAR OPERATION ALL THE WAY TO 0 OR 100% MODULATION, 
* WHICH IS NOT POSSIBLE WITH THE HARDWARE.
* 
* THE ILIM/SHDN FUNCTION IS NOT MODELED.
*
*BEGIN MODEL SA16TOOL FOR PSPICE.
*PINS CLKIN CLKOUT +PWM -PWM SIGGND SHDN PWRGND OUT VS VCC 
*PINS   1      2     3    4     5     6     7    8   9  10  
.SUBCKT SA16TOOL_AM 1 2 3 4 5 6 7 8 9 10 
* R110 & C110 DUPLICATE HARDWARE
R110 3 127 50
C110 127 0 .01U
* SET UP HIGH, LOW AND P-P RAMP VALUES
E124 124 0 123 125 1 
V123 123 0 7 
V125 125 0 3 
* S123 & S125 LIMIT MODULATOR DRIVE TO 0/100%
S123 129 123 127 123 SM1 
S125 125 129 125 127 SM1 
R129 127 129 10K 
.MODEL SM1 VSWITCH (RON=1 ROFF=100MEG VON=.001 VOFF=-.001)
* E119 SHOWS ONLY INTEGRATOR VOLTAGE OUTSIDE MODULATION RANGE
E119 128 0 129 127 -1 
R128 128 6 10 
R6 3 0 1meg 
* 130 SERIES PARTS ARE THE NON-INVERTING OUT, 140 ARE INVERTING
* E130 & E140 GIVE MODULATION VOLTAGES; 0=0 OUT, VP-P=VS OUT
E130 130 0 129 125 1 
E140 140 0 123 129 1 
* E141 GENERATES OUTPUT; V(MODULATE)*PWM GAIN [VS/VP-P]
E141 141 0 VALUE={V(140)*V(9)/V(124)} 
* R142 SETS ZOUT (ABOUT 100DEGREES C) AND MEASURE IOUT
R142 141 8 .735
* E142 SENSES OUTPUT CURRENT & MULTIPLY BY FRACTION OF MODULATION
* FRACTION IS 1 @ VOUT=0 AND 0 @ VOUT=VS
E142 145 0 VALUE={(V(141)-V(8))*V(130)/V(124)} 
* G145 REFLECTS OUTPUT CURRENT INTO VSENSE PINS
G145 212 0 145 0 1.361
V145 212 7 0 
* F145 REFLECTS CURRENT INTO VS PIN
F145 9 0 V145 -1 
* 
R1 1 0 1meg 
R2 2 0 1meg 
R4 4 0 1meg 
R5 5 0 1meg 
* CATCH DIODES-FILTER/LOAD PHASE SHIFT CAN MAKE CURRENT FLOW BACKWARDS
D140 8 9 D1M 
D141 0 8 D1M 
.MODEL D1M D (IS=2.832E-12 M=0.333 N=1.00 RS=0.043 VJ=0.75)
*
D120 127 10 D1N4148 
D121 0 127 D1N4148
.MODEL D1N4148  D(IS=0.1P RS=16 CJO=2P TT=12N BV=100 IBV=0.1P)  
.ENDS
*END OF MODEL SA16TOOL
**********
*       SA18 PWM MODEL FEATURES INCLUDE:
*
*   1 PULSE BY PULSE TIME DOMAIN PERFORMANCE
*   2 OUTPUT RESISTANCE AND CAPACITANCE
*   3 ACCURATE CATCH DIODE I V CHARACTERISTIC
*   4 ACCURATE RON AND VON
*   5 INCREASING IQ ON THE VS SUPPLY VS FREQUENCY
*   6 DEADTIME BETWEEN SWITCH ON TIMES
*   7 ACCURATE IQ ON THE VCC LINE
*   8 REDUCTION IN IQ VCC IN SHUTDOWN
*   9 INTERNAL CMOS BUFFER ON THE CLK IN PIN
*  10 ILIM / SHUTDOWN FUNCTIONS
*
*     NOTE: THERMAL SHUTDOWN IS NOT MODELED
*     NOTE: HIGH SIDE CURRENT LIMIT IS NOT MODELED
*
*       SOME NOTES ON USING SPICE FOR PWM SIMULATION
*
*  REQUIRES BERKELEY SPICE 3E.3P OR LATER. YOUR SIMULATOR
*  MUST SUPPORT THE BERKELEY STANDARD VOLTAGE CONTROLLED
*  SWITCH ELEMENT (S)
*  OR
*  REQUIRES PSPICE 4.04 OR LATER
*
*  BE PREPARED FOR LONG SIMULATIONS
*
*  NOTE: BERKELEY SIMULATORS TYPICALLY RUN THESE
*  PWM MODELS ABOUT TWO TO FOUR TIMES FASTER THAN
*  PSPICE TYPE SIMULATORS AS THE BERKELEY SWITCH
*  ELEMENT DOES NOT INVOKE AS BIG A COMPUTATIONAL
*  BURDEN
*
*  IF YOUR SIMULATION STOPS DUE TO "TIMESTEP TOO SMALL"
*  ERRORS YOU MAY WANT TO INCREASE ITL4 TO 100, INCREASE
*  RELTOL TO 0.003 TO 0.01, INCREASE ABSTOL TO 1E-11 TO
*  1E-9, INCREASE GMIN TO 1E-11 TO 1E-7, INCREASE VNTOL
*  TO 1E-5 TO 1E-4, OR INCREASE CHGTOL TO 1E-11 TO 1E-9.
*  ANY OR ALL OF THESE SIMULATOR OPTIONS MAY BE REQUIRED
*  DEPENDING ON YOUR SIMULATOR. NEWER SIMULATORS USUALLY
*  REQUIRE FEWER OF THEM.
*
*  TO AID THE INITIAL TRANSIENT CONVERGANCE, SET UP THE
*  INITIAL VALUE OF CLOCK IN AS FOLLOWS:
*        IF PWM IN > 5V, CLOCK IN INITIAL = 5 VOLTS
*        IF PWM IN < 5V, CLOCK IN INITIAL = 0 VOLTS
*
*  TO AID THE INITIAL DC CONVERGANCE SET ITL1 TO 500.
*
*  THE CLOCK IS A GENERATOR STATEMENT INSIDE THE MODEL.
*  WHERE THE REAL PART HAS AN OSCILLATOR FOLLOWED BY A
*  DIGITAL DIVIDE BY TWO, THE MODEL HAS THE GENERATOR
*  AT HALF OF THE CLOCK FREQUENCY. IF YOU NEED TO SYNCH-
*  RONIZE THE PWM CLOCK TO AN EXTERNAL SOURCE, LOOK IN
*  YOUR SIMULATOR LIBRARY FOR A SIMPLE FAST RUNNING
*  BEHAVIORAL FREQUENCY DIVIDER OR DFLOP. BECAUSE THE
*  EXTENTIONS THAT ALLOW BEHAVIORAL MODELS VARY WIDELY
*  AMONG VENDORS NONE ARE INCLUDED HERE. AT THE BOTTOM
*  OF THIS LIBRARY FILE YOU WILL FIND A COMPONENT LEVEL
*  FREQUENCY DIVIDER SUBCIRCUIT (FDIV) WILL WORK WITH
*  ALL SIMULATORS. IT WORKS AT FIVE VOLTS (PROVIDE 5V
*  AND GROUND ON THE SUPPLIES OF FDIV) AND CAN PROVIDE
*  FREQUENCY DIVISION BY 2 TO GO BETWEEN YOUR EXTERNAL
*  SYNCH SIGNAL AND THE CLOCK INPUT OF THE PWM MODEL.
*  BECAUSE FDIV IS COMPONENT LEVEL IT IS SLOW AND WILL
*  EXTEND THE EXECUTION TIME BY AS MUCH AS 2 TO 1.
*
*  A GOOD WAY TO TEST SIMULATION ACCURACY IS TO FIX THE
*  PWM SIGNAL INPUT TO A FIXED VOLTAGE THAT IS EQUIVALENT
*  TO HALFWAY BETWEEN 50-50 DUTY FACTOR AND 100 PERCENT
*  DUTY FACTOR. RUN A SIMULATION THAT HAS TIME FOR OUTPUT
*  FILTER SETTLING. IF THE OUTPUT VOLTAGE WANDERS AROUND
*  RATHER THAN STAYS SETTLED TO LESS THAN ONE PERCENT YOU
*  SHOULD REDUCE THE TIMESTEP MAX (TMAX) PARAMETER IN THE
*  TRAN LINE. THIS IS THE FOURTH TIME PARAMETER ON THAT
*  LINE AND IS OPTIONAL LIKE THE TSTART PARAMETER (THIRD
*  TIME PARAMETER ON THAT LINE). IF YOU ARE NOT USING
*  TSTART YOU MUST SET IT TO ZERO SO THE SIMULATOR WILL
*  RECOGNIZE TMAX AS TMAX RATHER THAN TSTART. FOR BERKELEY
*  SPICE 3 TMAX WILL USUALLY BE IN THE 500 TO 150 NS RANGE.
*  FOR PSPICE TMAX WILL USUALLY BE IN THE 250 TO 50 NS
*  RANGE.
*
*  BECAUSE THE SPICE OUTPUT DATA IS A SAMPLED SYSTEM,
*  ALIASING CAN TAKE PLACE. IF THE WAVEFORM YOU ARE
*  LOOKING AT IS REPETATIVE BUT SEEMS TO HAVE INADEQUATE
*  P-P AMPLITUDE, YOU MAY WANT TO SAMPLE THE DATA MORE
*  OFTEN OR CHANGE THE RATIONALITY BETWEEN THE PWM CLOCK
*  PERIOD AND YOUR SAMPLING PERIOD.
*
*  IF YOUR SIMULATION CANNOT GET PAST INITIAL CONVERGANCE
*  FOR THE TRANSIENT ANALYSIS, RAMP VCC AND VS UP FROM
*  ZERO VOLTS TO NORMAL IN THE FIRST 10 MICROSECONDS OR SO.
*  THIS WILL NOT ONLY HELP THE TRAN ANALYSIS GET STARTED
*  BUT WILL ALLOW YOU TO SEE THE INITIAL VOLTAGES AND
*  CURRENTS FOR LATER SETTING OF NODESETS. LOOK FOR
*  OUTPUT FILTER INDUCTOR CURRENTS AND CAPACITOR VOLTAGES
*  TO ALLOW SETTING UP INITIAL CONDITIONS ON THOSE PARTS.
*  SETTING INITIAL CONDITIONS CAN ALLOW YOUR OUTPUT FILTER
*  TO GET TO OPERATING CONDITIONS MORE QUICKLY. DON'T
*  FORGET TO USE THE UIC OPTION IN THE TRAN LINE TO FORCE
*  USE OF INITIAL CONDITIONS.
*
*  BECAUSE THIS MODEL MUST BE CAPABLE OF RUNNING AT ANY
*  CLOCK RATE UP TO THE SPECIFICATION, THE MODEL MEASURES
*  THE CLOCK FREQUENCY AND FILTERS THE ANALOG RESULT AND
*  USES IT AS PART OF THE MODELING THAT CREATES THE
*  FREQUENCY DEPENDENT PART OF IQ(VSS). THE FILTER HAS A
*  TIME CONSTANT OF 300 USEC. DURING SHUTDOWN THE IQ(VSS)
*  IS SET TO A LOWER VALUE VIA THIS TIME CONSTANT AND
*  IQ(VCC) IS SET TO A LOWER VALUE WITH NO TIME CONSTANT.
*
*BEGIN MODEL SA18 FOR PSPICE
*PINOUT ORDER CKIN CKOUT PWM SGND SHTDN PGND  OUT +VS VCC
*PINOUT         1    2    3    5    6     7    8   9   10
.SUBCKT SA18_AM 1 2 3 5 6 7 8 9 10
V7 44 5 0 PULSE 0 5 0 10N 10N 22.22U 44.44U
RE2 41 5 1E9
E1 14 5 23 15 1
D5 7 8 D1M
R13 27 5 10
R42 5 14 1E9
R39 67 63 10E3
C17 63 5 28E-12
R46 27 13 10E3
C18 13 5 28E-12
R1 40 8 0.085
R3 64 7 0.085
D4 13 27 D2M
D8 63 67 D2M
R14 32 23 1E3
R37 23 27 143E9
E4 32 5 68 5 1
E3 5 31 41 27 -1
R43 44 2 100
C22 2 5 10E-12
V2 41 5 4.5
D1 8 9 D1M
E9 16 5 65 25 1000
V9 28 5 0.1
C4 9 34 300E-12
C6 8 35 300E-12
R10 34 8 0.7
R12 35 7 0.7
S5 61 27 14 5 S5M
C19 66 5 1000E-12
C20 29 5 2000E-12
R15 26 29 10
E13 43 5 42 38 1
R16 43 30 300
C21 30 5 1E-6
R45 30 5 1E9
C10 65 5 1000E-12
R21 65 6 1E3
D2 46 47 DN
D3 48 46 DN
R22 46 16 1E3
V10 48 5 0.8
V11 47 0 4.1
R23 28 25 1E3
R24 57 25 1E6
R25 57 50 1E3
R26 59 50 1E3
R27 52 25 100E3
R19 60 5 1
C8 57 52 5E-12
V13 56 5 5
V8 22 5 2.5
Q1 57 53 5 QFN
Q2 57 54 5 QFN
Q3 59 55 5 QFN
Q4 59 51 5 QFN
R28 53 46 50E3
R29 54 59 50E3
R30 55 49 50E3
R31 51 57 50E3
C9 53 5 1E-12
C11 51 5 1E-12
C12 55 5 1E-12
C13 54 5 1E-12
R33 58 15 55E3
C15 15 5 470E-12
M1 49 62 5 5 M1M
M2 49 62 50 50 M2M
R34 62 1 50
C16 62 5 5E-12
E10 58 5 49 0 2
V12 50 5 5
R35 61 5 1E9
S7 26 42 22 13 S7M
S8 26 60 13 22 S7M
R36 68 5 10E6
R38 38 42 1
V4 38 5 10
G1 5 10 30 5 0.36
R40 10 69 500
S10 69 5 57 5 S1M
I2 10 5 0.05
GQ1 5 9 VALUE = {(-0.045)*((0.6+(V(9)/600))*(0.45+V(30)*(-1000)))}
R49 65 5 10E6
R51 66 68 50
R52 3 66 50
R53 67 5 10
VD1 9 71 0.85
VD3 8 73 0.85
S1 71 40 63 5 S1M
S3 73 64 13 5 S1M
S6 67 31 57 5 S6M
S9 56 61 57 5 S1M
.MODEL QFN NPN (BF=100 NE=1.5 EG=1.11
+ IS=1.5E-15 NC=1.7 FC=0.5 CJC=1E-12)
.MODEL M1M NMOS (CBD=17E-12 CBS=17E-12 CGBO=26E-9
+ CGDO=18E-9 CGSO=20E-9 IS=31E-15 KP=4.3E-3 RD=50
+ RS=50 VTO=2.25)
.MODEL M2M PMOS (CBD=17E-12 CBS=17E-12 CGBO=26E-9
+ CGDO=18E-9 CGSO=20E-9 IS=31E-15 KP=4.3E-3 RD=50
+ RS=50 VTO=-2.25)
.MODEL S1M VSWITCH RON=0.01 ROFF=1E6 VON=2.55 VOFF=2.0
.MODEL S5M VSWITCH RON=1 ROFF=1E3 VON=0.001 VOFF=0
.MODEL S6M VSWITCH RON=0.1 ROFF=1E4 VON=2.91 VOFF=2.5
.MODEL S7M VSWITCH RON=1 ROFF=1E5 VON=0.1 VOFF=0
.MODEL D1M D (IS=2.645E-15 M=0.333 N=1.00 RS=0.086 VJ=0.75)
.MODEL D2M D (IS=1.68E-08 M=0.333 N=1.89 RS=0.452 VJ=0.75)
.MODEL DN D (BV=100 CJO=4E-12 IS=7E-09 M=0.45 N=2 RS=0.8 TT=6E-9 VJ=0.6)
.ENDS
*END OF MODEL SA18
*************
*     SA18TOOL STATE AVERAGE PWM MODEL FEATURES INCLUDE:
* 1 AVERAGE VALUE, TIME AND FREQUENCY DOMAIN PERFORMANCE
* 2 OUTPUT RESISTANCE FOR 100 DEGREE C JUNCTIONS
* 3 CURRENT SENSE PIN OUTPUTS
* 4 VS LOADING DUE TO OUTPUT CURRENT ONLY
* 5 SYMBOL COMPATABILITY WITH THE PULSE BY PULSE MODEL
* 6 PIN NUMBERS CORRESPOND TO THE HARDWARE
* 7 A FLAG OUTPUT SHOWS INPUT VOLTAGE OUTSIDE THE MODULATION RANGE
*
* WITH NO SWITCHING, THIS MODEL RUNS MANY TIMES FASTER THAN THE PULSE
* BY PULSE MODEL AND IT CAN RUN AN AC SWEEP, MAKING SIMULATION OF
* FEEDBACK LOOPS QUICK (RAISE OR ELIMINATE STEP CEILING).  
*
* BEWARE: LACK OF SWITCHING ELIMINATES SOME DISTORTION ELEMENTS FOUND
* IN THE PULSE BY PULSE MODEL AND THE HARDWARE. ALSO, LACK OF DEAD
* TIME ALLOWS LINEAR OPERATION ALL THE WAY TO 0 OR 100% MODULATION, 
* WHICH IS NOT POSSIBLE WITH THE HARDWARE.
* 
* THE ILIM/SHDN FUNCTION IS NOT MODELED.
*
*BEGIN MODEL SA18TOOL FOR PSPICE.
*PINS CLKIN CLKOUT +PWM SIGGND SHDN PWRGND OUT VS VCC 
*PINS   1      2     3     5     6     7    8   9  10  
.SUBCKT SA18TOOL_AM 1 2 3 5 6 7 8 9 10 
* R110 & C110 DUPLICATE HARDWARE
R110 3 127 50
C110 127 0 .01U
* SET UP HIGH, LOW AND P-P RAMP VALUES
E124 124 0 123 125 1 
V123 123 0 7 
V125 125 0 3 
* S123 & S125 LIMIT MODULATOR DRIVE TO 0/100%
S123 129 123 127 123 SM1 
S125 125 129 125 127 SM1 
R129 127 129 10K 
.MODEL SM1 VSWITCH (RON=1 ROFF=100MEG VON=.001 VOFF=-.001)
* E119 SHOWS ONLY INTEGRATOR VOLTAGE OUTSIDE MODULATION RANGE
E119 128 0 129 127 -1 
R128 128 6 10 
R6 3 0 1meg 
* 130 SERIES PARTS ARE THE NON-INVERTING OUT, 140 ARE INVERTING
* E130 & E140 GIVE MODULATION VOLTAGES; 0=0 OUT, VP-P=VS OUT
E130 130 0 129 125 1 
E140 140 0 123 129 1 
* E141 GENERATES OUTPUT; V(MODULATE)*PWM GAIN [VS/VP-P]
E141 141 0 VALUE={V(140)*V(9)/V(124)} 
* R142 SETS ZOUT (ABOUT 100DEGREES C) AND MEASURE IOUT
R142 141 8 .1375 
* E142 SENSES OUTPUT CURRENT & MULTIPLY BY FRACTION OF MODULATION
* FRACTION IS 1 @ VOUT=0 AND 0 @ VOUT=VS
E142 145 0 VALUE={(V(141)-V(8))*V(130)/V(124)} 
* G145 REFLECTS OUTPUT CURRENT INTO VSENSE PINS
G145 212 0 145 0 7.273
V145 212 7 0 
* F145 REFLECTS CURRENT INTO VS PIN
F145 9 0 V145 -1 
* 
R1 1 0 1meg 
R2 2 0 1meg 
R5 5 0 1meg 
* CATCH DIODES-FILTER/LOAD PHASE SHIFT CAN MAKE CURRENT FLOW BACKWARDS
D140 8 9 D1M 
D141 0 8 D1M 
.MODEL D1M D (IS=2.832E-12 M=0.333 N=1.00 RS=0.043 VJ=0.75)
*
D120 127 10 D1N4148 
D121 0 127 D1N4148
.MODEL D1N4148  D(IS=0.1P RS=16 CJO=2P TT=12N BV=100 IBV=0.1P)  
.ENDS
*END OF MODEL SA18TOOL
**********
*       SA50 PWM MODEL FEATURES INCLUDE:
*
*  1 PULSE BY PULSE TIME DOMAIN PERFORMANCE
*  2 OUTPUT RESISTANCE AND CAPACITANCE
*  3 ACCURATE RON TEMPERATURE COEFFICIENT
*  4 INCREASING IQ ON THE VS SUPPLY VS FREQUENCY
*  5 DEADTIME BETWEEN SWITCH ON TIMES
*  6 ACCURATE IQ ON THE VCC LINE
*
*
*       SOME NOTES ON USING SPICE FOR PWM SIMULATION
*
*  REQUIRES BERKELEY SPICE 3E.3P OR LATER. YOUR SIMULATOR
*  MUST SUPPORT THE BERKELEY STANDARD VOLTAGE CONTROLLED
*  SWITCH ELEMENT (S)
*  OR
*  REQUIRES PSPICE 4.04 OR LATER
*
*  BE PREPARED FOR LONG SIMULATIONS
*
*  NOTE: BERKELEY SIMULATORS TYPICALLY RUN THESE
*  PWM MODELS ABOUT TWO TO FOUR TIMES FASTER THAN
*  PSPICE TYPE SIMULATORS AS THE BERKELEY SWITCH
*  ELEMENT DOES NOT INVOKE AS BIG A COMPUTATIONAL
*  BURDEN
*
*  IF YOUR SIMULATION STOPS DUE TO "TIMESTEP TOO SMALL"
*  ERRORS YOU MAY WANT TO INCREASE ITL4 TO 100, INCREASE
*  RELTOL TO 0.003 TO 0.01, INCREASE ABSTOL TO 1E-11 TO
*  1E-9, INCREASE GMIN TO 1E-11 TO 1E-7, INCREASE VNTOL
*  TO 1E-5 TO 1E-4, OR INCREASE CHGTOL TO 1E-11 TO 1E-9.
*  ANY OR ALL OF THESE SIMULATOR OPTIONS MAY BE REQUIRED
*  DEPENDING ON YOUR SIMULATOR. NEWER SIMULATORS USUALLY
*  REQUIRE FEWER OF THEM.
*
*  INITIAL CONVERGANCE CAN BE AFFECTED BY WHETHER THE
*  PWM INPUT IS ABOVE OR BELOW THE HALFWAY VOLTAGE.
*
*  TO AID THE INITIAL DC CONVERGANCE SET ITL1 TO 500.
*
*  A GOOD WAY TO TEST SIMULATION ACCURACY IS TO FIX THE
*  PWM SIGNAL INPUT TO A FIXED VOLTAGE THAT IS EQUIVALENT
*  TO HALFWAY BETWEEN 50-50 DUTY FACTOR AND 100 PERCENT
*  DUTY FACTOR. RUN A SIMULATION THAT HAS TIME FOR OUTPUT
*  FILTER SETTLING. IF THE OUTPUT VOLTAGE WANDERS AROUND
*  RATHER THAN STAYS SETTLED TO LESS THAN ONE PERCENT YOU
*  SHOULD REDUCE THE TIMESTEP MAX (TMAX) PARAMETER IN THE
*  TRAN LINE. THIS IS THE FOURTH TIME PARAMETER ON THAT
*  LINE AND IS OPTIONAL LIKE THE TSTART PARAMETER (THIRD
*  TIME PARAMETER ON THAT LINE). IF YOU ARE NOT USING
*  TSTART YOU MUST SET IT TO ZERO SO THE SIMULATOR WILL
*  RECOGNIZE TMAX AS TMAX RATHER THAN TSTART. FOR BERKELEY
*  SPICE 3 TMAX WILL USUALLY BE IN THE 500 TO 150 NS RANGE.
*  FOR PSPICE TMAX WILL USUALLY BE IN THE 250 TO 50 NS
*  RANGE.
*
*  BECAUSE THE SPICE OUTPUT DATA IS A SAMPLED SYSTEM,
*  ALIASING CAN TAKE PLACE. IF THE WAVEFORM YOU ARE
*  LOOKING AT IS REPETATIVE BUT SEEMS TO HAVE INADEQUATE
*  P-P AMPLITUDE, YOU MAY WANT TO SAMPLE THE DATA MORE
*  OFTEN OR CHANGE THE RATIONALITY BETWEEN THE PWM CLOCK
*  PERIOD AND YOUR SAMPLING PERIOD.
*
*  IF YOUR SIMULATION CANNOT GET PAST INITIAL CONVERGANCE
*  FOR THE TRANSIENT ANALYSIS, RAMP VCC AND VS UP FROM
*  ZERO VOLTS TO NORMAL IN THE FIRST 10 MICROSECONDS OR SO.
*  THIS WILL NOT ONLY HELP THE TRAN ANALYSIS GET STARTED
*  BUT WILL ALLOW YOU TO SEE THE INITIAL VOLTAGES AND
*  CURRENTS FOR LATER SETTING OF NODESETS. LOOK FOR
*  OUTPUT FILTER INDUCTOR CURRENTS AND CAPACITOR VOLTAGES
*  TO ALLOW SETTING UP INITIAL CONDITIONS ON THOSE PARTS.
*  SETTING INITIAL CONDITIONS CAN ALLOW YOUR OUTPUT FILTER
*  TO GET TO OPERATING CONDITIONS MORE QUICKLY. DON'T
*  FORGET TO USE THE UIC OPTION IN THE TRAN LINE TO FORCE
*  USE OF INITIAL CONDITIONS.
*
*BEGIN MODEL SA50 FOR PSPICE
*PINOUT ORDER IS RSB BOUT +VS AOUT RSA VCC GND IN
*PINOUT           1    2   3    4   5   6   7   8
.SUBCKT SA50_AM 1 2 3 4 5 6 7 8
V1 23 7 0 PULSE 0 1 100N 10N 10N 11.395U 22.222U
E1 14 7 15 24 1
RE2 26 7 1E9
E3 30 7 8 7 1
D5 5 4 D1M
S1 3 45 59 7 SM1
S2 3 9 22 7 SM1
S3 4 47 59 7 SM1
S4 2 21 22 7 SM1
R1 9 4 R1M 0.25
R2 45 2 R1M 0.25
R3 47 5 R1M 0.25
R4 21 1 R1M 0.25
S5 16 13 14 7 SM5
R25 29 7 1
S7 50 42 32 22 SM7
V2 31 7 10
S8 50 29 22 32 SM8
R13 23 7 1E9
R14 7 12 1E9
EQ1 48 7 VALUE = {V(12)*V(23)}
V8 32 7 2.5
R36 30 15 1E3
I1 3 7 0.011
D1 4 3 D1M
R5 48 24 51.575E3
D6 1 2 D1M
D7 2 3 D1M
I2 6 7 0.0026
C4 3 34 75E-12
C5 3 37 75E-12
C6 4 35 75E-12
C7 2 33 75E-12
C8 24 7 317.4E-12
R10 34 4 2.8
R12 35 5 2.8
R18 37 2 2.8
R20 33 1 2.8
R37 15 13 143E9
C15 8 7 10E-12
E2 7 28 26 13 -1
V11 26 7 4.5
D4 19 48 D4M
R15 19 24 981.427E3
R16 48 24 50E12
R39 28 59 10E3
Q1 8 25 12 QPU
C10 51 7 2000E-12
R27 50 51 10
I4 25 12 10E-9
R17 8 7 10E6
R19 13 7 10
R28 31 42 1
V13 16 7 5
E13 53 7 42 31 1
R29 53 54 300
C11 54 7 1E-6
G2 7 3 54 7 14
E14 12 7 6 7 1
R42 7 14 1E9
R30 3 7 6700
R31 6 7 1795
R45 54 7 1E9
C13 59 7 23.3E-12
R46 13 22 10E3
C14 22 7 23.3E-12
D2 22 13 D2M
R35 16 7 1E9
D3 59 28 D2M
.MODEL R1M RES (TC1=7.374E-3 TC2=2.598E-5)
.MODEL QPU PNP (BF=100 NE=1.5 EG=1.11
+ IS=1.5E-15 NC=1.7 FC=0.5 CJC=1E-12)
.MODEL SM1 VSWITCH RON=0.01 ROFF=1E6 VON=2.55 VOFF=2.0
.MODEL SM5 VSWITCH RON=1 ROFF=1E3 VON=0.001 VOFF=0
.MODEL SM7 VSWITCH RON=1 ROFF=1E5 VON=0.1 VOFF=0
.MODEL SM8 VSWITCH RON=1 ROFF=1E5 VON=0.1 VOFF=0
.MODEL D1M D (IS=4.5E-14 M=0.333 N=1.00 RS=0.112 VJ=0.75)
.MODEL D4M D (CJO=1E-12 IS=1.68E-08 M=0.333 N=1.89 RS=0.452 VJ=0.75)
.MODEL D2M D (IS=1.68E-08 M=0.333 N=1.89 RS=0.452 VJ=0.75)
.ENDS
*END OF MODEL SA50
*************
*     SA50TOOL STATE AVERAGE PWM MODEL FEATURES INCLUDE:
* 1 AVERAGE VALUE, TIME AND FREQUENCY DOMAIN PERFORMANCE
* 2 OUTPUT RESISTANCE FOR 100 DEGREE C JUNCTIONS
* 3 CURRENT SENSE PIN OUTPUTS
* 4 VS LOADING DUE TO OUTPUT CURRENT ONLY
* 5 SYMBOL COMPATABILITY WITH THE PULSE BY PULSE MODEL
* 6 PIN NUMBERS CORRESPOND TO THE HARDWARE
* 7 AN INTERNAL FLAG SHOWS INPUT VOLTAGE OUTSIDE THE MODULATION RANGE
*
* WITH NO SWITCHING, THIS MODEL RUNS MANY TIMES FASTER THAN THE PULSE
* BY PULSE MODEL AND IT CAN RUN AN AC SWEEP, MAKING SIMULATION OF
* FEEDBACK LOOPS QUICK (RAISE OR ELIMINATE STEP CEILING).  
*
* BEWARE: LACK OF SWITCHING ELIMINATES SOME DISTORTION ELEMENTS FOUND
* IN THE PULSE BY PULSE MODEL AND THE HARDWARE. ALSO, LACK OF DEAD
* TIME ALLOWS LINEAR OPERATION ALL THE WAY TO 0 OR 100% MODULATION, 
* WHICH IS NOT POSSIBLE WITH THE HARDWARE.
* 
*BEGIN MODEL SA50TOOL FOR PSPICE.
*PIN ORDER RSENB BOUT VS AOUT RSENSA VCC GND INPUT
*PINOUT      1     2   3   4     5    6   7    8 
.SUBCKT SA50TOOL_AM 1 2 3 4 5 6 7 8 
* DIVIDE VCC BY 3, FIND HIGH, LOW AND P-P RAMP VALUES
R120 6 101 1K 
R121 101 102 1K 
R122 102 0 1K 
E124 124 0 101 102 1 
E123 123 0 101 0 1 
E125 125 0 102 0 1 
* S123 & S125 LIMIT MODULATOR DRIVE TO 0/100%
S123 129 123 8 123 SM1 
S125 125 129 125 8 SM1 
R129 8 129 10K 
.MODEL SM1 VSWITCH (RON=1 ROFF=100MEG VON=.001 VOFF=-.001)
* E119 SHOWS ONLY INTEGRATOR VOLTAGE OUTSIDE MODULATION RANGE
E119 128 0 129 8 -1 
* 130 SERIES PARTS ARE THE NON-INVERTING OUT, 140 ARE INVERTING
* E130 & E140 GIVE MODULATION VOLTAGES; 0=0 OUT, VP-P=VS OUT
E130 130 0 129 125 1 
E140 140 0 123 129 1 
* E131 & E141 GENERATE OUTPUTS; V(MODULATE)*PWM GAIN [VS/VP-P]
E141 141 0 VALUE={V(140)*V(3)/V(124)} 
E131 131 0 VALUE={V(130)*V(3)/V(124)} 
* R132 & 142 SET ZOUT (ABOUT 100DEGREES C) AND MEASURE IOUT
R132 131 4 .387 
R142 141 2 .387 
* E132 & E142 SENSE OUTPUT CURRENT & MULTIPLY BY FRACTION OF MODULATION
* FRACTION IS 0 @ VOUT=0 AND 1 @ VOUT=VS
E132 135 0 VALUE={(V(131)-V(4))*V(130)/V(124)} 
E142 145 0 VALUE={(V(141)-V(2))*V(140)/V(124)} 
* G135 & G145 REFLECT OUTPUT CURRENT INTO VSENSE PINS
G135 201 0 135 0 -2.584
G145 205 0 145 0 -2.584
V135 201 1 0 
V145 205 5 0 
* F135 & F145 REFLECT CURRENT INTO VS PIN
F135 3 0 V135 1 
F145 3 0 V145 1 
* 
R7 7 0 1meg 
* CATCH DIODES-FILTER/LOAD PHASE SHIFT CAN MAKE CURRENT FLOW BACKWARDS
D130 4 3 D1M 
D131 0 4 D1M 
D140 2 3 D1M 
D141 0 2 D1M 
.MODEL D1M D (IS=2.832E-12 M=0.333 N=1.00 RS=0.043 VJ=0.75)
*
D120 8 6 D1N4148 
D121 0 8 D1N4148
.MODEL D1N4148  D(IS=0.1P RS=16 CJO=2P TT=12N BV=100 IBV=0.1P)  
.ENDS
*END OF MODEL SA50TOOL
**********
*       SA51 PWM MODEL FEATURES INCLUDE:
*
*  1 PULSE BY PULSE TIME DOMAIN PERFORMANCE
*  2 OUTPUT RESISTANCE AND CAPACITANCE
*  3 ACCURATE RON TEMPERATURE COEFFICIENT
*  4 INCREASING IQ ON THE VS SUPPLY VS FREQUENCY
*  5 DEADTIME BETWEEN SWITCH ON TIMES
*  6 ACCURATE IQ ON THE VCC LINE
*  7 DISABLE FUNCTION
*
*
*       SOME NOTES ON USING SPICE FOR PWM SIMULATION
*
*  REQUIRES BERKELEY SPICE 3E.3P OR LATER. YOUR SIMULATOR
*  MUST SUPPORT THE BERKELEY STANDARD VOLTAGE CONTROLLED
*  SWITCH ELEMENT (S)
*  OR
*  REQUIRES PSPICE 4.04 OR LATER
*
*  BE PREPARED FOR LONG SIMULATIONS
*
*  NOTE: BERKELEY SIMULATORS TYPICALLY RUN THESE
*  PWM MODELS ABOUT TWO TO FOUR TIMES FASTER THAN
*  PSPICE TYPE SIMULATORS AS THE BERKELEY SWITCH
*  ELEMENT DOES NOT INVOKE AS BIG A COMPUTATIONAL
*  BURDEN
*
*  IF YOUR SIMULATION STOPS DUE TO "TIMESTEP TOO SMALL"
*  ERRORS YOU MAY WANT TO INCREASE ITL4 TO 100, INCREASE
*  RELTOL TO 0.003 TO 0.01, INCREASE ABSTOL TO 1E-11 TO
*  1E-9, INCREASE GMIN TO 1E-11 TO 1E-7, INCREASE VNTOL
*  TO 1E-5 TO 1E-4, OR INCREASE CHGTOL TO 1E-11 TO 1E-9.
*  ANY OR ALL OF THESE SIMULATOR OPTIONS MAY BE REQUIRED
*  DEPENDING ON YOUR SIMULATOR. NEWER SIMULATORS USUALLY
*  REQUIRE FEWER OF THEM.
*
*  TO AID THE INITIAL DC CONVERGANCE SET ITL1 TO 500.
*
*  TO AID TRANSIENT INITIAL CONVERGANCE, YOU MAY WANT
*  TO ADJUST THE INITIAL STATE OF THE INPUT.
*  NOTE THAT BOTH THE FOLLWING STATEMENTS GIVE THE
*  SAME DUTY FACTOR BUT HAVE OPPOSITE INITIAL VALUES.
*
*  VIN XX XX 0 PULSE 0 5 1U 50N 50N 1.5U 2U
*  VIN XX XX 5 PULSE 5 0 1U 50N 50N 0.5U 2U
*
*  A GOOD WAY TO TEST SIMULATION ACCURACY IS TO FIX THE
*  PWM CLOCK INPUT TO A 75 PERCENT DUTY FACTOR AND RUN
*  A SIMULATION THAT HAS TIME FOR OUTPUT FILTER SETTLING.
*  IF THE OUTPUT VOLTAGE WANDERS AROUND RATHER THAN STAY
*  SETTLED TO LESS THAN ONE PERCENT YOU SHOULD REDUCE
*  THE TIMESTEP MAX (TMAX) PARAMETER IN THE TRAN LINE.
*  THIS IS THE FOURTH TIME PARAMETER ON THAT LINE AND IS
*  OPTIONAL LIKE THE TSTART PARAMETER (THIRD TIME
*  PARAMETER ON THAT LINE). IF YOU ARE NOT USING TSTART
*  YOU MUST SET IT TO ZERO SO THE SIMULATOR WILL RECOGNIZE
*  TMAX AS TMAX RATHER THAN TSTART. FOR BERKELEY SPICE 3
*  TMAX WILL USUALLY BE IN THE 500 TO 150 NS RANGE. FOR
*  PSPICE TMAX WILL USUALLY BE IN THE 250 TO 50 NS RANGE.
*
*  BECAUSE THE SPICE OUTPUT DATA IS A SAMPLED SYSTEM,
*  ALIASING CAN TAKE PLACE. IF THE WAVEFORM YOU ARE
*  LOOKING AT IS REPETATIVE BUT SEEMS TO HAVE INADEQUATE
*  P-P AMPLITUDE, YOU MAY WANT TO SAMPLE THE DATA MORE
*  OFTEN OR CHANGE THE RATIONALITY BETWEEN THE PWM CLOCK
*  PERIOD AND YOUR SAMPLING PERIOD.
*
*  IF YOUR SIMULATION CANNOT GET PAST INITIAL CONVERGANCE
*  FOR THE TRANSIENT ANALYSIS, RAMP VCC AND VS UP FROM
*  ZERO VOLTS TO NORMAL IN THE FIRST 10 MICROSECONDS OR SO.
*  THIS WILL NOT ONLY HELP THE TRAN ANALYSIS GET STARTED
*  BUT WILL ALLOW YOU TO SEE THE INITIAL VOLTAGES AND
*  CURRENTS FOR LATER SETTING OF NODESETS. LOOK FOR
*  OUTPUT FILTER INDUCTOR CURRENTS AND CAPACITOR VOLTAGES
*  TO ALLOW SETTING UP INITIAL CONDITIONS ON THOSE PARTS.
*  SETTING INITIAL CONDITIONS CAN ALLOW YOUR OUTPUT FILTER
*  TO GET TO OPERATING CONDITIONS MORE QUICKLY. DON'T
*  FORGET TO USE THE UIC OPTION IN THE TRAN LINE TO FORCE
*  USE OF INITIAL CONDITIONS.
*
*BEGIN MODEL SA51 FOR PSPICE
*PINOUT ORDER IS +VS BOUT VCC DIS GND IN AOUT RSEN
*PINOUT           1    2   3   4   5   6   7    8
.SUBCKT SA51_AM 1 2 3 4 5 6 7 8
E1 14 5 15 30 1
RE2 26 5 1E9
D5 8 7 D1M
S1 1 27 59 5 S1M
S2 1 48 22 5 S1M
S3 7 47 59 5 S1M
S4 2 21 22 5 S1M
S5 19 13 14 5 S5M
R5 30 5 15E3
R1 48 7 R1M 0.25
R2 27 2 R1M 0.25
R3 47 8 R1M 0.25
R4 21 8 R1M 0.25
R25 29 5 1
S7 50 42 32 22 S7M
V2 31 5 10
S8 50 29 22 32 S7M
S9 56 19 45 5 S9M
G1 5 3 10 5 0.36
V14 49 5 5
S10 45 5 4 5 S10M
V8 32 5 2.5
R36 16 15 1E3
R15 24 30 105E3
D1 7 1 D1M
Q1 4 46 3 QPU
C8 30 5 0.01E-6
D6 8 2 D1M
D7 2 1 D1M
Q2 6 25 24 QPU
I2 25 24 10E-9
C4 1 34 75E-12
C5 1 37 75E-12
C6 7 35 75E-12
C7 2 33 75E-12
R16 6 23 3E3
R10 34 7 2.8
R12 35 8 2.8
R18 37 2 2.8
R20 33 8 2.8
R37 15 13 143E9
C15 23 5 10E-12
E2 5 60 26 13 -1
V11 26 5 4.5
I3 3 5 0.0026
C9 30 5 10E-12
E3 16 5 23 5 1
R13 23 5 1E6
R39 28 59 10E3
R14 30 5 1E6
C10 51 5 2000E-12
R27 50 51 10
I1 46 3 1E-6
C12 4 5 10E-12
I4 1 5 0.011
R19 13 5 10
R28 31 42 1
V13 56 5 5
R26 49 45 100
E13 53 5 42 31 1
R29 53 10 300
C11 10 5 1E-6
G2 5 1 10 5 14
E14 24 5 3 5 1
R42 5 14 1E9
R30 1 5 6700
R31 3 5 1795
R45 10 5 1E9
C13 59 5 23.3E-12
R46 13 22 10E3
C14 22 5 23.3E-12
D2 22 13 D2M
R35 19 5 1E9
D3 59 28 D2M
S6 60 28 45 5 S9M
RA1 60 0 1E9
RA3 28 5 10
.MODEL QPU PNP
.MODEL R1M RES (TC1=7.374E-3 TC2=2.598E-5)
.MODEL S1M VSWITCH RON=0.01 ROFF=1E6 VON=2.55 VOFF=2.0
.MODEL S5M VSWITCH RON=1 ROFF=1E3 VON=0.001 VOFF=0
.MODEL S7M VSWITCH RON=1 ROFF=1E5 VON=0.1 VOFF=0
.MODEL S9M VSWITCH RON=0.1 ROFF=1E3 VON=2.91 VOFF=2.5
.MODEL S10M VSWITCH RON=1 ROFF=1E3 VON=1.1 VOFF=1
.MODEL D1M D (IS=4.5E-14 M=0.333 N=1.00 RS=0.112 VJ=0.75)
.MODEL D2M D (IS=1.68E-12 M=0.333 N=1.89 RS=0.452 VJ=0.75)
.ENDS
*END OF MODEL SA51
**********
*       SA60 PWM MODEL FEATURES INCLUDE:
*
*  1 PULSE BY PULSE TIME DOMAIN PERFORMANCE
*  2 OUTPUT RESISTANCE AND CAPACITANCE
*  3 ACCURATE RON TEMPERATURE COEFFICIENT
*  4 INCREASING IQ ON THE VS SUPPLY VS FREQUENCY
*  5 DEADTIME BETWEEN SWITCH ON TIMES
*  6 ACCURATE IQ ON THE VCC LINE
*
*       SOME NOTES ON USING SPICE FOR PWM SIMULATION
*
*  REQUIRES BERKELEY SPICE 3E.3P OR LATER. YOUR SIMULATOR
*  MUST SUPPORT THE BERKELEY STANDARD VOLTAGE CONTROLLED
*  SWITCH ELEMENT (S)
*  OR
*  REQUIRES PSPICE 4.04 OR LATER
*
*  BE PREPARED FOR LONG SIMULATIONS.
*
*  NOTE: BERKELEY SIMULATORS TYPICALLY RUN THESE
*  PWM MODELS ABOUT TWO TO FOUR TIMES FASTER THAN
*  PSPICE TYPE SIMULATORS AS THE BERKELEY SWITCH
*  ELEMENT DOES NOT INVOKE AS BIG A COMPUTATIONAL
*  BURDEN
*
*  IF YOUR SIMULATION RUNS INTO TIMESTEP TOO SMALL
*  PROBLEMS YOU MAY WANT TO INCREASE ITL4 TO 100,
*  RELTOL TO 0.003 TO 0.01, ABSTOL TO 1E-9 TO 1E-11,
*  GMIN TO 1E-7 TO 1E-11, VNTOL TO 1E-4 TO 1E-5,
*  OR CHGTOL TO 1E-9 TO 1E-11.
*
*  A GOOD WAY TO TEST SIMULATION ACCURACY IS TO FIX THE
*  PWM SIGNAL INPUT TO A FIXED VOLTAGE THAT IS EQUIVALENT
*  TO HALFWAY BETWEEN 50-50 DUTY FACTOR AND 100 PERCENT
*  DUTY FACTOR. RUN A SIMULATION THAT HAS TIME FOR OUTPUT
*  FILTER SETTLING. IF THE OUTPUT VOLTAGE WANDERS AROUND
*  RATHER THAN STAYS SETTLED TO LESS THAN ONE PERCENT YOU
*  SHOULD REDUCE THE TIMESTEP MAX (TMAX) PARAMETER IN THE
*  TRAN LINE. THIS IS THE FOURTH TIME PARAMETER ON THAT
*  LINE AND IS OPTIONAL LIKE THE TSTART PARAMETER (THIRD
*  TIME PARAMETER ON THAT LINE). IF YOU ARE NOT USING
*  TSTART YOU MUST SET IT TO ZERO SO THE SIMULATOR WILL
*  RECOGNIZE TMAX AS TMAX RATHER THAN TSTART. FOR BERKELEY
*  SPICE 3 TMAX WILL USUALLY BE IN THE 250 TO 150 NS RANGE.
*  FOR PSPICE TMAX WILL USUALLY BE IN THE 100 TO 50 NS
*  RANGE.
*
*  BECAUSE THE SPICE OUTPUT DATA IS A SAMPLED SYSTEM,
*  ALIASING CAN TAKE PLACE. IF THE WAVEFORM YOU ARE
*  LOOKING AT IS REPETATIVE BUT SEEMS TO HAVE INADEQUATE
*  P-P AMPLITUDE, YOU MAY WANT TO SAMPLE THE DATA MORE
*  OFTEN OR CHANGE THE RATIONALITY BETWEEN THE PWM CLOCK
*  PERIOD AND YOUR SAMPLING PERIOD.
*
*  IF YOUR SIMULATION CANNOT GET PAST INITIAL CONVERGENCE
*  FOR THE TRANSIENT ANALYSIS, RAMP VCC AND VS UP FROM
*  ZERO VOLTS TO NORMAL IN THE FIRST MICROSECOND OR SO.
*  THIS WILL NOT ONLY HELP THE TRAN ANALYSIS GET STARTED
*  BUT WILL ALLOW YOU TO SEE THE INITIAL VOLTAGES FOR LATER
*  SETTING OF NODESETS. FURTHER INTO THE ANALYSIS LOOK FOR
*  OUTPUT FILTER INDUCTOR CURRENTS AND CAPACITOR VOLTAGES
*  TO ALLOW SETTING UP INITIAL CONDITIONS ON THOSE PARTS.
*  SETTING INITIAL CONDITIONS CAN ALLOW YOUR OUTPUT FILTER
*  TO GET TO OPERATING CONDITIONS MORE QUICKLY. DON'T
*  FORGET TO USE THE UIC OPTION IN THE TRAN LINE TO FORCE
*  USE OF INITIAL CONDITIONS.
*
*BEGIN MODEL SA60 FOR PSPICE
*PINOUT ORDER IS AGND CF DIS ANAIN GND VCC ISENA AOUT VS BOUT ISENB
*PINOUT            1   2  3    4    6   7    8     9  10  11    12
* NOTE THAT YOUR EXTERNAL CF SHOULD HAVE IC=0 (INITIAL CONDITION)
.SUBCKT SA60_AM 1 2 3 4 6 7 8 9 10 11 12
E1 14 1 15 2 1
D5 8 9 D1M
R25 21 6 1
V2 31 6 10
V14 49 6 5
S3 19 13 14 1 PSW3
V8 32 6 2.5
RV8 32 6 1E9
R36 4 15 1E3
R5 16 24 1E3
D1 9 10 D1M
Q1 3 46 7 QPU
R21 24 25 1.91E3
D6 12 11 D1M
D7 11 10 D1M
E9 16 1 27 1 0.5
RA2 27 0 1E9
R22 2 23 49E3
C4 10 34 150E-12
C5 10 37 150E-12
C6 9 35 150E-12
C7 11 33 150E-12
R10 34 9 1.4
C9 2 1 47.4E-12 IC=0
R12 35 8 1.4
R18 37 11 1.4
R20 33 12 1.4
R1 48 9 RM1 0.16
R2 5 11 RM1 0.16
R3 47 8 RM1 0.16
R4 39 12 RM1 0.16
R37 15 13 143E9
E2 6 60 26 13 -1
RE2 26 0 1E9
V11 26 1 4.5
S4 50 21 22 32 PSW4
R39 28 59 10E3
S5 50 42 32 22 PSW4
C10 51 6 2E-9
R27 50 51 10
I1 46 7 1E-6
C12 3 6 10E-12
S12 23 1 57 24 PSW12
R24 27 23 2.575E3
E11 55 1 23 1 1
V1 55 25 -0.1
R19 13 6 10
V10 57 2 -0.01
CX10 23 1 4E-12
RV10 57 1 1E9
R28 31 42 1
V13 56 6 5
S15 10 48 59 6 PSW15
S16 10 5 22 6 PSW15
S17 9 47 22 6 PSW15
S18 11 39 59 6 PSW15
S19 45 6 3 6 PSW19
R26 49 45 1
E13 53 6 42 31 1
R29 53 54 300
C11 54 6 1E-6
G2 6 10 54 6 28
E14 27 1 7 1 1
R42 1 14 1E9
R30 10 6 9330
R31 7 1 454
R44 55 1 1E9
R45 54 6 1E9
C13 59 6 28E-12
R46 13 22 10E3
C14 22 6 28E-12
D2 22 13 D2M
S1 56 19 45 6 PSW1
S6 60 28 45 6 PSW1
RA1 60 0 1E9
RA3 28 6 10
R35 19 6 1E9
D3 59 28 D2M
.MODEL QPU PNP (BF=100 NE=1.5 EG=1.11
+ IS=1.5E-15 NC=1.7 FC=0.5 CJC=1E-12)
.MODEL RM1 RES (TC1=7.374E-3 TC2=2.598E-5)
.MODEL PSW1 VSWITCH RON=0.01 ROFF=1E3 VON=2.91 VOFF=2.5
.MODEL PSW3 VSWITCH RON=1 ROFF=1E3 VON=0.001 VOFF=0
.MODEL PSW4 VSWITCH RON=1 ROFF=1E5 VON=2 VOFF=0
.MODEL PSW12 VSWITCH RON=10 ROFF=1E6 VON=0.001 VOFF=0
.MODEL PSW15 VSWITCH RON=0.01 ROFF=1E6 VON=2.55 VOFF=2.0
.MODEL PSW19 VSWITCH RON=1 ROFF=1E3 VON=1.5 VOFF=1
.MODEL D1M D (IS=9E-14 M=0.333 N=1.00 RS=0.056 VJ=0.75)
.MODEL D2M D (IS=1.68E-08 M=0.333 N=1.89 RS=0.5 VJ=0.75)
.ENDS
* END MODEL SA60 FOR PSPICE
*************
*     SA60TOOL STATE AVERAGE PWM MODEL FEATURES INCLUDE:
* 1 AVERAGE VALUE, TIME AND FREQUENCY DOMAIN PERFORMANCE
* 2 OUTPUT RESISTANCE FOR 100 DEGREE C JUNCTIONS
* 3 CURRENT SENSE PIN OUTPUTS
* 4 VS LOADING DUE TO OUTPUT CURRENT ONLY
* 5 SYMBOL COMPATABILITY WITH THE PULSE BY PULSE MODEL
* 6 PIN NUMBERS CORRESPOND TO THE HARDWARE
* 7 A FLAG OUTPUT SHOWS INPUT VOLTAGE OUTSIDE THE MODULATION RANGE
*
* WITH NO SWITCHING, THIS MODEL RUNS MANY TIMES FASTER THAN THE PULSE
* BY PULSE MODEL AND IT CAN RUN AN AC SWEEP, MAKING SIMULATION OF
* FEEDBACK LOOPS QUICK (RAISE OR ELIMINATE STEP CEILING).  
*
* BEWARE: LACK OF SWITCHING ELIMINATES SOME DISTORTION ELEMENTS FOUND
* IN THE PULSE BY PULSE MODEL AND THE HARDWARE. ALSO, LACK OF DEAD
* TIME ALLOWS LINEAR OPERATION ALL THE WAY TO 0 OR 100% MODULATION, 
* WHICH IS NOT POSSIBLE WITH THE HARDWARE.
* 
* THE DISABLE FUNCTION IS NOT MODELED.
*
*BEGIN MODEL SA60TOOL FOR PSPICE.
*PIN ORDER AGND PWM DISABLE ANAIN PGND VCC ISENSA AOUT VS BOUT ISENB
*PINOUT      1   2     3      4     6   7     8     9  10  11    12
.SUBCKT SA60TOOL_AM 1 2 3 4 6 7 8 9 10 11 12
* DIVIDE VCC BY 3, FIND HIGH, LOW AND P-P RAMP VALUES
R120 7 101 1K 
R121 101 102 1K 
R122 102 0 1K 
E124 124 0 101 102 1 
E123 123 0 101 0 1 
E125 125 0 102 0 1 
* S123 & S125 LIMIT MODULATOR DRIVE TO 0/100%
S123 129 123 4 123 SM1 
S125 125 129 125 4 SM1 
R129 4 129 10K 
.MODEL SM1 VSWITCH (RON=1 ROFF=100MEG VON=.001 VOFF=-.001)
* E119 SHOWS ONLY INTEGRATOR VOLTAGE OUTSIDE MODULATION RANGE
E119 128 0 129 4 -1 
R128 128 3 10 
R3 3 0 1meg 
* 130 SERIES PARTS ARE THE NON-INVERTING OUT, 140 ARE INVERTING
* E130 & E140 GIVE MODULATION VOLTAGES; 0=0 OUT, VP-P=VS OUT
E130 130 0 129 125 1 
E140 140 0 123 129 1 
* E131 & E141 GENERATE OUTPUTS; V(MODULATE)*PWM GAIN [VS/VP-P]
E141 141 0 VALUE={V(140)*V(10)/V(124)} 
E131 131 0 VALUE={V(130)*V(10)/V(124)}
* R132 & 142 SET ZOUT (ABOUT 100DEGREES C) AND MEASURE IOUT
R132 131 11 .32 
R142 141 9 .32 
* E132 & E142 SENSE OUTPUT CURRENT & MULTIPLY BY FRACTION OF MODULATION
* FRACTION IS 0 @ VOUT=0 AND 1 @ VOUT=VS
E132 135 0 VALUE={(V(131)-V(11))*V(130)/V(124)} 
E142 145 0 VALUE={(V(141)-V(9))*V(140)/V(124)} 
* G135 & G145 REFLECT OUTPUT CURRENT INTO VSENSE PINS
G135 208 0 135 0 -3.125 
G145 212 0 145 0 -3.125 
V135 208 8 0 
V145 212 12 0 
* F135 & F145 REFLECT CURRENT INTO VS PIN
F135 10 0 V135 1 
F145 10 0 V145 1 
* 
R1 1 0 1meg 
R2 2 0 1meg 
R4 4 0 1meg 
R6 6 0 1meg 
* CATCH DIODES-FILTER/LOAD PHASE SHIFT CAN MAKE CURRENT FLOW BACKWARDS
D130 11 10 D1M 
D131 0 11 D1M 
D140 9 10 D1M 
D141 0 9 D1M 
.MODEL D1M D (IS=2.832E-12 M=0.333 N=1.00 RS=0.043 VJ=0.75)
*
D120 4 7 D1N4148 
D121 0 4 D1N4148
.MODEL D1N4148  D(IS=0.1P RS=16 CJO=2P TT=12N BV=100 IBV=0.1P)  
.ENDS
*END OF MODEL SA60TOOL
**********
* FREQUENCY DIVIDER
* USE AT VDD = 5 VOLTS  VSS = 0 VOLTS
* INPUT SWING CAN BE AS LITTLE
* AS 0.9 TO 3.7 VOLTS BUT 0 TO 5
* ALLOWS FASTER EXECUTION
* OUTPUT SWING IS 5 VOLTS
*BEGIN MODEL FREQUENCY DIVIDE BY 2
*FOR BERKELEY SPICE AND PSPICE
*PINOUT ORDER IS IN OUT VDD VSS
*PINOUT           1  2   3   4
.SUBCKT FDIV_AM 1 2 3 4
M1 9 11 3 3 FMP
M2 10 12 9 3 FMP
M3 10 12 4 4 FMN
M4 10 11 4 4 FMN
M5 15 16 3 3 FMP
M6 12 17 15 3 FMP
M7 12 17 4 4 FMN
M8 12 16 4 4 FMN
M9 21 2 3 3 FMP
M10 17 16 21 3 FMP
M11 17 16 4 4 FMN
M12 17 2 4 4 FMN
M13 27 11 3 3 FMP
M14 2 17 27 3 FMP
M15 2 17 4 4 FMN
M16 2 11 4 4 FMN
M17 33 1 3 3 FMP
M18 11 10 33 3 FMP
M19 11 10 4 4 FMN
M20 11 1 4 4 FMN
M21 20 12 3 3 FMP
M22 20 12 4 4 FMN
M23 40 11 3 3 FMP
M24 40 11 4 4 FMN
M25 19 1 3 3 FMP
M26 19 1 4 4 FMN
M27 47 19 3 3 FMP
M28 47 40 3 3 FMP
M29 47 20 3 3 FMP
M30 47 19 50 4 FMN
M31 50 40 51 4 FMN
M32 51 20 4 4 FMN
M33 16 47 3 3 FMP
M34 16 47 4 4 FMN
RC1 1 4 1E15
RC2 2 4 1E15
RC3 3 4 1E15
C1 4 16 1E-12
.MODEL FMP PMOS (CBD=4E-12 CBS=4E-12
+ IS=30E-15 KP=2E-3 VTO=-3.0)
.MODEL FMN NMOS (CBD=4E-12 CBS=4E-12
+ IS=30E-15 KP=2E-3 VTO=3.5)
.ENDS
*END OF MODEL FDIV
************

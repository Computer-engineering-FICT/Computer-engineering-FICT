Доработано на задание(последний блок WRITE независим, как раз он и связан с доп заданием)